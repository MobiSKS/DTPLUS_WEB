@model HPCL.Common.Models.ViewModel.Customer.CustomerCardInfo
@using HPCL.Common.Resources
@{
    ViewData["Title"] = "Add Customer Card Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<div class="row w-100">

    <div class="col-lg-12">
        <div class="bg-white p-2 p-md-4">
            <h5>Add Card</h5>
            <form name="addCustomerCardsForm" method="post" asp-action="AddCardDetails" class="w-100">
                <div class="w-100">
                    <div class="col-lg-12 col-md-12 col-12 pl-0 pr-md-2 pr-0 py-2">
                        <div class="border-1 rounded border-grey">
                            <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Add New Card</p>
                            <div class="alert alert-danger alert-cust-success" id="dvRemarks" style="@(Model.Remarks=="" ? "display:none":"display:block")">
                                @Html.DisplayFor(m => m.Remarks)
                            </div>
                            <div class="py-3 px-0 px-md-2">

                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-0">
                                            <label class="font-weight-normal col-md-5 col-12">Customer Ref No. <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.CustomerReferenceNo, new { @id = "CustomerReferenceNo", @class = "form-control", maxlength = "10" })
                                                <span class="error" id="CustomerReferenceNo_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center justify-content-start flex-wrap mb-0">
                                            <div class="col-12 col-md-auto">
                                                <button class="btn btn_primary px-4 py-2" id="btnSearch">@Label.Search</button>
                                            </div>
                                            <div class="col-12 col-md-auto">
                                                <button class="btn btn_primary px-4 py-2" type="button" id="btnHeaderReset">@Label.Reset</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">Customer Name <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.CustomerName, new { @id = "CustomerName", @class = "form-control", @readonly = "readonly" })
                                                <span class="error" id="CustomerName_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">Form Number <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.FormNumber, new { @id = "FormNumber", @class = "form-control", @readonly = "readonly" })
                                                <span class="error" id="FormNumber_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">No of Cards <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.NoOfCards, new { @id = "NoOfCards", @class = "form-control", maxlength = "4", onkeypress = "return isNumberKey(event)", autocomplete = "off" })
                                                <span class="error" id="NoOfCards_error"></span>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12" id="lblNoOfVehicles" style="display:none;">No Of Vehicles (For All Cards) <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.NoOfVehiclesAllCards, new { @id = "NoOfVehiclesAllCards", @class = "form-control", maxlength = "4", onkeypress = "return isNumberKey(event)", @style = "display:none", autocomplete = "off" })
                                                <span class="error" id="NoOfVehiclesAllCards_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center justify-content-center flex-wrap mb-3 mt-3">
                                    <div class="col-md-3 col-12 d-flex align-items-center justify-content-center">
                                        <div class="pr-2 w-50">
                                            <button class="btn btn_primary px-4 py-2" onclick="LoadCardDeatils()" type="button">Add</button>
                                        </div>
                                        <div class="pl-2 w-50">
                                            <button class="btn btn_primary px-4 py-2" type="button" onclick="ClearCardDeatils()">Reset</button>
                                        </div>
                                    </div>
                                    <span class="error" id="VehicleNo_error"></span>
                                </div>
                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">RBE ID </label> @*<sup class="text-danger">*</sup>*@
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.RBEId, new { @id = "RBEId", @class = "form-control" })
                                                <span class="error" id="RBEId_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12 mb-3">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">RBE Name </label> @*<sup class="text-danger">*</sup>*@
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.RBEName, new { @id = "RBEName", @class = "form-control", @readonly = "readonly" })
                                                <span class="error" id="RBEName_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="px-2 px-md-4">
                                    <fieldset class="border-1 rounded border-grey mb-3">
                                        <legend class="font-12 font-weight-bold d-inline-block w-auto ml-3 mb-0 px-2">Card Preference</legend>
                                        <div class="d-flex align-items-center justify-content-between flex-wrap pt-3">
                                            <div class="col-md-6 col-12">
                                                <div class="col-md-7 col-12 d-flex align-items-center justify-content-start">
                                                    <label class="d-flex align-items-center justify-content-start">
                                                        @Html.RadioButtonFor(m => m.CardPreference, "Card", new { @id = "rbtnCard" })
                                                        <span class="ml-2">Card</span>
                                                    </label>
                                                    <label class="d-flex align-items-center justify-content-start ml-3">
                                                        @Html.RadioButtonFor(m => m.CardPreference, "Cardless", new { @id = "rbtnCardless" })
                                                        <span class="ml-2">Cardless</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </fieldset>

                                    <fieldset class="border-1 rounded border-grey mb-4" id="divFeePaymentDetails">
                                        <legend class="font-12 font-weight-bold d-inline-block w-auto ml-3 mb-0 px-2">Fee Payment Details</legend>
                                        <div class="d-flex align-items-center justify-content-between flex-wrap pt-3">
                                            <div class="col-md-6 col-12">
                                                <div class="col-12">
                                                    <div class="d-flex align-items-center justify-content-start flex-wrap">
                                                        <label class="d-flex align-items-center justify-content-start mr-3">
                                                            @Html.RadioButtonFor(m => m.FeePaymentsCollectFeeWaiver, "1", new { id = "rbtnOnline", name = "FeePaymentsCollectFeeWaiver", @class = "radio-toolbar" })
                                                            <span>Online</span>
                                                        </label>
                                                        <label class="d-flex align-items-center justify-content-start">
                                                            @Html.RadioButtonFor(model => Model.FeePaymentsCollectFeeWaiver, "2", new { id = "rbtnFeeWaiver", name = "FeePaymentsCollectFeeWaiver", @class = "radio-toolbar" })
                                                            <span>Fee Waiver</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </fieldset>

                                </div>


                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12 mb-3">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12" id="lblChequeNo">Cheque No.<sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.FeePaymentNo, new { @id = "FeePaymentNo", @class = "form-control", autocomplete = "off" })
                                                <span class="error" id="FeePaymentNo_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12 mb-3">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12" id="lblChequeDate">Cheque Date<sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.FeePaymentDate, new { @id = "FeePaymentDate", @class = "form-control", autocomplete = "off" })
                                                <span class="error" id="FeePaymentDate_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12 mb-3">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12" id="lblReceivedAmount">Received Amount<sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.ReceivedAmount, new { @id = "ReceivedAmount", @class = "form-control", @readonly = "readonly" })
                                                <span class="error" id="FeePaymentNo_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12 mb-3">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            @*<label class="font-weight-normal col-md-5 col-12" id="lblChequeDate">Cheque Date<sup class="text-danger">*</sup></label>*@
                                            <div class="col-md-7 col-12">

                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="w-100">
                                    <div class=" table-responsive">
                                        <table class="table table-bordered text-nowrap" id="NoOfCardsTbl" style="display: none">
                                            @*<thead>
                            <tr>
                                <th>S No.</th>
                                <th>Card Identifier</th>
                                <th>Vehicle No.</th>
                                <th>Vehicle Type</th>
                                <th>Vehicle Make</th>
                                <th>Year of Reg.</th>
                            </tr>
                        </thead>*@
                                            <tbody id="cardDetails">
                                                @if ((@Model.CustomerTypeId == "905") || (@Model.CustomerTypeId == "909"))
                                                {
                                                    @for (int i = 0; i < Model.ObjCardDetail.Count; i++)
                                                    {
                                                        var j = i + 1;
                                                        <tr>
                                                            <td>
                                                                @j
                                                            </td>
                                                            <td>
                                                                @Html.TextBoxFor(m => m.ObjCardDetail[i].CardIdentifier)
                                                            </td>

                                                            <td>
                                                                @Html.TextBoxFor(m => m.ObjCardDetail[i].VechileNo)
                                                            </td>
                                                            <td>
                                                                @Html.DropDownListFor(m => m.ObjCardDetail[i].VehicleType, new SelectList(Model.VehicleTypeMdl, "VehicleTypeName", "VehicleTypeName"), new { @class = "form-control" })
                                                            </td>
                                                            <td>
                                                                @Html.TextBoxFor(m => m.ObjCardDetail[i].VehicleMake)
                                                            </td>
                                                            <td>
                                                                @Html.TextBoxFor(m => m.ObjCardDetail[i].YearOfRegistration)
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {
                                                    @for (int i = 0; i < Model.ObjCardDetail.Count; i++)
                                                    {
                                                        var j = i + 1;
                                                        <tr>
                                                            <td>
                                                                @j
                                                            </td>
                                                            <td>
                                                                @Html.TextBoxFor(m => m.ObjCardDetail[i].CardIdentifier)
                                                            </td>
                                                            <td>
                                                                @Html.DropDownListFor(m => m.ObjCardDetail[i].VehicleType, new SelectList(Model.VehicleTypeMdl, "VehicleTypeName", "VehicleTypeName"), new { @class = "form-control" })
                                                            </td>
                                                            <td>
                                                                @Html.TextBoxFor(m => m.ObjCardDetail[i].VehicleMake)
                                                            </td>
                                                            <td>
                                                                @Html.TextBoxFor(m => m.ObjCardDetail[i].YearOfRegistration)
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center justify-content-center flex-wrap mb-3 mt-5">
                            <div class="col-md-2 col-12 d-flex align-items-center justify-content-center">
                                <div class="pr-2 w-50">
                                    <button class="btn btn_primary px-4 py-2" id="btnsubmit" type="submit" onclick="return SubmitValidations()">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div style="display:none;">@Html.TextBoxFor(m => m.CustomerTypeId)</div>
                @Html.HiddenFor(model => Model.FeePaymentsCollectFeeWaiver)
                @Html.HiddenFor(model => Model.CardPreference)
            </form>
        </div>
    </div>


</div>

<script type="text/javascript">

    //$(document).ready(function () {
    //    $('input[name=FeePaymentsCollectFeeWaiver]').click(function () {
    //        if ($('input[name=FeePaymentsCollectFeeWaiver]:checked').val() == "1") {
    //            document.getElementById("CustomerReferenceNo_error").innerHTML = "";
    //        } else {
    //            $('#tab1').hide();
    //        }
    //    });
    //});

    var feePaymentDate = $("#FeePaymentDate").val();
    var notFoundError = "@ViewBag.NotFoundError";

    $(document).ready(function () {

        if (notFoundError == "") {
            if (feePaymentDate == "") {
                $("#FeePaymentDate").datepicker({
                    "setDate": new Date(),
                    "autoclose": true,
                    dateFormat: 'dd-mm-yy'
                });
                //setDates();
            }
            else {
                $("#FeePaymentDate").datepicker({ dateFormat: 'dd-mm-yy' });
            }

        }

        if (!document.getElementById("rbtnCard").checked && !document.getElementById("rbtnCardless").checked) {
            document.getElementById("rbtnCard").checked = true;
            document.getElementById("rbtnCardless").checked = false;
        }
       
    });

    function setDates() {
        var d = new Date();

        var month = d.getMonth() + 1;
        var day = d.getDate();
        var output = (day < 10 ? '0' : '') + day + '-' +
            (month < 10 ? '0' : '') + month + '-' +
            d.getFullYear();

        $("#FeePaymentDate").val(output);

    };


    $("#btnSearch").click(function () {
        debugger;

        var custRefNo = document.getElementById("CustomerReferenceNo").value;
        if (custRefNo == "") {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "Customer Reference No is required";
            $("#CustomerReferenceNo").focus;
            return (false);
        }
        else {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "";
        }

            $.ajax({
                type: 'POST',  // http method
                url: '@Url.Action("GetCustomerDetails", "Customer")',
                data: { customerReferenceNo: custRefNo },  // data to submit
                dataType: "json",
                success: function (data, status, xhr) {
                    console.log(data);
                    var v = data;
                    if (status == 'success') {
                        //$("#userNamediv").addClass("btmMargin");
                        //$("#userName_error").html("User Name Exists");
                        document.getElementById("CustomerName").value = data.customerName;
                        document.getElementById("FormNumber").value = data.formNumber;
                        document.getElementById("CustomerTypeId").value = data.customerTypeId;
                        document.getElementById("NoOfCardsTbl").deleteTHead();
                        $("#NoOfCardsTbl td").parent().remove();
                        var customerTypeId = document.getElementById("CustomerTypeId").value;
                        $("#CustomerReferenceNo").prop('readonly', true);
                        console.log(customerTypeId);
                        if (customerTypeId == "905" || customerTypeId == "909") {
                            $('#lblNoOfVehicles').show();
                            $('#NoOfVehiclesAllCards').show();
                        }
                        else {
                            $('#lblNoOfVehicles').hide();
                            $('#NoOfVehiclesAllCards').hide();
                        }
                        console.log(data.paymentType);

                        if (data.rbeId != "") {
                            document.getElementById("RBEId").value = data.rbeId;
                            document.getElementById("RBEName").value = data.rbeName;
                            $("#RBEId").prop('readonly', true);
                        }
                        else {
                            document.getElementById("RBEId").value = "";
                            document.getElementById("RBEName").value = "";
                            $("#RBEId").prop('readonly', false);
                        }

                        if (data.paymentType != "") {
                            document.getElementById("FeePaymentNo").value = data.paymentType;
                            document.getElementById("FeePaymentDate").value = data.paymentReceivedDate;
                            $("#FeePaymentNo").prop('readonly', true);
                            $("#FeePaymentDate").prop('readonly', true);

                            document.getElementById("rbtnCard").checked = true;
                            document.getElementById("rbtnCard").disabled = true;
                            document.getElementById("CardPreference").value = document.getElementById("rbtnCard").value;

                            document.getElementById("rbtnCardless").checked = false;
                            document.getElementById("rbtnCardless").disabled = true;

                            document.getElementById("rbtnOnline").checked = true;
                            document.getElementById("rbtnOnline").disabled = true;

                            document.getElementById("rbtnFeeWaiver").checked = false;
                            document.getElementById("rbtnFeeWaiver").disabled = true;

                            $('#lblChequeNo').text("Payment Source");
                            $('#lblChequeDate').text("Payment Date");
                            document.getElementById("NoOfCards").value = data.noOfCards;
                            $("#NoOfCards").prop('readonly', true);
                            document.getElementById("ReceivedAmount").value = data.receivedAmount;

                        }
                        else {
                            $("#rbtnOnline").prop('disabled', true);
                            document.getElementById("rbtnOnline").checked = false;
                            document.getElementById("rbtnCard").checked = false;
                            $("#rbtnCard").prop('disabled', false);
                            $("#FeePaymentNo").prop('readonly', false);
                            $("#FeePaymentDate").prop('readonly', false);
                            $('#lblChequeNo').text("Approval Email From");
                            $('#lblChequeDate').text("Approval Email Date");
                            document.getElementById("NoOfCards").value = "";
                            $("#NoOfCards").prop('readonly', false);
                            document.getElementById("ReceivedAmount").value = "";
                        }
                    }
                    else {
                        $("#CustomerReferenceNo_error").html("");
                        console.log(v);
                        document.getElementById("CustomerName").value = "";
                        document.getElementById("FormNumber").value = "";
                        document.getElementById("CustomerTypeId").value = "";
                        var customerTypeId = document.getElementById("CustomerTypeId").value;
                        $("#CustomerReferenceNo").prop('readonly', false);
                        console.log(customerTypeId);
                        if (customerTypeId == 905 || customerTypeId == 909) {
                            $('#lblNoOfVehicles').show();
                            $('#NoOfVehiclesAllCards').show();
                        }
                        else {
                            $('#lblNoOfVehicles').hide();
                            $('#NoOfVehiclesAllCards').hide();
                        }
                    }
                }
            });


    });


    $("#RBEId").on("blur", function () {
        //debugger;
         var custRBEId = document.getElementById("RBEId").value;
         if (custRBEId == "") {
             //document.getElementById("RBEId_error").innerHTML = "RBE Id is required";
             document.getElementById("RBEId_error").innerHTML = "";
             document.getElementById("RBEName").innerHTML = "";
             //$("#custRBEId").focus;
            return (false);
        }
        else {
             document.getElementById("RBEId_error").innerHTML = "";
        }

        //var found = false;

            $.ajax({
                type: 'POST',  // http method
                url: '@Url.Action("GetCustomerRBEName", "Customer")',
                data: { RBEId: custRBEId },  // data to submit
                dataType: "json",
                success: function (data, status, xhr) {
                    console.log(data);
                    console.log(status);
                    var v = data;
                    if (status == 'success') {
                        document.getElementById("RBEName").value = data.rbeName;
                        //found = true;

                        if (data == "Failed to load Customer Details")
                            document.getElementById("RBEName").value = "";
                    }
                    else {
                        $("#RBEId_error").html("");
                        document.getElementById("RBEName").value = "";
                        console.log(v);
                        //found = false;
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    document.getElementById("RBEName").value = "";
                },
                statusCode: {
                    1024: function () {
                        document.getElementById("RBEName").value = "";
                    }
                }
            });

        //alert(found);
        //if (found == false) {
        //    document.getElementById("RBEId_error").innerHTML = "RBE Id is not valid";
        //    $("#RBEId").focus;
        //    return (false);
        //}
        //else {
        //    document.getElementById("RBEId_error").innerHTML = "";
        //}

    });



    function LoadCardDeatils() {

        debugger;

        //if (document.getElementById("RBEId").value == "") {
        //    document.getElementById("RBEId_error").innerHTML = "RBE Id is required";
        //    //$("#RBEId").focus;
        //    return (false);
        //}
        //else {
        //    document.getElementById("RBEId_error").innerHTML = "";
        //}

        //if (document.getElementById("RBEName").value == "") {
        //    document.getElementById("RBEName_error").innerHTML = "RBE Name is not valid";
        //    //$("#RBEId").focus;
        //    return (false);
        //}
        //else {
        //    document.getElementById("RBEName_error").innerHTML = "";
        //}

        var noOfCards = document.getElementById("NoOfCards").value;
        if (noOfCards == "0" || noOfCards == "") {
            document.getElementById("NoOfCards_error").innerHTML = "No Of Cards is required";
            $("#NoOfCards").focus;
            return (false);
        }
        else {
            document.getElementById("NoOfCards_error").innerHTML = "";
        }


        var customerTypeId = document.getElementById("CustomerTypeId").value;
        var noOfVehiclesAllCards = document.getElementById("NoOfVehiclesAllCards").value;
        console.log(customerTypeId);
        if (customerTypeId == "905" || customerTypeId == "909") {
            if (noOfVehiclesAllCards == "0" || noOfVehiclesAllCards == "") {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No Of Vehicles (For All Cards) is required";
                $("#NoOfVehiclesAllCards").focus;
                return (false);
            }
            else {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
            }

            if (noOfCards > noOfVehiclesAllCards) {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No Of Vehicles (For All Cards) cannnot be less than No Of Cards";
                $("#NoOfVehiclesAllCards").focus;
                return (false);
            }
        }
        else {
            document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
        }

        $('#NoOfCards').attr("readonly", true);
        $('#NoOfVehiclesAllCards').attr("readonly", true);
        var selected = $("input[name='CardPreference']:checked").val();
        if (selected == "" || selected == undefined)
            selected = "Not Selected";
        console.log(selected);
        //var found = false;
        //var custRBEId = document.getElementById("RBEId").value;

        @*$.ajax({
            type: 'POST',  // http method
            url: '@Url.Action("GetCustomerRBEName", "Customer")',
            data: { RBEId: custRBEId },  // data to submit
            dataType: "json",
            success: function (data, status, xhr) {
                console.log(data);
                var v = data;
                if (status == 'success') {
                    found = true;
                }
                else {
                    found = false;
                }
            }
        });*@

        //if (found == false) {
        //    document.getElementById("RBEId_error").innerHTML = "RBE Id is not valid";
        //    //$("#RBEId").focus;
        //    return (false);
        //}
        //else {
        //    document.getElementById("RBEId_error").innerHTML = "";
        //}
        var customerTypeId = document.getElementById("CustomerTypeId").value;
        //console.log('Kiran');
        //console.log(customerTypeId);

        $.ajax({
            type: 'POST',  // http method
            url: '@Url.Action("GetVehicleTypeDetails", "Customer")',
            data: {},
            dataType: "json",
            success: function (data, status, xhr) {
                //debugger;

                var NoOfcards = $('#NoOfCards').val();
                $("#NoOfCardsTbl td").parent().remove();

                var NoOfVehicles = $('#NoOfVehiclesAllCards').val();

                //<option value="901">Fleet</option>
                //<option value="906">Credit</option>

                //<option value="905">Attached</option>
                //<option value="909">Generic</option>

                //<option value="902">Corporate</option>
                //<option value="917">Non Fleet</option>

                document.getElementById("NoOfCardsTbl").deleteTHead();

                if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic
                    if (selected.toUpperCase() == "CARDLESS") {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Card Identifier</th><th>Vehicle No.</th><th>Vehicle Type</th><th>Vehicle Make</th><th>Year of Reg.</th><th>Mobile No</th><th></th></tr></thead>');
                    }
                    else {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Card Identifier</th><th>Vehicle No.</th><th>Vehicle Type</th><th>Vehicle Make</th><th>Year of Reg.</th><th></th></tr></thead>');
                    }
                }
                else if (customerTypeId == "902" || customerTypeId == "917") {//Corporate,Non Fleet
                    if (selected.toUpperCase() == "CARDLESS") {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Card Identifier</th><th>Mobile No</th><th></th></tr></thead>');
                    }
                    else {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Card Identifier</th><th></th></tr></thead>');
                    }
                }
                else if (customerTypeId == "901" || customerTypeId == "906") {//Fleet,Credit
                    if (selected.toUpperCase() == "CARDLESS") {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Vehicle No</th><th>Vehicle Type</th><th>Vehicle Make</th><th>Year of Reg.</th><th>Mobile No</th><th></th></tr></thead>');
                    }
                    else {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Vehicle No</th><th>Vehicle Type</th><th>Vehicle Make</th><th>Year of Reg.</th><th></th></tr></thead>');
                    }
                }


                if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic

                    NoOfcards = NoOfVehicles;
                }


                for (var i = 0; i < parseInt(NoOfcards); i++) {
                    //var id = 'ddlVehicleType' + i;
                    var j = (i + 1);
                    var name = 'ObjCardDetail[' + (i) + '].VehicleType';
                    var id = 'ddlVehicleType' + i;

                    if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic

                        if (selected.toUpperCase() == "CARDLESS") {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='22' class='form - control' class='cardIdentifierInput' name='ObjCardDetail[" + (i) + "].CardIdentifier'> </span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='10' onkeydown='javascript: IsAlphaNumeric(this)' class='form - control' style='text-transform:uppercase' onchange='ValidateVehicleNo(this," + (i) + ")' name='ObjCardDetail[" + (i) + "].VechileNo'></span></td>"
                                + "<td><select id='" + id + "'class='vls' name='" + name + "'></select></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' name='ObjCardDetail[" + (i) + "].VehicleMake'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' name='ObjCardDetail[" + (i) + "].YearOfRegistration'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' maxlength='10' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].MobileNo'></span></td>"
                                + "<td class='rowData'><span class='error'></span></td></tr>";
                        }
                        else {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='22' class='form - control' class='cardIdentifierInput' name='ObjCardDetail[" + (i) + "].CardIdentifier'> </span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='10' onkeydown='javascript: IsAlphaNumeric(this)' class='form - control' style='text-transform:uppercase' onchange='ValidateVehicleNo(this," + (i) + ")' name='ObjCardDetail[" + (i) + "].VechileNo'></span></td>"
                                + "<td><select id='" + id + "'class='vls' name='" + name + "'></select></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' name='ObjCardDetail[" + (i) + "].VehicleMake'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' name='ObjCardDetail[" + (i) + "].YearOfRegistration'></span></td>"
                                + "<td class='rowData'><span class='error'></span></td></tr>";
                        }
                    }
                    else if (customerTypeId == "902" || customerTypeId == "917") {//Corporate,Non Fleet
                        if (selected.toUpperCase() == "CARDLESS") {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='22' class='form - control' class='cardIdentifierInput' name='ObjCardDetail[" + (i) + "].CardIdentifier'> </span></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control'  maxlength='10' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].MobileNo'></span></td>"
                                + "<td class='rowData'><span class='error'></span></td></tr>";
                        }
                        else {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='22' class='form - control' class='cardIdentifierInput' name='ObjCardDetail[" + (i) + "].CardIdentifier'> </span></td>"
                                + "<td class='rowData'><span class='error'></span></td></tr>";
                        }
                    }
                    else if (customerTypeId == "901" || customerTypeId == "906") {//Fleet,Credit

                        if (selected.toUpperCase() == "CARDLESS") {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='10' onkeydown='javascript: IsAlphaNumeric(this)' style='text-transform:uppercase' class='form - control' onchange='ValidateVehicleNo(this," + (i) + ")' name='ObjCardDetail[" + (i) + "].VechileNo'></span></td>"
                                + "<td><select id='" + id + "'class='vls' name='" + name + "'></select></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' name='ObjCardDetail[" + (i) + "].VehicleMake'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' name='ObjCardDetail[" + (i) + "].YearOfRegistration'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control'  maxlength='10' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].MobileNo'></span></td>"
                                + "<td class='rowData'><span class='error'></span></td></tr>";
                        }
                        else {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='10' onkeydown='javascript: IsAlphaNumeric(this)' style='text-transform:uppercase' class='form - control' onchange='ValidateVehicleNo(this," + (i) + ")' name='ObjCardDetail[" + (i) + "].VechileNo'></span></td>"
                                + "<td><select id='" + id + "'class='vls' name='" + name + "'></select></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' name='ObjCardDetail[" + (i) + "].VehicleMake'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form - control' name='ObjCardDetail[" + (i) + "].YearOfRegistration'></span></td>"
                                + "<td class='rowData'><span class='error'></span></td></tr>";
                        }
                    }

                    console.log(rows);

                    $('#NoOfCardsTbl').append(rows);
                    //console.log(document.getElementById(id));

                    $("#" + id).html("");
                    $.each(data.sortedtList, function (i, data) { // bind the dropdown list using json result
                        $('<option>',
                            {
                                value: data.vehicleTypeName,
                                text: data.vehicleTypeName
                            }).html(data.vehicleTypeName).appendTo("#" + id);
                    });
                }


            },
            error: function (jqXhr, textStatus, errorMessage) {
                alert("Error Populating VehicleTpeData Data");
            }


        });

        //  vehicleTypelst.append('</select >');


        document.getElementById('NoOfCardsTbl').style.display = 'table';
        // document.getElementById('NoOfCardsTbl').style.display = 'block';

        //$('#NoOfCards').attr("disabled", true);
        //$('#FeePaymentDate').attr("disabled", true);
        //$('#FeePaymentNo').attr("disabled", true);
        //$('#FeePaymentDate').attr("disabled", true);
    }

    function ClearCardDeatils() {

        //$('#NoOfCards').val('');
        //$('#FeePaymentDate').val('');
        // $('#FeePaymentNo').val('');
        $('#NoOfCardsTbl > tr').remove();
        document.getElementById('NoOfCardsTbl').style.display = 'none';


        $('#NoOfCards').attr("readonly", false);
        $('#NoOfVehiclesAllCards').attr("readonly", false);
        $('#FeePaymentDate').attr("readonly", false);
        $('#FeePaymentNo').attr("readonly", false);
    }


    function SubmitValidations() {
        debugger;


        if (document.getElementById("CustomerReferenceNo").value == "0" || document.getElementById("CustomerReferenceNo").value == "") {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "Customre Ref No is required";
            document.getElementById("CustomerReferenceNo").focus();
            return false;
        }
        else {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "";
        }

        if (document.getElementById("CustomerName").value == "0" || document.getElementById("CustomerName").value == "") {
            document.getElementById("CustomerName_error").innerHTML = "Customer Name is required";
            document.getElementById("CustomerName").focus();
            return false;
        }
        else {
            document.getElementById("CustomerName_error").innerHTML = "";
        }

        if (document.getElementById("FormNumber").value == "0" || document.getElementById("FormNumber").value == "") {
            document.getElementById("FormNumber_error").innerHTML = "Form Number is required";
            document.getElementById("FormNumber").focus();
            return false;
        }
        else {
            document.getElementById("FormNumber_error").innerHTML = "";
        }

        if (document.getElementById("NoOfCards").value == "0" || document.getElementById("NoOfCards").value == "") {
            document.getElementById("NoOfCards_error").innerHTML = "No of Cards is required";
            document.getElementById("NoOfCards").focus();
            return false;
        }
        else {
            document.getElementById("NoOfCards_error").innerHTML = "";
        }

        var customerTypeId = document.getElementById("CustomerTypeId").value;
        if (customerTypeId == "905" || customerTypeId == "909") {
            if (document.getElementById("NoOfVehiclesAllCards").value == "0" || document.getElementById("NoOfVehiclesAllCards").value == "") {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No Of Vehicles (For All Cards) is required";
                document.getElementById("NoOfVehiclesAllCards").focus();
                return false;
            }
            else {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
            }
        }


        //if (document.getElementById("RBEId").value == "0" || document.getElementById("RBEId").value == "") {
        //    document.getElementById("RBEId_error").innerHTML = "RBE Id is required";
        //    document.getElementById("RBEId").focus();
        //    return false;
        //}
        //else {
        //    document.getElementById("RBEId_error").innerHTML = "";
        //}

        //if (document.getElementById("RBEName").value == "0" || document.getElementById("RBEName").value == "") {
        //    document.getElementById("RBEName_error").innerHTML = "RBE Name is required";
        //    document.getElementById("RBEName").focus();
        //    return false;
        //}
        //else {
        //    document.getElementById("RBEName_error").innerHTML = "";
        //}

        if (document.getElementById("rbtnCard").checked) {

            if (document.getElementById("rbtnFeeWaiver").checked) {
                if (document.getElementById("FeePaymentNo").value == "0" || document.getElementById("FeePaymentNo").value == "") {
                    document.getElementById("FeePaymentNo_error").innerHTML = "Approval Email From is required";
                    document.getElementById("FeePaymentNo").focus();
                    return false;
                }
                else {
                    document.getElementById("FeePaymentNo_error").innerHTML = "";
                }

                if (document.getElementById("FeePaymentDate").value == "0" || document.getElementById("FeePaymentDate").value == "") {
                    document.getElementById("FeePaymentDate_error").innerHTML = "Approval Email Date is required";
                    document.getElementById("FeePaymentDate").focus();
                    return false;
                }
                else {
                    document.getElementById("FeePaymentDate_error").innerHTML = "";
                }
            }
        }

        if (document.getElementById("rbtnCard").checked) {

            if (document.getElementById("rbtnOnline").checked) {
                if (document.getElementById("FeePaymentNo").value == "0" || document.getElementById("FeePaymentNo").value == "") {
                    document.getElementById("FeePaymentNo_error").innerHTML = "Payment Source is required";
                    document.getElementById("FeePaymentNo").focus();
                    return false;
                }
                else {
                    document.getElementById("FeePaymentNo_error").innerHTML = "";
                }

                if (document.getElementById("FeePaymentDate").value == "0" || document.getElementById("FeePaymentDate").value == "") {
                    document.getElementById("FeePaymentDate_error").innerHTML = "Payment Date is required";
                    document.getElementById("FeePaymentDate").focus();
                    return false;
                }
                else {
                    document.getElementById("FeePaymentDate_error").innerHTML = "";
                }
            }
        }

        if (!(document.querySelector('input[name="CardPreference"]:checked'))) {
            alert("Card Preference Not Selected");
            return;
        }

        if (document.getElementById("rbtnCard").checked) {
            if (!(document.querySelector('input[name="FeePaymentsCollectFeeWaiver"]:checked'))) {
                alert("Fee Payment Details Not Selected");
                return false;
            }
        }

        var selectedCardType = $("input[name='CardPreference']:checked").val();
        document.getElementById("CardPreference").value = selectedCardType;
        console.log(selectedCardType);

        var selectedFeePayment = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val();
        document.getElementById("FeePaymentsCollectFeeWaiver").value = selectedFeePayment;
        console.log(selectedFeePayment);

        var count = $('#NoOfCardsTbl tr').length;

        //alert(count);

        if (count == 1) {
            alert("Vehicle Details Not Added");
            return false;
        }
        var DuplicateFound = false;
        console.log('Before Checking For Duplicate VehicleNo');
        $('#NoOfCardsTbl td:nth-child(2) input').filter(function () {
            var value = $(this).val();
            $('#NoOfCardsTbl td:nth-child(2) input').not(this).each(function () {
                if ($(this).val() == value) {
                    document.getElementById("VehicleNo_error").innerHTML = "Duplicate Vehicle Registration Number " + $(this).val() + " Found";
                    console.log('Found Duplicates');
                    console.log($(this).val());
                    DuplicateFound = true;
                    return false;
                }
            });
        });

        if (DuplicateFound) {
            return false;
        }

        return true;
    }


</script>

@if (Model != null)
{
    <script type="text/javascript">
    $(function () {
        debugger;
            if (@Model.Status== 1)
                alert("Card Created Successfully");
            @*else if (@Model.StatusCode== 1000)
                alert("Card Created Successfully");
            else if (@Model.StatusCode> 0 &&  @Model.StatusCode!=1000)
                alert(@ViewBag.Message);*@

            });
    </script>
}

<script language="javascript">
    $(document).ready(function () {

        $('input[name="FeePaymentsCollectFeeWaiver"]:radio').change(function () {
            //alert($("input[name='FeePaymentsCollectFeeWaiver']:checked").val());

            var selected = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val()
            //alert(selected);
            if (selected == "1") {
                $('#lblChequeNo').text("Payment Source");
                $('#lblChequeDate').text("Payment Date");
            }
            else if (selected == "2") {
                $('#lblChequeNo').text("Approval Email From");
                $('#lblChequeDate').text("Approval Email Date");
            }

        });

        $('input[name="CardPreference"]:radio').change(function () {
            //alert($("input[name='CardPreference']:checked").val());

            var selected = $("input[name='CardPreference']:checked").val()
            //alert(selected);
            if (selected == "Cardless") {
                $('#lblChequeNo').hide();
                $('#lblChequeDate').hide();
                $("#FeePaymentNo").val('');
                $("#FeePaymentDate").val('');
                $('#FeePaymentNo').hide();
                $('#FeePaymentDate').hide();
                $('#ReceivedAmount').hide();
                $('#divFeePaymentDetails').hide();
                $('#lblReceivedAmount').hide();
                document.getElementById("rbtnFeeWaiver").checked = false;
                document.getElementById("rbtnOnline").checked = false;
            }
            else if (selected == "Card") {
                $('#lblChequeNo').show();
                $('#lblChequeDate').show();
                $("#FeePaymentNo").val('');
                $("#FeePaymentDate").val('');
                $('#FeePaymentNo').show();
                $('#FeePaymentDate').show();
                $('#ReceivedAmount').show();
                $('#divFeePaymentDetails').show();
                $('#lblReceivedAmount').show();

                document.getElementById("rbtnFeeWaiver").checked = true;
                //$("#rbtnCard").prop('disabled', false);
                //$("#FeePaymentNo").prop('disabled', false);
                //$("#FeePaymentDate").prop('disabled', false);
                //$('#lblChequeNo').text("Approval Email From");
            }

            LoadCardDeatils();

        });
    });

    function RemoveSpecialChar(txtName) {
        if (txtName.value != '' && txtName.value.match(/^[\w ]+$/) == null) {
            txtName.value = txtName.value.replace(/[\W]/g, '');
        }
    }
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode;
        if (charCode = 46 && charCode > 31
            && (charCode < 48 || charCode > 57))
            return false;

        return true;
    }

    function ValidateVehicleNo(o, rowSelected) {
        debugger;
        var vehicleNo = o.value;
        console.log(vehicleNo);

        var customerTypeId = document.getElementById("CustomerTypeId").value;

        //if (vehicleNo == '') {
        //    //alert('Enter Vehicle No');
        //    document.getElementById("VehicleNo_error").innerHTML = "Enter Vehicle No";
        //    return;
        //}
        //else {
        //    document.getElementById("VehicleNo_error").innerHTML = "";
        //}


        console.log(rowSelected);
        var tbl = document.getElementById('NoOfCardsTbl');
        mytablebody = tbl.getElementsByTagName("tbody")[0];
        myrow = mytablebody.getElementsByTagName("tr")[rowSelected];
        var mycel;
        if (customerTypeId == "901" || customerTypeId == "906") {
            mycel = myrow.getElementsByTagName("td")[5];
        }
        else if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic
            mycel = myrow.getElementsByTagName("td")[6];
        }
        console.log(mycel);
        if (vehicleNo == '') {
            mycel.innerHTML = "Enter Vehicle No";
            return;
        }
        else {
            mycel.innerHTML = "";
        }

        var result = false;

        $.ajax({
            type: 'POST',  // http method
            url: "CheckVehicleRegistrationValid/Customer",
            data: { RegistrationNumber: vehicleNo },  // data to submit
            dataType: "json",
            success: function (data, status, xhr) {
                //debugger;
                var jsonData = JSON.parse(data);
                if (status == 'success' && jsonData['statusCode'] == '101') {
                    result = true;
                    mycel.innerHTML = "";
                    console.log(jsonData);
                    console.log(mycel.innerHTML);
                }
                else {
                    mycel.innerHTML = "Invalid Vehicle Registration Number";
                }
            },
            error: function (jqXhr, textStatus, errorMessage) {
                mycel.innerHTML = "Invalid Vehicle Registration Number";

            }
        });

    }


    //function CheckDuplicates() {
    //    console.log('Before CheckDuplicates');
    //    $('#NoOfCardsTbl td:nth-child(2) input').filter(function () {
    //        var value = $(this).val();
    //        $('#NoOfCardsTbl td:nth-child(2) input').not(this).each(function () {
    //            if ($(this).val() == value) {
    //                console.log('Found Duplicates');
    //                console.log($(this).val());
    //            }
    //        });
    //    });
    //    return false;
    //}
    //});

    $("#btnHeaderReset").click(function () {
        debugger;
        document.getElementById("CustomerReferenceNo").value = "";
        $("#CustomerReferenceNo").prop('readonly', false);
        document.getElementById("CustomerReferenceNo_error").innerHTML = "";
        document.getElementById("CustomerName").value = "";
        document.getElementById("FormNumber").value = "";
        $('#lblNoOfVehicles').hide();
        $('#NoOfVehiclesAllCards').hide();
        document.getElementById("RBEId").value = "";
        document.getElementById("RBEName").value = "";
        $("#RBEId").prop('readonly', false);
        document.getElementById("rbtnCardless").checked = false;
        document.getElementById("rbtnCardless").disabled = false;

        document.getElementById("rbtnCard").checked = false;
        document.getElementById("rbtnCard").disabled = false;

        document.getElementById("rbtnOnline").checked = false;
        document.getElementById("rbtnOnline").disabled = false;

        document.getElementById("rbtnFeeWaiver").checked = false;
        document.getElementById("rbtnFeeWaiver").disabled = false;

        document.getElementById("FeePaymentNo").value = "";
        document.getElementById("FeePaymentDate").value = "";

        $("#rbtnCard").prop('disabled', false);
        $("#FeePaymentNo").prop('readonly', false);
        $("#FeePaymentDate").prop('readonly', false);
        document.getElementById("NoOfCards").value = "";
        $("#NoOfCards").prop('readonly', false);
        document.getElementById("ReceivedAmount").value = "";

        $('#NoOfCardsTbl > tr').remove();
        document.getElementById('NoOfCardsTbl').style.display = 'none';


        $('#NoOfCards').attr("readonly", false);
        $('#FeePaymentDate').attr("readonly", false);
        $('#FeePaymentNo').attr("readonly", false);

    });

    var specialKeys = new Array();
    specialKeys.push(8); //Backspace Character
    specialKeys.push(9); //Tab Character
    specialKeys.push(46); //Delete Character
    specialKeys.push(36); //Home Character
    specialKeys.push(35); //End Character
    specialKeys.push(37); //Left Character
    specialKeys.push(39); //Right Character
    //function IsAlphaNumeric(e) {
    //    var keyCode = e.keyCode == 0 ? e.charCode : e.keyCode;
    //    var ret = ((keyCode >= 48 && keyCode <= 57) || (keyCode >= 65 && keyCode <= 90) || (keyCode >= 97 && keyCode <= 122) || (specialKeys.indexOf(e.keyCode) != -1 && e.charCode != e.keyCode));
    //    document.getElementById("error").style.display = ret ? "none" : "inline";
    //    return ret;
    //}

    function IsAlphaNumeric(e) {
        var k = e.which;
        var ok = k >= 65 && k <= 90 || // A-Z
            k >= 96 && k <= 105 || // a-z
            k >= 35 && k <= 40 || // arrows
            k == 8 || // Backspaces
            (!e.shiftKey && k >= 48 && k <= 57); // 0-9

        if (!ok) {
            e.preventDefault();
        }
    }

</script>