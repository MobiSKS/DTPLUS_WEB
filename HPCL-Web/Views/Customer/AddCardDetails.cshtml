@model HPCL.Common.Models.ViewModel.Customer.CustomerCardInfo
@using HPCL.Common.Resources
@{
    ViewData["Title"] = "Add Customer Card Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<div class="row w-100">
    <div class="col-lg-12">
        <div class="bg-white p-2 p-md-4">
            <ul class="breadcrumb bread_custom bg-transparent m-0 pb-1 py-0 px-0">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "Enrollments")" class="text_primary">Enrollments</a> </li>
                <li class="breadcrumb-item font-weight-light">Add Card</li>
            </ul>
            <h5>Add Card</h5>
            <div id="divSuccess" class="mb-3 text-center" style="background-color: #a0f1d6;display:none"></div>
            <form name="addCustomerCardsForm" class="toBeHiddenOnSuccess"> @*class="w-100" method="post" asp-action="AddCardDetails" *@
                <div class="w-100">
                    <div class="col-lg-12 col-md-12 col-12 pl-0 pr-md-2 pr-0 py-2">
                        <div class="border-1 rounded border-grey">
                            <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Add New Card</p>
                            @*<div class="alert alert-danger alert-cust-success" id="dvRemarks" style="@(Model.Remarks=="" ? "display:none":"display:block")">
                                @Html.DisplayFor(m => m.Remarks)
                            </div>*@
                            <div class="py-3 px-0 px-md-2">

                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label class="font-weight-normal col-md-5 col-12">Customer Ref No. <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.CustomerReferenceNo, new { @id = "CustomerReferenceNo", @class = "form-control", maxlength = "10", onkeypress = "return isNumberKey(event)" })
                                                <span class="error" id="CustomerReferenceNo_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center justify-content-start flex-wrap mb-3">
                                            <div class="col-12 col-md-auto">
                                                <button class="btn btn_primary px-4 py-2" type="button" id="btnSearch">@Label.Search</button>
                                            </div>
                                            <div class="col-12 col-md-auto">
                                                <button class="btn btn_primary px-4 py-2" type="button" id="btnHeaderReset">@Label.Reset</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">Customer Name <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.CustomerName, new { @id = "CustomerName", @class = "form-control", @readonly = "readonly" })
                                                <span class="error" id="CustomerName_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">Form Number <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.FormNumber, new { @id = "FormNumber", @class = "form-control", @readonly = "readonly" })
                                                <span class="error" id="FormNumber_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">No of Cards <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.NoOfCards, new { @id = "NoOfCards", @class = "form-control", maxlength = "2", onkeypress = "return isNumberKey(event)", autocomplete = "off" })
                                                <span class="error" id="NoOfCards_error"></span>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12" id="lblNoOfVehicles" style="display:none;">No Of Vehicles (For All Cards) <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.NoOfVehiclesAllCards, new { @id = "NoOfVehiclesAllCards", @class = "form-control", maxlength = "2", onkeypress = "return isNumberKey(event)", @style = "display:none", autocomplete = "off" })
                                                <span class="error" id="NoOfVehiclesAllCards_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">RBE ID </label> @*<sup class="text-danger">*</sup>*@
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.RBEId, new { @id = "RBEId", @class = "form-control" })
                                                <span class="error" id="RBEId_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12 mb-3">
                                        <div class="form-group d-flex align-items-center flex-wrap">
                                            <label class="font-weight-normal col-md-5 col-12">RBE Name </label> @*<sup class="text-danger">*</sup>*@
                                            <div class="col-md-7 col-12">
                                                @Html.TextBoxFor(m => m.RBEName, new { @id = "RBEName", @class = "form-control", @readonly = "readonly" })
                                                <span class="error" id="RBEName_error"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="divDetails" style="display:none">
                                    <div class="px-2 px-md-4">
                                        <fieldset class="border-1 rounded border-grey mb-3">
                                            <legend class="font-12 font-weight-bold d-inline-block w-auto ml-3 mb-0 px-2">Card Preference</legend>
                                            <div class="d-flex align-items-center justify-content-between flex-wrap pt-3">
                                                <div class="col-md-6 col-12">
                                                    <div class="col-md-7 col-12 d-flex align-items-center justify-content-start mb-3">
                                                        <label class="d-flex align-items-center justify-content-start">
                                                            @Html.RadioButtonFor(m => m.CardPreference, "Card", new { @id = "rbtnCard" })
                                                            <span class="ml-2">Card</span>
                                                        </label>
                                                        <label class="d-flex align-items-center justify-content-start ml-3">
                                                            @Html.RadioButtonFor(m => m.CardPreference, "Cardless", new { @id = "rbtnCardless" })
                                                            <span class="ml-2">Cardless</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="clearfix"></div>
                                        </fieldset>

                                        <fieldset class="border-1 rounded border-grey mb-4" id="divFeePaymentDetails">
                                            <legend class="font-12 font-weight-bold d-inline-block w-auto ml-3 mb-0 px-2">Fee Payment Details</legend>
                                            <div class="d-flex align-items-center justify-content-between flex-wrap pt-3">
                                                <div class="col-md-6 col-12">
                                                    <div class="col-12">
                                                        <div class="d-flex align-items-center justify-content-start flex-wrap mb-3">
                                                            <label class="d-flex align-items-center justify-content-start mr-3">
                                                                @Html.RadioButtonFor(m => m.FeePaymentsCollectFeeWaiver, "1", new { id = "rbtnOnline", name = "FeePaymentsCollectFeeWaiver", @class = "radio-toolbar" })
                                                                <span class="ml-2">Online</span>
                                                            </label>
                                                            <label class="d-flex align-items-center justify-content-start">
                                                                @Html.RadioButtonFor(model => Model.FeePaymentsCollectFeeWaiver, "2", new { id = "rbtnFeeWaiver", name = "FeePaymentsCollectFeeWaiver", @class = "radio-toolbar" })
                                                                <span class="ml-2">Fee Waiver</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="clearfix"></div>
                                        </fieldset>

                                    </div>


                                    <div class="d-flex align-items-center flex-wrap">
                                        <div class="col-lg-6 col-12 mb-0">
                                            <div class="form-group d-flex align-items-center flex-wrap">
                                                <label class="font-weight-normal col-md-5 col-12" id="lblChequeNo">Cheque No.<sup class="text-danger">*</sup></label>
                                                <div class="col-md-7 col-12">
                                                    @Html.TextBoxFor(m => m.FeePaymentNo, new { @id = "FeePaymentNo", @class = "form-control", autocomplete = "off" })
                                                    <span class="error" id="FeePaymentNo_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-12 mb-0">
                                            <div class="form-group d-flex align-items-center flex-wrap">
                                                <label class="font-weight-normal col-md-5 col-12" id="lblChequeDate">Cheque Date<sup class="text-danger">*</sup></label>
                                                <div class="col-md-7 col-12">
                                                    @Html.TextBoxFor(m => m.FeePaymentDate, new { @id = "FeePaymentDate", @class = "form-control", autocomplete = "off" })
                                                    <span class="error" id="FeePaymentDate_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center flex-wrap">
                                        <div class="col-lg-6 col-12 mb-0">
                                            <div class="form-group d-flex align-items-center flex-wrap">
                                                <label class="font-weight-normal col-md-5 col-12" id="lblReceivedAmount">Received Amount<sup class="text-danger">*</sup></label>
                                                <div class="col-md-7 col-12">
                                                    @Html.TextBoxFor(m => m.ReceivedAmount, new { @id = "ReceivedAmount", @class = "form-control", @readonly = "readonly" })
                                                    <span class="error" id="FeePaymentNo_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-12 mb-3">
                                            <div class="form-group d-flex align-items-center flex-wrap">
                                                @*<label class="font-weight-normal col-md-5 col-12" id="lblChequeDate">Cheque Date<sup class="text-danger">*</sup></label>*@
                                                <div class="col-md-7 col-12">
                                                    <span class="error" id="Common_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center flex-wrap mb-3">
                                        <div class="col-md-3 col-12 d-flex align-items-center justify-content-center">
                                            <div class="px-2">
                                                <button class="btn btn_primary" onclick="LoadCardDeatils()" type="button">Add</button>
                                            </div>
                                            <div class="px-2">
                                                <button class="btn btn_primary" type="button" onclick="ClearCardDeatils()">Reset</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="px-2 px-md-4 w-100">
                                        <div class=" table-responsive">
                                            <table class="table table-bordered table-striped text-nowrap" id="NoOfCardsTbl" style="display: none">
                                                <tbody id="cardDetails">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="divSubmit" style="display:none;">
                            <div class="col-md-12 col-12 px-0" id="divVehicleNoVerifiedManually">
                                <div class="d-flex align-items-center justify-content-start mt-3 mb-3">
                                    <div class="pr-2 chk_sty">
                                        @Html.CheckBoxFor(m=>m.VehicleNoVerifiedManually)<span class="ml-2">Vehicle Numbers have been verified using VAHAN Portal</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 col-12 px-0">
                                <div class="d-flex align-items-center justify-content-center flex-wrap mb-0 mt-0">
                                    <div class="col-md-12 col-12 d-flex align-items-center justify-content-center">
                                        <div class="pr-2">
                                            @*<button class="btn btn_primary" id="btnsubmit" type="submit" onclick="return SubmitValidations()">Submit</button>*@
                                            <button class="btn btn_primary" id="btnsubmit" type="button">Submit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div style="display:none;">@Html.TextBoxFor(m => m.CustomerTypeId)</div>
                @Html.HiddenFor(model => Model.FeePaymentsCollectFeeWaiver)
                @Html.HiddenFor(model => Model.CardPreference)
                @Html.HiddenFor(model => Model.Status)
            </form>
        </div>
    </div>


</div>

<script type="text/javascript">

    //$(document).ready(function () {
    //    $('input[name=FeePaymentsCollectFeeWaiver]').click(function () {
    //        if ($('input[name=FeePaymentsCollectFeeWaiver]:checked').val() == "1") {
    //            document.getElementById("CustomerReferenceNo_error").innerHTML = "";
    //        } else {
    //            $('#tab1').hide();
    //        }
    //    });
    //});

    var feePaymentDate = $("#FeePaymentDate").val();
    var notFoundError = "@ViewBag.NotFoundError";

    $(document).ready(function () {

        if (notFoundError == "") {
            if (feePaymentDate == "") {
                $("#FeePaymentDate").datepicker({
                    "setDate": new Date(),
                    "autoclose": true,
                    dateFormat: 'dd-mm-yy'
                });
                //setDates();
            }
            else {
                $("#FeePaymentDate").datepicker({ dateFormat: 'dd-mm-yy' });
            }

        }

        if (!document.getElementById("rbtnCard").checked && !document.getElementById("rbtnCardless").checked) {
            document.getElementById("rbtnCard").checked = true;
            document.getElementById("rbtnCardless").checked = false;
        }

        if(document.getElementById("Status").value=="1")
        {
             document.getElementById("divDetails").style.display = "block";
             document.getElementById("divSubmit").style.display = "none";

             var customerTypeId = document.getElementById("CustomerTypeId").value;

             if (customerTypeId == "905" || customerTypeId == "909")
             {
                $('#lblNoOfVehicles').show();
                $('#NoOfVehiclesAllCards').show();
                $('#NoOfVehiclesAllCards').attr("readonly", false);
            }
            else {
                $('#lblNoOfVehicles').hide();
                $('#NoOfVehiclesAllCards').hide();
            }

            //if($("#dvRemarks").html().trim()=="")
            //{
               $("#btnSearch").click();
            //}
        }
        else
        {
             document.getElementById("divDetails").style.display = "none";
             document.getElementById("divSubmit").style.display = "none";
        }

        //if($("#dvRemarks").html().trim()!="")
        //{
        //  LoadCardDeatils();
        //}
    });

    function setDates() {
        var d = new Date();

        var month = d.getMonth() + 1;
        var day = d.getDate();
        var output = (day < 10 ? '0' : '') + day + '-' +
            (month < 10 ? '0' : '') + month + '-' +
            d.getFullYear();

        $("#FeePaymentDate").val(output);

    };


    $("#btnSearch").click(function () {
        debugger;

        var custRefNo = document.getElementById("CustomerReferenceNo").value;
        if (custRefNo == "") {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "Customer Reference Number cannot be left blank";
            return (false);
        }
        else {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "";
        }

            $.ajax({
                type: 'POST',  // http method
                url: '@Url.Action("GetCustomerDetailsForAddCard", "Customer")',
                data: { customerReferenceNo: custRefNo },  // data to submit
                dataType: "json",
                success: function (data, status, xhr) {

                    var v = data;
                    if (status == 'success')
                    {
                        if(data.formNumber=="")
                        {
                            alert(data.remarks);
                        }
                        else
                        {
                            //alert(data.status);
                            if(data.status==0)
                            {
                                document.getElementById("divDetails").style.display = "none";
                                document.getElementById("divSubmit").style.display = "none";
                                alert(data.reason);
                            }
                            else
                            {
                                document.getElementById("divDetails").style.display = "block";
                                document.getElementById("divSubmit").style.display = "none";
                            }
                            document.getElementById("CustomerName").value = data.customerName;
                            document.getElementById("FormNumber").value = data.formNumber;
                            document.getElementById("CustomerTypeId").value = data.customerTypeId;
                            document.getElementById("NoOfCardsTbl").deleteTHead();
                            $("#NoOfCardsTbl td").parent().remove();
                            var customerTypeId = document.getElementById("CustomerTypeId").value;
                            $("#CustomerReferenceNo").prop('readonly', true);
                            console.log(customerTypeId);
                            if (customerTypeId == "905" || customerTypeId == "909") 
                            {
                                $('#lblNoOfVehicles').show();
                                $('#NoOfVehiclesAllCards').show();
                                $('#NoOfVehiclesAllCards').attr("readonly", false);
                            }
                            else 
                            {
                                $('#lblNoOfVehicles').hide();
                                $('#NoOfVehiclesAllCards').hide();
                            }
                            console.log(data.paymentType);

                            if(customerTypeId == "902" || customerTypeId == "917")
                            {
                                document.getElementById("divVehicleNoVerifiedManually").style.display = "none";
                            }
                            else
                            {
                                 document.getElementById("divVehicleNoVerifiedManually").style.display = "block";
                            }

                            if (data.rbeId != "") {
                                document.getElementById("RBEId").value = data.rbeId;
                                document.getElementById("RBEName").value = data.rbeName;
                                $("#RBEId").prop('readonly', true);
                            }
                            else {
                                document.getElementById("RBEId").value = "";
                                document.getElementById("RBEName").value = "";
                                $("#RBEId").prop('readonly', false);
                            }

                            if (data.paymentType != "")
                            {
                                document.getElementById("FeePaymentNo").value = data.paymentType;
                                document.getElementById("FeePaymentDate").value = data.paymentReceivedDate;
                                $("#FeePaymentNo").prop('readonly', true);
                                $("#FeePaymentDate").prop('readonly', true);

                                document.getElementById("rbtnCard").checked = true;
                                document.getElementById("rbtnCard").disabled = true;
                                document.getElementById("CardPreference").value = document.getElementById("rbtnCard").value;

                                document.getElementById("rbtnCardless").checked = false;
                                document.getElementById("rbtnCardless").disabled = true;

                                document.getElementById("rbtnOnline").checked = true;
                                document.getElementById("rbtnOnline").disabled = true;

                                document.getElementById("rbtnFeeWaiver").checked = false;
                                document.getElementById("rbtnFeeWaiver").disabled = true;

                                $('#lblChequeNo').text('');
                                $('#lblChequeNo').append("Payment Source<sup class='text-danger'>*</sup>");
                                $('#lblChequeDate').text('');
                                $('#lblChequeDate').append("Payment Date<sup class='text-danger'>*</sup>");
                                document.getElementById("NoOfCards").value = data.noOfCards;
                                $("#NoOfCards").prop('readonly', true);
                                document.getElementById("ReceivedAmount").value = data.receivedAmount;

                            }
                            else
                            {
                                $("#rbtnOnline").prop('disabled', true);
                                document.getElementById("rbtnOnline").checked = false;
                                document.getElementById("rbtnCard").checked = false;
                                $("#rbtnCard").prop('disabled', false);
                                $("#FeePaymentNo").prop('readonly', false);
                                $("#FeePaymentDate").prop('readonly', false);
                                $('#lblChequeNo').text('');
                                $('#lblChequeNo').append("Approval Email From<sup class='text-danger'>*</sup>");
                                $('#lblChequeDate').text('');
                                $('#lblChequeDate').append("Approval Email Date<sup class='text-danger'>*</sup>");
                                document.getElementById("NoOfCards").value = "";
                                $("#NoOfCards").prop('readonly', false);
                                document.getElementById("ReceivedAmount").value = "";
                            }

                       }
                    }
                    else {
                        $("#CustomerReferenceNo_error").html("");
                        console.log(v);
                        document.getElementById("CustomerName").value = "";
                        document.getElementById("FormNumber").value = "";
                        document.getElementById("CustomerTypeId").value = "";
                        var customerTypeId = document.getElementById("CustomerTypeId").value;
                        $("#CustomerReferenceNo").prop('readonly', false);
                        console.log(customerTypeId);
                        if (customerTypeId == 905 || customerTypeId == 909) {
                            $('#lblNoOfVehicles').show();
                            $('#NoOfVehiclesAllCards').show();
                        }
                        else {
                            $('#lblNoOfVehicles').hide();
                            $('#NoOfVehiclesAllCards').hide();
                        }
                    }
                }
            });


    });


    $("#RBEId").on("blur", function () {
        //debugger;
         var custRBEId = document.getElementById("RBEId").value;
         if (custRBEId == "") {
             //document.getElementById("RBEId_error").innerHTML = "RBE Id cannot be left blank";
             document.getElementById("RBEId_error").innerHTML = "";
             document.getElementById("RBEName").innerHTML = "";
            return (false);
        }
        else {
             document.getElementById("RBEId_error").innerHTML = "";
        }

        //var found = false;

            $.ajax({
                type: 'POST',  // http method
                url: '@Url.Action("GetCustomerRBEName", "Customer")',
                data: { RBEId: custRBEId },  // data to submit
                dataType: "json",
                success: function (data, status, xhr) {
                    console.log(data);
                    console.log(status);
                    var v = data;
                    if (status == 'success') {
                        document.getElementById("RBEName").value = data.rbeName;
                        //found = true;

                        if (data == "Failed to load Customer Details")
                            document.getElementById("RBEName").value = "";
                    }
                    else {
                        $("#RBEId_error").html("");
                        document.getElementById("RBEName").value = "";
                        console.log(v);
                        //found = false;
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    document.getElementById("RBEName").value = "";
                },
                statusCode: {
                    1024: function () {
                        document.getElementById("RBEName").value = "";
                    }
                }
            });


    });



    function LoadCardDeatils() {

        debugger;

        //if (document.getElementById("RBEId").value == "") {
        //    document.getElementById("RBEId_error").innerHTML = "RBE Id cannot be left blank";
        //    return (false);
        //}
        //else {
        //    document.getElementById("RBEId_error").innerHTML = "";
        //}

        //if (document.getElementById("RBEName").value == "") {
        //    document.getElementById("RBEName_error").innerHTML = "RBE Name is not valid";
        //    return (false);
        //}
        //else {
        //    document.getElementById("RBEName_error").innerHTML = "";
        //}

         //var images =JSON.parse('@Html.Raw(Json.Serialize(@Model.ObjCardDetail))');
         //console.log(images);

        var noOfCards = document.getElementById("NoOfCards").value;
        if (noOfCards == "0" || noOfCards == "") {
            document.getElementById("NoOfCards_error").innerHTML = "No of Cards cannot be left blank";
            return (false);
        }
        else
        {
            if (noOfCards >10)
            {
                document.getElementById("NoOfCards_error").innerHTML = "No of Cards may be 1 to 10";
                return (false);
            }
            else
            {
              document.getElementById("NoOfCards_error").innerHTML = "";
            }
        }

        if (!(document.querySelector('input[name="CardPreference"]:checked'))) {
            alert("Card Preference Not Selected");
            return;
        }

        var customerTypeId = document.getElementById("CustomerTypeId").value;
        var noOfVehiclesAllCards = document.getElementById("NoOfVehiclesAllCards").value;
        console.log(customerTypeId);
        if (customerTypeId == "905" || customerTypeId == "909") {
            if (noOfVehiclesAllCards == "0" || noOfVehiclesAllCards == "") {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No Of Vehicles (For All Cards) cannot be left blank";
                return (false);
            }
            else
            {
                if (noOfVehiclesAllCards >10)
                {
                    document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No Of Vehicles (For All Cards) cannot be greater than 10";
                    return (false);
                }
                else
                {
                   document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
                }

            }

            if (noOfCards > noOfVehiclesAllCards) {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No of Vehicles (For All Cards) cannnot be less than No of Cards";
                return (false);
            }
        }
        else {
            document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
        }

        $('#NoOfCards').attr("readonly", true);
        $('#NoOfVehiclesAllCards').attr("readonly", true);
        var selected = $("input[name='CardPreference']:checked").val();
        if (selected == "" || selected == undefined)
            selected = "Not Selected";
        console.log(selected);
        //var found = false;
        //var custRBEId = document.getElementById("RBEId").value;

    @*$.ajax({
        type: 'POST',  // http method
        url: '@Url.Action("GetCustomerRBEName", "Customer")',
        data: { RBEId: custRBEId },  // data to submit
        dataType: "json",
        success: function (data, status, xhr) {
        console.log(data);
        var v = data;
        if (status == 'success') {
        found = true;
        }
        else {
        found = false;
        }
        }
        });*@

        //if (found == false) {
        //    document.getElementById("RBEId_error").innerHTML = "RBE Id is not valid";
        //    return (false);
        //}
        //else {
        //    document.getElementById("RBEId_error").innerHTML = "";
        //}
        var customerTypeId = document.getElementById("CustomerTypeId").value;
        //console.log(customerTypeId);

        $.ajax({
            type: 'POST',  // http method
            url: '@Url.Action("GetVehicleTypeDetails", "Customer")',
            data: {},
            dataType: "json",
            success: function (data, status, xhr) {
                //debugger;

                var NoOfcards = $('#NoOfCards').val();
                $("#NoOfCardsTbl td").parent().remove();

                var NoOfVehicles = $('#NoOfVehiclesAllCards').val();

                //<option value="901">Fleet</option>
                //<option value="906">Credit</option>
                    
                //<option value="905">Attached</option>
                //<option value="909">Generic</option>

                //<option value="902">Corporate</option>
                //<option value="917">Non Fleet</option>

                document.getElementById("NoOfCardsTbl").deleteTHead();

                if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic
                    if (selected.toUpperCase() == "CARDLESS") {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Card Identifier</th><th>Vehicle No.</th><th></th><th>Vehicle Type</th><th>Vehicle Make</th><th>Year of Reg.</th><th>Mobile No</th><th></th><th style="display:none;"></th><th style="display:none;"></th></tr></thead>');
                    }
                    else {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Card Identifier</th><th>Vehicle No.</th><th></th><th>Vehicle Type</th><th>Vehicle Make</th><th>Year of Reg.</th><th></th><th style="display:none;"></th><th style="display:none;"></th></tr></thead>');
                    }
                }
                else if (customerTypeId == "902" || customerTypeId == "917") {//Corporate,Non Fleet
                    if (selected.toUpperCase() == "CARDLESS") {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Card Identifier</th><th>Mobile No</th><th></th></tr></thead>');
                    }
                    else {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Card Identifier</th><th></th></tr></thead>');
                    }
                }
                else if (customerTypeId == "901" || customerTypeId == "906") {//Fleet,Credit
                    if (selected.toUpperCase() == "CARDLESS") {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Vehicle No</th><th></th><th>Vehicle Type</th><th>Vehicle Make</th><th>Year of Reg.</th><th>Mobile No</th><th></th><th></th> <th style="display:none;"></th><th style="display:none;"></th></tr></thead>');
                    }
                    else {
                        $('#NoOfCardsTbl').append('<thead><tr><th>S No.</th><th>Vehicle No</th><th></th><th>Vehicle Type</th><th>Vehicle Make</th><th>Year of Reg.</th><th></th><th style="display:none;"></th><th style="display:none;"></th></tr></thead>');
                    }
                }


                if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic

                    NoOfcards = NoOfVehicles;
                }


                for (var i = 0; i < parseInt(NoOfcards); i++) {
                    //var id = 'ddlVehicleType' + i;
                    var j = (i + 1);
                    var name = 'ObjCardDetail[' + (i) + '].VehicleType';
                    var id = 'ddlVehicleType' + i;

                    if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic

                        if (selected.toUpperCase() == "CARDLESS") {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='22' class='form-control' class='cardIdentifierInput' name='ObjCardDetail[" + (i) + "].CardIdentifier'> </span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='10' onkeydown='return IsAlphaNumeric(event.keyCode)' class='form-control' style='text-transform:uppercase' onchange='CheckVechileNoUsed(this," + (i) + ")' name='ObjCardDetail[" + (i) + "].VechileNo'></span></td>"
                                + "<td><button class='btn btn_primary px-4 py - 2 verify' onclick='ValidateVehicleNo(" + (i) + ")' type='button' name='btnVechileCheck" + (i) + "'>Verify</button></td>"
                                + "<td><select id='" + id + "'class='vls form-control' name='" + name + "'></select></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' name='ObjCardDetail[" + (i) + "].VehicleMake'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' maxlength='4' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].YearOfRegistration'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' maxlength='10' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].MobileNo'></span></td>"
                                + "<td class='rowData' style='color: red;'><span class='error'></span></td>"
                                + "<td style='display:none;'></td>"
                                + "<td style='display:none;'>0</td></tr>";
                        }
                        else {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='22' class='form-control' class='cardIdentifierInput' name='ObjCardDetail[" + (i) + "].CardIdentifier'> </span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='10' onkeydown='return IsAlphaNumeric(event.keyCode)' class='form-control' style='text-transform:uppercase' onchange='CheckVechileNoUsed(this," + (i) + ")' name='ObjCardDetail[" + (i) + "].VechileNo'></span></td>"
                                + "<td><button class='btn btn_primary px-4 py - 2 verify' onclick='ValidateVehicleNo(" + (i) + ")' type='button' name='btnVechileCheck" + (i) + "'>Verify</button></td>"
                                + "<td><select id='" + id + "'class='vls form-control' name='" + name + "'></select></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' name='ObjCardDetail[" + (i) + "].VehicleMake'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' maxlength='4' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].YearOfRegistration'></span></td>"
                                + "<td class='rowData' style='color: red;'><span class='error'></span></td>"
                                + "<td style='display:none;'></td>"
                                + "<td style='display:none;'>0</td></tr>";
                        }
                    }
                    else if (customerTypeId == "902" || customerTypeId == "917") {//Corporate,Non Fleet
                        if (selected.toUpperCase() == "CARDLESS") {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='22' class='form-control' class='cardIdentifierInput' name='ObjCardDetail[" + (i) + "].CardIdentifier'> </span></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control'  maxlength='10' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].MobileNo'></span></td>"
                                + "<td class='rowData' style='color: red;'><span class='error'></span></td></tr>";
                        }
                        else {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='22' class='form - control' class='cardIdentifierInput' name='ObjCardDetail[" + (i) + "].CardIdentifier'> </span></td>"
                                + "<td class='rowData' style='color: red;'><span class='error'></span></td></tr>";
                        }
                    }
                    else if (customerTypeId == "901" || customerTypeId == "906") {//Fleet,Credit

                        if (selected.toUpperCase() == "CARDLESS") {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='10' onkeydown='return IsAlphaNumeric(event.keyCode)' style='text-transform:uppercase' class='form-control' onchange='CheckVechileNoUsed(this," + (i) + ")' name='ObjCardDetail[" + (i) + "].VechileNo'></span></td>"
                                + "<td><button class='btn btn_primary px-4 py - 2 verify' onclick='ValidateVehicleNo(" + (i) + ")' type='button' name='btnVechileCheck" + (i) + "'>Verify</button></td>"
                                + "<td><select id='" + id + "'class='vls form-control' name='" + name + "'></select></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' name='ObjCardDetail[" + (i) + "].VehicleMake'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' maxlength='4' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].YearOfRegistration'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control'  maxlength='10' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].MobileNo'></span></td>"
                                + "<td class='rowData' style='color: red;'><span class='error'></span></td>"
                                + "<td style='display:none;'></td>"
                                + "<td style='display:none;'>0</td></tr>";
                        }
                        else {
                            var rows = "<tr><td><span class='rowData'>" + j + "</span></td>"
                                + "<td><span class='rowData'><input type='text' maxlength='10' onkeydown='return IsAlphaNumeric(event.keyCode)' style='text-transform:uppercase' class='form-control' onchange='CheckVechileNoUsed(this," + (i) + ")' name='ObjCardDetail[" + (i) + "].VechileNo'></span></td>"
                                + "<td><button class='btn btn_primary px-4 py - 2 verify' onclick='ValidateVehicleNo(" + (i) + ")' type='button' name='btnVechileCheck" + (i) + "'>Verify</button></td>"
                                + "<td><select id='" + id + "'class='vls form-control' name='" + name + "'></select></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' name='ObjCardDetail[" + (i) + "].VehicleMake'></span></td>"
                                + "<td><span class='rowData'><input type='text' class='form-control' maxlength='4' onkeypress = 'return isNumberKey(event)' name='ObjCardDetail[" + (i) + "].YearOfRegistration'></span></td>"
                                + "<td class='rowData' style='color: red;'><span class='error'></span></td>"
                                + "<td style='display:none;'></td>"
                                + "<td style='display:none;'>0</td></tr>";
                        }
                    }

                    //console.log(rows);

                    $('#NoOfCardsTbl').append(rows);
                    //console.log(document.getElementById(id));

                    $("#" + id).html("");
                    $.each(data.sortedtList, function (i, data) { // bind the dropdown list using json result
                        $('<option>',
                            {
                                value: data.vehicleTypeName,
                                text: data.vehicleTypeName
                            }).html(data.vehicleTypeName).appendTo("#" + id);
                    });
                }

                var count = $('#NoOfCardsTbl tr').length;
                //alert(count);
                if(count>1)
                {
                   document.getElementById("divSubmit").style.display = "block";
                }
                else
                {
                   document.getElementById("divSubmit").style.display = "none";
                }

            },
            error: function (jqXhr, textStatus, errorMessage) {
                alert("Error Populating VehicleTpeData Data");
            }


        });

        //  vehicleTypelst.append('</select >');


        document.getElementById('NoOfCardsTbl').style.display = 'table';
        // document.getElementById('NoOfCardsTbl').style.display = 'block';

        //$('#NoOfCards').attr("disabled", true);
        //$('#FeePaymentDate').attr("disabled", true);
        //$('#FeePaymentNo').attr("disabled", true);
        //$('#FeePaymentDate').attr("disabled", true);

   
    }

    function ClearCardDeatils() {

        //$('#NoOfCards').val('');
        //$('#FeePaymentDate').val('');
        // $('#FeePaymentNo').val('');
        $('#NoOfCardsTbl > tr').remove();
        document.getElementById('NoOfCardsTbl').style.display = 'none';
        $("#NoOfCardsTbl tr").remove();

        $('#NoOfCards').attr("readonly", false);
        $('#NoOfVehiclesAllCards').attr("readonly", false);
        $('#FeePaymentDate').attr("readonly", false);
        $('#FeePaymentNo').attr("readonly", false);

        var count = $('#NoOfCardsTbl tr').length;
        //alert(count);
        if(count>1)
        {
           document.getElementById("divSubmit").style.display = "block";
        }
        else
        {
           document.getElementById("divSubmit").style.display = "none";
        }
    }

       $("#btnsubmit").on("click", (function (e) {

        var i=0;
        var j=0;
        var table = document.getElementById("NoOfCardsTbl");

        if (document.getElementById("CustomerReferenceNo").value == "0" || document.getElementById("CustomerReferenceNo").value == "") 
        {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "Customre Ref No cannot be left blank";
            return false;
        }
        else 
        {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "";
        }

        if (document.getElementById("CustomerName").value == "0" || document.getElementById("CustomerName").value == "") 
        {
            document.getElementById("CustomerName_error").innerHTML = "Customer Name cannot be left blank";
            return false;
        }
        else 
        {
            document.getElementById("CustomerName_error").innerHTML = "";
        }

        if (document.getElementById("FormNumber").value == "0" || document.getElementById("FormNumber").value == "") 
        {
            document.getElementById("FormNumber_error").innerHTML = "Form Number cannot be left blank";
            return false;
        }
        else 
        {
            document.getElementById("FormNumber_error").innerHTML = "";
        }

        if (document.getElementById("NoOfCards").value == "0" || document.getElementById("NoOfCards").value.trim() == "") 
        {
            document.getElementById("NoOfCards_error").innerHTML = "No of Cards cannot be left blank";
            return false;
        }
        else 
        {
            document.getElementById("NoOfCards_error").innerHTML = "";
        }

        var customerTypeId = document.getElementById("CustomerTypeId").value;
        if (customerTypeId == "905" || customerTypeId == "909") 
        {
            if (document.getElementById("NoOfVehiclesAllCards").value == "0" || document.getElementById("NoOfVehiclesAllCards").value == "") 
            {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No Of Vehicles (For All Cards) cannot be left blank";
                return false;
            }
            else 
            {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
            }
        }


        if (document.getElementById("rbtnCard").checked) 
        {

            if (document.getElementById("rbtnFeeWaiver").checked) 
            {
                if (document.getElementById("FeePaymentNo").value == "") 
                {
                    document.getElementById("FeePaymentNo_error").innerHTML = "Approval Email From cannot be left blank";
                    return false;
                }
                else {

                    if (document.getElementById("FeePaymentNo").value.match(email)) {
                        document.getElementById("FeePaymentNo_error").innerHTML = "";
                        //return true
                    }
                    else {
                        document.getElementById("FeePaymentNo_error").innerHTML = "Invalid email id (e.g.: abc@gmail.com)";
                        return (false);
                    }
                }

                if (document.getElementById("FeePaymentDate").value == "0" || document.getElementById("FeePaymentDate").value == "") {
                    document.getElementById("FeePaymentDate_error").innerHTML = "Approval Email Date cannot be left blank";
                    return false;
                }
                else {
                    document.getElementById("FeePaymentDate_error").innerHTML = "";
                }
            }
        }

        if (document.getElementById("rbtnCard").checked) {

            if (document.getElementById("rbtnOnline").checked) {
                if (document.getElementById("FeePaymentNo").value == "0" || document.getElementById("FeePaymentNo").value == "") {
                    document.getElementById("FeePaymentNo_error").innerHTML = "Payment Source cannot be left blank";
                    return false;
                }
                else {
                    document.getElementById("FeePaymentNo_error").innerHTML = "";
                }

                if (document.getElementById("FeePaymentDate").value == "0" || document.getElementById("FeePaymentDate").value == "") {
                    document.getElementById("FeePaymentDate_error").innerHTML = "Payment Date cannot be left blank";
                    return false;
                }
                else {
                    document.getElementById("FeePaymentDate_error").innerHTML = "";
                }
            }
        }

        if (!(document.querySelector('input[name="CardPreference"]:checked'))) {
            alert("Card Preference Not Selected");
            return;
        }

        if (document.getElementById("rbtnCard").checked) {
            if (!(document.querySelector('input[name="FeePaymentsCollectFeeWaiver"]:checked'))) {
                alert("Fee Payment Details Not Selected");
                return false;
            }
        }

        var selectedCardType = $("input[name='CardPreference']:checked").val();
        document.getElementById("CardPreference").value = selectedCardType;
        console.log(selectedCardType);

        var selectedFeePayment = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val();
        document.getElementById("FeePaymentsCollectFeeWaiver").value = selectedFeePayment;
        console.log(selectedFeePayment);

        var count = $('#NoOfCardsTbl tr').length;

        //alert(count);

        if (count == 1) {
            alert("Vehicle Details Not Added");
            return false;
        }

        var DuplicateFound = false;
        var DetailsNotFound = false;
        var InvalidYearFound = false;

        var selected = $("input[name='CardPreference']:checked").val();
        if (selected == "" || selected == undefined)
            selected = "Not Selected";

        if (customerTypeId == "901" || customerTypeId == "906") //Fleet And Credit
        {

            document.getElementById("Common_error").innerHTML = "";

            $('#NoOfCardsTbl td:nth-child(2) input').filter(function () {
                var VehicleNo = $(this).val().trim();
                if (VehicleNo == "") {
                    //document.getElementById("Common_error").innerHTML = "Plese Enter Vehicle Number for all the rows";
                    alert("Plese Enter Vehicle Number for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            j=0;i=0;
            console.log('Before Checking For Duplicate VehicleNo');
            for (let row of table.rows) 
            {
                j=0;
                i=i+1;
                for (let row1 of table.rows) 
                {
                    j=j+1;
                    if(i>1 && j>1 && j>i)
                    {
                        var PrevRVno = $(row).find("td:eq(1) input[type='text']").val();
                        var CurRVno = $(row1).find("td:eq(1) input[type='text']").val();

                        if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                        {
                            console.log("Ravi" + i + " " + j)
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                               row1.cells[7].innerHTML="Duplicate Vehicle No";
                            }
                            else
                            {
                                row1.cells[6].innerHTML="Duplicate Vehicle No";
                            }
                            DuplicateFound = true;
                        }
                    }
                }
            }

            if (DuplicateFound)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(5) input').filter(function () {
                var vehicleMake = $(this).val().trim();
                if (vehicleMake == "") {
                    //document.getElementById("Common_error").innerHTML = "Please Enter Vehicle Make for all the rows";
                    alert("Please Enter Vehicle Make for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(6) input').filter(function () {
                var yearReg = $(this).val().trim();
                if (yearReg == "") {
                    //document.getElementById("Common_error").innerHTML = "Please Enter Year Of Reg. for all the rows";
                    alert("Please Enter Year Of Reg. for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            const d = new Date();
            let curYear = d.getFullYear();

            console.log('Before Checking For Year Of Registration');
            $('#NoOfCardsTbl td:nth-child(6) input').filter(function () {
                var YearOfRegistration = $(this).val();
                if (YearOfRegistration != "") {
                    if (YearOfRegistration < 1980 || YearOfRegistration > curYear) {
                        //document.getElementById("Common_error").innerHTML = "Year Of Reg. must be between 1980 and " + curYear;
                        alert("Year Of Reg. must be between 1980 and " + curYear);
                        console.log('Found Invalid Year Of Registration');
                        console.log(YearOfRegistration);
                        InvalidYearFound = true;
                        return false;
                    }

                    if (YearOfRegistration.length < 4) {
                        //document.getElementById("Common_error").innerHTML = "Length of Year Of Registration must be 4 digit";
                        alert("Invalid Year Of Registration");
                        console.log('Found Invalid Year Of Registration');
                        console.log(YearOfRegistration);
                        InvalidYearFound = true;
                        return false;
                    }

                }
            });

            if (InvalidYearFound)
            {
                return false;
            }

            var VehicleTypeNotSelected=false;

            $('#NoOfCardsTbl td:nth-child(4) select').filter(function () {
                var VehicleType = $(this).val().trim();
                console.log(VehicleType);
                if (VehicleType == "--Select--") {
                    //document.getElementById("Common_error").innerHTML = "Please select vehicle Type for all the rows";
                    alert("Please select vehicle Type for all the rows");
                    VehicleTypeNotSelected = true;
                    return false;
                }
            });

            if (VehicleTypeNotSelected)
            {
                return false;
            }

            if (selected.toUpperCase() == "CARDLESS")
            {

                console.log('Before Checking For Invalid Mobile Number');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    i=i+1;

                    if(i>1)
                    {
                        var mobileNo = $(row).find("td:eq(6) input[type='text']").val();

                        if (mobileNo != "" && mobileNo.charAt(0) == "0") 
                        {
                            row1.cells[7].innerHTML="Invalid Mobile Number.";
                            DetailsNotFound = true;
                        }
                        else
                        {
                            if (mobileNo != "" && mobileNo.length < 10) 
                            {
                                row1.cells[7].innerHTML="Invalid Mobile Number.";
                                DetailsNotFound = true;
                            }
                            else
                            {
                                 row1.cells[7].innerHTML="";
                            }
                        }
                    }

                }


                if (DetailsNotFound)
                {
                    return false;
                }

                console.log('Before Checking For Duplicate MobileNo');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    j=0;
                    i=i+1;
                    for (let row1 of table.rows) 
                    {
                        j=j+1;
                        if(i>1 && j>1 && j>i)
                        {
                            var PrevRVno = $(row).find("td:eq(6) input[type='text']").val();
                            var CurRVno = $(row1).find("td:eq(6) input[type='text']").val();

                            if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                            {
                                if (mobileNo != "" && mobileNo.length < 10) 
                                {
                                    row1.cells[7].innerHTML="Invalid Mobile Number.";
                                }
                                else
                                {
                                     row1.cells[7].innerHTML="";
                                }
                                DuplicateFound=true;
                            }
                        }
                    }
                }

                if (DuplicateFound)
                {
                    return false;
                }

                console.log('Before Checking Existing Vehicle No');
                var table = document.getElementById("NoOfCardsTbl");
                for (let row of table.rows)
                {
                    //alert(row.cells[8].innerHTML);
                    if(row.cells[8].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(1) input[type='text']").val();
                        Vhno=Vhno.toUpperCase()
                        alert('Vehicle No Already Exists: ' + Vhno);
                        return false;
                    }
                }

                if (!$(VehicleNoVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[9].innerHTML);
                        if(row.cells[9].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(1) input[type='text']").val();
                            Vhno=Vhno.toUpperCase()
                            alert('Vehicle No Not Verified: ' + Vhno);
                            return false;
                        }
                    }
                }

            }
            else
            {
                console.log('Before Checking Existing Vehicle No');
                var table = document.getElementById("NoOfCardsTbl");
                for (let row of table.rows)
                {
                    //alert(row.cells[7].innerHTML);
                    if(row.cells[7].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(1) input[type='text']").val();
                        Vhno=Vhno.toUpperCase()
                        alert('Vehicle No Already Exists: ' + Vhno);
                        return false;
                    }
                }

                if (!$(VehicleNoVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[8].innerHTML);
                        if(row.cells[8].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(1) input[type='text']").val();
                            Vhno=Vhno.toUpperCase()
                            alert('Vehicle No Not Verified: ' + Vhno);
                            return false;
                        }
                    }
                }



            }

        }
        else if (customerTypeId == "905" || customerTypeId == "909") //Attached,Generic
        {

            document.getElementById("Common_error").innerHTML = "";

            $('#NoOfCardsTbl td:nth-child(2) input').filter(function () {
                var cardIdentifier = $(this).val().trim();
                if (cardIdentifier == "") {
                    //document.getElementById("Common_error").innerHTML = "Please Enter Card Identifier for all the rows";
                    alert("Please Enter Card Identifier for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            i=0;
            j=0;
            console.log('Before Checking For Duplicate Card Identifier');
            for (let row of table.rows) 
            {
                j=0;
                i=i+1;
                for (let row1 of table.rows) 
                {
                    j=j+1;
                    if(i>1 && j>1 && j>i)
                    {
                        var PrevRVno = $(row).find("td:eq(1) input[type='text']").val();
                        var CurRVno = $(row1).find("td:eq(1) input[type='text']").val();

                        if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                        {
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                               row1.cells[8].innerHTML="Duplicate Card Identifier";
                            }
                            else
                            {
                                row1.cells[7].innerHTML="Duplicate Card Identifier";
                            }
                            DuplicateFound=true;
                        }
                        
                    }
                }
            }

            if (DuplicateFound)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(3) input').filter(function () {
                var VehicleNo = $(this).val().trim();
                if (VehicleNo == "") {
                    //document.getElementById("Common_error").innerHTML = "Please Enter Vehicle Number for all the rows";
                    alert("Please Enter Vehicle Number for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            i=0;
            j=0;
            console.log('Before Checking For Duplicate VehicleNo');
            for (let row of table.rows) 
            {
                j=0;
                i=i+1;
                for (let row1 of table.rows) 
                {
                    j=j+1;
                    if(i>1 && j>1 && j>i)
                    {
                        var PrevRVno = $(row).find("td:eq(2) input[type='text']").val();
                        var CurRVno = $(row1).find("td:eq(2) input[type='text']").val();

                        if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                        {
                            //console.log("Ravi" + i + " " + j)
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                               row1.cells[8].innerHTML="Duplicate Vehicle No";
                            }
                            else
                            {
                                row1.cells[7].innerHTML="Duplicate Vehicle No";
                            }
                            DuplicateFound=true;
                        }
                    }
                }
            }


            if (DuplicateFound)
            {
                return false;
            }

            var VehicleTypeNotSelected=false;

            $('#NoOfCardsTbl td:nth-child(5) select').filter(function () {
                var VehicleType = $(this).val().trim();
                console.log(VehicleType);
                if (VehicleType == "--Select--") {
                    document.getElementById("Common_error").innerHTML = "Please select vehicle Type for all the rows";
                    VehicleTypeNotSelected = true;
                    return false;
                }
            });

            if (VehicleTypeNotSelected)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(6) input').filter(function () {
                var vehicleMake = $(this).val().trim();
                if (vehicleMake == "") {
                    document.getElementById("Common_error").innerHTML = "Please Enter Vehicle Make for all the rows";
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(7) input').filter(function () {
                var yearReg = $(this).val().trim();
                if (yearReg == "") {
                    document.getElementById("Common_error").innerHTML = "Please Enter Year Of Reg. for all the rows";
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            const d = new Date();
            let curYear = d.getFullYear();

            console.log('Before Checking For Year Of Registration');
            $('#NoOfCardsTbl td:nth-child(7) input').filter(function () {
                var YearOfRegistration = $(this).val();
                if (YearOfRegistration != "") {
                    if (YearOfRegistration < 1980 || YearOfRegistration > curYear) {
                        document.getElementById("Common_error").innerHTML = "Year Of Reg. must be between 1980 and " + curYear;
                        console.log('Found Invalid Year Of Registration');
                        console.log(YearOfRegistration);
                        InvalidYearFound = true;
                        return false;
                    }

                    if (YearOfRegistration.length < 4) {
                        document.getElementById("Common_error").innerHTML = "Length of Year Of Registration must be 4 digit";
                        console.log('Found Invalid Year Of Registration');
                        console.log(YearOfRegistration);
                        InvalidYearFound = true;
                        return false;
                    }

                }
            });

            if (InvalidYearFound)
            {
                return false;
            }

            if (selected.toUpperCase() == "CARDLESS")
            {

                console.log('Before Checking For Invalid Mobile Number');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    i=i+1;

                    if(i>1)
                    {
                        var mobileNo = $(row).find("td:eq(7) input[type='text']").val();

                        if (mobileNo != "" && mobileNo.charAt(0) == "0") 
                        {
                            row1.cells[8].innerHTML="Invalid Mobile Number.";
                            DetailsNotFound = true;
                        }
                        else
                        {
                            if (mobileNo != "" && mobileNo.length < 10) 
                            {
                                row1.cells[8].innerHTML="Invalid Mobile Number.";
                                DetailsNotFound = true;
                            }
                            else
                            {
                                 row1.cells[8].innerHTML="";
                            }
                        }
                    }

                }


                if (DetailsNotFound)
                {
                    return false;
                }

                console.log('Before Checking For Duplicate MobileNo');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    j=0;
                    i=i+1;
                    for (let row1 of table.rows) 
                    {
                        j=j+1;
                        if(i>1 && j>1 && j>i)
                        {
                            var PrevRVno = $(row).find("td:eq(7) input[type='text']").val();
                            var CurRVno = $(row1).find("td:eq(7) input[type='text']").val();

                            if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                            {
                                if (mobileNo != "" && mobileNo.length < 10) 
                                {
                                    row1.cells[8].innerHTML="Invalid Mobile Number.";
                                }
                                else
                                {
                                     row1.cells[8].innerHTML="";
                                }
                                DuplicateFound=true;
                            }
                        }
                    }
                }

                if (DuplicateFound)
                {
                    return false;
                }

                console.log('Before Checking Existing Vehicle No');
                var table = document.getElementById("NoOfCardsTbl");
                for (let row of table.rows)
                {
                    //alert(row.cells[9].innerHTML);
                    if(row.cells[9].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(2) input[type='text']").val();
                        Vhno=Vhno.toUpperCase()
                        alert('Vehicle No Already Exists: ' + Vhno);
                        return false;
                    }
                }

                if (!$(VehicleNoVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[10].innerHTML);
                        if(row.cells[10].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(2) input[type='text']").val();
                            Vhno=Vhno.toUpperCase()
                            alert('Vehicle No Not Verified: ' + Vhno);
                            return false;
                        }
                    }
                }


            }
            else
            {
                console.log('Before Checking Existing Vehicle No');
                var table = document.getElementById("NoOfCardsTbl");
                for (let row of table.rows)
                {
                    //alert(row.cells[8].innerHTML);
                    if(row.cells[8].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(2) input[type='text']").val();
                        Vhno=Vhno.toUpperCase()
                        alert('Vehicle No Already Exists: ' + Vhno);
                        return false;
                    }
                }

                if (!$(VehicleNoVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[9].innerHTML);
                        if(row.cells[9].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(2) input[type='text']").val();
                            Vhno=Vhno.toUpperCase()
                            alert('Vehicle No Not Verified: ' + Vhno);
                            return false;
                        }
                    }
                }

            }

        }
        else if (customerTypeId == "902" || customerTypeId == "917") //Corporate,Non Fleet
        {

            document.getElementById("Common_error").innerHTML = "";

            $('#NoOfCardsTbl td:nth-child(2) input').filter(function () {
                var cardIdentifier = $(this).val().trim();
                if (cardIdentifier == "") {
                    document.getElementById("Common_error").innerHTML = "Please Enter Card Identifier for all the rows";
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            i=0;j=0;
            console.log('Before Checking For Duplicate Card Identifier');
            for (let row of table.rows) 
            {
                j=0;
                i=i+1;
                for (let row1 of table.rows) 
                {
                    j=j+1;
                    if(i>1 && j>1 && j>i)
                    {
                        var PrevRVno = $(row).find("td:eq(1) input[type='text']").val();
                        var CurRVno = $(row1).find("td:eq(1) input[type='text']").val();

                        if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                        {
                            //console.log("Ravi" + i + " " + j)
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                               row1.cells[3].innerHTML="Duplicate Card Identifier";
                            }
                            else
                            {
                                row1.cells[2].innerHTML="Duplicate Card Identifier";
                            }
                            DuplicateFound=true;
                        }
                    }
                }
            }

            if (DuplicateFound)
            {
                return false;
            }


            if (selected.toUpperCase() == "CARDLESS")
            {

                document.getElementById("Common_error").innerHTML = "";

                $('#NoOfCardsTbl td:nth-child(3) input').filter(function () 
                {
                    var mobile = $(this).val().trim();
                    if (mobile == "") 
                    {
                        document.getElementById("Common_error").innerHTML = "Please Enter Mobile Numbers for all the rows";
                        DetailsNotFound = true;
                        return false;
                    }
                });

                if (DetailsNotFound)
                {
                    return false;
                }

                console.log('Before Checking For Invalid Mobile Number');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    i=i+1;

                    if(i>1)
                    {
                        var mobileNo = $(row).find("td:eq(2) input[type='text']").val();

                        if (mobileNo != "" && mobileNo.charAt(0) == "0") 
                        {
                           row.cells[3].innerHTML="Invalid Mobile Number.";
                           DetailsNotFound = true;
                        }
                        else
                        {
                            if (mobileNo != "" && mobileNo.length < 10) 
                            {
                                row.cells[3].innerHTML="Invalid Mobile Number.";
                                DetailsNotFound = true;
                            }
                            else
                            {
                                if(!mobileNo.match(phoneno)) 
                                {
                                    row.cells[3].innerHTML="Invalid Mobile Number.";
                                    DetailsNotFound = true;
                                }
                                else 
                                {
                                    row.cells[3].innerHTML="";
                                }
                            }
                        }
                    }

                }


                if (DetailsNotFound)
                {
                    return false;
                }

                console.log('Before Checking For Duplicate MobileNo');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    j=0;
                    i=i+1;
                    for (let row1 of table.rows) 
                    {
                        j=j+1;
                        if(i>1 && j>1 && j>i)
                        {
                            var PrevRVno = $(row).find("td:eq(2) input[type='text']").val();
                            var CurRVno = $(row1).find("td:eq(2) input[type='text']").val();

                            if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                            {
                                row1.cells[3].innerHTML="Duplicate Mobile Number";
                                DuplicateFound=true;
                            }
                        }
                    }
                }

                if (DuplicateFound)
                {
                    return false;
                }
            }

        }


         cardDetail = [];
         $("#NoOfCardsTbl tbody tr").each(function () {
             //debugger;

             var row = $(this);
             var cardIdentifier="";
             var mobileNo="";
             var vehicleNo="";
             var vehicleType="";
             var vehicleMake="";
             var yearOfRegistration="1900";
             console.log(customerTypeId);
             if(customerTypeId == "902" || customerTypeId == "917")
             {
                 cardIdentifier = row.find("td:eq(1) input[type='text']").val();
                 if (selected.toUpperCase() == "CARDLESS")
                 {
                     mobileNo=row.find("td:eq(2) input[type='text']").val();
                 }
             }
             else if(customerTypeId == "901" || customerTypeId == "906")
             {
                 vehicleNo = row.find("td:eq(1) input[type='text']").val();
                 //vehicleType = row.find("td:eq(3) input[type='select']").val();
                 vehicleType = row.find('td').eq(3).find('select').val();
                 vehicleMake = row.find("td:eq(4) input[type='text']").val();
                 yearOfRegistration = row.find("td:eq(5) input[type='text']").val();

                 if (selected.toUpperCase() == "CARDLESS")
                 {
                     mobileNo=row.find("td:eq(6) input[type='text']").val();
                 }
             }
             else
             {
                 cardIdentifier = row.find("td:eq(1) input[type='text']").val();
                 vehicleNo = row.find("td:eq(2) input[type='text']").val();
                 vehicleType = row.find('td').eq(4).find('select').val();
                 vehicleMake = row.find("td:eq(5) input[type='text']").val();
                 yearOfRegistration = row.find("td:eq(6) input[type='text']").val();

                 if (selected.toUpperCase() == "CARDLESS")
                 {
                     mobileNo=row.find("td:eq(7) input[type='text']").val();
                 }
             }

              cardDetail.push({ CardIdentifier: cardIdentifier, VechileNo: vehicleNo, VehicleType: vehicleType, VehicleMake: vehicleMake,YearOfRegistration: yearOfRegistration,MobileNo: mobileNo });

         });
        var flag = "Y";
        //debugger;
       
        if (cardDetail.length > 0 && flag == "Y") 
        {
                var custRefNo = document.getElementById("CustomerReferenceNo").value;
                var noOfCards = document.getElementById("NoOfCards").value;
                var custRBEId = document.getElementById("RBEId").value;
                var selectedFeePayment = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val();
                var feePaymentNo = document.getElementById("FeePaymentNo").value;
                var feePaymentDate = document.getElementById("FeePaymentDate").value;
                var cardPreference = $("input[name='CardPreference']:checked").val();
                var noOfVehiclesAllCards = document.getElementById("NoOfVehiclesAllCards").value;
                var vehicleNoVerifiedManually=false;
                if($(VehicleNoVerifiedManually).prop("checked"))
                {
                    vehicleNoVerifiedManually=true;
                }
                                
                //var customerCardInfo = { CustomerReferenceNo: custRefNo, NoOfCards: noOfCards, RBEId : custRBEId, FeePaymentsCollectFeeWaiver : selectedFeePayment, FeePaymentNo : feePaymentNo, FeePaymentDate : feePaymentDate, CardPreference: cardPreference, NoOfVehiclesAllCards : noOfVehiclesAllCards, VehicleNoVerifiedManually : vehicleNoVerifiedManually, ObjCardDetail: cardDetail };
                var customerCardInfo = { CustomerReferenceNo: custRefNo, NoOfCards: noOfCards, RBEId : custRBEId, FeePaymentsCollectFeeWaiver : selectedFeePayment, FeePaymentNo : feePaymentNo, FeePaymentDate : feePaymentDate, CardPreference: cardPreference, NoOfVehiclesAllCards : noOfVehiclesAllCards, VehicleNoVerifiedManually : vehicleNoVerifiedManually, ObjCardDetail: cardDetail };

                //console.log(customerCardInfo);
                console.log('Before Json');
                console.log(JSON.stringify(customerCardInfo));
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("AddCardDetails", "Customer")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(customerCardInfo),
                    success: function (data) 
                    {
                        console.log(data);
                        if(data.statusCode==1000)
                        {
                          $("#divSuccess").html(data.reason);
                          $(".toBeHiddenOnSuccess").hide();
                          document.getElementById("divSuccess").style.display = "block";
                          document.getElementById("divSuccess").className = "mb-3 text-center";
                        }
                        else
                        {
                            $("#divSuccess").html(data.message);
                            document.getElementById("divSuccess").style.display = "block";
                            document.getElementById("divSuccess").className = "alert alert-danger alert-cust-success";
                        }
                        console.log('success');
                    },
                    error: function (ex) {
                        console.log('Failed');
                        alert('Error.' + ex);
                    }
                });
            
        }


        console.log('ZZZZZZZ');

       })

       );

    function SubmitValidations() {
        debugger;

        var i=0;
        var j=0;
        var table = document.getElementById("NoOfCardsTbl");

        if (document.getElementById("CustomerReferenceNo").value == "0" || document.getElementById("CustomerReferenceNo").value == "") 
        {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "Customre Ref No cannot be left blank";
            return false;
        }
        else 
        {
            document.getElementById("CustomerReferenceNo_error").innerHTML = "";
        }

        if (document.getElementById("CustomerName").value == "0" || document.getElementById("CustomerName").value == "") 
        {
            document.getElementById("CustomerName_error").innerHTML = "Customer Name cannot be left blank";
            return false;
        }
        else 
        {
            document.getElementById("CustomerName_error").innerHTML = "";
        }

        if (document.getElementById("FormNumber").value == "0" || document.getElementById("FormNumber").value == "") 
        {
            document.getElementById("FormNumber_error").innerHTML = "Form Number cannot be left blank";
            return false;
        }
        else 
        {
            document.getElementById("FormNumber_error").innerHTML = "";
        }

        if (document.getElementById("NoOfCards").value == "0" || document.getElementById("NoOfCards").value.trim() == "") 
        {
            document.getElementById("NoOfCards_error").innerHTML = "No of Cards cannot be left blank";
            return false;
        }
        else 
        {
            document.getElementById("NoOfCards_error").innerHTML = "";
        }

        var customerTypeId = document.getElementById("CustomerTypeId").value;
        if (customerTypeId == "905" || customerTypeId == "909") 
        {
            if (document.getElementById("NoOfVehiclesAllCards").value == "0" || document.getElementById("NoOfVehiclesAllCards").value == "") 
            {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No Of Vehicles (For All Cards) cannot be left blank";
                return false;
            }
            else 
            {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
            }
        }


        if (document.getElementById("rbtnCard").checked) 
        {

            if (document.getElementById("rbtnFeeWaiver").checked) 
            {
                if (document.getElementById("FeePaymentNo").value == "") 
                {
                    document.getElementById("FeePaymentNo_error").innerHTML = "Approval Email From cannot be left blank";
                    return false;
                }
                else {

                    if (document.getElementById("FeePaymentNo").value.match(email)) {
                        document.getElementById("FeePaymentNo_error").innerHTML = "";
                        //return true
                    }
                    else {
                        document.getElementById("FeePaymentNo_error").innerHTML = "Invalid email id (e.g.: abc@gmail.com)";
                        return (false);
                    }
                }

                if (document.getElementById("FeePaymentDate").value == "0" || document.getElementById("FeePaymentDate").value == "") {
                    document.getElementById("FeePaymentDate_error").innerHTML = "Approval Email Date cannot be left blank";
                    return false;
                }
                else {
                    document.getElementById("FeePaymentDate_error").innerHTML = "";
                }
            }
        }

        if (document.getElementById("rbtnCard").checked) {

            if (document.getElementById("rbtnOnline").checked) {
                if (document.getElementById("FeePaymentNo").value == "0" || document.getElementById("FeePaymentNo").value == "") {
                    document.getElementById("FeePaymentNo_error").innerHTML = "Payment Source cannot be left blank";
                    return false;
                }
                else {
                    document.getElementById("FeePaymentNo_error").innerHTML = "";
                }

                if (document.getElementById("FeePaymentDate").value == "0" || document.getElementById("FeePaymentDate").value == "") {
                    document.getElementById("FeePaymentDate_error").innerHTML = "Payment Date cannot be left blank";
                    return false;
                }
                else {
                    document.getElementById("FeePaymentDate_error").innerHTML = "";
                }
            }
        }

        if (!(document.querySelector('input[name="CardPreference"]:checked'))) {
            alert("Card Preference Not Selected");
            return;
        }

        if (document.getElementById("rbtnCard").checked) {
            if (!(document.querySelector('input[name="FeePaymentsCollectFeeWaiver"]:checked'))) {
                alert("Fee Payment Details Not Selected");
                return false;
            }
        }

        var selectedCardType = $("input[name='CardPreference']:checked").val();
        document.getElementById("CardPreference").value = selectedCardType;
        console.log(selectedCardType);

        var selectedFeePayment = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val();
        document.getElementById("FeePaymentsCollectFeeWaiver").value = selectedFeePayment;
        console.log(selectedFeePayment);

        var count = $('#NoOfCardsTbl tr').length;

        //alert(count);

        if (count == 1) {
            alert("Vehicle Details Not Added");
            return false;
        }

        var DuplicateFound = false;
        var DetailsNotFound = false;
        var InvalidYearFound = false;

        var selected = $("input[name='CardPreference']:checked").val();
        if (selected == "" || selected == undefined)
            selected = "Not Selected";

        if (customerTypeId == "901" || customerTypeId == "906") //Fleet And Credit
        {

            document.getElementById("Common_error").innerHTML = "";

            $('#NoOfCardsTbl td:nth-child(2) input').filter(function () {
                var VehicleNo = $(this).val().trim();
                if (VehicleNo == "") {
                    //document.getElementById("Common_error").innerHTML = "Plese Enter Vehicle Number for all the rows";
                    alert("Plese Enter Vehicle Number for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            j=0;i=0;
            console.log('Before Checking For Duplicate VehicleNo');
            for (let row of table.rows) 
            {
                j=0;
                i=i+1;
                for (let row1 of table.rows) 
                {
                    j=j+1;
                    if(i>1 && j>1 && j>i)
                    {
                        var PrevRVno = $(row).find("td:eq(1) input[type='text']").val();
                        var CurRVno = $(row1).find("td:eq(1) input[type='text']").val();

                        if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                        {
                            console.log("Ravi" + i + " " + j)
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                               row1.cells[7].innerHTML="Duplicate Vehicle No";
                            }
                            else
                            {
                                row1.cells[6].innerHTML="Duplicate Vehicle No";
                            }
                            DuplicateFound = true;
                        }
                    }
                }
            }

            if (DuplicateFound)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(5) input').filter(function () {
                var vehicleMake = $(this).val().trim();
                if (vehicleMake == "") {
                    //document.getElementById("Common_error").innerHTML = "Please Enter Vehicle Make for all the rows";
                    alert("Please Enter Vehicle Make for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(6) input').filter(function () {
                var yearReg = $(this).val().trim();
                if (yearReg == "") {
                    //document.getElementById("Common_error").innerHTML = "Please Enter Year Of Reg. for all the rows";
                    alert("Please Enter Year Of Reg. for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            const d = new Date();
            let curYear = d.getFullYear();

            console.log('Before Checking For Year Of Registration');
            $('#NoOfCardsTbl td:nth-child(6) input').filter(function () {
                var YearOfRegistration = $(this).val();
                if (YearOfRegistration != "") {
                    if (YearOfRegistration < 1980 || YearOfRegistration > curYear) {
                        //document.getElementById("Common_error").innerHTML = "Year Of Reg. must be between 1980 and " + curYear;
                        alert("Year Of Reg. must be between 1980 and " + curYear);
                        console.log('Found Invalid Year Of Registration');
                        console.log(YearOfRegistration);
                        InvalidYearFound = true;
                        return false;
                    }

                    if (YearOfRegistration.length < 4) {
                        //document.getElementById("Common_error").innerHTML = "Length of Year Of Registration must be 4 digit";
                        alert("Invalid Year Of Registration");
                        console.log('Found Invalid Year Of Registration');
                        console.log(YearOfRegistration);
                        InvalidYearFound = true;
                        return false;
                    }

                }
            });

            if (InvalidYearFound)
            {
                return false;
            }

            var VehicleTypeNotSelected=false;

            $('#NoOfCardsTbl td:nth-child(4) select').filter(function () {
                var VehicleType = $(this).val().trim();
                console.log(VehicleType);
                if (VehicleType == "--Select--") {
                    //document.getElementById("Common_error").innerHTML = "Please select vehicle Type for all the rows";
                    alert("Please select vehicle Type for all the rows");
                    VehicleTypeNotSelected = true;
                    return false;
                }
            });

            if (VehicleTypeNotSelected)
            {
                return false;
            }

            if (selected.toUpperCase() == "CARDLESS")
            {

                console.log('Before Checking For Invalid Mobile Number');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    i=i+1;

                    if(i>1)
                    {
                        var mobileNo = $(row).find("td:eq(6) input[type='text']").val();

                        if (mobileNo != "" && mobileNo.charAt(0) == "0") 
                        {
                            row1.cells[7].innerHTML="Invalid Mobile Number.";
                            DetailsNotFound = true;
                        }
                        else
                        {
                            if (mobileNo != "" && mobileNo.length < 10) 
                            {
                                row1.cells[7].innerHTML="Invalid Mobile Number.";
                                DetailsNotFound = true;
                            }
                            else
                            {
                                 row1.cells[7].innerHTML="";
                            }
                        }
                    }

                }


                if (DetailsNotFound)
                {
                    return false;
                }

                console.log('Before Checking For Duplicate MobileNo');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    j=0;
                    i=i+1;
                    for (let row1 of table.rows) 
                    {
                        j=j+1;
                        if(i>1 && j>1 && j>i)
                        {
                            var PrevRVno = $(row).find("td:eq(6) input[type='text']").val();
                            var CurRVno = $(row1).find("td:eq(6) input[type='text']").val();

                            if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                            {
                                if (mobileNo != "" && mobileNo.length < 10) 
                                {
                                    row1.cells[7].innerHTML="Invalid Mobile Number.";
                                }
                                else
                                {
                                     row1.cells[7].innerHTML="";
                                }
                                DuplicateFound=true;
                            }
                        }
                    }
                }

                if (DuplicateFound)
                {
                    return false;
                }

                console.log('Before Checking Existing Vehicle No');
                var table = document.getElementById("NoOfCardsTbl");
                for (let row of table.rows)
                {
                    //alert(row.cells[8].innerHTML);
                    if(row.cells[8].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(1) input[type='text']").val();
                        Vhno=Vhno.toUpperCase()
                        alert('Vehicle No Already Exists: ' + Vhno);
                        return false;
                    }
                }

                if (!$(VehicleNoVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[9].innerHTML);
                        if(row.cells[9].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(1) input[type='text']").val();
                            Vhno=Vhno.toUpperCase()
                            alert('Vehicle No Not Verified: ' + Vhno);
                            return false;
                        }
                    }
                }

            }
            else
            {
                console.log('Before Checking Existing Vehicle No');
                var table = document.getElementById("NoOfCardsTbl");
                for (let row of table.rows)
                {
                    //alert(row.cells[7].innerHTML);
                    if(row.cells[7].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(1) input[type='text']").val();
                        Vhno=Vhno.toUpperCase()
                        alert('Vehicle No Already Exists: ' + Vhno);
                        return false;
                    }
                }

                if (!$(VehicleNoVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[8].innerHTML);
                        if(row.cells[8].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(1) input[type='text']").val();
                            Vhno=Vhno.toUpperCase()
                            alert('Vehicle No Not Verified: ' + Vhno);
                            return false;
                        }
                    }
                }



            }

        }
        else if (customerTypeId == "905" || customerTypeId == "909") //Attached,Generic
        {

            document.getElementById("Common_error").innerHTML = "";

            $('#NoOfCardsTbl td:nth-child(2) input').filter(function () {
                var cardIdentifier = $(this).val().trim();
                if (cardIdentifier == "") {
                    //document.getElementById("Common_error").innerHTML = "Please Enter Card Identifier for all the rows";
                    alert("Please Enter Card Identifier for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            i=0;
            j=0;
            console.log('Before Checking For Duplicate Card Identifier');
            for (let row of table.rows) 
            {
                j=0;
                i=i+1;
                for (let row1 of table.rows) 
                {
                    j=j+1;
                    if(i>1 && j>1 && j>i)
                    {
                        var PrevRVno = $(row).find("td:eq(1) input[type='text']").val();
                        var CurRVno = $(row1).find("td:eq(1) input[type='text']").val();

                        if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                        {
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                               row1.cells[8].innerHTML="Duplicate Card Identifier";
                            }
                            else
                            {
                                row1.cells[7].innerHTML="Duplicate Card Identifier";
                            }
                            DuplicateFound=true;
                        }
                        
                    }
                }
            }

            if (DuplicateFound)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(3) input').filter(function () {
                var VehicleNo = $(this).val().trim();
                if (VehicleNo == "") {
                    //document.getElementById("Common_error").innerHTML = "Please Enter Vehicle Number for all the rows";
                    alert("Please Enter Vehicle Number for all the rows");
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            i=0;
            j=0;
            console.log('Before Checking For Duplicate VehicleNo');
            for (let row of table.rows) 
            {
                j=0;
                i=i+1;
                for (let row1 of table.rows) 
                {
                    j=j+1;
                    if(i>1 && j>1 && j>i)
                    {
                        var PrevRVno = $(row).find("td:eq(2) input[type='text']").val();
                        var CurRVno = $(row1).find("td:eq(2) input[type='text']").val();

                        if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                        {
                            //console.log("Ravi" + i + " " + j)
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                               row1.cells[8].innerHTML="Duplicate Vehicle No";
                            }
                            else
                            {
                                row1.cells[7].innerHTML="Duplicate Vehicle No";
                            }
                            DuplicateFound=true;
                        }
                    }
                }
            }


            if (DuplicateFound)
            {
                return false;
            }

            var VehicleTypeNotSelected=false;

            $('#NoOfCardsTbl td:nth-child(5) select').filter(function () {
                var VehicleType = $(this).val().trim();
                console.log(VehicleType);
                if (VehicleType == "--Select--") {
                    document.getElementById("Common_error").innerHTML = "Please select vehicle Type for all the rows";
                    VehicleTypeNotSelected = true;
                    return false;
                }
            });

            if (VehicleTypeNotSelected)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(6) input').filter(function () {
                var vehicleMake = $(this).val().trim();
                if (vehicleMake == "") {
                    document.getElementById("Common_error").innerHTML = "Please Enter Vehicle Make for all the rows";
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            $('#NoOfCardsTbl td:nth-child(7) input').filter(function () {
                var yearReg = $(this).val().trim();
                if (yearReg == "") {
                    document.getElementById("Common_error").innerHTML = "Please Enter Year Of Reg. for all the rows";
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            const d = new Date();
            let curYear = d.getFullYear();

            console.log('Before Checking For Year Of Registration');
            $('#NoOfCardsTbl td:nth-child(7) input').filter(function () {
                var YearOfRegistration = $(this).val();
                if (YearOfRegistration != "") {
                    if (YearOfRegistration < 1980 || YearOfRegistration > curYear) {
                        document.getElementById("Common_error").innerHTML = "Year Of Reg. must be between 1980 and " + curYear;
                        console.log('Found Invalid Year Of Registration');
                        console.log(YearOfRegistration);
                        InvalidYearFound = true;
                        return false;
                    }

                    if (YearOfRegistration.length < 4) {
                        document.getElementById("Common_error").innerHTML = "Length of Year Of Registration must be 4 digit";
                        console.log('Found Invalid Year Of Registration');
                        console.log(YearOfRegistration);
                        InvalidYearFound = true;
                        return false;
                    }

                }
            });

            if (InvalidYearFound)
            {
                return false;
            }

            if (selected.toUpperCase() == "CARDLESS")
            {

                console.log('Before Checking For Invalid Mobile Number');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    i=i+1;

                    if(i>1)
                    {
                        var mobileNo = $(row).find("td:eq(7) input[type='text']").val();

                        if (mobileNo != "" && mobileNo.charAt(0) == "0") 
                        {
                            row1.cells[8].innerHTML="Invalid Mobile Number.";
                            DetailsNotFound = true;
                        }
                        else
                        {
                            if (mobileNo != "" && mobileNo.length < 10) 
                            {
                                row1.cells[8].innerHTML="Invalid Mobile Number.";
                                DetailsNotFound = true;
                            }
                            else
                            {
                                 row1.cells[8].innerHTML="";
                            }
                        }
                    }

                }


                if (DetailsNotFound)
                {
                    return false;
                }

                console.log('Before Checking For Duplicate MobileNo');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    j=0;
                    i=i+1;
                    for (let row1 of table.rows) 
                    {
                        j=j+1;
                        if(i>1 && j>1 && j>i)
                        {
                            var PrevRVno = $(row).find("td:eq(7) input[type='text']").val();
                            var CurRVno = $(row1).find("td:eq(7) input[type='text']").val();

                            if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                            {
                                if (mobileNo != "" && mobileNo.length < 10) 
                                {
                                    row1.cells[8].innerHTML="Invalid Mobile Number.";
                                }
                                else
                                {
                                     row1.cells[8].innerHTML="";
                                }
                                DuplicateFound=true;
                            }
                        }
                    }
                }

                if (DuplicateFound)
                {
                    return false;
                }

                console.log('Before Checking Existing Vehicle No');
                var table = document.getElementById("NoOfCardsTbl");
                for (let row of table.rows)
                {
                    //alert(row.cells[9].innerHTML);
                    if(row.cells[9].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(2) input[type='text']").val();
                        Vhno=Vhno.toUpperCase()
                        alert('Vehicle No Already Exists: ' + Vhno);
                        return false;
                    }
                }

                if (!$(VehicleNoVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[10].innerHTML);
                        if(row.cells[10].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(2) input[type='text']").val();
                            Vhno=Vhno.toUpperCase()
                            alert('Vehicle No Not Verified: ' + Vhno);
                            return false;
                        }
                    }
                }


            }
            else
            {
                console.log('Before Checking Existing Vehicle No');
                var table = document.getElementById("NoOfCardsTbl");
                for (let row of table.rows)
                {
                    //alert(row.cells[8].innerHTML);
                    if(row.cells[8].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(2) input[type='text']").val();
                        Vhno=Vhno.toUpperCase()
                        alert('Vehicle No Already Exists: ' + Vhno);
                        return false;
                    }
                }

                if (!$(VehicleNoVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[9].innerHTML);
                        if(row.cells[9].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(2) input[type='text']").val();
                            Vhno=Vhno.toUpperCase()
                            alert('Vehicle No Not Verified: ' + Vhno);
                            return false;
                        }
                    }
                }

            }

        }
        else if (customerTypeId == "902" || customerTypeId == "917") //Corporate,Non Fleet
        {

            document.getElementById("Common_error").innerHTML = "";

            $('#NoOfCardsTbl td:nth-child(2) input').filter(function () {
                var cardIdentifier = $(this).val().trim();
                if (cardIdentifier == "") {
                    document.getElementById("Common_error").innerHTML = "Please Enter Card Identifier for all the rows";
                    DetailsNotFound = true;
                    return false;
                }
            });

            if (DetailsNotFound)
            {
                return false;
            }

            i=0;j=0;
            console.log('Before Checking For Duplicate Card Identifier');
            for (let row of table.rows) 
            {
                j=0;
                i=i+1;
                for (let row1 of table.rows) 
                {
                    j=j+1;
                    if(i>1 && j>1 && j>i)
                    {
                        var PrevRVno = $(row).find("td:eq(1) input[type='text']").val();
                        var CurRVno = $(row1).find("td:eq(1) input[type='text']").val();

                        if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                        {
                            //console.log("Ravi" + i + " " + j)
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                               row1.cells[3].innerHTML="Duplicate Card Identifier";
                            }
                            else
                            {
                                row1.cells[2].innerHTML="Duplicate Card Identifier";
                            }
                            DuplicateFound=true;
                        }
                    }
                }
            }

            if (DuplicateFound)
            {
                return false;
            }


            if (selected.toUpperCase() == "CARDLESS")
            {

                console.log('Before Checking For Invalid Mobile Number');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    i=i+1;

                    if(i>1)
                    {
                        var mobileNo = $(row).find("td:eq(2) input[type='text']").val();

                        if (mobileNo != "" && mobileNo.charAt(0) == "0") 
                        {
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                                row1.cells[3].innerHTML="Invalid Mobile Number.";
                            }
                            else
                            {
                                row1.cells[2].innerHTML="Invalid Mobile Number.";
                            }
                            DetailsNotFound = true;
                        }

                        if (mobileNo != "" && mobileNo.length < 10) 
                        {
                            if (selected.toUpperCase() == "CARDLESS")
                            {
                                row1.cells[3].innerHTML="Invalid Mobile Number.";
                            }
                            else
                            {
                                row1.cells[2].innerHTML="Invalid Mobile Number.";
                            }
                            DetailsNotFound = true;
                        }
                    }

                }


                if (DetailsNotFound)
                {
                    return false;
                }

                console.log('Before Checking For Duplicate MobileNo');
                i=0;j=0;
                for (let row of table.rows) 
                {
                    j=0;
                    i=i+1;
                    for (let row1 of table.rows) 
                    {
                        j=j+1;
                        if(i>1 && j>1 && j>i)
                        {
                            var PrevRVno = $(row).find("td:eq(2) input[type='text']").val();
                            var CurRVno = $(row1).find("td:eq(2) input[type='text']").val();

                            if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                            {
                                if (selected.toUpperCase() == "CARDLESS")
                                {
                                   row1.cells[3].innerHTML="Duplicate Mobile Number";
                                }
                                else
                                {
                                    row1.cells[2].innerHTML="Duplicate Mobile Number";
                                }
                                DuplicateFound=true;
                            }
                        }
                    }
                }

                if (DuplicateFound)
                {
                    return false;
                }
            }

        }
        console.log('BBBBBB');
        return true;
    }


</script>

<script language="javascript">
      $(document).ready(function () {

          $('input[name="FeePaymentsCollectFeeWaiver"]:radio').change(function () {
              //alert($("input[name='FeePaymentsCollectFeeWaiver']:checked").val());

              var selected = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val()
              //alert(selected);
              if (selected == "1") {
                $('#lblChequeNo').text('');
                $('#lblChequeNo').append("Payment Source<sup class='text-danger'>*</sup>");
                $('#lblChequeDate').text('');
                $('#lblChequeDate').text("Payment Date<sup class='text-danger'>*</sup>");
              }
              else if (selected == "2") {
                $('#lblChequeNo').text('');
                $('#lblChequeNo').append("Approval Email From<sup class='text-danger'>*</sup>");
                $('#lblChequeDate').text('');
                $('#lblChequeDate').append("Approval Email Date<sup class='text-danger'>*</sup>");
              }

          });

          $('#lblReceivedAmount').hide();
          $('#ReceivedAmount').hide();

          $('input[name="CardPreference"]:radio').change(function () {
              //alert($("input[name='CardPreference']:checked").val());

              var selected = $("input[name='CardPreference']:checked").val()
              //alert(selected);
              if (selected == "Cardless") {
                  $('#lblChequeNo').hide();
                  $('#lblChequeDate').hide();
                  $("#FeePaymentNo").val('');
                  $("#FeePaymentDate").val('');
                  $('#FeePaymentNo').hide();
                  $('#FeePaymentDate').hide();
                  $('#ReceivedAmount').hide();
                  $('#divFeePaymentDetails').hide();
                  $('#lblReceivedAmount').hide();
                  document.getElementById("rbtnFeeWaiver").checked = false;
                  document.getElementById("rbtnOnline").checked = false;
              }
              else if (selected == "Card") {
                  $('#lblChequeNo').show();
                  $('#lblChequeDate').show();
                  $("#FeePaymentNo").val('');
                  $("#FeePaymentDate").val('');
                  $('#FeePaymentNo').show();
                  $('#FeePaymentDate').show();
                  $('#ReceivedAmount').show();
                  $('#divFeePaymentDetails').show();
                  $('#lblReceivedAmount').show();

                  document.getElementById("rbtnFeeWaiver").checked = true;
                  //$("#rbtnCard").prop('disabled', false);
                  //$("#FeePaymentNo").prop('disabled', false);
                  //$("#FeePaymentDate").prop('disabled', false);
                  //$('#lblChequeNo').text("Approval Email From");
                  if(document.getElementById("rbtnFeeWaiver").checked)
                  {
                      $('#lblReceivedAmount').hide();
                      $('#ReceivedAmount').hide();
                  }
              }

              //LoadCardDeatils();

          });
      });

      function RemoveSpecialChar(txtName) {
          if (txtName.value != '' && txtName.value.match(/^[\w ]+$/) == null) {
              txtName.value = txtName.value.replace(/[\W]/g, '');
          }
      }

      function CheckVechileNoUsed(o, rowSelected) {
          debugger;
          var vehicleNo = o.value;
          console.log(vehicleNo);

          var customerTypeId = document.getElementById("CustomerTypeId").value;


          var selected = $("input[name='CardPreference']:checked").val();
          if (selected == "" || selected == undefined)
              selected = "Not Selected";
          console.log(selected);


          console.log(rowSelected);
          var tbl = document.getElementById('NoOfCardsTbl');
          mytablebody = tbl.getElementsByTagName("tbody")[0];
          myrow = mytablebody.getElementsByTagName("tr")[rowSelected];
          var mycel;
          var mycelStatus;
          if (customerTypeId == "901" || customerTypeId == "906") {
              if (selected.toUpperCase() == "CARDLESS") {
                  mycel = myrow.getElementsByTagName("td")[7];
                  mycelStatus=myrow.getElementsByTagName("td")[8];
              }
              else {
                  mycel = myrow.getElementsByTagName("td")[6];
                  mycelStatus=myrow.getElementsByTagName("td")[7];
              }
          }
          else if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic
              if (selected.toUpperCase() == "CARDLESS") {
                  mycel = myrow.getElementsByTagName("td")[8];
                  mycelStatus=myrow.getElementsByTagName("td")[9];
              }
              else {
                  mycel = myrow.getElementsByTagName("td")[7];
                  mycelStatus=myrow.getElementsByTagName("td")[8];
              }
          }
          console.log(mycel);
          if (vehicleNo == '') {
              mycel.innerHTML = "Enter Vehicle No";
              mycelStatus.innerHTML = "";
              return;
          }
          else {
              mycel.innerHTML = "";
              mycelStatus.innerHTML = "";
          }

          var result = false;


          $.ajax({
              type: 'POST',  // http method
              url: "CheckVechileNoUsed/Customer",
              data: { VechileNo: vehicleNo },  // data to submit
              dataType: "json",
              success: function (data, status, xhr) {
                  console.log(data);
                  if (data.status == "0") {
                      mycel.innerHTML = "Vehicle No. already exists";
                      mycelStatus.innerHTML = "1";
                  }
                  else {
                      mycel.innerHTML = "";
                      mycelStatus.innerHTML = "0";
                  }
              },
              error: function (jqXhr, textStatus, errorMessage) {
                  mycel.innerHTML = "Vehicle No. already exists";
                  mycelStatus.innerHTML = "1";

              }
          });

      }

      $("#btnHeaderReset").click(function () {
          debugger;
          document.getElementById("CustomerReferenceNo").value = "";
          $("#CustomerReferenceNo").prop('readonly', false);
          document.getElementById("CustomerReferenceNo_error").innerHTML = "";
          document.getElementById("CustomerName").value = "";
          document.getElementById("FormNumber").value = "";
          $('#lblNoOfVehicles').hide();
          $('#NoOfVehiclesAllCards').hide();
          document.getElementById("RBEId").value = "";
          document.getElementById("RBEName").value = "";
          $("#RBEId").prop('readonly', false);
          document.getElementById("rbtnCardless").checked = false;
          document.getElementById("rbtnCardless").disabled = false;

          document.getElementById("rbtnCard").checked = false;
          document.getElementById("rbtnCard").disabled = false;

          document.getElementById("rbtnOnline").checked = false;
          document.getElementById("rbtnOnline").disabled = false;

          document.getElementById("rbtnFeeWaiver").checked = false;
          document.getElementById("rbtnFeeWaiver").disabled = false;

          document.getElementById("FeePaymentNo").value = "";
          document.getElementById("FeePaymentDate").value = "";

          $("#rbtnCard").prop('disabled', false);
          $("#FeePaymentNo").prop('readonly', false);
          $("#FeePaymentDate").prop('readonly', false);
          document.getElementById("NoOfCards").value = "";
          $("#NoOfCards").prop('readonly', false);
          document.getElementById("ReceivedAmount").value = "";

          $('#NoOfCardsTbl > tr').remove();
          document.getElementById('NoOfCardsTbl').style.display = 'none';


          $('#NoOfCards').attr("readonly", false);
          $('#FeePaymentDate').attr("readonly", false);
          $('#FeePaymentNo').attr("readonly", false);
          document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
          document.getElementById("FeePaymentNo_error").innerHTML = "";
          document.getElementById("Common_error").innerHTML = "";
          document.getElementById("divSubmit").style.display = "none";
          document.getElementById("divDetails").style.display = "none";
          document.getElementById("NoOfVehiclesAllCards").value = "";
          document.getElementById("NoOfCards_error").innerHTML = "";
          //$("#Remarks").html('');
          //$("#dvRemarks").html('');
          //dvRemarks.style.display = 'none';

      });

      function IsAlphaNumeric(keyCode) {
           return ((keyCode >= 48 && keyCode <= 57) || (keyCode >= 65 && keyCode <= 90) || keyCode == 8 || keyCode == 46 ||
                    (keyCode >= 97 && keyCode <= 122) || keyCode == 37 || keyCode == 38 || keyCode == 39 || keyCode == 40);
      }

      function ValidateVehicleNo(rowSelected) {
          debugger;
          var customerTypeId = document.getElementById("CustomerTypeId").value;

          if($(VehicleNoVerifiedManually).prop("checked"))
          {
              return false;
          }

          var tbl = document.getElementById('NoOfCardsTbl');
          mytablebody = tbl.getElementsByTagName("tbody")[0];
          myrow = mytablebody.getElementsByTagName("tr")[rowSelected];
          mycel = myrow.getElementsByTagName("td")[1];
          mycelValidStatus = myrow.getElementsByTagName("td")[1];

          if (customerTypeId == "901" || customerTypeId == "906") {//Fleet
              mycel = myrow.getElementsByTagName("td")[1];
          }
          else if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic
              mycel = myrow.getElementsByTagName("td")[2];
          }

          console.log(mycel);
          var vehicleNo = mycel.getElementsByTagName("input")[0].value;

          console.log(vehicleNo);


          var selected = $("input[name='CardPreference']:checked").val();
          if (selected == "" || selected == undefined)
              selected = "Not Selected";
          console.log(selected);


          console.log(rowSelected);
          var tbl = document.getElementById('NoOfCardsTbl');
          mytablebody = tbl.getElementsByTagName("tbody")[0];
          myrow = mytablebody.getElementsByTagName("tr")[rowSelected];
          var mycel;
          if (customerTypeId == "901" || customerTypeId == "906") {//Fleet
              if (selected.toUpperCase() == "CARDLESS") {
                  mycel = myrow.getElementsByTagName("td")[7];
                  mycelValidStatus = myrow.getElementsByTagName("td")[9];
              }
              else {
                  mycel = myrow.getElementsByTagName("td")[6];
                  mycelValidStatus = myrow.getElementsByTagName("td")[8];
              }
          }
          else if (customerTypeId == "905" || customerTypeId == "909") {//Attached,Generic
              if (selected.toUpperCase() == "CARDLESS") {
                  mycel = myrow.getElementsByTagName("td")[8];
                  mycelValidStatus = myrow.getElementsByTagName("td")[10];
              }
              else {
                  mycel = myrow.getElementsByTagName("td")[7];
                  mycelValidStatus = myrow.getElementsByTagName("td")[9];
              }
          }
          console.log(mycel);
          if (vehicleNo == '') {
              mycel.innerHTML = "Please Enter Vehicle No";
              return;
          }
          else {
              mycel.innerHTML = "";
          }


          $.ajax({
              type: 'POST',  // http method
              url: "CheckVehicleRegistrationValid/Customer",
              data: { RegistrationNumber: vehicleNo },  // data to submit
              dataType: "json",
              success: function (data, status, xhr) {
                  //debugger;
                  var jsonData = JSON.parse(data);
                  if (status == 'success' && jsonData['statusCode'] == '101') {
                      result = true;
                      //mycel.innerHTML = "Vehicle Number is valid";
                      mycel.innerHTML = "";
                      console.log(jsonData);
                      mycelValidStatus.innerHTML="1";
                      //console.log(mycel.innerHTML);
                  }
                  else {
                      mycel.innerHTML = "Invalid Vehicle Number";
                      mycelValidStatus.innerHTML="0";
                  }
              },
              error: function (jqXhr, textStatus, errorMessage) {
                  mycel.innerHTML = "Invalid Vehicle Number";
                  mycelValidStatus.innerHTML="0";

              }
          });

      }

    $('#VehicleNoVerifiedManually').click(function()
    {
          var customerTypeId = document.getElementById("CustomerTypeId").value;
          console.log(customerTypeId);
          if ($(this).prop("checked"))
          {
             $(".verify").addClass("disabled");
          }
          else
          {
              $('.verify').removeClass("disabled");
          }

    });

   $("#NoOfCards").on("blur", function () 
   {
    //debugger;
       if (document.getElementById('NoOfCards').value.trim() == "" || document.getElementById('NoOfCards').value == "0") 
       {
            document.getElementById("NoOfCards_error").innerHTML = "No of Cards cannot be left blank";
            return false;
       }
       else 
       {
            if (Number(document.getElementById('NoOfCards').value) < 1 || Number(document.getElementById('NoOfCards').value) > 10) 
            {
                document.getElementById("NoOfCards_error").innerHTML = "No of Cards may be 1 to 10";
                return false;
            }
            else 
            {
                document.getElementById("NoOfCards_error").innerHTML = "";
            }
       }
        
    });

   $("#NoOfVehiclesAllCards").on("blur", function () 
   {
    //debugger;
       var noofCards = document.getElementById('NoOfCards').value.trim();
       if(noofCards=="") noofCards = 0;
       if (document.getElementById('NoOfVehiclesAllCards').value.trim() == "" || document.getElementById('NoOfVehiclesAllCards').value == "0") 
       {
            document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No of Vehicles (For All Cards) cannot be left blank";
            return false;
       }
       else 
       {
            if (Number(document.getElementById('NoOfVehiclesAllCards').value) < 1 || Number(document.getElementById('NoOfVehiclesAllCards').value) > 10) 
            {
                document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No of Cards may be 1 to 10";
                return false;
            }
            else 
            {
                if (Number(document.getElementById('NoOfVehiclesAllCards').value) < noofCards) 
                {
                     document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "No Of Vehicles (For All Cards) cannnot be less than No of Cards";
                }
                else
                {
                    document.getElementById("NoOfVehiclesAllCards_error").innerHTML = "";
                }
                
            }
       }
        
    });

</script>