@model HPCL.Common.Models.ViewModel.AshokLeyLand.AshokLeylandCustomerUpdateModel
@{
    ViewData["Title"] = "Ashok Leyland Customer Updation";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="col-lg-12 p-4 p-md-4">
   <div class="bg-white p-2 p-md-4">
      <ul class="breadcrumb bread_custom bg-transparent m-0 pb-1 py-0 px-0">
         <li class="breadcrumb-item"><a href="@Url.Action("Index", "AshokLeyLand")" class="text_primary">Ashok Leyland</a> </li>
         <li class="breadcrumb-item font-weight-light">Ashok Leyland Customer Updation</li>
      </ul>
      @using (Html.BeginForm("UpdateALCustomer", "AshokLeyLand", FormMethod.Post, new { @enctype = "multipart/form-data" }))
      {
         <div class="w-100">
            <div class="col-lg-12 col-md-12 col-12 pl-0 pr-0">
               <div class="border-1 rounded border-grey">
                  <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Manage Profile</p>
                  <div class="alert alert-danger alert-cust-success" id="dvRemarks" style="@(Model.Message=="" ? "display:none":"display:block")">
                     @Html.DisplayFor(m => m.Message)
                  </div>
                  <div class="col-lg-12 col-md-12 col-12 py-3">
                     <div class="d-flex align-items-center flex-wrap">
                        <div class="col-lg-12 col-12">
                           <div class="d-flex align-items-center flex-wrap mb-0">
                              <label class="font-weight-normal col-md-2 col-12">Customer ID  <sup class="text-danger">*</sup></label>
                              <div class="col-sm-3 col-md-3 col-12">
                                 <div class="custom_select">
                                    @Html.TextBoxFor(m => m.CustomerID, new { @class = "form-control", @id = "CustomerID", maxlength = "10", onkeypress = "return isNumberKey(event)" })
                                    @Html.ValidationMessageFor(m => m.CustomerID, "", new { @class = "error", @id = "CustomerIdValErrMsg" })
                                 </div>
                              </div>
                              <div class="col-md-7 col-12">
                                 <div class="d-flex align-items-center flex-wrap">
                                    <div class="px-2">
                                       <button class="btn btn_primary regrate_btn" type="button" onclick="ViewCustomerDetails()" id="btnSearch">Search</button>
                                    </div>
                                    <div class="px-2">
                                       <button class="btn btn_primary regrate_btn" type="button" id="btnReset">Reset</button>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="clearfix"></div>
                  </div>
                  <div class="clearfix"></div>
               </div>
            </div>
            <div class="clearfix"></div>
                <div id="dvNoData" style="background-color: #fee4e4;display:none;text-align:center;font-weight:bold" class="alert alert-danger mt-3">
            </div>
            <div class="clearfix"></div>
            <div id="dvDetails" style="display:none">
               <div class="col-lg-12 col-md-12 col-12 pl-0 pr-0 mt-3">
                  <div class="border-1 rounded border-grey pb-0">
                     <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Application Details</p>
                     <div class="col-lg-12 col-md-12 col-12 pt-3">
                        <div class="d-flex align-items-center flex-wrap">
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal col-md-4 col-12">Customer/Org Name <sup class="text-danger">*</sup></label>
                                 <div class="col-md-8 col-12">
                                    <div class="row">
                                       <div class="col-md-4 col-12">
                                          <div class="custom_select">
                                             @Html.DropDownListFor(x => x.IndividualOrgNameTitle, new[]{
                                             new SelectListItem(){ Text = "Title", Value = "0" },
                                             new SelectListItem(){ Text = "Mr", Value = "Mr"},
                                             new SelectListItem(){ Text = "Ms", Value = "Ms"},
                                             new SelectListItem(){ Text = "M/s", Value = "M/s"},
                                             }, null, new { @class = "form-control px-0" })
                                          </div>
                                          <span class="error" id="salutaion_error"></span>
                                       </div>
                                       <div class="col-md-8 col-12 px-0">
                                          <div class="custom_select">
                                             @Html.TextBoxFor(m => m.IndividualOrgName, new { @class = "form-control", autocomplete = "off", maxlength = "50" })
                                          </div>
                                          <span class="error" id="IndividualOrgName_error"></span>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal offset-md-1 col-md-4 col-12">Name On Card <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.NameOnCard, new { @class = "form-control", autocomplete = "off" })
                                       <span class="error" id="nameOnCard_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="clearfix"></div>
                  </div>
               </div>
               <div class="col-lg-12 col-md-12 col-12 pl-0 pr-0 mt-3">
                  <div class="border-1 rounded border-grey pb-0">
                     <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Communication Address</p>
                     <div class="col-lg-12 col-md-12 col-12 py-3">
                        <div class="d-flex align-items-center flex-wrap">
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal col-md-4 col-12">City <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.CommunicationCityName, new { @class = "form-control", autocomplete = "off" })
                                       <span class="error" id="communicationCityName_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal offset-md-1 col-md-4 col-12">PIN Code <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.CommunicationPincode, new { @class = "form-control", maxlength = "6", onkeypress = "return isNumberKey(event)", autocomplete = "off" })
                                       <span class="error" id="communicationPincode_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="d-flex align-items-center flex-wrap">
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal col-md-4 col-12">State <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.DropDownListFor(m => m.CommunicationStateId, new SelectList(Model.CustomerStateMdl, "StateID", "StateName"), new { @class = "form-control" })
                                       <span class="error" id="comm_states_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal offset-md-1 col-md-4 col-12">District <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.DropDownListFor(m => m.CommunicationDistrictId, new SelectList(Model.CommunicationDistrictMdl, "districtID", "districtName"), new { @class = "form-control" })
                                       <span class="error" id="comm_district_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="d-flex align-items-center flex-wrap">
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal col-md-4 col-12">Ph (Off) </label>
                                 <div class="col-md-7 col-12">
                                    <div class="row">
                                       <div class="col-4">
                                          @Html.TextBoxFor(m => m.CommunicationDialCode, new { @class = "form-control", maxlength = "4", onkeypress = "return isNumberKey(event)", autocomplete = "off" })
                                          <span class="error" id="CommunicationDialCode_error"></span>
                                       </div>
                                       <div class="col-8 pl-0">
                                          @Html.TextBoxFor(m => m.CommunicationPhonePart2, new { @class = "form-control", maxlength = "8", onkeypress = "return isNumberKey(event)", autocomplete = "off" })
                                          <span class="error" id="CommunicationPhonePart2_error"></span>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal offset-md-1 col-md-4 col-12">Fax </label>
                                 <div class="col-md-7 col-12">
                                    <div class="row">
                                       <div class="col-4">
                                          @Html.TextBoxFor(m => m.CommunicationFaxCode, new { @class = "form-control", maxlength = "4", onkeypress = "return isNumberKey(event)", autocomplete = "off" })
                                          <span class="error" id="CommunicationFaxCode_error"></span>
                                       </div>
                                       <div class="col-8 pl-0">
                                          @Html.TextBoxFor(m => m.CommunicationFaxPart2, new { @class = "form-control", maxlength = "8", onkeypress = "return isNumberKey(event)", autocomplete = "off" })
                                          <span class="error" id="CommunicationFaxPart2_error"></span>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="d-flex align-items-center flex-wrap">
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal col-md-4 col-12">Mobile <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.CommunicationMobileNo, new { @class = "form-control", maxlength = "10", onkeypress = "return isNumberKey(event)", autocomplete = "off" })
                                       <span class="error" id="comm_mobileNumber_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal offset-md-1 col-md-4 col-12">Email <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.CommunicationEmailid, new { @class = "form-control", autocomplete = "off", maxlength = "50" })
                                       <span class="error" id="comm_email_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="d-flex align-items-center flex-wrap">
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal col-md-4 col-12">Address 1 <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.CommunicationAddress1, new { @class = "form-control", autocomplete = "off", maxlength = "50" })
                                       <span class="error" id="comm_address1_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal offset-md-1 col-md-4 col-12">Address 2 <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.CommunicationAddress2, new { @class = "form-control", autocomplete = "off", maxlength = "50" })
                                       <span class="error" id="comm_address2_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="clearfix"></div>
                  </div>
               </div>
               <div class="col-lg-12 col-md-12 col-12 pl-0 pr-0 mt-3">
                  <div class="border-1 rounded border-grey pb-0">
                     <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Dealer Details</p>
                     <div class="col-lg-12 col-md-12 col-12 pt-3">
                        <div class="d-flex align-items-center flex-wrap">
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal col-md-4 col-12">Dealer Code <sup class="text-danger">*</sup></label>
                                 <div class="col-md-7 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.DealerCode, new { @class = "form-control", maxlength = "25", autocomplete = "off" })
                                       <span class="error" id="DealerCode_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-6 col-12">
                              <div class="d-flex align-items-center flex-wrap mb-3">
                                 <label class="font-weight-normal offset-md-1 col-md-5 col-12">Sales Executive Employee ID <sup class="text-danger">*</sup></label>
                                 <div class="col-md-6 col-12">
                                    <div class="custom_select">
                                       @Html.TextBoxFor(m => m.SalesExecutiveEmployeeID, new { @class = "form-control", maxlength = "25", autocomplete = "off" })
                                       <span class="error" id="SalesExecutiveEmployeeID_error"></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="clearfix"></div>
                  </div>
               </div>
               <div class="clearfix"></div>
               <div class="d-flex align-items-center justify-content-center mt-3">
                  <div class="px-2">
                     <button class="btn btn_primary" type="button" onclick="ViewCustomerDetails()">Back</button>
                  </div>
                  <div class="px-2">
                     <button class="btn btn_primary" type="submit" id="btnSubmit">Update</button>
                  </div>
               </div>
            </div>
         </div>
      }
      <div class="clearfix"></div>
   </div>
</div>
<div class="clearfix"></div>
<script>
$('#CustomerID').keypress(function (e) 
{
    if (e.keyCode == 13) // detect the enter key
    {  
        $('#btnSearch').click();
    }
});

 $('select').SumoSelect({
                placeholder: '--Select--',
                search: true,
                searchText: 'Enter Text here.'
            });

$("#CustomerID").on("blur", function () 
{
    debugger;
    if (document.getElementById("CustomerID").value.trim() == "") 
    {
        $("#CustomerIdValErrMsg").attr("style", "display:block");
        $("#CustomerIdValErrMsg").html("Customer ID should not be Empty");
        return false;
    }
    else if (!$("#CustomerID").val().match(mappedCustomerId)) 
    {
        $("#CustomerIdValErrMsg").attr("style", "display:block");
        $("#CustomerIdValErrMsg").html("Invalid Customer ID");
        return false;
    }
    else
    {
        $("#CustomerIdValErrMsg").html("");
    }

});

$("#btnReset").click(function ()
{
    location.reload();
});

 function ViewCustomerDetails()
 {
            debugger;
            if ($("#CustomerID").val().trim() == "")
            {
                $('#CustomerIdValErrMsg').html("Customer ID should not be Empty");
                return false;
            }
            else if (!$("#CustomerID").val().match(mappedCustomerId))
            {
                $("#CustomerIdValErrMsg").attr("style", "display:block");
                $("#CustomerIdValErrMsg").html("Invalid Customer ID");
                return false;
            }
            else
            {
               $('#CustomerIdValErrMsg').html("");
            }

            localStorage.setItem("DUPLICATEPANUSED", "1");

            $.ajax({
                url: "@Url.Action("GetCustomerAddress", "AshokLeyLand")",
                type: "POST",
                dataType: "JSON",
                data: { CustomerId: $("#CustomerID").val() },
                success: function (res)
                {
                    console.log("customer", res.customer);

                    if(res.customer.communicationAddress1!="")
                    {
                        document.getElementById("dvDetails").style.display="block";
                        document.getElementById("dvNoData").style.display = "none";
                        document.getElementById("dvNoData").innerHTML="";
                        $("#CustomerID").prop('readonly', true);

                        $('#CommunicationAddress1').val(res.customer.communicationAddress1);
                        $('#CommunicationAddress2').val(res.customer.communicationAddress2);
                        $('#CommunicationAddress3').val(res.customer.communicationAddress3);
                        $('#CommunicationLocation').val(res.customer.communicationLocation);
                        $('#CommunicationCityName').val(res.customer.communicationCityName);
                        $('#CommunicationPincode').val(res.customer.communicationPincode);
                        $('#IndividualOrgName').val(res.customer.individualOrgName);
                        $('#NameOnCard').val(res.customer.nameOnCard);
                        $('#DealerCode').val(res.customer.dealerCode);
                        $('#SalesExecutiveEmployeeID').val(res.customer.salesExecutiveEmployeeID);
                                                                                                                       

                        $('#CommunicationStateId')[0].sumo.selectItem(res.customer.casid);

                        $('#CommunicationDialCode').val(res.customer.communicationDialCode);
                        $('#CommunicationPhonePart2').val(res.customer.communicationPhonePart2);
                        $('#CommunicationFaxCode').val(res.customer.communicationFaxCode);
                        $('#CommunicationFaxPart2').val(res.customer.communicationFaxPart2);
                        $('#CommunicationMobileNo').val(res.customer.communicationMobileNo);
                        $('#CommunicationEmailid').val(res.customer.communicationEmailid);
                        console.log(res.customer.individualOrgNameTitle);
                        //$('#IndividualOrgNameTitle').sumo.selectItem(res.customer.individualOrgNameTitle);

                         $.ajax({
                            type: 'POST',  // http method
                            url: '@Url.Action("GetDistrictDetails", "Customer")',
                            data: { Stateid: res.customer.casid },  // data to submit
                            dataType: "json",
                            success: function (data, status, xhr) {
                                var v = data;
                                if (status == 'success')
                                {
                                    $("#CommunicationDistrictId").html("");
                                    $.each(data, function (i, data) { // bind the dropdown list using json result
                                        $('<option>',
                                            {
                                                value: data.districtID,
                                                text: data.districtName
                                            }).html(data.districtName).appendTo("#CommunicationDistrictId");
                                    });
                                    $("#CommunicationDistrictId")[0].sumo.reload();

                                    setTimeout(function(){
                                       $('#CommunicationDistrictId')[0].sumo.selectItem(res.customer.cadid);
                                       },500);
                                }
                                else {
                                    console.log(v);
                                }
                            },
                            error: function (jqXhr, textStatus, errorMessage) {
                                alert("Error Populating District Data");
                            }
                        });

                    }
                    else
                    {
                        document.getElementById("dvDetails").style.display = "none";
                        document.getElementById("dvNoData").style.display = "block";
                        document.getElementById("dvNoData").innerHTML= res.customer.message;
                        $("#CustomerID").prop('readonly', false);
                    }
                    
                    
                    

                },
                error: function (ex)
                {
                    alert('Failed' + ex);
                    document.getElementById("dvAddress").style.display = "none";
                    document.getElementById("dvNoData").style.display = "block";
                    document.getElementById("dvNoData").innerHTML= res.customer.message;
                }

            });
            clearValidations();
        };

        function clearValidations()
        {
           document.getElementById("CustomerIdValErrMsg").innerHTML="";
           document.getElementById("salutaion_error").innerHTML="";
           document.getElementById("IndividualOrgName_error").innerHTML="";
           document.getElementById("nameOnCard_error").innerHTML="";
           document.getElementById("communicationCityName_error").innerHTML="";
           document.getElementById("communicationPincode_error").innerHTML="";
           document.getElementById("comm_states_error").innerHTML="";
           document.getElementById("comm_district_error").innerHTML="";
           document.getElementById("CommunicationDialCode_error").innerHTML="";
           document.getElementById("CommunicationPhonePart2_error").innerHTML="";
           document.getElementById("CommunicationFaxCode_error").innerHTML="";
           document.getElementById("CommunicationFaxPart2_error").innerHTML="";
           document.getElementById("comm_mobileNumber_error").innerHTML="";
           document.getElementById("comm_email_error").innerHTML="";
           document.getElementById("comm_address1_error").innerHTML="";
           document.getElementById("comm_address2_error").innerHTML="";
           document.getElementById("DealerCode_error").innerHTML="";
           document.getElementById("SalesExecutiveEmployeeID_error").innerHTML="";

        }

</script>