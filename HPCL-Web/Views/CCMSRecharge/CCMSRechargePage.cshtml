@{
    Layout = "";
}

@using Microsoft.AspNetCore.Http;

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="~/favicon.ico">
    <meta name="theme-color" content="#74cbcb" />
    <link rel="manifest" href="~/assets/manifest.json">
    <title>DriveTrackPlus : DT Plus</title>
    <!-- Bootstrap core CSS -->
    <link href="~/assets/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.datatables.net/1.11.4/css/dataTables.bootstrap4.min.css" type="text/css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="~/assets/aos/aos.css" rel="stylesheet">
    <link href="~/assets/css/style.css" rel="stylesheet">
    <link href="~/assets/css/responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="~/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="~/assets/css/owl.theme.default.css">
    <link rel="stylesheet" href="~/assets/css/font-awesome.min.css">

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="~/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="~/assets/js/vendor/popper.min.js"></script>
    <script src="~/assets/aos/aos.js"></script>
    <script src="~/assets/js/bootstrap.min.js"></script>
    <script src="~/assets/js/owl.carousel.min.js"></script>
    <link rel="stylesheet" href="~/assets/css/jquery.es-drawermenu.min.css">
    <script src="~/assets/js/jquery.slidereveal.min.js" type="text/javascript"></script>
    <script src="~/assets/js/jquery.es-drawermenu.js"></script>
    <script src="~/assets/js/mloyal.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.11/jquery.validate.unobtrusive.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script src="~/js/CommonRegexDeclaration.js"></script>
    <script src="~/js/CommonValidations.js"></script>

    <script>
        $(document).ready(function(){
            $("form").attr('autocomplete', 'off');
            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            });
        });

    </script>



    @*For Sumo Select Dropdowns*@
    <script src="~/js/jquery.sumoselect.min.js"></script>
    <link href="~/css/sumoselect.min.css" rel="stylesheet" />

    <style>
        .btmMargin {
            padding-bottom: 3.5%;
        }

        .displayNone {
            display: none;
        }

        .comment_error {
            width: 100%;
            float: left;
            font-size: 12px;
            color: #f00;
            top: 100%;
        }

        .dropdown-menu.radio .dropdown-item {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .dropdown-menu.radio input {
            visibility: hidden;
            position: absolute;
            left: -30px;
        }

        .dropdown-menu.radio i {
            font-weight: normal;
            font-style: normal;
            display: block;
        }

        .dropdown-item.active {
            background-color: #555;
            color: #fff;
        }

        .dropdown-menu.radio .dropdown-item {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .dropdown-menu.radio input {
            visibility: hidden;
            position: absolute;
            left: -30px;
        }

        .dropdown-menu.radio i {
            font-weight: normal;
            font-style: normal;
            display: block;
        }

        .dropdown-menu.radio.show .dropdown-item.active {
            background-color: #073a7a;
            color: #fff;
        }

        .btn_filter {
            background: #084693;
            color: #fff;
            font-size: 12px;
            height: 42px;
            border-radius: 30px;
            min-width: 140px;
        }

        .dropdown-menu.radio.show {
            background: #084693;
        }

            .dropdown-menu.radio.show .dropdown-item i {
                color: #fff;
                font-size: 12px;
            }

            .dropdown-menu.radio.show .dropdown-item i {
                padding: 5px 10px;
            }

            .dropdown-menu.radio.show .dropdown-item:focus,
            .dropdown-menu.radio.show .dropdown-item:hover {
                color: #fff;
                text-decoration: none;
                background-color: #0f58b2;
            }

    </style>
</head>

<body>
    <header class="bb1">
        <div class="top_header pt-2 pt-md-3">
            <div class="d-flex align-items-center justify-content-start flex-wrap navbar-expand-lg">
                <div class="d-flex align-items-center justify-content-start col-lg-3 col-md-4 col-7 p-2">
                    <button class="navbar-toggler navbar_toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <img src="~/assets/images/menu_icon.png" class="img-fluid" alt="">
                    </button>
                    <a class="navbar-brand header_logo" href="index.html"> <img src="~/assets/images/logo.png" class="img-fluid" alt=""> </a>
                </div>
            </div>
            <nav class="navbar navbar-expand-lg main_header p-0">
                <div class="container-fluid position-relative">
                    <div class="d-flex align-items-center justify-content-start w-100">
                        <div class="top_navs">
                            <div class="collapse navbar-collapse" id="navbarNav">
                                <ul class="navbar-nav main_navs" id="topMenuList">
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    <main role="main">
        <div class="bg-white p-md-4 p-4 w-50">
            <div class="CCMSRechargePaygateway">
                <h3 class="">CCMS Recharge through Payment gateway</h3>
                <div class="payment_gateway_form">
                    <form id="submitForm">
                        <div class="py-4 pr-4 pl-0 pr-md-4">
                            <div class="form-group d-flex align-items-center flex-wrap">
                                <label class="font-weight-normal col-md-4 col-12">Mobile Number </label>
                                <div class="col-md-8 col-12">
                                    <div class="custom_select">
                                        <input type="text" maxlength="10" id="mobNoVal" class="form-control" onkeypress="return isNumberKey(event)">
                                        @Html.ValidationMessage("mobNoVal", "", new { @id = "mobNoError", @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                            <div class="form-group d-flex align-items-center flex-wrap">
                                <label class="font-weight-normal col-md-4 col-12">Customer ID <sup class="text-danger">*</sup></label>
                                <div class="col-md-8 col-12">
                                    <div class="custom_select">
                                        <input type="text" maxlength="10" id="customerIdVal" class="form-control" onkeypress="return isNumberKey(event)">
                                        @Html.ValidationMessage("customerIdVal", "", new { @id = "customerIdValErr", @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                            <div class="form-group d-flex align-items-center flex-wrap">
                                <label class="font-weight-normal col-md-4 col-12">Control Card Number <sup class="text-danger">*</sup></label>
                                <div class="col-md-8 col-12">
                                    <input type="text" id="controlCardNoVal" class="form-control" onkeypress="return isNumberKey(event)">
                                    @Html.ValidationMessage("controlCardNoVal", "", new { @id = "controlCardNoValErr", @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group align-items-center flex-wrap" style="display:none;" id="cutomerName">
                                <label class="font-weight-normal col-md-4 col-12">Customer Name <sup class="text-danger">*</sup></label>
                                <div class="col-md-8 col-12">
                                    <input type="text" id="customerNameVal" class="form-control">
                                </div>
                            </div>

                            <div class="form-group d-flex align-items-center flex-wrap">
                                <label class="font-weight-normal col-md-4 col-12">Amount <sup class="text-danger">*</sup></label>
                                <div class="col-md-8 col-12">
                                    <input type="text" id="amountVal" class="form-control">
                                    @Html.ValidationMessage("amountVal", "", new { @id = "amountValErr", @class = "text-danger" })
                                </div>
                            </div>

                            <table id="mobNoSearchRes" class="table table-bordered" style="display:none;">
                                <thead>
                                    <tr>
                                        <th>Action</th>
                                        <th>Customer ID</th>
                                        <th>Customer Name</th>
                                        <th>Customer Type</th>
                                    </tr>
                                </thead>
                            </table>


                            <div class="form-group d-flex align-items-center flex-wrap">
                                <label class="font-weight-normal col-md-4 col-12">Payment Gateway </label>
                                <div class="col-md-8 col-12">
                                    <div class="custom_select">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
                                            <label class="form-check-label" for="exampleRadios1">
                                                <strong>HDFC PG </strong>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group d-flex align-items-center flex-wrap">
                                <label class="font-weight-normal col-md-4 col-12"></label>
                                <div class="col-md-8 col-12">
                                    <div class="custom_select">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="inlineCheckboxTC" value="option1">
                                            <label class="form-check-label" for="inlineCheckboxTC">I Agree to <a data-toggle="modal" data-target="#termsConditions">Terms &amp; Conditions</a> and <a data-toggle="modal" data-target="#App_charges">Applicable Charges</a></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center justify-content-center flex-wrap mb-3">
                                <div class="offset-md-4 col-md-8 col-12">
                                    <div class="px-0 float-left mr-3">
                                        <button class="btn btn_primary" type="button" onclick="submitRec()">SUBMIT</button>
                                    </div>
                                    <div class="px-0 float-left">
                                        <button class="btn btn_primary" onclick="resetClick()">RESET</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                    <div id="customerDetailsSection" style="display:none;">
                        <div class="d-flex align-items-center flex-wrap">
                            <div class="col-lg-12 col-12">
                                <div class="d-flex align-items-center flex-wrap mb-2">
                                    <label class="font-weight-normal col-md-4 col-12 mb-0">Customer ID: </label>
                                    <div class="col-md-7 col-12">
                                        <div class="custom_select" id="customerIdFinal">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 col-12">
                                <div class="d-flex align-items-center flex-wrap mb-2">
                                    <label class="font-weight-normal col-md-4 col-12 mb-0">Control Card Number: </label>
                                    <div class="col-md-6 col-12">
                                        <div class="custom_select" id="controlCardNoFinal">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 col-12">
                                <div class="d-flex align-items-center flex-wrap mb-2">
                                    <label class="font-weight-normal col-md-4 col-12 mb-0">Customer Name: </label>
                                    <div class="col-md-7 col-12">
                                        <div class="custom_select" id="customerNameFinal">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 col-12">
                                <div class="d-flex align-items-center flex-wrap mb-2">
                                    <label class="font-weight-normal col-md-4 col-12 mb-0">Amount: </label>
                                    <div class="col-md-7 col-12">
                                        <div class="custom_select" id="amountValFinal">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 col-12">
                                <div class="d-flex align-items-center flex-wrap mb-2">
                                    <label class="font-weight-normal col-md-4 col-12 mb-0">Payment throught: </label>
                                    <div class="col-md-6 col-12">
                                        <div class="custom_select">
                                            HDFCPG
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 col-12">
                                <div class="d-flex align-items-center justify-content-center flex-wrap mb-2">
                                    <div class="offset-md-4 col-md-8 col-12">
                                        <div class="px-0 float-left mr-3">
                                            <button class="btn btn_primary" type="button" onclick="redirectToOTP()">CONFIRM</button>
                                        </div>
                                        <div class="px-0 float-left">
                                            <button class="btn btn_primary" onclick="cancelClick()">CANCEL</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="otpSection" style="display:none;">
                        <div class="py-4 pr-4 pl-0 pr-md-4">
                            <p style="color:green;" id="otpMsg"></p>
                            <div class="form-group d-flex align-items-center flex-wrap">

                                <label class="font-weight-normal col-md-4 col-12">Enter OTP </label>
                                <div class="col-md-8 col-12">
                                    <div class="custom_select">

                                        @* <input type="hidden" id="storeOtp">
                                        *@
                                        <input type="text" maxlength="6" id="otpVal" class="form-control" onblur="otpValidate(this)" onkeypress="return isNumberKey(event)">
                                        <span><a style="color:#0012ff;outline:none;" onclick="resendOtp()">Resend OTP</a> Maximum three attempt</span>
                                        @Html.ValidationMessage("otpVal", "", new { @id = "otpValErr", @class = "text-danger" })
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center justify-content-center flex-wrap mb-3">
                                <div class="offset-md-4 col-md-8 col-12">
                                    <div class="px-0 float-left mr-3">
                                        <button class="btn btn_primary" type="button" onclick="confirmOTP()">CONTINUE</button>
                                    </div>
                                    <div class="px-0 float-left">
                                        <button class="btn btn_primary" onclick="cancelOtpClick()">CANCEL</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <div id="loader">
        <div class="loader_overlay"></div>
        <div class="loader_img"><img src="~/assets/images/loader.gif" class="img-fluid" alt="Loader Image" /></div>
    </div>
    <footer class="main_footer">
        <div class="copyright_text p-4">
            <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <div class="col-md-4 col-12 py-2">
                        <div class="footer_links">
                            <ul>
                                <li><a href="#">Privacy Policy</a></li>
                                <li><a href="#">Legal Notice</a></li>
                                <li><a href="#">Terms & Conditions</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4 col-12 py-2">
                        <p class="footer_text text-white text-sm text-center mb-0">DriveTrackPlus Version(Build 4.8.3, Revision 19830)</p>
                    </div>
                    <div class="col-md-4 col-12 py-2">
                        <p class="footer_text text-white text-sm text-center mb-0">© 2021, HPCL. All rights reserved</p>
                    </div>
                </div>
            </div>
            <a href="#" class="bottom_logo"><img src="~/assets/images/footer_hp.png" class="img-fluid" alt=""></a>
        </div>
    </footer>
    <script>
        AOS.init({
            easing: 'ease-in-out-sine'
        });
    </script>
</body>
</html>
<script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.4/js/dataTables.bootstrap4.min.js"></script>
<script>

    var today = '@Context.Session.GetString("Today")';
    var dateflag = "N";
    var localStrNum = '@Context.Session.GetString("LocalStorage")';
    localStorage.setItem("clearStorage", localStrNum);
    debugger;

    if (!sessionStorage.getItem("LoginCheck"))
    {
        window.location.href = '@Html.Raw(@Url.Action("Index", "Home"))';
    }

    $(document).ready(function () {
        //setTimeout(function(){
        $('.datatable').DataTable({
            "lengthMenu": [10, 20, 50, 100, 200, 500, 1000, 2000],
            "autoWidth": false,
            "oLanguage": {
                "sLengthMenu": "Display _MENU_ Records",
                "info": "Showing _START_ to _END_ of _TOTAL_ Records",
            }
        });


        if ($('.fromDate').val() != undefined){
            setFromDateFormat();
        }

        if ($('.toDate').val() != undefined){
            setToDateFormat();
        }
        if ($('.nodefaultDate').val() != undefined){
                setDateFormat();
            }
        $('select').SumoSelect({
            placeholder: '-Select-',
            search: true,
            searchText: 'Enter Text here.'
        });

        if (localStorage.getItem("clearStorage") === localStrNum) {
            window.localStorage.clear();
        }

        if (!sessionStorage.getItem("CurrentLoggedInUser"))
        {
            sessionStorage.setItem("CurrentLoggedInUser", '@Context.Session.GetString("UserId")');
        }
        debugger;
        console.log("Session",sessionStorage.getItem("CurrentLoggedInUser"));
        $.ajax({
            type: 'POST',  // http method
            url: '@Url.Action("TopMenu", "Home")',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(sessionStorage.getItem("CurrentLoggedInUser")),
            dataType: "html",
            success: function (data, status, xhr) {
                        var v = data;
                        if (status == 'success') {
                            $("#topMenuList").html(data);
                            //$(".breadcrumb").html("");
                            //var breadCrumbHtml = "<li class='breadcrumb-item'><a href='@Url.Action(@Context.Session.GetString("BreadCrumbsAction"), @Context.Session.GetString("BreadCrumbsController"))' class='text_primary'>@Context.Session.GetString("BreadCrumbsPerviousMenuName")</a> </li><li class='breadcrumb-item font-weight-light'>@Context.Session.GetString("CurrentAction")</li>";
                            //$(".breadcrumb").html(breadCrumbHtml);
                        }
                        else {
                            console.log(v);
                        }
                    },
                error: function (jqXhr, textStatus, errorMessage) {
                    console.log("jqXhr",jqXhr);
                    console.log("textStatus",textStatus);
                    console.log("errorMessage",errorMessage);
                }
        });

        $('button').each(function() {
            debugger;
            if ($(this).html().trim().toLowerCase() == "search"){
                var btnHtml = $(this).html();
                $(this).html("<i class='fa fa-search'>&nbsp;</i> " + btnHtml);
            }
            else if ($(this).html().trim().toLowerCase() == "reset"){
                var btnHtml = $(this).html();
                $(this).html("<i class='fa fa-refresh''>&nbsp;</i> " + btnHtml);
            }
            else if ($(this).html().trim().toLowerCase() == "add"){
                var btnHtml = $(this).html();
                $(this).html("<i class='fa fa-plus''>&nbsp;</i> " + btnHtml);
            }
            else if ($(this).html().trim().toLowerCase() == "next"){
                var btnHtml = $(this).html();
                $(this).html(btnHtml + " <i class='fa fa-angle-double-right''>&nbsp;</i>");
            }
            else if ($(this).html().trim().toLowerCase() == "back"){
                var btnHtml = $(this).html();
                $(this).html("<i class='fa fa-angle-double-left''>&nbsp;</i> " + btnHtml);
            }
            else if ($(this).html().trim().toLowerCase() == "previous"){
                var btnHtml = $(this).html();
                $(this).html("<i class='fa fa-angle-double-left''>&nbsp;</i> " + btnHtml);
            }
            else if ($(this).html().trim().toLowerCase() == "save"){
                var btnHtml = $(this).html();
                $(this).html("<i class='fa fa-floppy''>&nbsp;</i> " + btnHtml);
            }
            else if ($(this).html().trim().toLowerCase() == "submit"){
                var btnHtml = $(this).html();
                $(this).html("<i class='fa fa-paper-plane''>&nbsp;</i> " + btnHtml);
            }
            else if ($(this).html().toLowerCase().startsWith("add ")){
                var btnHtml = $(this).html();
                $(this).html("<i class='fa fa-plus'>&nbsp;</i> " + btnHtml);
            }

        });
        //$(".error").addClass("displayNone");
        // },3000)
    });


    function setFromDateFormat(){
        $(".fromDate").attr("readonly", true);
        $('.fromDate').datepicker({
            dateFormat: 'dd-mm-yy',
            changeMonth: true,
            changeYear: true,
            maxDate: new Date(today),
            autoclose: "true",
            yearRange: "-100:+0"
        });

         if (($('.fromDate').val() != undefined)  && ($('.fromDate').val() != "") ){
            var d = stringToDate($('.fromDate').val(),"dd-mm-yyyy");
            if(d!="Invalid Date"){
                var ye = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(d)
                var mo = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(d)
                var da = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(d)
                $('.fromDate').val(`${da}-${mo}-${ye}`);
            }
         }
    }

    function setToDateFormat(){
        $(".toDate").attr("readonly", true);
        $('.toDate').datepicker({
            dateFormat: 'dd-mm-yy',
            changeMonth: true,
            changeYear: true,
            maxDate: new Date(today),
            autoclose: "true",
            yearRange: "-100:+0"
        });
        if (($('.toDate').val() != undefined)  && ($('.toDate').val() != "") ){
            var d1 = stringToDate($('.toDate').val(),"dd-mm-yyyy");
            if(d1!="Invalid Date"){
                var ye1 = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(d1)
                var mo1 = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(d1)
                var da1 = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(d1)
                $('.toDate').val(`${da1}-${mo1}-${ye1}`);
            }
        }
    }

    function checkDates(dateId,n) {
        var dateflag="Y";
        if (($('.fromDate').val() != undefined) && ($('.toDate').val() != undefined) && ($('.fromDate').val() != "") && ($('.toDate').val() != "")){

            var d = stringToDate($('.fromDate').val(),"dd-mm-yyyy");
            if(d!="Invalid Date"){
                var ye = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(d)
                var mo = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(d)
                var da = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(d)
                //$('.fromDate').val(`${mo}-${da}-${ye}`);
            }
            else{
                dateflag = "N";
                return dateflag;
            }
            var d1 = stringToDate($('.toDate').val(),"dd-mm-yyyy");
            if(d1!="Invalid Date"){
                var ye1 = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(d1)
                var mo1 = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(d1)
                var da1 = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(d1)
                //$('.toDate').val(`${mo1}-${da1}-${ye1}`);
            }
            else{
                dateflag = "N";
                return dateflag;
            }
            var fromD =d;
            var toD =  d1;

            if (fromD != "" && toD != "") {
                if (fromD > toD) {
                    $("#" + dateId + "").attr("style", "display:block");
                    $("#" + dateId + "").html("'From Date' should be less or equal to 'To date'");
                    dateflag = "N";
                }
                else if(n>0)
                {
                    var aday = 24 * 60 * 60 * 1000;
                    if ((Math.abs(toD-fromD) / aday) > n)
                    {
                        $("#" + dateId + "").attr("style", "display:block");
                        $("#" + dateId + "").html("Difference between From Date and To Date should not be more than " + n + " days");
                        dateflag = "N";
                    }
                    else {
                        $("#" + dateId + "").html("");
                        $("#" + dateId + "").attr("style", "display:none");
                    }
                }
                else {
                    $("#" + dateId + "").html("");
                    $("#" + dateId + "").attr("style", "display:none");
                }
            }
        }

        return dateflag;
    }

    document.addEventListener("submit", function(){
        $("#loader").fadeIn();
        if (event.defaultPrevented){
            if (~event.composedPath().indexOf("form#saveDocs") < 0){
                $("#loader").fadeOut();
            }
        }
    });

    $(window).focus(function() {
        var userid = sessionStorage.getItem("CurrentLoggedInUser");

        $.ajax({
            type: 'POST',  // http method
            url: '@Url.Action("SetSessionItems", "Home")',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(userid),
            dataType: "json",
            success: function (data, status, xhr) {
                        if (status == 'success') {
                            console.log("User sessions has been restored");
                        }
                        else {
                            console.log("output",data);
                        }
                    },
                error: function (jqXhr, textStatus, errorMessage) {
                    //document.getElementById("CustomerRegionID_error").innerHTML = "Error populating card details";
                }
        });
    });

    function preventBack() { window.history.forward(); }
    setTimeout("preventBack()", 0);
    window.onunload = function () { null };

    function stringToDate(date, format) {
        var formatArr = format.split("-");
        var dateArr = date.split("-");
        var monthIndex = formatArr.indexOf("mm");
        var dayIndex = formatArr.indexOf("dd");
        var yearIndex = formatArr.indexOf("yyyy");
        var month = parseInt(dateArr[monthIndex]);
        month -= 1;
        if(dateArr[yearIndex]<(new Date(today).getFullYear()-100)||month<0 ||month>11 ||dateArr[dayIndex]<=0||dateArr[dayIndex]>31)
            return "Invalid Date";
        var outputDate = new Date(dateArr[yearIndex], month, dateArr[dayIndex]);
        if(outputDate.getFullYear()!=dateArr[yearIndex] || outputDate.getMonth()!=month || outputDate.getDate()!= dateArr[dayIndex])
            return "Invalid Date";
        return outputDate;
    }
     $('.fromDate,.toDate').on("cut copy paste",function(e) {
      e.preventDefault();
    });

    function checkForSpecialChars(str){
        var flag = "N";
        var count = 0;
        for (var i = 0; i < str.length; i++) {
            if (!str.charAt(i).match(notOnlySpecialChars)){
                if(!str.charAt(i + 1).match(notOnlySpecialChars)){
                    flag = "Y";
                    break;
                }
            }
        }
        if (flag == "N"){
            return false;
        }
        else{
            return true;
        }
    }
    function setDateFormat(){
        $(".nodefaultDate").attr("readonly", true);
        $('.nodefaultDate').datepicker({
            dateFormat: 'dd-mm-yy',
            changeMonth: true,
            changeYear: true,
            maxDate: new Date(today),
            autoclose: "true",
            yearRange: "-100:+0"
        });
        if (($('.nodefaultDate').val() != undefined)  && ($('.nodefaultDate').val() != "") ){
            var d1 = stringToDate($('.nodefaultDate').val(),"dd-mm-yyyy");
            if(d1!="Invalid Date"){
                var ye1 = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(d1)
                var mo1 = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(d1)
                var da1 = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(d1)
                $('.nodefault').val(`${da1}-${mo1}-${ye1}`);
            }
        }
    }
    function validateDate(dateClass,dateId) {
        var dateflag="Y";
        if (($("#" + dateClass + "").val() != undefined) && ($("#" + dateClass + "").val() != "")){
            var d = stringToDate($("#" + dateClass + "").val(),"dd-mm-yyyy");
            if(d!="Invalid Date"){
                if(d>new Date(today)){
                    $("#" + dateId + "").attr("style", "display:block");
                    $("#" + dateId + "").html("Date should be less than Today");
                    dateflag = "N";
                }
                else
                {
                    $("#" + dateId + "").attr("style", "display:none");
                    $("#" + dateId + "").html("");
                }

            }
            else{
                $("#" + dateId + "").attr("style", "display:block");
                $("#" + dateId + "").html("Invalid Date");
                dateflag = "N";
            }
        }

        return dateflag;
    }

    //window.addEventListener('beforeunload', function (e) {
    //    window.location.href = '@Html.Raw(@Url.Action("Profile", "Home"))';
    //});

    //$(document).keydown(function (event) {
    //    if (event.keyCode == 123) { // To Prevent F12
    //        return false;
    //    } else if (event.ctrlKey && event.shiftKey && event.keyCode == 73) { // To Prevent Ctrl+Shift+I
    //        return false;
    //    }
    //});

    ////To Prevent Right Click > Inspect Element
    //$(document).on("contextmenu", function (e) {
    //    e.preventDefault();
    //});

    //Enter Key Blocked
    $(document).keypress(
      function(event){
        if (event.which == '13') {
          event.preventDefault();
        }
    });

    function ValidateVehicleNumber(vehicleNo)
    {
        var isValid = true;

        if(vehicleNo.trim()=='')
        {
            isValid=false;
        }
        else
        {
            if(vehicleNo.trim()!='')
            {
                if (!(vehicleNo.match(forVehicleNo)))
                {
                    isValid=false;
                }
                else if(vehicleNo.length<6 || vehicleNo.length>10)
                {
                    isValid=false;
                }
            }
        }

        return isValid;

    }
</script>

<script>
    $("#logOutId").on('click', function () {
        sessionStorage.clear();
        window.location.href = '@Html.Raw(@Url.Action("Logout", "Home"))';
    });

    // Change the button text & add active class
        $('.jRadioDropdown').change(function() {
          var dropdown = $(this).closest('.dropdown');
          var thislabel = $(this).closest('label');

          dropdown.find('label').removeClass('active');
          if( $(this).is(':checked') ) {
            thislabel.addClass('active');
            dropdown.find('span').html( thislabel.text() );
          }

        });

        //Add tabindex on labels
        $('label.dropdown-item').each(function (index, value){
          $(this).attr('tabindex', 0 );
          $(this).find('input').attr('tabindex', -1 );
        });

        //Add keyboard navigation
        $('label.dropdown-item').keypress(function(e){
          if((e.keyCode ? e.keyCode : e.which) == 13){
            $(this).trigger('click');
          }
        });

</script>
<script>

    $(document).ready(function () {

        function isNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : event.keyCode;
            if (charCode != 46 && charCode > 31
                && (charCode < 48 || charCode > 57))
                return false;

            return true;
        }

    });


    $("#amountVal").on('keydown', function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }
        debugger;
        if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode==110) {

        } else {
            event.preventDefault();
        }
        if($(this).val().indexOf('.') !== -1 && (event.keyCode == 190|| event.keyCode == 110))
            event.preventDefault();
     });

    function cancelOtpClick(){
        locaion.reload();
    }

    function cancelClick(){
        locaion.reload();
    }

    function resetClick(){
        location.reload();
        $("#mobNoVal").attr("readonly", false);
        $("#customerIdVal").attr("readonly", false);
        $("#controlCardNoVal").attr("readonly", false);
    }

    $("#mobNoVal").on("blur", function (){

        var mobNo = $("#mobNoVal").val();

        var flag = "Y";

        if(mobNo.trim() == ''){
            flag = "N";
        }

        if(mobNo.trim() != ''){
            if(!mobNo.trim().match(/^[6789]\d{9}$/)){
                $('#mobNoError').text("Invalid Mobile Number");
                flag = "N";
            }else{
                $('#mobNoError').text("");
            }
        }


        if (flag == "N")
            e.preventDefault();


        if(flag == "Y"){

            $('#mobNoError').text("");

            document.getElementById("mobNoSearchRes").style.display = "none";
            $("#cutomerName").removeClass("d-flex");
            document.getElementById("cutomerName").style.display = "none";

            $.ajax({
                url: "@Url.Action("CCMSRechargePage","CCMSRecharge")",
                type: "POST",
                dataType: "JSON",
                data: { mobNo: mobNo, customerId: null },
                success: function (res) {

                    console.log(res,"res");

                    if(res.searchList.success == true){

                        $("#mobNoSearchRes td").parent().remove();

                        for (var i = 0; i < res.searchList.data.length; i++) {

                            var rows = "<tbody><tr>"
                                + "<td><input type='radio' class='merchantRow' name='merchantCheck'></td>"
                                + "<td><span class='customerIdVal'>" + (res.searchList.data[i].customerID || '') + "</span></td>"
                                + "<td><span class='customerNameVal'>" + (res.searchList.data[i].customerName || '') + "</span></td>"
                                + "<td><span class='customerTypeVal'>" + (res.searchList.data[i].customerType || '') + "</span><span style='display:none;' class='conCardNoVal'>"+(res.searchList.data[i].controlCardNo || '')+"</span></td>"
                                + "</tr ></tbody>";

                            $('#mobNoSearchRes').append(rows);
                        }

                        document.getElementById("mobNoSearchRes").style.display = "block";

                        $("#mobNoVal").attr("readonly", true);
                        $("#customerIdVal").attr("readonly", true);
                        $("#controlCardNoVal").attr("readonly", true);

                    }else{
                        document.getElementById("mobNoSearchRes").style.display = "none";
                        $("#cutomerName").removeClass("d-flex");
                        document.getElementById("cutomerName").style.display = "none";
                        alert(res.searchList.message);
                    }
                },
                error: function (ex) {
                    alert('Failed' + ex);
                }
            });
        }
    });

    $("#customerIdVal").on("blur", function (){

        var customerId = $("#customerIdVal").val();

        var flag = "Y";

        if(customerId == ""){
            $('#customerIdValErr').text("Please enter Customer ID");
            flag = "N";
        }
        if(customerId.trim() != ''){
            if(!customerId.trim().match(mappedCustomerId)){
                $('#customerIdValErr').text("Invalid Customer ID");
                flag = "N";
            }else{
                $('#customerIdValErr').text("");
            }
        }

        if (flag == "N")
            e.preventDefault();


        if(flag == "Y"){

            $('#mobNoError').text("");

            document.getElementById("mobNoSearchRes").style.display = "none";
            $("#cutomerName").removeClass("d-flex");
            document.getElementById("cutomerName").style.display = "none";

            $.ajax({
                url: "@Url.Action("CCMSRechargePage","CCMSRecharge")",
                type: "POST",
                dataType: "JSON",
                data: { mobNo: null, customerId: customerId },
                success: function (res) {

                    console.log(res,"res");

                    if(res.searchList.success == true){

                        $("#customerIdVal").val(res.searchList.data[0].customerID);
                        $("#customerNameVal").val(res.searchList.data[0].customerName);
                        $("#controlCardNoVal").val(res.searchList.data[0].controlCardNo);

                        $("#mobNoVal").attr("readonly", true);
                        $("#customerIdVal").attr("readonly", true);
                        $("#controlCardNoVal").attr("readonly", true);

                    }else{
                        $("#cutomerName").removeClass("d-flex");
                        document.getElementById("cutomerName").style.display = "none";
                        alert(res.searchList.message);
                    }
                },
                error: function (ex) {
                    alert('Failed' + ex);
                }
            });
        }
    });

    $("#mobNoSearchRes").on('click', '.merchantRow', function (e) {

        var currentRow = $(this).closest("tr");

        if ($(this).is(':checked')) {

            $("#cutomerName").addClass("d-flex");
            document.getElementById("cutomerName").style.display = "block";
            document.getElementById("mobNoSearchRes").style.display = "none";
            $("#customerIdVal").val(currentRow.find('.customerIdVal').text());
            $("#customerNameVal").val(currentRow.find('.customerNameVal').text());
            $("#controlCardNoVal").val(currentRow.find('.conCardNoVal').text());

        }
    });

    function submitRec(){

       var flag = "Y";

       var mobNo = $("#mobNoVal").val();
       var customerId = $("#customerIdVal").val();
       var controlCardNo = $("#controlCardNoVal").val();
       var amount = $("#amountVal").val();

        if(mobNo.trim() != ''){
            if(!mobNo.trim().match(/^[6789]\d{9}$/)){
                $('#mobNoError').text("Invalid Mobile Number");
                flag = "N";
            }
        }

        if(customerId == ""){
            $('#customerIdValErr').text("Please enter Customer ID");
            flag = "N";
        }
        if(customerId.trim() != ''){
            if(!customerId.trim().match(mappedCustomerId)){
                $('#customerIdValErr').text("Invalid Customer ID");
                flag = "N";
            }
        }

        if(controlCardNo == ""){
            $('#controlCardNoValErr').text("Please enter ControlCard Number");
            flag = "N";
        }

        if(amount == ""){
            $('#amountValErr').text("Please enter Amount");
            flag = "N";
        }

        if($("#inlineCheckboxTC").prop('checked') == false){
            alert("Please accept the terms and conditions.");
            flag = "N";
        }

        if (flag == "N")
            e.preventDefault();


        if(flag == "Y"){
            if (confirm('Are you sure you want to initiate for CCMS Recharge by Payment Gateway.?')) {
                console.log('ok');

                $("#submitForm").hide();

                $("#customerIdFinal").append("<span style='font-weight:bold'>"+$("#customerIdVal").val()+"</span>");
                $("#controlCardNoFinal").append("<span>"+$("#controlCardNoVal").val()+"</span>");
                $("#customerNameFinal").append("<span>"+$("#customerNameVal").val()+"</span>");
                $("#amountValFinal").append("<span>"+$("#amountVal").val()+"</span>");

                document.getElementById("customerDetailsSection").style.display = "block";

            } else {
                console.log('cancel')
            }
        }
    }

    function redirectToOTP(){

          var mobNo = $("#mobNoVal").val();
          var customerId = $("#customerIdVal").val();

          $.ajax({
                url: "@Url.Action("CCCMSRecGenerateOtp","CCMSRecharge")",
                type: "POST",
                dataType: "JSON",
                data: { mobNo: mobNo, customerId: customerId },
                success: function (res) {

                    console.log(res,"res");

                    if(res.getOtp.success == true){

                        //$("#storeOtp").val('');

                        //$("#storeOtp").val(res.getOtp.data[0].otp);

                        $("#otpMsg").html('');
                        $("#otpMsg").append("<span>OTP has been sent to customer registered Mobile No.</span>");
                        document.getElementById("customerDetailsSection").style.display = "none";
                        document.getElementById("otpSection").style.display = "block";

                    }else{
                        alert(res.getOtp.message);
                    }
                },
                error: function (ex) {
                    alert('Failed' + ex);
                }
            });
    }

    function confirmOTP(){

        var otpVal = $("#otpVal").val();

        var flag = "Y";

        if(otpVal == ""){
            $("#otpValErr").text("Please enter Valid OTP");
            flag = "N";
        }

        if (flag == "N")
            e.preventDefault();


        if(flag == "Y"){

           var mobNo = $("#mobNoVal").val();
           var customerId = $("#customerIdVal").val();


           $.ajax({
                url: "@Url.Action("CCCMSRecVerifyOtp","CCMSRecharge")",
                type: "POST",
                dataType: "JSON",
                data: { mobNo: mobNo, otp: otpVal, customerId:customerId },
                success: function (res) {

                    console.log(res,"res");


                    if(res.verifyOtp[0].status == 1){

                        if (confirm('Are you sure you want to initiate For CCMS Recharge by Payment Gateway?')) {
                            console.log('ok');

                            var customerId = $("#customerIdVal").val();
                            var mobNo = $("#mobNoVal").val();
                            var controlCardNo = $("#controlCardNoVal").val();
                            var amount = $("#amountVal").val();

                            $.ajax({
                                url: "@Url.Action("RedirectToPG","CCMSRecharge")",
                                type: "POST",
                                dataType: "JSON",
                                data: { customerId: customerId, mobNo: mobNo, controlCardNo: controlCardNo, amount: amount },
                                success: function (res) {

                                    console.log(res,"res");

                                    var ress = JSON.stringify(res.redirectDetails.data);

                                    if(res.redirectDetails.success == true){

                                        var url = '@Html.Raw(@Url.Action("RedirectToPaymentGateway", new { inputTxtValues = "dd" }))';

                                        url = url.replace("dd", encodeURIComponent(ress));

                                        window.location.href = url;
                                    }

                                },
                                error: function (ex) {
                                    alert('Failed' + ex);
                                }
                            });

                        } else {
                            console.log('cancel')
                        }

                    }else{
                        alert(res.verifyOtp[0].reason);
                    }


                },
                error: function (ex) {
                    alert('Failed' + ex);
                }
           });
        }
    }

    function otpValidate(o){
        var otp = o.value;
        if(otpVal == ""){
            $("#otpValErr").text("Please enter Valid OTP");
            return false;
        }else{
             $("#otpValErr").text('');
        }
    }


     function resendOtp(){

         var mobNo = $("#mobNoVal").val();
         var customerId = $("#customerIdVal").val();

         $.ajax({
                url: "@Url.Action("CCCMSRecGenerateOtp","CCMSRecharge")",
                type: "POST",
                dataType: "JSON",
                data: { mobNo: mobNo, customerId: customerId },
                success: function (res) {

                    console.log(res,"res");

                    if(res.getOtp.success == true){
                        $("#otpMsg").html('');
                        $("#otpMsg").append("<span>OTP has been resent to customer registered Mobile No.</span>");
                    }
                },
                error: function (ex) {
                    alert('Failed' + ex);
                }
        });
     }
</script>