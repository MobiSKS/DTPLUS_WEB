@model HPCL_Web.Models.ViewCard.ViewCardDetails

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.js"></script>

<marquee width="100%" direction="left" height="30%">
    Dear Fleet Customer, For TDS related information, Please check the latest notification at TDS Alert
</marquee>
<div class="col-lg-12 p-4 p-md-4">
    <div class="bg-white p-2 p-md-4">

        @*<form name="applicationForm" onsubmit="return submitForm()" class="w-100">*@

        <form method="post" data-ajax="true" data-ajax-controller="Cards" data-ajax-action="ViewCardSearch" data-ajax-method="POST" data-ajax-success="OnSuccess" data-ajax-failure="OnFailure">

            <div class="tab-content mt-3" id="myTabContent">
                <div class="tab-pane fade show active" id="basicInfo" role="tabpanel" aria-labelledby="basicInfo-tab">

                    <div class="border-1 rounded border-grey h-100 mt-3">

                        <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold" id="ManageCardHeader"> View Cards Limits </p>
                        <div class="py-2 p-md-4">

                            <div class="form-group d-flex align-items-center flex-wrap">
                                <div class="tab-content">

                                    <div id="CustomerCardsSection" class="tab-pane active" role="tabpanel">
                                        <div class="row w-100">

                                            <div class="d-flex align-items-center justify-content-between flex-wrap">

                                                <div class="form-group d-flex align-items-center flex-wrap">

                                                </div>

                                                <div class="col-md-12 col-12">
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Customer ID<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.CustomerId, new { @class = "form-control" })
                                                            @Html.ValidationMessageFor(m => m.CustomerId, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="d-flex align-items-center justify-content-left mt-md-2">
                                            <div class="px-2">
                                                <button class="btn" type="submit" id="btnSave" name="submit" onclick="document.getElementById('CardSearch').style.display = 'block';" style="background-color:#084693;color:white;">SEARCH</button>
                                                <a class="btn" href="@Url.Action("ViewCardSearch")" id="btnrest" name="reset" style="background-color:#084693;color:white;">
                                                    RESET
                                                </a>
                                                <a class="btn" href="@Url.Action("AddOrEditMobile")" id="btnCancel" name="cancel" style="background-color:#084693;color:white;">ADD/EDIT MOBILE</a>
                                            </div>
                                        </div>

                                        <div class="form-group d-flex align-items-center flex-wrap">

                                        </div>

                                        <table id="CardSearch" class="table table-striped table-bordered table-responsive" style="display:none;">
                                            <tr>
                                                <th>
                                                    @Html.DisplayName("Sr#")
                                                </th>

                                                <th>
                                                    @Html.DisplayName("Card Number")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("Vehicle No/User Name")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("Mobile Number")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("Daily Sale Limit")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("Daily Sale Balance")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("Monthly Sale Limit")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("Monthly Sale Balance")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("CCMS Limit/Rs")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("Type of Limit")
                                                </th>
                                                <th>
                                                    @Html.DisplayName("Availabe CCMS Limits")
                                                </th>

                                            </tr>
                                        </table>

                                        <div class="form-group d-flex align-items-center flex-wrap">

                                        </div>







                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </form>

    </div>
</div>

<script type="text/javascript">

    $(document).ready(function () {
        let tableData = sessionStorage.getItem("tableData");
        let getCusId = sessionStorage.getItem("cusmId");
        if ($("input:text").val() == "") {
            document.getElementById('CardSearch').style.display = 'none';
        }
        if (($("input:text").val() != "")) {
            document.getElementById('CardSearch').style.display = 'inline-table';
        }
        if (tableData != null) {
            document.getElementById('CardSearch').style.display = 'block'
            $('#GetCustomerIdValue').val(getCusId);
            $('#CardSearch').html(tableData);
        }


    });



    //$("#CustomerCardsSection").click(function () {
    //    $('#CardDetailsTab').tab('show');
    //    $("#ManageCardHeader").replaceWith("<p class='text_primary px-3 py-2 bg-grey m-0 font-weight-bold'>Manage Cards</p>");
    //});

    function OnSuccess(data) {
        $("#CardSearch td").parent().remove();

        for (var i = 0; i < data.searchList.length; i++) {


            var rows = "<tbody><tr>"
                + "<td><span class='rowData'>" + (data.searchList[i].sr || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].userName || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].monthlySaleLimits || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].mobileNumber || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].dailySaleBalance|| '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].vehicleNo || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].montlySaleBalance || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].cCMSLimts || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].typeOfLimits || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].availabeCCMSLimits || '') + "</span></td>"
                + "<td><span class='rowData'>" + (data.searchList[i].cardNumber || '') + "</span></td>"

                + "<td><a href='#aaa' class='editNumber'>Edit</a></td></tr></tbody>";


            $('#CardSearch').append(rows);
        }
        let tableData = $('#CardSearch').html();
        sessionStorage.setItem("tableData", tableData);

        let custmId = $('.cusId').html();
        sessionStorage.setItem("cusmId", custmId);



</script>
