@model HPCL.Common.Models.ViewModel.ApplicationFormDataEntry.AddAddOnCard


<div>
    <fieldset class="border-1 rounded border-grey mb-3">
        <legend class="font-12 font-weight-bold d-inline-block w-auto ml-3 mb-0 px-2">Card Preference</legend>
        <div class="col-md-12 col-12 px-4">
            <div class="form-group">
                <div class="d-flex align-items-center justify-content-start mt-3">
                    <div class="d-flex align-items-center justify-content-start mr-3">
                        @Html.RadioButtonFor(m => m.CardPreference, "Card", new { @id = "rbtnCard",@class="radio-button" }) <span class="ml-2"> Card </span>
                    </div>
                    <div class="d-flex align-items-center justify-content-start">
                        @Html.RadioButtonFor(m => m.CardPreference, "Cardless", new { @id = "rbtnCardless",@class="radio-button" }) <span class="ml-2"> Cardless </span>
                    </div>
                </div>
                <span class="error position-static mb-0 mt-2" id="CardPreference_error"></span>
            </div>
        </div>
    </fieldset>

    <fieldset class="border-1 rounded border-grey mb-3" id="divFeePaymentDetails">
        <legend class="font-12 font-weight-bold d-inline-block w-auto ml-3 mb-0 px-2">Fee Payment Details</legend>
        <div class="col-md-12 col-12 px-4">
            <div class="form-group">
                <div class="d-flex align-items-center justify-content-start mt-3">
                    <div class="d-flex align-items-center justify-content-start mr-3">
                        @Html.RadioButtonFor(m => m.FeePaymentsCollectFeeWaiver, "1", new { @id = "rbtnOnline", @class = "radio-toolbar" })
                        <span class="ml-2">Online</span>
                    </div>
                    <div class="d-flex align-items-center justify-content-start mr-3">
                        @Html.RadioButtonFor(m => m.FeePaymentsCollectFeeWaiver, "2", new { @id = "rbtnFeeWaiver", @class = "radio-toolbar" })
                        <span class="ml-2">Fee Waiver</span>
                    </div>
                </div>
            </div>
        </div>

    </fieldset>

    <div class="clearfix"></div>

    <div class="d-flex align-items-center flex-wrap">
        <div class="col-lg-6 col-12 mb-0">
            <div class="form-group d-flex align-items-center flex-wrap">
                <label class="font-weight-normal col-md-5 col-12" id="lblChequeNo">Cheque No.<sup class="text-danger">*</sup></label>
                <div class="col-md-7 col-12">
                    @Html.TextBoxFor(m => m.FeePaymentNo, new { @id = "FeePaymentNo", @class = "form-control", autocomplete = "off" })
                    @Html.ValidationMessageFor(m => m.FeePaymentNo, "", new { @class = "error", @id = "FeePaymentNoErrMsg" })
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-12 mb-0">
            <div class="form-group d-flex align-items-center flex-wrap">
                <label class="font-weight-normal col-md-5 col-12" id="lblChequeDate">Cheque Date<sup class="text-danger">*</sup></label>
                <div class="col-md-7 col-12">
                    @Html.TextBoxFor(m => m.FeePaymentDate, new { @id = "FeePaymentDate", @class = "form-control fromDate",@placeholder="dd-mm-yyyy", autocomplete = "off" })
                    @Html.ValidationMessageFor(m => m.FeePaymentDate, "", new { @class = "error", @id = "FeePaymentDateErrMsg" })
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex align-items-center flex-wrap">
        <div class="col-lg-6 col-12 mb-0">
            <div class="form-group d-flex align-items-center flex-wrap">
                <label class="font-weight-normal col-md-5 col-12" id="lblReceivedAmount">Received Amount<sup class="text-danger">*</sup></label>
                <div class="col-md-7 col-12">
                    @Html.TextBoxFor(m => m.ReceivedAmount, new { @id = "ReceivedAmount", @class = "form-control", @readonly = "readonly" })
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-12 mb-3">
            <div class="form-group d-flex align-items-center flex-wrap">
                <div class="col-md-7 col-12">
                    <span class="error" id="Common_error"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="clearfix"></div>
    <div class="d-flex align-items-center justify-content-center mt-3 mb-4">
        <div class="px-2">
            <button class="btn btn_primary" type="button" id="btnAdd" onclick="AddCardTbl()">ADD</button>
        </div>
        <div class="px-2">
            <button class="btn btn_primary" type="button" onclick="ResetClick()" style="display:none">RESET</button>
        </div>
    </div>
    <div class="clearfix"></div>

    <div class="clearfix"></div>

    <div class="clearfix"></div>
</div>
<div class="align-items-start flex-wrap" id="uploadSection" style="display:none;">
    <div class="col-lg-12 col-12">
        <p class="text-dark px-0 pb-2 mb-3 font-weight-bold" style="border-bottom: 1px solid #ccc;">
            Upload Card details File
        </p>
        <div class="d-flex align-items-center flex-wrap mb-3">
            <label class="font-weight-normal col-md-2 col-12 mb-0">Select File <sup class="text-danger">*</sup></label>
            <div class="col-md-3 col-12">
                <div class="custom_select">
                    <input class="form-control-file" id="excel_file" name="batchid" type="file" value="">
                    <span style="display:none" class="error" id="excel_file_error"></span>
                </div>
            </div>
            <div class="col-lg-3 col-12">
                <div class="d-flex align-items-start justify-content-start mb-0">
                    <div class="px-0">
                        <button class="btn btn_primary" type="button" onclick="uploadBulkLimitRow()">Upload</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-12">
                <div class="d-flex align-items-start justify-content-start mb-0">
                    <p class="mb-0"> Only .xlsx file is allowed!</p>
                </div>
            </div>
            <div>
                <div class="d-flex align-items-start justify-content-start mb-0">
                    @*<button class="btn btn_primary" type="button" id="btnDownloadTemplate" style="background-color:#084693;color:white;" onclick="location.href='@Url.Action("Download", "Customer", new { CustomerType="909",CardOrCardLess="Cardless" })'">Download Template</button>*@
                    <button class="btn btn_primary" type="button" id="btnDownloadTemplate" style="background-color:#084693;color:white;">Download Template</button>
                </div>
            </div>
            <p class="mb-0 mt-2 font-weight-bold" style="padding-top:2%">Note:-Please add ‘ before Card Identifier. For example, if Card Identifier. is 7000 0000 0000 0001, it should be mentioned as ‘7000000000000001 in the excel sheet in the “Card Identifier” column.</p>
        </div>
    </div>
    <div class="mb-3 text-center alert alert-danger" style="display:none;" id="ExcelDataError"></div>

    <div class="row" id="reponseErr" style="display:none;">
        <div class="col">
            <div class="border-1 rounded border-grey pb-0">
                <p style="background-color: #3399FF;font-weight:bold;">
                    Successful Transactions
                </p>
                <div class="mb-3 text-center alert alert-danger" id="checkRecord"></div>
            </div>
        </div>
        <div class="col" style="margin-top:2%">
            <div class="border-1 rounded border-grey pb-0">
                <p style="background-color: #FF5050;font-weight:bold;">
                    Unsuccessful Transactions
                </p>
                <div id="excel_data"></div>
            </div>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<div id="ViewNoOfCardsTbl" style="display:none;"></div>

<div id="divSubmit" style="display:none;">
    <div class="col-md-12 col-12 px-0" id="divVehicleVerifiedManually">
        <div class="d-flex align-items-center justify-content-start mt-3 mb-3">
            <div class="pr-2 chk_sty">
                @Html.CheckBoxFor(m=>m.VehicleVerifiedManually)<span class="ml-2">Vehicle Numbers have been verified using VAHAN Portal</span>
            </div>
        </div>
    </div>
    <div class="col-md-12 col-12 px-0">
        <div class="d-flex align-items-center justify-content-center flex-wrap mb-0 mt-0">
            <div class="col-md-12 col-12 d-flex align-items-center justify-content-center">
                <div class="pr-2">
                    <button class="btn btn_primary" id="btnsubmit" type="Submit" onclick="return SubmitValidations()">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>
@Html.HiddenFor(model => Model.Message)
@Html.HiddenFor(model => Model.CardPreference)
@Html.HiddenFor(model => Model.ExternalVehicleAPIStatus)
@Html.HiddenFor(model => Model.FeePaymentsCollectFeeWaiver)

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>
<script>

     $(document).ready(function ()
     {

        $('#lblReceivedAmount').hide();
        $('#ReceivedAmount').hide();
        setFromDateFormat();

        console.log('Before Message');

        var customerTypeId = $("#CustomerTypeId").val();

        console.log(customerTypeId);
        if (customerTypeId == "902" || customerTypeId == "917")
        {
            $('#divVehicleVerifiedManually').hide();
        }
        else
        {
            $('#divVehicleVerifiedManually').show();
        }

        if($("#Message").val()=="")
        {

            $.ajax({
                type: 'POST',  // http method
                url: '@Url.Action("GetFormName", "ApplicationFormDataEntry")',
                data: { customerId: $("#CustomerId").val() },  // data to submit
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    if (res.searchResult.data.length > 0)
                    {

                        if (res.searchResult.data[0].paymentType != "")
                        {
                            document.getElementById("FeePaymentNo").value = res.searchResult.data[0].paymentType;
                            document.getElementById("FeePaymentDate").value = res.searchResult.data[0].paymentReceivedDate;
                            $("#FeePaymentNo").prop('readonly', true);
                            $("#FeePaymentDate").prop('readonly', true);

                            document.getElementById("rbtnCard").checked = true;
                            document.getElementById("rbtnCard").disabled = true;
                            document.getElementById("CardPreference").value = document.getElementById("rbtnCard").value;

                            document.getElementById("rbtnCardless").checked = false;
                            document.getElementById("rbtnCardless").disabled = true;

                            document.getElementById("rbtnOnline").checked = true;
                            document.getElementById("rbtnOnline").disabled = true;

                            document.getElementById("rbtnFeeWaiver").checked = false;
                            document.getElementById("rbtnFeeWaiver").disabled = true;

                            $('#lblChequeNo').text('');
                            $('#lblChequeNo').append("Payment Source<sup class='text-danger'>*</sup>");
                            $('#lblChequeDate').text('');
                            $('#lblChequeDate').append("Payment Date<sup class='text-danger'>*</sup>");
                            document.getElementById("ReceivedAmount").value = res.searchResult.data[0].receivedAmount;

                        }
                        else
                        {
                            $("#rbtnOnline").prop('disabled', true);
                            document.getElementById("rbtnOnline").checked = false;
                            document.getElementById("rbtnCard").checked = false;
                            $("#rbtnCard").prop('disabled', false);
                            $("#FeePaymentNo").prop('readonly', false);
                            //$("#FeePaymentDate").prop('readonly', false);
                            $('#lblChequeNo').text('');
                            $('#lblChequeNo').append("Approval Email From<sup class='text-danger'>*</sup>");
                            $('#lblChequeDate').text('');
                            $('#lblChequeDate').append("Approval Email Date<sup class='text-danger'>*</sup>");
                            document.getElementById("ReceivedAmount").value = "";
                        }

                    }
                    else
                    {

                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(xhr);
                }
            });


         }

            if($("#Message").val()!="")
            {
               if($('input[name="CardPreference"]:checked').val()=="Card")
               {
                      document.getElementById("rbtnCard").checked = true;
                      document.getElementById("rbtnCardless").checked = false;

                      $('#lblChequeNo').show();
                      $('#lblChequeDate').show();
                      //$("#FeePaymentNo").val('');
                      //$("#FeePaymentDate").val('');
                      $('#FeePaymentNo').show();
                      $('#FeePaymentDate').show();
                      $('#ReceivedAmount').show();
                      $('#divFeePaymentDetails').show();
                      $('#lblReceivedAmount').show();

                      document.getElementById("rbtnFeeWaiver").checked = true;

                      if(document.getElementById("rbtnFeeWaiver").checked)
                      {
                          $('#lblReceivedAmount').hide();
                          $('#ReceivedAmount').hide();

                          $('#lblChequeNo').text('');
                          $('#lblChequeNo').append("Approval Email From<sup class='text-danger'>*</sup>");
                          $('#lblChequeDate').text('');
                          $('#lblChequeDate').append("Approval Email Date<sup class='text-danger'>*</sup>");
                      }
               }
               else
               {
                    document.getElementById("rbtnCard").checked = false;
                    document.getElementById("rbtnCardless").checked = true;
                    $('#lblChequeNo').hide();
                    $('#lblChequeDate').hide();
                    $("#FeePaymentNo").val('');
                    $("#FeePaymentDate").val('');
                    $('#FeePaymentNo').hide();
                    $('#FeePaymentDate').hide();
                    $('#ReceivedAmount').hide();
                    $('#divFeePaymentDetails').hide();
                    $('#lblReceivedAmount').hide();
                    document.getElementById("rbtnFeeWaiver").checked = false;
                    document.getElementById("rbtnOnline").checked = false;
               }

               AddCardTblAfterSave();
               document.getElementById("uploadSection").style.display="none";
            }

     });

    function setFromDateFormat(){
            $(".fromDate").attr("readonly", true);
            $('.fromDate').datepicker({
                dateFormat: 'dd-mm-yy',
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(today),
                autoclose: "true",
                yearRange: "-100:+0"
            });

             if (($('.fromDate').val() != undefined)  && ($('.fromDate').val() != "") ){
                var d = stringToDate($('.fromDate').val(),"dd-mm-yyyy");
                var ye = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(d)
                var mo = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(d)
                var da = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(d)
                $('.fromDate').val(`${da}-${mo}-${ye}`);
             }
        }

         function AddCardTbl()
         {
           var ret=true;
           console.log('Inside AddCardTbl()');
           var cardsCount = $("#NoOfCards").val();

            if (cardsCount == "")
            {
                $('#NoOfCardsErrMsg').text("No. of Cards cannot be left blank");
                $("#NoOfCardsErrMsg").attr("style", "display:block");
                ret=false;
            }
            //else if (Number(cardsCount) <=0 || Number(cardsCount) >10)
            //{
            //    $('#NoOfCardsErrMsg').text("No. of Cards may be 1 to 10");
            //    $("#NoOfCardsErrMsg").attr("style", "display:block");
            //    ret=false;
            //}
            else if (Number(cardsCount) <=0)
            {
                $('#NoOfCardsErrMsg').text("No. of Cards must be greater than zero");
                $("#NoOfCardsErrMsg").attr("style", "display:block");
                ret=false;
            }
            else
            {
                $('#NoOfCardsErrMsg').text("");
            }

            var customerTypeId = $("#CustomerTypeId").val();
            var noOfVehiclesAllCards = $("#NoofVechileforAllCards").val().trim();
            console.log(customerTypeId);
            if (customerTypeId == "905" || customerTypeId == "909")
            {
                if (noOfVehiclesAllCards == "")
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be left blank");
                    $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                    ret=false;
                }
                //else if (Number(noOfVehiclesAllCards) <=0 || Number(noOfVehiclesAllCards) >10)
                //{
                //    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles May be 1 to 10");
                //    $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                //    ret=false;
                //}
                else if (Number(noOfVehiclesAllCards) <=0)
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles must be greater than zero");
                    $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                    ret=false;
                }
                else if (Number(cardsCount) > Number(noOfVehiclesAllCards))
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be less than No. of Cards");
                    ret=false;
                }
                else
                {
                    $("#NoofVechileforAllCardsErrMsg").text("");
                }
            }
            else
            {
                $("#NoofVechileforAllCardsErrMsg").text("");
            }

            var formNumber = $("#FormNumber").val().trim();

            if(formNumber=="")
            {
               $('#formNameValErrMsg').text("Form Number cannot be left blank");
               $("#formNameValErrMsg").attr("style", "display:block");
               ret=false;
            }
            else if (formNumber.substring(0, 1) == "0")
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (formNumber.length < 10)
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (!(formNumber.match(number)))
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (localStorage.getItem("FORMNOALREADYUSED") == 0)
            {
                $('#formNameValErrMsg').text("Form Number already exists");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret = false;
            }
            else
            {
                $('#formNameValErrMsg').text("");
            }

            if (!(document.querySelector('input[name="CardPreference"]:checked')))
            {
                document.getElementById("CardPreference_error").innerHTML="Please select Card Preference";
                ret = false;
            }

            if (document.getElementById("rbtnCard").checked)
            {

                if (document.getElementById("rbtnFeeWaiver").checked)
                {
                    if (document.getElementById("FeePaymentNo").value.trim() == "")
                    {
                        $('#FeePaymentNoErrMsg').text("Approval Email From cannot be left blank");
                        $("#FeePaymentNoErrMsg").attr("style", "display:block");
                        ret=false;
                    }
                    else
                    {
                      $('#FeePaymentNoErrMsg').text("");
                    }

                    if (document.getElementById("FeePaymentDate").value.trim() == "")
                    {
                        $('#FeePaymentDateErrMsg').text("Approval Email Date cannot be left blank");
                        $("#FeePaymentDateErrMsg").attr("style", "display:block");
                        ret=false;
                    }
                    else
                    {
                        $('#FeePaymentDateErrMsg').text("");
                    }
                }

                if (document.getElementById("rbtnOnline").checked)
                {
                    if (document.getElementById("FeePaymentNo").value.trim() == "")
                    {
                        $('#FeePaymentNoErrMsg').text("Payment Source cannot be left blank");
                        $("#FeePaymentNoErrMsg").attr("style", "display:block");
                        ret=false;
                    }
                    else
                    {
                         $('#FeePaymentNoErrMsg').text("");
                    }

                    if (document.getElementById("FeePaymentDate").value.trim() == "")
                    {
                        $('#FeePaymentDateErrMsg').text("Payment Date cannot be left blank");
                        $("#FeePaymentDateErrMsg").attr("style", "display:block");
                        ret=false;
                    }
                    else
                    {
                        $('#FeePaymentDateErrMsg').text("");
                    }
                }
            }

            if (document.getElementById("RBEId").value != "")
            {
                if(document.getElementById("RbeNameVal").value=="")
                {
                  document.getElementById("RbeValErrMsg").innerHTML = "Invalid RBE ID";
                  document.getElementById("RBEId").focus();
                  ret = false;
                }
                else
                {
                    document.getElementById("RbeValErrMsg").innerHTML = "";
                }
            }
            else
            {
                document.getElementById("RbeValErrMsg").innerHTML = "";
            }

            if(ret==false)
            {
               return ret;
            }

            if(Number(cardsCount)>10 || Number(noOfVehiclesAllCards)>10)
            {
                $('#NoOfCards').attr("readonly", true);
                $('#NoofVechileforAllCards').attr("readonly", true);
                $('#FeePaymentDate').attr("readonly", true);
                $('#FeePaymentNo').attr("readonly", true);
                $("#btnAdd").attr("disabled", true);
                $(".radio-button").prop("disabled", true);
                $(".radio-toolbar").prop("disabled", true);
                $('#FormNumber').attr("readonly", true);
                document.getElementById("uploadSection").style.display="block";
            }
            else
            {
                document.getElementById("uploadSection").style.display="none";
                var vehicles = [];
                var checked="false";

                if ($(VehicleVerifiedManually).prop("checked"))
                {
                    checked="true";
                }

                var FeePayments=$("#FeePaymentsCollectFeeWaiver").val();

                if(FeePayments===undefined)
                {
                    FeePayments="0";
                }
                else if(FeePayments==undefined)
                {
                    FeePayments="0";
                }
                else if(FeePayments=="undefined")
                {
                    FeePayments="0";
                }

                console.log('Before FeePayments');
                console.log(FeePayments);
                if($("#dvRemarks").html().trim()!="")
                {
                        $("#OldVehicleDetails TBODY TR").each(function () {
                            var row = $(this);
                            vehicles.push({
                                CustomerTypeId: customerTypeId,
                                Message: $("#Message").val(),
                                CardPreference: $('input[name="CardPreference"]:checked').val(),
                                FeePaymentDate: $("#FeePaymentDate").val(),
                                FeePaymentNo: $("#FeePaymentNo").val(),
                                FeePaymentsCollectFeeWaiver: FeePayments,
                                CardIdentifier: row.find("TD").eq(0).html(),
                                VechileNo: row.find("TD").eq(1).html(),
                                VehicleType: row.find("TD").eq(2).html(),
                                VehicleMake: row.find("TD").eq(3).html(),
                                YearOfRegistration: row.find("TD").eq(4).html(),
                                MobileNo: row.find("TD").eq(5).html(),
                                NoOfCards: cardsCount,
                                NoofVehicles: noOfVehiclesAllCards,
                                VehicleVerifiedManually: checked,
                                VehicleNoMsg: row.find("TD").eq(6).html(),
                                MobileNoMsg: row.find("TD").eq(7).html(),
                                Verified: row.find("TD").eq(8).html(),
                                CardIdentMsg: row.find("TD").eq(9).html()
                            })
                        });
                   }
                   else
                   {
                        vehicles.push({
                                    CustomerTypeId: customerTypeId,
                                    Message: $("#Message").val(),
                                    CardPreference: $('input[name="CardPreference"]:checked').val(),
                                    FeePaymentDate: $("#FeePaymentDate").val(),
                                    FeePaymentNo: $("#FeePaymentNo").val(),
                                    FeePaymentsCollectFeeWaiver: FeePayments,
                                    CardIdentifier: "",
                                    VechileNo: "",
                                    VehicleType: "",
                                    VehicleMake: "",
                                    YearOfRegistration: "",
                                    MobileNo: "",
                                    NoOfCards: cardsCount,
                                    NoofVehicles: noOfVehiclesAllCards,
                                    VehicleVerifiedManually: checked,
                                    VehicleNoMsg: "",
                                    MobileNoMsg: "",
                                    Verified: "0",
                                    CardIdentMsg: ""
                                });
                   }
                   console.log("2nd Partial Data");
                   console.log(JSON.stringify(vehicles));


                 $.ajax({
                    type: 'POST',
                    url: '@Url.Action("CustomerAddCardVehicleTbl", "ApplicationFormDataEntry")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(vehicles),
                    dataType: "html",
                    success: function (data, status, xhr) {
                            var v = data;
                            if (status == 'success')
                            {
                                document.getElementById("ViewNoOfCardsTbl").style.display = "block";
                                $("#ViewNoOfCardsTbl").html(data);
                                $('html, body').animate({
                                    scrollTop: $("#ViewNoOfCardsTbl").offset().top
                                }, 2000);
                                document.getElementById("divSubmit").style.display = "block";

                                $('#NoOfCards').attr("readonly", true);
                                $('#NoofVechileforAllCards').attr("readonly", true);
                                $('#FeePaymentDate').attr("readonly", true);
                                $('#FeePaymentNo').attr("readonly", true);
                                $("#btnAdd").attr("disabled", true);
                                $(".radio-button").prop("disabled", true);
                                $(".radio-toolbar").prop("disabled", true);
                                $('#FormNumber').attr("readonly", true);

                                if(customerTypeId==902 || customerTypeId==917)
                                {
                                 document.getElementById("NoOfCardsTbl").className="datatable table table-striped table-bordered w-50 d-md-table b-block text-nowrap display table-responsive";
                                }
                                else
                                {
                                 document.getElementById("NoOfCardsTbl").className="datatable table table-striped table-bordered w-100 d-md-table b-block text-nowrap display table-responsive";
                                }
                            }
                        },
                    error: function (jqXhr, textStatus, errorMessage)
                    {
                        $("#ViewNoOfCardsTbl").html("");
                        $("#btnAdd").attr("disabled", false);
                    }
                });
            }
        }

        function AddCardTblAfterSave()
        {
           var ret=true;
           console.log('Inside AddCardTbl()');
           var cardsCount = $("#NoOfCards").val();

            if (cardsCount == "")
            {
                $('#NoOfCardsErrMsg').text("No. of Cards cannot be left blank");
                $("#NoOfCardsErrMsg").attr("style", "display:block");
                ret=false;
            }
            //else if (Number(cardsCount) <=0 || Number(cardsCount) >10)
            //{
            //    $('#NoOfCardsErrMsg').text("No. of Cards may be 1 to 10");
            //    $("#NoOfCardsErrMsg").attr("style", "display:block");
            //    ret=false;
            //}
            else if (Number(cardsCount) <=0)
            {
                $('#NoOfCardsErrMsg').text("No. of Cards must be greater than zero");
                $("#NoOfCardsErrMsg").attr("style", "display:block");
                ret=false;
            }
            else
            {
                $('#NoOfCardsErrMsg').text("");
            }

            var customerTypeId = $("#CustomerTypeId").val();
            var noOfVehiclesAllCards = $("#NoofVechileforAllCards").val().trim();
            console.log(customerTypeId);
            if (customerTypeId == "905" || customerTypeId == "909")
            {
                if (noOfVehiclesAllCards == "")
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be left blank");
                    $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                    ret=false;
                }
                //else if (Number(noOfVehiclesAllCards) <=0 || Number(noOfVehiclesAllCards) >10)
                //{
                //    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles May be 1 to 10");
                //    $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                //    ret=false;
                //}
                else if (Number(noOfVehiclesAllCards) <=0)
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles must be greater than zero");
                    $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                    ret=false;
                }
                else if (Number(cardsCount) > Number(noOfVehiclesAllCards))
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be less than No. of Cards");
                    ret=false;
                }
                else
                {
                    $("#NoofVechileforAllCardsErrMsg").text("");
                }
            }
            else
            {
                $("#NoofVechileforAllCardsErrMsg").text("");
            }

            var formNumber = $("#FormNumber").val().trim();

            if(formNumber=="")
            {
               $('#formNameValErrMsg').text("Form Number cannot be left blank");
               $("#formNameValErrMsg").attr("style", "display:block");
               ret=false;
            }
            else if (formNumber.substring(0, 1) == "0")
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (formNumber.length < 10)
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (!(formNumber.match(number)))
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (localStorage.getItem("FORMNOALREADYUSED") == 0)
            {
                $('#formNameValErrMsg').text("Form Number already exists");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret = false;
            }
            else
            {
                $('#formNameValErrMsg').text("");
            }

            if (!(document.querySelector('input[name="CardPreference"]:checked')))
            {
                document.getElementById("CardPreference_error").innerHTML="Please select Card Preference";
                ret = false;
            }

            if (document.getElementById("rbtnCard").checked)
            {

                if (document.getElementById("rbtnFeeWaiver").checked)
                {
                    if (document.getElementById("FeePaymentNo").value.trim() == "")
                    {
                        $('#FeePaymentNoErrMsg').text("Approval Email From cannot be left blank");
                        $("#FeePaymentNoErrMsg").attr("style", "display:block");
                        ret=false;
                    }
                    else
                    {
                      $('#FeePaymentNoErrMsg').text("");
                    }

                    if (document.getElementById("FeePaymentDate").value.trim() == "")
                    {
                        $('#FeePaymentDateErrMsg').text("Approval Email Date cannot be left blank");
                        $("#FeePaymentDateErrMsg").attr("style", "display:block");
                        ret=false;
                    }
                    else
                    {
                        $('#FeePaymentDateErrMsg').text("");
                    }
                }

                if (document.getElementById("rbtnOnline").checked)
                {
                    if (document.getElementById("FeePaymentNo").value.trim() == "")
                    {
                        $('#FeePaymentNoErrMsg').text("Payment Source cannot be left blank");
                        $("#FeePaymentNoErrMsg").attr("style", "display:block");
                        ret=false;
                    }
                    else
                    {
                         $('#FeePaymentNoErrMsg').text("");
                    }

                    if (document.getElementById("FeePaymentDate").value.trim() == "")
                    {
                        $('#FeePaymentDateErrMsg').text("Payment Date cannot be left blank");
                        $("#FeePaymentDateErrMsg").attr("style", "display:block");
                        ret=false;
                    }
                    else
                    {
                        $('#FeePaymentDateErrMsg').text("");
                    }
                }
            }

            if (document.getElementById("RBEId").value != "")
            {
                if(document.getElementById("RbeNameVal").value=="")
                {
                  document.getElementById("RbeValErrMsg").innerHTML = "Invalid RBE ID";
                  document.getElementById("RBEId").focus();
                  ret = false;
                }
                else
                {
                    document.getElementById("RbeValErrMsg").innerHTML = "";
                }
            }
            else
            {
                document.getElementById("RbeValErrMsg").innerHTML = "";
            }

            if(ret==false)
            {
               return ret;
            }

           
                var vehicles = [];
                var checked="false";

                if ($(VehicleVerifiedManually).prop("checked"))
                {
                    checked="true";
                }

                var FeePayments=$("#FeePaymentsCollectFeeWaiver").val();

                if(FeePayments===undefined)
                {
                    FeePayments="0";
                }
                else if(FeePayments==undefined)
                {
                    FeePayments="0";
                }
                else if(FeePayments=="undefined")
                {
                    FeePayments="0";
                }

                console.log('Before FeePayments');
                console.log(FeePayments);
                if($("#dvRemarks").html().trim()!="")
                {
                        $("#OldVehicleDetails TBODY TR").each(function () {
                            var row = $(this);
                            vehicles.push({
                                CustomerTypeId: customerTypeId,
                                Message: $("#Message").val(),
                                CardPreference: $('input[name="CardPreference"]:checked').val(),
                                FeePaymentDate: $("#FeePaymentDate").val(),
                                FeePaymentNo: $("#FeePaymentNo").val(),
                                FeePaymentsCollectFeeWaiver: FeePayments,
                                CardIdentifier: row.find("TD").eq(0).html(),
                                VechileNo: row.find("TD").eq(1).html(),
                                VehicleType: row.find("TD").eq(2).html(),
                                VehicleMake: row.find("TD").eq(3).html(),
                                YearOfRegistration: row.find("TD").eq(4).html(),
                                MobileNo: row.find("TD").eq(5).html(),
                                NoOfCards: cardsCount,
                                NoofVehicles: noOfVehiclesAllCards,
                                VehicleVerifiedManually: checked,
                                VehicleNoMsg: row.find("TD").eq(6).html(),
                                MobileNoMsg: row.find("TD").eq(7).html(),
                                Verified: row.find("TD").eq(8).html(),
                                CardIdentMsg: row.find("TD").eq(9).html()
                            })
                        });
                   }
                   else
                   {
                        vehicles.push({
                                    CustomerTypeId: customerTypeId,
                                    Message: $("#Message").val(),
                                    CardPreference: $('input[name="CardPreference"]:checked').val(),
                                    FeePaymentDate: $("#FeePaymentDate").val(),
                                    FeePaymentNo: $("#FeePaymentNo").val(),
                                    FeePaymentsCollectFeeWaiver: FeePayments,
                                    CardIdentifier: "",
                                    VechileNo: "",
                                    VehicleType: "",
                                    VehicleMake: "",
                                    YearOfRegistration: "",
                                    MobileNo: "",
                                    NoOfCards: cardsCount,
                                    NoofVehicles: noOfVehiclesAllCards,
                                    VehicleVerifiedManually: checked,
                                    VehicleNoMsg: "",
                                    MobileNoMsg: "",
                                    Verified: "0",
                                    CardIdentMsg: ""
                                });
                   }
                   console.log("2nd Partial Data");
                   console.log(JSON.stringify(vehicles));


                 $.ajax({
                    type: 'POST',
                    url: '@Url.Action("CustomerAddCardVehicleTbl", "ApplicationFormDataEntry")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(vehicles),
                    dataType: "html",
                    success: function (data, status, xhr) {
                            var v = data;
                            if (status == 'success')
                            {
                                document.getElementById("ViewNoOfCardsTbl").style.display = "block";
                                $("#ViewNoOfCardsTbl").html(data);
                                $('html, body').animate({
                                    scrollTop: $("#ViewNoOfCardsTbl").offset().top
                                }, 2000);
                                document.getElementById("divSubmit").style.display = "block";

                                $('#NoOfCards').attr("readonly", true);
                                $('#NoofVechileforAllCards').attr("readonly", true);
                                $('#FeePaymentDate').attr("readonly", true);
                                $('#FeePaymentNo').attr("readonly", true);
                                $("#btnAdd").attr("disabled", true);
                                $(".radio-button").prop("disabled", true);
                                $(".radio-toolbar").prop("disabled", true);
                                $('#FormNumber').attr("readonly", true);

                                if(customerTypeId==902 || customerTypeId==917)
                                {
                                 document.getElementById("NoOfCardsTbl").className="datatable table table-striped table-bordered w-50 d-md-table b-block text-nowrap display table-responsive";
                                }
                                else
                                {
                                 document.getElementById("NoOfCardsTbl").className="datatable table table-striped table-bordered w-100 d-md-table b-block text-nowrap display table-responsive";
                                }
                            }
                        },
                    error: function (jqXhr, textStatus, errorMessage)
                    {
                        $("#ViewNoOfCardsTbl").html("");
                        $("#btnAdd").attr("disabled", false);
                    }
                });

        }

        $('input[name="FeePaymentsCollectFeeWaiver"]:radio').change(function ()
        {
            var selected = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val()
            //alert(selected);
            if (selected == "1")
            {
                $('#lblChequeNo').text('');
                $('#lblChequeNo').append("Payment Source<sup class='text-danger'>*</sup>");
                $('#lblChequeDate').text('');
                $('#lblChequeDate').append("Payment Date<sup class='text-danger'>*</sup>");
            }
            else if (selected == "2")
            {
                $('#lblChequeNo').text('');
                $('#lblChequeNo').append("Approval Email From<sup class='text-danger'>*</sup>");
                $('#lblChequeDate').text('');
                $('#lblChequeDate').append("Approval Email Date<sup class='text-danger'>*</sup>");
            }

       });



    $('input[name="CardPreference"]:radio').change(function ()
    {
        document.getElementById("FeePaymentNoErrMsg").innerHTML = "";
        document.getElementById("FeePaymentDateErrMsg").innerHTML = "";

        var selected = $("input[name='CardPreference']:checked").val()
        //alert(selected);
        if (selected == "Cardless")
        {
            $('#lblChequeNo').hide();
            $('#lblChequeDate').hide();
            $("#FeePaymentNo").val('');
            $("#FeePaymentDate").val('');
            $('#FeePaymentNo').hide();
            $('#FeePaymentDate').hide();
            $('#ReceivedAmount').hide();
            $('#divFeePaymentDetails').hide();
            $('#lblReceivedAmount').hide();
            document.getElementById("rbtnFeeWaiver").checked = false;
            document.getElementById("rbtnOnline").checked = false;
            document.getElementById("CardPreference_error").innerHTML="";
        }
        else if (selected == "Card")
        {
            $('#lblChequeNo').show();
            $('#lblChequeDate').show();
            $("#FeePaymentNo").val('');
            $("#FeePaymentDate").val('');
            $('#FeePaymentNo').show();
            $('#FeePaymentDate').show();
            $('#ReceivedAmount').show();
            $('#divFeePaymentDetails').show();
            $('#lblReceivedAmount').show();

            document.getElementById("rbtnFeeWaiver").checked = true;
            //$("#rbtnCard").prop('disabled', false);
            //$("#FeePaymentNo").prop('disabled', false);
            //$("#FeePaymentDate").prop('disabled', false);
            //$('#lblChequeNo').text("Approval Email From");
            if(document.getElementById("rbtnFeeWaiver").checked)
            {
                $('#lblReceivedAmount').hide();
                $('#ReceivedAmount').hide();
            }
            document.getElementById("CardPreference_error").innerHTML="";
        }

        var count = $('#NoOfCardsTbl tr').length;


    });


    function RemoveSpecialChar(txtName)
    {
        if (txtName.value != '' && txtName.value.match(/^[\w ]+$/) == null)
        {
            txtName.value = txtName.value.replace(/[\W]/g, '');
        }
    }

     $("#FeePaymentNo").on("blur", function ()
        {
            var paymentNo = document.getElementById("FeePaymentNo").value.trim();
            if (paymentNo == "")
            {
                if (document.getElementById("rbtnCard").checked)
                {
                    if (document.getElementById("rbtnFeeWaiver").checked)
                    {
                        document.getElementById("FeePaymentNoErrMsg").innerHTML = "Approval Email From cannot be left blank";
                        return false;
                    }
                }

                if (document.getElementById("rbtnOnline").checked)
                {
                    document.getElementById("FeePaymentNoErrMsg").innerHTML = "Payment Source cannot be left blank";
                    return false;
                }
            }
            else
            {
                document.getElementById("FeePaymentNoErrMsg").innerHTML = "";
            }

       });

       $("#FeePaymentDate").on("change", function ()
        {
            var paymentDate = document.getElementById("FeePaymentDate").value.trim();
            if (paymentDate == "")
            {
                if (document.getElementById("rbtnCard").checked)
                {
                    if (document.getElementById("rbtnFeeWaiver").checked)
                    {
                        document.getElementById("FeePaymentDateErrMsg").innerHTML = "Approval Email Date cannot be left blank";
                        return false;
                    }
                }

                if (document.getElementById("rbtnOnline").checked)
                {
                    document.getElementById("FeePaymentDateErrMsg").innerHTML = "Payment Date cannot be left blank";
                    return false;
                }
            }
            else
            {
                document.getElementById("FeePaymentDateErrMsg").innerHTML = "";
            }

       });

       function ResetClick()
       {
            $('#NoOfCards').attr("readonly", false);
            $('#NoofVechileforAllCards').attr("readonly", false);
            //$('#FeePaymentDate').attr("readonly", false);
            $('#FeePaymentNo').attr("readonly", false);

            $("#ViewNoOfCardsTbl").html("");
            document.getElementById("ViewNoOfCardsTbl").style.display = "none";
            document.getElementById("divSubmit").style.display = "none";
        }

        function SubmitValidations()
        {
            debugger;
            var ret=true;

            var i=0;
            var j=0;
            var cnt = 0;

            $("#VehicleVerifiedManually").rules("remove", "required");

            var table = document.getElementById("NoOfCardsTbl");

            if (document.getElementById("CustomerId").value.trim() == "")
            {
                $('#CustomerIdValErrMsg').text("Please enter Customer ID");
                $("#CustomerIdValErrMsg").attr("style", "display:block");
                ret = false;
            }
            else if (!$("#CustomerId").val().match(mappedCustomerId))
            {
                $("#CustomerIdValErrMsg").attr("style", "display:block");
                $("#CustomerIdValErrMsg").html("Invalid Customer ID");
                ret = false;
            }
            else
            {
                $('#CustomerIdValErrMsg').text("");
            }
            console.log('After CustomerId');

            if (document.getElementById("CustomerName").value == "")
            {
                document.getElementById("CustomerName_error").innerHTML = "Customer Name cannot be left blank";
                ret = false;
            }
            else
            {
                document.getElementById("CustomerName_error").innerHTML = "";
            }

            var formNumberVal = document.getElementById("FormNumber").value.trim();
            if (formNumberVal == "")
            {
                 $("#formNameValErrMsg").html("Form Number cannot be left blank");
                 $("#formNameValErrMsg").attr("style", "display:block");
                 ret = false;
            }
            else if (formNumberVal.substring(0, 1) == "0")
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret = false;
            }
            else if (formNumberVal.length < 10)
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret = false;
            }
            else if (!(formNumberVal.match(number)))
            {
                $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
                $("#formNameValErrMsg").attr("style", "display:block");
                ret = false;
            }
            else
            {
                 $("#formNameValErrMsg").html("");
            }
            console.log('After FormNumber');

            if (document.getElementById("NoOfCards").value == "0" || document.getElementById("NoOfCards").value.trim() == "")
            {
                document.getElementById("NoOfCardsErrMsg").innerHTML = "No. of Cards cannot be left blank";
                ret = false;
            }
            else
            {
                document.getElementById("NoOfCardsErrMsg").innerHTML = "";
            }
            console.log('After NoOfCards');

            if (document.getElementById("RBEId").value != "")
            {
                if(document.getElementById("RbeNameVal").value=="")
                {
                  document.getElementById("RbeValErrMsg").innerHTML = "Invalid RBE ID";
                  document.getElementById("RBEId").focus();
                  ret = false;
                }
                else
                {
                    document.getElementById("RbeValErrMsg").innerHTML = "";
                }
            }
            else
            {
                document.getElementById("RbeValErrMsg").innerHTML = "";
            }
            console.log('After RBEId');

            var cardsCount = $("#NoOfCards").val();
            var customerTypeId = document.getElementById("CustomerTypeId").value;
            if (customerTypeId == "905" || customerTypeId == "909")
            {
                var noOfVehiclesAllCards = $("#NoofVechileforAllCards").val().trim();

                if (noOfVehiclesAllCards == "")
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be left blank");
                    $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                    ret=false;
                }
                else if (Number(noOfVehiclesAllCards) <=0 || Number(noOfVehiclesAllCards) >10)
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles May be 1 to 10");
                    $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                    ret=false;
                }
                else if (Number(cardsCount) > Number(noOfVehiclesAllCards))
                {
                    $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be less than No. of Cards");
                    ret=false;
                }
                else
                {
                    $("#NoofVechileforAllCardsErrMsg").text("");
                }

            }
            else
            {
                $("#NoofVechileforAllCardsErrMsg").text("");
            }
            console.log('After NoofVechileforAllCards');

            if (document.getElementById("rbtnCard").checked)
            {

                if (document.getElementById("rbtnFeeWaiver").checked)
                {
                    if (document.getElementById("FeePaymentNo").value.trim() == "")
                    {
                        document.getElementById("FeePaymentNoErrMsg").innerHTML = "Approval Email From cannot be left blank";
                        ret=false;
                    }
                    else
                    {
                      document.getElementById("FeePaymentNoErrMsg").innerHTML = "";
                    }

                    if (document.getElementById("FeePaymentDate").value.trim() == "")
                    {
                        document.getElementById("FeePaymentDateErrMsg").innerHTML = "Approval Email Date cannot be left blank";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById("FeePaymentDateErrMsg").innerHTML = "";
                    }
                }
            }

            if (document.getElementById("rbtnCard").checked)
            {
                if (document.getElementById("rbtnOnline").checked)
                {
                    if (document.getElementById("FeePaymentNo").value.trim() == "")
                    {
                        document.getElementById("FeePaymentNoErrMsg").innerHTML = "Payment Source cannot be left blank";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById("FeePaymentNoErrMsg").innerHTML = "";
                    }

                    if (document.getElementById("FeePaymentDate").value.trim() == "")
                    {
                        document.getElementById("FeePaymentDateErrMsg").innerHTML = "Payment Date cannot be left blank";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById("FeePaymentDateErrMsg").innerHTML = "";
                    }
                }
            }
            console.log('After rbtnCard');

            if (!(document.querySelector('input[name="CardPreference"]:checked')))
            {
                //alert("Please select Card Preference");
                document.getElementById("CardPreference_error").innerHTML="Please select Card Preference";
                ret=false;
            }

            if (document.getElementById("rbtnCard").checked)
            {
                if (!(document.querySelector('input[name="FeePaymentsCollectFeeWaiver"]:checked'))) {
                    alert("Fee Payment Details Not Selected");
                    ret=false;
                }
            }

            var selectedCardType = $("input[name='CardPreference']:checked").val();
            if(selectedCardType!=undefined)
            {
             document.getElementById("CardPreference").value = selectedCardType;
             console.log(selectedCardType);
            }

            var selectedFeePayment = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val();
            document.getElementById("FeePaymentsCollectFeeWaiver").value = selectedFeePayment;
            console.log(selectedFeePayment);

            var count = $('#NoOfCardsTbl tr').length;
            console.log('After count');
            //alert(count);

            if (count == 1) {
                alert("Vehicle Details Not Added");
                return false;
                ret=false;
            }

            var DuplicateFound = false;
            var DetailsNotFound = false;
            var InvalidYearFound = false;
            const d = new Date();
            let curYear = d.getFullYear();

            var selected = $("input[name='CardPreference']:checked").val();
            if (selected == "" || selected == undefined)
                selected = "Not Selected";

            if (customerTypeId == "901" || customerTypeId == "906") //Fleet And Credit
            {

                i=0;
                cnt = 0;

                $("#NoOfCardsTbl tbody tr").each(function ()
                {
                    var row = $(this);

                    var vhno = row.find("td:eq(1) input[type='text']").val();
                    var vehicleType =row.find('td').eq(3).find('select').val();
                    var vehicleMake = row.find("td:eq(4) input[type='text']").val();
                    var yearReg = row.find("td:eq(5) input[type='text']").val();

                    if (selected.toUpperCase() == "CARDLESS")
                    {
                        var mobile = row.find("td:eq(6) input[type='text']").val();
                    }

                    if(vhno!= undefined && vhno.trim()=='')
                    {
                        document.getElementById('VechileNo_error_'+cnt).innerHTML="Enter Vehicle No.";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById('VechileNo_error_'+cnt).innerHTML="";
                    }

                    if(vhno!= undefined && vhno.trim()!='')
                    {
                        if (!(vhno.match(forVehicleNo)))
                        {
                            document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                            ret=false;
                        }
                        else if(vhno.length<6 || vhno.length>10)
                        {
                           document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                           ret=false;
                        }
                        else
                        {
                            document.getElementById('VechileNo_error_'+cnt).innerHTML ="";
                        }
                    }

                    if (vehicleType == "--Select--")
                    {
                        document.getElementById('ddlVehicleType_error_'+cnt).innerHTML="Select Vehicle Type";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById('ddlVehicleType_error_'+cnt).innerHTML="";
                    }

                    if(vehicleMake.trim()=='')
                    {
                        document.getElementById('VehicleMake_error_'+cnt).innerHTML="Enter Vehicle Make";
                        ret=false;
                    }
                    else if (!(vehicleMake.match(atLeastOneAlphabet)))
                    {
                        document.getElementById('VehicleMake_error_'+cnt).innerHTML="Invalid Vehicle Make";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById('VehicleMake_error_'+cnt).innerHTML="";
                    }

                    if(yearReg.trim()=='')
                    {
                        document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Enter Year of Reg.";
                        ret=false;
                    }
                    else
                    {
                        if (!yearReg.match(number))
                        {
                            document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                            ret=false;
                        }
                        else if (yearReg.length < 4)
                        {
                          document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                          ret=false;
                        }
                        else if (yearReg < 1980 || yearReg > curYear)
                        {
                          document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                          ret=false;
                        }
                        else
                        {
                          document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="";
                        }
                    }


                    if (selected.toUpperCase() == "CARDLESS")
                    {
                        var mobile = row.find("td:eq(6) input[type='text']").val();

                        if(mobile.trim()=='')
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Enter Mobile Number";
                            ret=false;
                        }
                        else
                        {
                            if (mobile.charAt(0) == "0")
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else if (mobile.length < 10)
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else if(!mobile.match(phoneno))
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else
                            {
                               document.getElementById('MobileNo_error_'+cnt).innerHTML="";
                            }
                        }



                    }


                    cnt=cnt+1;

                });


                j=0;i=0;
                cnt=0;
                console.log('Before Checking For Duplicate VehicleNo');
                $("#NoOfCardsTbl tbody tr").each(function ()
                {
                    var row = $(this);
                    j=0;
                    i=i+1;
                    cnt = 0;
                    $("#NoOfCardsTbl tbody tr").each(function ()
                    {
                        var row1 = $(this);

                        j=j+1;
                        if(i>0 && j>1 && j>i)
                        {
                            var PrevRVno = row.find("td:eq(1) input[type='text']").val();
                            var CurRVno =  row1.find("td:eq(1) input[type='text']").val();

                            if(PrevRVno!="" && CurRVno!="")
                            {
                                if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                                {
                                    document.getElementById('VechileNo_error_'+cnt).innerHTML="Duplicate Vehicle No.";
                                    ret=false;
                                }
                            }
                        }

                        cnt=cnt+1;
                    });

                });


                if (selected.toUpperCase() == "CARDLESS")
                {
                    j=0;i=0;
                    cnt=0;
                    console.log('Before Checking For Duplicate MobileNo');
                    $("#NoOfCardsTbl tbody tr").each(function ()
                    {
                        var row = $(this);
                        j=0;
                        i=i+1;
                        cnt = 0;
                        $("#NoOfCardsTbl tbody tr").each(function ()
                        {
                            var row1 = $(this);

                            j=j+1;
                            if(i>0 && j>1 && j>i)
                            {
                                var PrevMbno = row.find("td:eq(6) input[type='text']").val();
                                var CurMbno =  row1.find("td:eq(6) input[type='text']").val();

                                if(PrevMbno!="" && CurMbno!="")
                                {
                                    if(PrevMbno.trim()==CurMbno.trim())
                                    {
                                        document.getElementById('MobileNo_error_'+cnt).innerHTML="Duplicate Mobile Number";
                                        ret=false;
                                    }
                                }
                            }

                            cnt=cnt+1;
                        });
                    });


                    console.log('Before Checking Existing Vehicle No.');
                    var table = document.getElementById("NoOfCardsTbl");
                    cnt=-1;
                    for (let row of table.rows)
                    {
                        if(row.cells[8].innerHTML.trim()=="1")
                        {
                           document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. already exists";
                           ret=false;
                        }
                        cnt=cnt+1;
                    }

                    cnt = 0;
                    var table = document.getElementById("NoOfCardsTbl");
                    if (!$(VehicleVerifiedManually).prop("checked"))
                    {
                        console.log('Before Checking Vehicle No. Verified');
                        cnt=-1;
                        for (let row of table.rows)
                        {
                            //console.log(row.cells);
                            //alert(row.cells[10].innerHTML);
                            var vno = $(row).find("td:eq(1) input[type='text']").val();
                            if(vno!= undefined && vno!="")
                            {
                                if(row.cells[9].innerHTML.trim()=="0")
                                {
                                    if (!(vno.match(forVehicleNo)))
                                    {
                                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                        ret=false;
                                    }
                                    else if(vno.length<6 || vno.length>10)
                                    {
                                      document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                      ret=false;
                                    }
                                    else
                                    {
                                      document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. not verified";
                                      ret=false;
                                    }
                                }
                            }
                            cnt=cnt+1;
                        }
                    }

                    console.log('Before Checking Existing Mobile No.');
                    var table = document.getElementById("NoOfCardsTbl");
                    cnt=-1;
                    for (let row of table.rows)
                    {
                        if(row.cells[10].innerHTML.trim()=="1")
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Mobile Number already exists";
                            ret=false;
                        }

                        cnt=cnt+1;
                    }

                }
                else
                {
                    console.log('Before Checking Existing Vehicle No.');
                    var table = document.getElementById("NoOfCardsTbl");
                    cnt=-1;
                    for (let row of table.rows)
                    {
                        if(row.cells[7].innerHTML.trim()=="1")
                        {
                           document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. already exists";
                           ret=false;
                        }
                        cnt=cnt+1;
                    }

                    cnt=-1;
                    if (!$(VehicleVerifiedManually).prop("checked"))
                    {
                        console.log('Before Checking Vehicle No. Verified');
                        for (let row of table.rows)
                        {
                            //alert(row.cells[10].innerHTML);
                            var vno = $(row).find("td:eq(1) input[type='text']").val();
                            if(vno!= undefined && vno!="")
                            {
                                if(row.cells[8].innerHTML.trim()=="0")
                                {
                                    if (!(vno.match(forVehicleNo)))
                                    {
                                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                        ret=false;
                                    }
                                    else if(vno.length<6 || vno.length>10)
                                    {
                                      document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                      ret=false;
                                    }
                                    else
                                    {
                                       document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. not verified";
                                       ret=false;
                                    }
                                }
                            }
                            cnt=cnt+1;
                        }
                    }
                }

            }
            else if (customerTypeId == "905" || customerTypeId == "909") //Attached,Generic
            {

                document.getElementById("Common_error").innerHTML = "";

               cnt=0;
               $("#NoOfCardsTbl tbody tr").each(function ()
                {
                    var row = $(this);

                    var cardIdentifier = row.find("td:eq(1) input[type='text']").val();
                    var vhno = row.find("td:eq(2) input[type='text']").val();
                    var vehicleType =row.find('td').eq(4).find('select').val();
                    var vehicleMake = row.find("td:eq(5) input[type='text']").val();
                    var yearReg = row.find("td:eq(6) input[type='text']").val();

                    if(cardIdentifier.trim()=='')
                    {
                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Enter Card Identifier";
                        ret=false;
                    }
                    else
                    {
                        if(cardIdentifier.trim()!='')
                        {
                            if(cardIdentifier.length<2 || cardIdentifier.length>16)
                            {
                              document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                              ret=false;
                            }
                            else if(!cardIdentifier.match(forVehicleNo))
                            {
                              document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                              ret=false;
                            }
                            else
                            {
                                document.getElementById('CardIdentifier_error_'+cnt).innerHTML="";
                            }
                        }
                    }

                    if(vhno!= undefined && vhno.trim()=='')
                    {
                        document.getElementById('VechileNo_error_'+cnt).innerHTML="Enter Vehicle No.";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById('VechileNo_error_'+cnt).innerHTML="";
                    }

                    if(vhno!= undefined && vhno.trim()!='')
                    {
                        if (!(vhno.match(forVehicleNo)))
                        {
                            document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                            ret=false;
                        }
                        else if(vhno.length<6 || vhno.length>10)
                        {
                          document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                          ret=false;
                        }
                        else
                        {
                            document.getElementById('VechileNo_error_'+cnt).innerHTML ="";
                        }
                    }

                    if (vehicleType == "--Select--")
                    {
                        document.getElementById('ddlVehicleType_error_'+cnt).innerHTML="Select Vehicle Type";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById('ddlVehicleType_error_'+cnt).innerHTML="";
                    }

                    if(vehicleMake.trim()=='')
                    {
                        document.getElementById('VehicleMake_error_'+cnt).innerHTML="Enter Vehicle Make";
                        ret=false;
                    }
                    else if (!(vehicleMake.match(atLeastOneAlphabet)))
                    {
                        document.getElementById('VehicleMake_error_'+cnt).innerHTML="Invalid Vehicle Make";
                        ret=false;
                    }
                    else
                    {
                        document.getElementById('VehicleMake_error_'+cnt).innerHTML="";
                    }

                    if(yearReg.trim()=='')
                    {
                        document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Enter Year of Reg.";
                        ret=false;
                    }
                    else
                    {
                        if (!yearReg.match(number))
                        {
                            document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                            ret=false;
                        }
                        else if (yearReg.length < 4)
                        {
                          document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                          ret=false;
                        }
                        else if (yearReg < 1980 || yearReg > curYear)
                        {
                          document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                          ret=false;
                        }
                        else
                        {
                          document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="";
                        }
                    }


                    if (selected.toUpperCase() == "CARDLESS")
                    {
                        var mobile = row.find("td:eq(7) input[type='text']").val();

                        if(mobile.trim()=='')
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Enter Mobile Number";
                            ret=false;
                        }
                        else
                        {
                            if (mobile.charAt(0) == "0")
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else if (mobile.length < 10)
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else if(!mobile.match(phoneno))
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else
                            {
                               document.getElementById('MobileNo_error_'+cnt).innerHTML="";
                            }
                        }


                    }


                    cnt=cnt+1;

                });


                //j=0;i=0;
                //cnt=0;
                //console.log('Before Checking For Duplicate Card Identifier');
                //$("#NoOfCardsTbl tbody tr").each(function ()
                //{
                //    var row = $(this);
                //    j=0;
                //    i=i+1;
                //    cnt = 0;
                //    $("#NoOfCardsTbl tbody tr").each(function ()
                //    {
                //        var row1 = $(this);

                //        j=j+1;
                //        if(i>0 && j>1 && j>i)
                //        {
                //            var PrevIdent = row.find("td:eq(1) input[type='text']").val();
                //            var CurIdent =  row1.find("td:eq(1) input[type='text']").val();

                //            if(PrevIdent!="" && CurIdent!="")
                //            {
                //                if(PrevIdent.trim().toUpperCase()==CurIdent.trim().toUpperCase())
                //                {

                //                    if(CurIdent.length<2 || CurIdent.length>16)
                //                    {
                //                      document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                //                      ret=false;
                //                    }
                //                    else if(!CurIdent.match(forVehicleNo))
                //                    {
                //                      document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                //                      ret=false;
                //                    }
                //                    else
                //                    {
                //                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Duplicate Card Identifier";
                //                        ret=false;
                //                    }

                //                }
                //            }
                //        }

                //        cnt=cnt+1;
                //    });

                //});


                j=0;i=0;
                cnt=0;
                console.log('Before Checking For Duplicate VehicleNo');
                $("#NoOfCardsTbl tbody tr").each(function ()
                {
                    var row = $(this);
                    j=0;
                    i=i+1;
                    cnt = 0;
                    $("#NoOfCardsTbl tbody tr").each(function ()
                    {
                        var row1 = $(this);

                        j=j+1;
                        if(i>0 && j>1 && j>i)
                        {
                            var PrevRVno = row.find("td:eq(2) input[type='text']").val();
                            var CurRVno =  row1.find("td:eq(2) input[type='text']").val();

                            if(PrevRVno!="" && CurRVno!="")
                            {
                                if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                                {
                                    document.getElementById('VechileNo_error_'+cnt).innerHTML="Duplicate Vehicle No.";
                                    ret=false;
                                }
                            }
                        }

                        cnt=cnt+1;
                    });

                });


                if (selected.toUpperCase() == "CARDLESS")
                {
                    j=0;i=0;
                    cnt=0;
                    //console.log('Before Checking For Duplicate MobileNo');
                    //$("#NoOfCardsTbl tbody tr").each(function ()
                    //{
                    //    var row = $(this);
                    //    j=0;
                    //    i=i+1;
                    //    cnt = 0;
                    //    $("#NoOfCardsTbl tbody tr").each(function ()
                    //    {
                    //        var row1 = $(this);

                    //        j=j+1;
                    //        if(i>0 && j>1 && j>i)
                    //        {
                    //            var PrevMbno = row.find("td:eq(7) input[type='text']").val();
                    //            var CurMbno =  row1.find("td:eq(7) input[type='text']").val();

                    //            if(PrevMbno!="" && CurMbno!="")
                    //            {
                    //                if(PrevMbno.trim()==CurMbno.trim())
                    //                {
                    //                    document.getElementById('MobileNo_error_'+cnt).innerHTML="Duplicate Mobile Number";
                    //                    ret=false;
                    //                }
                    //            }
                    //        }

                    //        cnt=cnt+1;
                    //    });
                    //});


                    cnt=-1;
                    console.log('Before Checking Existing Vehicle No.');
                    var table = document.getElementById("NoOfCardsTbl");

                    for (let row of table.rows)
                    {
                        //alert(row.cells[9].innerHTML);
                        if(row.cells[9].innerHTML.trim()=="1")
                        {
                            var Vhno = $(row).find("td:eq(2) input[type='text']").val();

                            if(Vhno!= undefined && Vhno!="")
                            {
                              document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. already exists";
                              ret=false;
                            }

                        }
                        cnt=cnt+1;
                    }

                   cnt=-1;
                    if (!$(VehicleVerifiedManually).prop("checked"))
                    {
                        console.log('Before Checking Vehicle No. Verified');
                        for (let row of table.rows)
                        {
                            //alert(row.cells[10].innerHTML);
                             console.log(row.cells[10].innerHTML);
                            if(row.cells[10].innerHTML.trim()=="0")
                            {
                                var Vhno = $(row).find("td:eq(2) input[type='text']").val();

                                if(Vhno!= undefined && Vhno!="")
                                {
                                    if (!(Vhno.match(forVehicleNo)))
                                    {
                                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                        ret=false;
                                    }
                                    else if(Vhno.length<6 || Vhno.length>10)
                                    {
                                      document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                      ret=false;
                                    }
                                    else
                                    {
                                        document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. not verified";
                                        ret=false;
                                    }
                                }
                            }
                            cnt=cnt+1;
                        }
                    }


                    console.log('Before Checking Existing Mobile No.');
                    var table = document.getElementById("NoOfCardsTbl");
                    cnt=-1;
                    for (let row of table.rows)
                    {
                        if(row.cells[11].innerHTML.trim()=="1")
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Mobile Number already exists";
                            ret=false;
                        }

                        cnt=cnt+1;
                    }

                }
                else
                {
                    console.log('Before Checking Existing Vehicle No.');
                    var table = document.getElementById("NoOfCardsTbl");
                    cnt=-1;
                    for (let row of table.rows)
                    {
                        //alert(row.cells[8].innerHTML);
                        if(row.cells[8].innerHTML.trim()=="1")
                        {
                            var Vhno = $(row).find("td:eq(2) input[type='text']").val();

                            if(Vhno!= undefined && Vhno!="")
                            {
                              document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. already exists";
                              ret=false;
                            }
                        }
                        cnt=cnt+1;
                    }

                    var table = document.getElementById("NoOfCardsTbl");
                    if (!$(VehicleVerifiedManually).prop("checked"))
                    {
                        console.log('Before Checking Vehicle No. Verified');
                        cnt=-1;
                        for (let row of table.rows)
                        {
                            //alert(row.cells[9].innerHTML);
                            if(row.cells[9].innerHTML.trim()=="0")
                            {
                                var Vhno = $(row).find("td:eq(2) input[type='text']").val();

                                if(Vhno!= undefined && Vhno!="")
                                {
                                    if (!(Vhno.match(forVehicleNo)))
                                    {
                                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                        ret=false;
                                    }
                                    else if(Vhno.length<6 || Vhno.length>10)
                                    {
                                      document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                      ret=false;
                                    }
                                    else
                                    {
                                        document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. not verified";
                                        ret=false;
                                    }
                                }
                            }

                            cnt=cnt+1;

                        }
                    }

                }


                console.log('Before Checking Existing Card Identifier');
                var table = document.getElementById("NoOfCardsTbl");
                cnt=-1;
                for (let row of table.rows)
                {
                    if (selected.toUpperCase() == "CARDLESS")
                    {
                        if(row.cells[8].innerHTML.trim()=="1")
                        {
                            document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Card Identifier already exists";
                            ret=false;
                        }
                    }
                    else
                    {
                        if(row.cells[7].innerHTML.trim()=="1")
                        {
                            document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Card Identifier already exists";
                            ret=false;
                        }
                    }
                    cnt=cnt+1;
                }

            }
            else if (customerTypeId == "902" || customerTypeId == "917") //Corporate,Non Fleet
            {

                document.getElementById("Common_error").innerHTML = "";

                cnt=0;
                $("#NoOfCardsTbl tbody tr").each(function ()
                {
                    var row = $(this);

                    var cardIdentifier = row.find("td:eq(1) input[type='text']").val();

                    if(cardIdentifier.trim()=='')
                    {
                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Enter Card Identifier";
                        ret=false;
                    }
                    else
                    {
                        if(cardIdentifier.trim()!='')
                        {
                            if(cardIdentifier.length<2 || cardIdentifier.length>16)
                            {
                              document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                              ret=false;
                            }
                            else if(!cardIdentifier.match(forVehicleNo))
                            {
                              document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                              ret=false;
                            }
                            else
                            {
                                document.getElementById('CardIdentifier_error_'+cnt).innerHTML="";
                            }
                        }
                    }


                    if (selected.toUpperCase() == "CARDLESS")
                    {
                        var mobile = row.find("td:eq(2) input[type='text']").val();

                        if(mobile.trim()=='')
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Enter Mobile Number";
                            ret=false;
                        }
                        else
                        {
                            if (mobile.charAt(0) == "0")
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else if (mobile.length < 10)
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else if(!mobile.match(phoneno))
                            {
                                document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                                ret=false;
                            }
                            else
                            {
                               document.getElementById('MobileNo_error_'+cnt).innerHTML="";
                            }
                        }

                    }


                    cnt=cnt+1;

                });


                j=0;i=0;
                cnt=0;
                console.log('Before Checking For Duplicate Card Identifier');
                $("#NoOfCardsTbl tbody tr").each(function ()
                {
                    var row = $(this);
                    j=0;
                    i=i+1;
                    cnt = 0;
                    $("#NoOfCardsTbl tbody tr").each(function ()
                    {
                        var row1 = $(this);

                        j=j+1;
                        if(i>0 && j>1 && j>i)
                        {
                            var PrevIdent = row.find("td:eq(1) input[type='text']").val();
                            var CurIdent =  row1.find("td:eq(1) input[type='text']").val();

                            if(PrevIdent!="" && CurIdent!="")
                            {
                                if(PrevIdent.trim().toUpperCase()==CurIdent.trim().toUpperCase())
                                {
                                    if(CurIdent.length<2 || CurIdent.length>16)
                                    {
                                      document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                                      ret=false;
                                    }
                                    else if(!CurIdent.match(forVehicleNo))
                                    {
                                      document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                                      ret=false;
                                    }
                                    else
                                    {
                                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Duplicate Card Identifier";
                                        ret=false;
                                    }
                                }
                            }
                        }

                        cnt=cnt+1;
                    });

                });


                if (selected.toUpperCase() == "CARDLESS")
                {

                    j=0;i=0;
                    cnt=0;
                    console.log('Before Checking For Duplicate MobileNo');
                    $("#NoOfCardsTbl tbody tr").each(function ()
                    {
                        var row = $(this);
                        j=0;
                        i=i+1;
                        cnt = 0;
                        $("#NoOfCardsTbl tbody tr").each(function ()
                        {
                            var row1 = $(this);

                            j=j+1;
                            if(i>0 && j>1 && j>i)
                            {
                                var PrevMobile = row.find("td:eq(2) input[type='text']").val();
                                var CurMobile =  row1.find("td:eq(2) input[type='text']").val();

                                if(PrevMobile!="" && CurMobile!="")
                                {
                                    if(PrevMobile.trim().toUpperCase()==CurMobile.trim().toUpperCase())
                                    {
                                        document.getElementById('MobileNo_error_'+cnt).innerHTML="Duplicate Mobile Number";
                                        ret=false;
                                    }
                                }
                            }

                            cnt=cnt+1;
                        });

                    });


                    console.log('Before Checking Existing Mobile No.');
                    var table = document.getElementById("NoOfCardsTbl");
                    cnt=-1;
                    for (let row of table.rows)
                    {
                        if(row.cells[4].innerHTML.trim()=="1")
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Mobile Number already exists";
                            ret=false;
                        }

                        cnt=cnt+1;
                    }

                }

                console.log('Before Checking Existing Card Identifier');
                var table = document.getElementById("NoOfCardsTbl");
                cnt=-1;
                for (let row of table.rows)
                {
                    if (selected.toUpperCase() == "CARDLESS")
                    {
                        if(row.cells[3].innerHTML.trim()=="1")
                        {
                            document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Card Identifier already exists";
                            ret=false;
                        }
                    }
                    else
                    {
                        if(row.cells[2].innerHTML.trim()=="1")
                        {
                            document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Card Identifier already exists";
                            ret=false;
                        }
                    }
                    cnt=cnt+1;
                }

            }

            console.log(ret);
            return ret;
        }

        $('#VehicleVerifiedManually').click(function()
        {
              var customerTypeId = document.getElementById("CustomerTypeId").value;
              console.log(customerTypeId);
              if ($(this).prop("checked"))
              {
                var cnt = 0;

                $("#NoOfCardsTbl tbody tr").each(function ()
                {
                    //var row = $(this);
                    document.getElementById('VechileNo_error_'+cnt).innerHTML ="";
                    $("#VechileNo_Vefirybtn_" + cnt).prop("disabled", true);
                    cnt=cnt+1;
                 });
              }
              else
              {
                    var cnt = 0;
                    var vehicleNo = "";
                    var isValid=true;

                   $("#NoOfCardsTbl tbody tr").each(function ()
                   {
                        isValid=true;
                        vehicleNo = "";
                        vehicleNo=document.getElementById('VechileNo_'+cnt).value;
                        if(vehicleNo.trim()=='')
                        {
                            isValid=false;
                        }
                        else
                        {
                            if(vehicleNo.trim()!='')
                            {
                                if (!(vehicleNo.match(forVehicleNo)))
                                {
                                    isValid=false;
                                }
                                else if(vehicleNo.length<6 || vehicleNo.length>10)
                                {
                                    isValid=false;
                                }
                            }
                        }

                        if(isValid)
                        {
                           $("#VechileNo_Vefirybtn_" + cnt).prop("disabled", false);
                        }
                        else
                        {
                           $("#VechileNo_Vefirybtn_" + cnt).prop("disabled", true);
                        }

                        cnt=cnt+1;

                  });

              }

        });

    $("#btnDownloadTemplate").click(function () 
    {
        var customerTypeId = $("#CustomerTypeId").val();
        var cardPreference = $('input[name="CardPreference"]:checked').val()
        var url = '@Html.Raw(@Url.Action("Download","ApplicationFormDataEntry", new { CustomerType="dd", CardOrCardLess="kk"  }))';
        url = url.replace("dd", encodeURIComponent(customerTypeId));
        url = url.replace("kk", encodeURIComponent(cardPreference));
        window.location.href = url;
    });

    $("#excel_file").change(function () 
    {
        debugger;
        var customerTypeId = $("#CustomerTypeId").val();
        var cardPreference = $('input[name="CardPreference"]:checked').val();
        var noOfVehiclesAllCards = $("#NoofVechileforAllCards").val().trim();
        var cardsCount = $("#NoOfCards").val();

        document.getElementById("reponseErr").style.display = "none";
        $("#excel_file_error").attr("style", "display:none");


        var fileUpload = document.getElementById("excel_file");
            var regex = /(.*?)\.(xlsx)$/;
            if (regex.test(fileUpload.value)) 
            {
                if (typeof (FileReader) != "undefined") 
                {
                    var reader = new FileReader();
                    reader.onload = function (e) 
                    {
                        var table = document.createElement("table");
                        table.setAttribute("id", "ExcelTable");

                        table.classList.add("table");

                        //Read the Excel File data.
                        var workbook = XLSX.read(e.target.result, {
                            type: 'binary'
                        });
 
                        //Fetch the name of First Sheet.
                        var firstSheet = workbook.SheetNames[0];
 
                        //Read all rows from First Sheet into an JSON array.
                        var rows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);
                        debugger;

                        //Add the header row.
                        if(customerTypeId==909 || customerTypeId==905)//Attached,Generic
                        {
                            var row = table.insertRow(-1);
 
                            //Add the header cells.
                            var headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Card Identifier";
                            row.appendChild(headerCell);
 
                            headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Vehicle Number";
                            row.appendChild(headerCell);
 
                            headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Vehicle Type";
                            row.appendChild(headerCell);

                            headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Vehicle Make";
                            row.appendChild(headerCell);

                            headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Year of Registration";
                            row.appendChild(headerCell);

                            if (cardPreference == "Cardless")
                            {
                                headerCell = document.createElement("TH");
                                headerCell.innerHTML = "Mobile Number";
                                row.appendChild(headerCell);
                            }
                        }
                        else if(customerTypeId==901 || customerTypeId==906)//Fleet,Credit
                        {
                            var row = table.insertRow(-1);
 
                            //Add the header cells.
                            headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Vehicle Number";
                            row.appendChild(headerCell);
 
                            headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Vehicle Type";
                            row.appendChild(headerCell);

                            headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Vehicle Make";
                            row.appendChild(headerCell);

                            headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Year of Registration";
                            row.appendChild(headerCell);

                            if (cardPreference == "Cardless")
                            {
                                headerCell = document.createElement("TH");
                                headerCell.innerHTML = "Mobile Number";
                                row.appendChild(headerCell);
                            }
                        }
                        else if(customerTypeId==902 || customerTypeId==917)//Corporate,Non Fleet
                        {
                            var row = table.insertRow(-1);
 
                            //Add the header cells.
                            var headerCell = document.createElement("TH");
                            headerCell.innerHTML = "Card Identifier";
                            row.appendChild(headerCell);
 
                            if (cardPreference == "Cardless")
                            {
                                headerCell = document.createElement("TH");
                                headerCell.innerHTML = "Mobile Number";
                                row.appendChild(headerCell);
                            }
                        }

                        debugger;
                        for (var i = 0; i < rows.length; i++) 
                        {
                            if(i<500)
                            {
                                if(customerTypeId==909 || customerTypeId==905)//Attached,Generic
                                {
                                    if(rows[i]["Card Identifier"]!="undefined" && rows[i]["Card Identifier"]!=undefined)
                                    {
                                        var row = table.insertRow(-1);
                                    
                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Card Identifier"].replace(/`/g, '');

                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Vehicle Number"];

                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Vehicle Type"];

                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Vehicle Make"];

                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Year of Registration"];

                                        if (cardPreference == "Cardless")
                                        {
                                            var cell = row.insertCell(-1);
                                            cell.innerHTML = rows[i]["Mobile Number"];
                                        }
                                    }
                                }
                                else if(customerTypeId==901 || customerTypeId==906)//Fleet,Credit
                                {
                                    if(rows[i]["Vehicle Number"]!="undefined" && rows[i]["Vehicle Number"]!=undefined)
                                    {
                                        var row = table.insertRow(-1);
                                    
                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Vehicle Number"];

                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Vehicle Type"];

                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Vehicle Make"];

                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Year of Registration"];

                                        if (cardPreference == "Cardless")
                                        {
                                            var cell = row.insertCell(-1);
                                            cell.innerHTML = rows[i]["Mobile Number"];
                                        }
                                    }
                                }
                                else if(customerTypeId==902 || customerTypeId==917)//Corporate,Non Fleet
                                {
                                    if(rows[i]["Card Identifier"]!="undefined" && rows[i]["Card Identifier"]!=undefined)
                                    {
                                        var row = table.insertRow(-1);
                                    
                                        var cell = row.insertCell(-1);
                                        cell.innerHTML = rows[i]["Card Identifier"].replace(/`/g, '');
                                    
                                        if (cardPreference == "Cardless")
                                        {
                                            var cell = row.insertCell(-1);
                                            cell.innerHTML = rows[i]["Mobile Number"];
                                        }
                                    }
                                }

                            }
                        }
                        debugger;
                        var dvCSV = document.getElementById("excel_data");
                        dvCSV.innerHTML = "";
                        dvCSV.appendChild(table);
                        debugger;
                        var rows = document.getElementById('ExcelTable').rows;

                        console.log("rows",rows.length);

                        $("tr:first").append("<td class ='errMsg'>Error Msg</td>");
                        $("tr:not(:first)").append("<td class ='errMsg'></td>");

                        const d = new Date();
                        let curYear = d.getFullYear();

                        if(rows.length==0)
                        {
                            $("#ExcelDataError").html('');
                            $("#ExcelDataError").append("<span>Vehicle Number/Card Identifier mismatching with No. of cards.</span>");
                            $("#excel_file").val('');
                            document.getElementById("ExcelDataError").style.display = "block";
                            return false;
                        }
                        else
                        {
                            if(customerTypeId=="905" || customerTypeId=="909")//Attached,Generic
                            {
                                if(rows.length-1!=Number(noOfVehiclesAllCards))
                                {
                                    $("#ExcelDataError").html('');
                                    $("#ExcelDataError").append("<span>Vehicle Number/Card Identifier mismatching with No. of Vehicles</span>");
                                    $("#excel_file").val('');
                                    document.getElementById("ExcelDataError").style.display = "block";
                                    return false;
                                }

                            }
                            else
                            {
                                if(rows.length-1!=Number(cardsCount))
                                {
                                    $("#ExcelDataError").html('');
                                    $("#ExcelDataError").append("<span>Vehicle Number/Card Identifier mismatching with No. of Cards</span>");
                                    $("#excel_file").val('');
                                    document.getElementById("ExcelDataError").style.display = "block";
                                    return false;
                                }
                            }
                        }

                        if(rows.length != 0)
                        {
                            $("#ExcelDataError").html('');
                            document.getElementById("ExcelDataError").style.display = "none";

                            $('#ExcelTable tr:gt(0)').each(function(index, tr) 
                            {
                                if(customerTypeId=="905" || customerTypeId=="909")//Attached,Generic
                                {
                                    var cardIdentifier = $(tr).find(':nth-child(1)').text();
                                    var vehicleNo = $(tr).find(':nth-child(2)').text();
                                    var vehicleType = $(tr).find(':nth-child(3)').text();
                                    var vehicleMake = $(tr).find(':nth-child(4)').text();
                                    var yearReg = $(tr).find(':nth-child(5)').text();
                                    var mobile = "";

                                    if (cardPreference == "Cardless")
                                    {
                                      mobile = $(tr).find(':nth-child(6)').text();
                                    }

                                    console.log(cardIdentifier+"    "+vehicleNo+"    "+vehicleType+"    "+vehicleMake + "  "+yearReg+ "  "+mobile);
                                

                                    var currentIndex = index + 1;

                                    if(cardIdentifier.trim() == '' || cardIdentifier == "undefined")
                                    {
                                        $("#ExcelDataError").html('');
                                        $("#ExcelDataError").append("<span>Card Identifier is required. Row Number: "+currentIndex+"</span>");
                                        $("#excel_file").val('');
                                        document.getElementById("ExcelDataError").style.display = "block";
                                        return false;
                                    }
                                    else
                                    {
                                        if (!(cardIdentifier.match(forVehicleNo))) 
                                        {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Invalid Card Identifier. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                        }
                                        else if (cardIdentifier.length < 2 || cardIdentifier.length > 16) 
                                        {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Invalid Card Identifier. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                        }
                                    }

                                      if (vehicleNo == '' || vehicleNo == "undefined") 
                                      {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Vehicle Number is required. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                      }
                                      else 
                                      {
                                            if (!ValidateVehicleNumber(vehicleNo)) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Vehicle Number. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                                                                      
                                      }

                                      if (vehicleType == '' || vehicleType == "undefined") 
                                      {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("Vehicle Type field should not be blank. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                      }

                                    if(vehicleMake.trim()=='' || vehicleMake == "undefined")
                                    {
                                        $("#ExcelDataError").html('');
                                        $("#ExcelDataError").append("<span>Vehicle Make is required. Row Number: "+currentIndex+"</span>");
                                        $("#excel_file").val('');
                                        document.getElementById("ExcelDataError").style.display = "block";
                                        return false;
                                    }
                                    else if (!vehicleMake.match(atLeastOneAlphabet)) 
                                    {
                                        $("#ExcelDataError").html('');
                                        $("#ExcelDataError").append("<span>Invalid Vehicle Make. Row Number: "+currentIndex+"</span>");
                                        $("#excel_file").val('');
                                        document.getElementById("ExcelDataError").style.display = "block";
                                        return false;
                                    }

                                    if(yearReg.trim()=='' || yearReg == "undefined")
                                    {
                                        $("#ExcelDataError").html('');
                                        $("#ExcelDataError").append("<span>Year Of Registation is required. Row Number: "+currentIndex+"</span>");
                                        $("#excel_file").val('');
                                        document.getElementById("ExcelDataError").style.display = "block";
                                        return false;
                                    }
                                    else
                                    {
                                         if(yearReg.trim()!='')
                                         {
                                            if (!yearReg.match(number)) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Year Of Registation. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if (yearReg.length < 4 || yearReg.length > 4) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Year Of Registation. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if (yearReg < 1980 || yearReg > curYear) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Year Of Registation. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
               
                                         } 
                                    }


                                    if (cardPreference == "Cardless")
                                    {
                                        if(mobile.trim()=='' || mobile == "undefined")
                                        {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                        }
                                        else
                                        {
                                            if (mobile.charAt(0) == "0") 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if (mobile.length < 10 || mobile.length > 10) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if(!mobile.match(phoneno)) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                        
                                        }
                                    }


                                }
                                else if(customerTypeId=="901" || customerTypeId=="906")//Fleet,Credit
                                {
                                    var vehicleNo = $(tr).find(':nth-child(1)').text();
                                    var vehicleType = $(tr).find(':nth-child(2)').text();
                                    var vehicleMake = $(tr).find(':nth-child(3)').text();
                                    var yearReg = $(tr).find(':nth-child(4)').text();
                                    var mobile = "";

                                    if (cardPreference == "Cardless")
                                    {
                                      mobile = $(tr).find(':nth-child(5)').text();
                                    }
debugger;
                                    console.log(vehicleNo+"    "+vehicleType+"    "+vehicleMake + "  "+yearReg+ "  "+mobile);
                                

                                    var currentIndex = index + 1;
                                    
                                      if (vehicleNo == '' || vehicleNo == "undefined") 
                                      {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Vehicle Number is required. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                      }
                                      else 
                                      {
                                            if (!ValidateVehicleNumber(vehicleNo)) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Vehicle Number. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                      }

                                      if (vehicleType == '' || vehicleType == "undefined") 
                                      {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Vehicle Type field should not be blank. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                      }

                                    if(vehicleMake.trim()=='' || vehicleMake == "undefined")
                                    {
                                        $("#ExcelDataError").html('');
                                        $("#ExcelDataError").append("<span>Vehicle Make is required. Row Number: "+currentIndex+"</span>");
                                        $("#excel_file").val('');
                                        document.getElementById("ExcelDataError").style.display = "block";
                                        return false;
                                    }
                                    else if (!vehicleMake.match(atLeastOneAlphabet)) 
                                    {
                                        $("#ExcelDataError").html('');
                                        $("#ExcelDataError").append("<span>Invalid Vehicle Make. Row Number: "+currentIndex+"</span>");
                                        $("#excel_file").val('');
                                        document.getElementById("ExcelDataError").style.display = "block";
                                        return false;
                                    }

                                    if(yearReg.trim()=='' || yearReg == "undefined")
                                    {
                                        $("#ExcelDataError").html('');
                                        $("#ExcelDataError").append("<span>Year Of Registation is required. Row Number: "+currentIndex+"</span>");
                                        $("#excel_file").val('');
                                        document.getElementById("ExcelDataError").style.display = "block";
                                        return false;
                                    }
                                    else
                                    {
                                         if(yearReg.trim()!='')
                                         {
                                            if (!yearReg.match(number)) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Year Of Registation. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if (yearReg.length < 4 || yearReg.length > 4) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Year Of Registation. Row Number: "+currentIndex+ "</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if (yearReg < 1980 || yearReg > curYear) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Year Of Registation. Row Number: "+currentIndex+ "</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
               
                                         } 
                                    }


                                    if (cardPreference == "Cardless")
                                    {
                                        if(mobile.trim()=='' || mobile == "undefined")
                                        {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                        }
                                        else
                                        {
                                            if (mobile.charAt(0) == "0") 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if (mobile.length < 10 || mobile.length > 10) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if(!mobile.match(phoneno)) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                        
                                        }
                                    }


                                }
                                else//Corporate,Non Fleet
                                {
debugger;
                                    var cardIdentifier = $(tr).find(':nth-child(1)').text();
                                    var mobile = "";

                                    if (cardPreference == "Cardless")
                                    {
                                      mobile = $(tr).find(':nth-child(2)').text();
                                    }

                                    console.log(cardIdentifier+"    "+mobile);
                                

                                    var currentIndex = index + 1;

                                    if(cardIdentifier.trim() == '' || cardIdentifier == "undefined")
                                    {
                                        $("#ExcelDataError").html('');
                                        $("#ExcelDataError").append("<span>Card Identifier is required. Row Number: "+currentIndex+"</span>");
                                        $("#excel_file").val('');
                                        document.getElementById("ExcelDataError").style.display = "block";
                                        return false;
                                    }
                                    else
                                    {
                                        if (!(cardIdentifier.match(forVehicleNo))) 
                                        {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Invalid Card Identifier. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                        }
                                        else if (cardIdentifier.length < 2 || cardIdentifier.length > 16) 
                                        {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Invalid Card Identifier. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                        }
                                    }


                                    if (cardPreference == "Cardless")
                                    {
                                        if(mobile.trim()=='' || mobile == "undefined")
                                        {
                                            $("#ExcelDataError").html('');
                                            $("#ExcelDataError").append("<span>Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                            $("#excel_file").val('');
                                            document.getElementById("ExcelDataError").style.display = "block";
                                            return false;
                                        }
                                        else
                                        {
                                            if (mobile.charAt(0) == "0") 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if (mobile.length < 10 || mobile.length > 10) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                            else if(!mobile.match(phoneno)) 
                                            {
                                                $("#ExcelDataError").html('');
                                                $("#ExcelDataError").append("<span>Invalid Mobile Number is required. Row Number: "+currentIndex+"</span>");
                                                $("#excel_file").val('');
                                                document.getElementById("ExcelDataError").style.display = "block";
                                                return false;
                                            }
                                        
                                        }
                                    }

                                }
                                                             


                            })

debugger;
                            if (customerTypeId == "902" || customerTypeId == "917") //Corporate,Non Fleet
                            {
                                    $("#ExcelDataError").html('');
                                    var j=0;i=0;
                                    var cnt=0;
                                    var isValid=true;
                                    console.log('Before Checking For Duplicate Card Identifier');
                                    $('#ExcelTable tr:gt(0)').each(function(index, tr) 
                                    {
                                        var PrevIdent = $(tr).find(':nth-child(1)').text();
                                        j=0;
                                        i=i+1;
//debugger;                                        
                                        $('#ExcelTable tr:gt(0)').each(function(index1, tr1)
                                        {
                                            var CurIdent = $(tr1).find(':nth-child(1)').text();
//debugger;
                                            j=j+1;
                                            if(i>0 && j>1 && j>i)
                                            {
                                                if(PrevIdent!="" && CurIdent!="")
                                                {
//debugger;
                                                    var currentIndex = index1 + 1;
                                                    if(PrevIdent.trim().toUpperCase()==CurIdent.trim().toUpperCase())
                                                    {
//debugger;
                                                        $("#ExcelDataError").append("<span>Duplicate Card Identifier Found. Row Number: "+currentIndex+"</span><br/>");
                                                        $("#excel_file").val('');
                                                        document.getElementById("ExcelDataError").style.display = "block";
                                                        isValid=false;
                                                        return false;
                                                    }
                                                }
                                            }


                                        });

                                    });

                                    var j=0;i=0;
                                    var cnt=0;
                                    
                                    if (cardPreference == "Cardless")
                                    {
                                        console.log('Before Checking For Duplicate Mobile Number');
                                        $('#ExcelTable tr:gt(0)').each(function(index, tr) 
                                        {
                                            var PrevMobileNo = $(tr).find(':nth-child(2)').text();
                                            j=0;
                                            i=i+1;
    //debugger;                                        
                                            $('#ExcelTable tr:gt(0)').each(function(index1, tr1)
                                            {
                                                var CurMobileNo = $(tr1).find(':nth-child(2)').text();
    //debugger;
                                                j=j+1;
                                                if(i>0 && j>1 && j>i)
                                                {
                                                    if(PrevMobileNo!="" && CurMobileNo!="")
                                                    {
    //debugger;
                                                        var currentIndex = index1 + 1;
                                                        if(PrevMobileNo.trim().toUpperCase()==CurMobileNo.trim().toUpperCase())
                                                        {
    //debugger;
                                                            $("#ExcelDataError").append("<span>Duplicate Mobile Number Found. Row Number: "+currentIndex+"</span><br/>");
                                                            $("#excel_file").val('');
                                                            document.getElementById("ExcelDataError").style.display = "block";
                                                            isValid=false;
                                                            return false;
                                                        }
                                                    }
                                                }


                                            });

                                        });
                                    }

                                if(isValid==false)
                                {
                                    return false;
                                }

                            }


                            if (customerTypeId == "901" || customerTypeId == "906") //Fleet, Credit
                            {
                                    $("#ExcelDataError").html('');
                                    document.getElementById("ExcelDataError").style.display = "none";
                                    var j=0;i=0;
                                    var cnt=0;
                                    var isValid=true;
                                    console.log('Before Checking For Duplicate Vehicle Number');
                                    $('#ExcelTable tr:gt(0)').each(function(index, tr) 
                                    {
                                        var PrevIdent = $(tr).find(':nth-child(1)').text();
                                        j=0;
                                        i=i+1;
//debugger;                                        
                                        $('#ExcelTable tr:gt(0)').each(function(index1, tr1)
                                        {
                                            var CurIdent = $(tr1).find(':nth-child(1)').text();
//debugger;
                                            j=j+1;
                                            if(i>0 && j>1 && j>i)
                                            {
                                                if(PrevIdent!="" && CurIdent!="")
                                                {
//debugger;
                                                    var currentIndex = index1 + 1;
                                                    if(PrevIdent.trim().toUpperCase()==CurIdent.trim().toUpperCase())
                                                    {
//debugger;
                                                        $("#ExcelDataError").append("<span>Duplicate Vehicle Number Found. Row Number: "+currentIndex+"</span><br/>");
                                                        $("#excel_file").val('');
                                                        document.getElementById("ExcelDataError").style.display = "block";
                                                        isValid=false;
                                                        return false;
                                                    }
                                                }
                                            }


                                        });

                                    });

                                    var j=0;i=0;
                                    var cnt=0;
                                    
                                    if (cardPreference == "Cardless")
                                    {
                                        console.log('Before Checking For Duplicate Mobile Number');
                                        $('#ExcelTable tr:gt(0)').each(function(index, tr) 
                                        {
                                            var PrevMobileNo = $(tr).find(':nth-child(5)').text();
                                            j=0;
                                            i=i+1;
    //debugger;                                        
                                            $('#ExcelTable tr:gt(0)').each(function(index1, tr1)
                                            {
                                                var CurMobileNo = $(tr1).find(':nth-child(5)').text();
    //debugger;
                                                j=j+1;
                                                if(i>0 && j>1 && j>i)
                                                {
                                                    if(PrevMobileNo!="" && CurMobileNo!="")
                                                    {
    //debugger;
                                                        var currentIndex = index1 + 1;
                                                        if(PrevMobileNo.trim().toUpperCase()==CurMobileNo.trim().toUpperCase())
                                                        {
    //debugger;
                                                            $("#ExcelDataError").append("<span>Duplicate Mobile Number Found. Row Number: "+currentIndex+"</span><br/>");
                                                            $("#excel_file").val('');
                                                            document.getElementById("ExcelDataError").style.display = "block";
                                                            isValid=false;
                                                            return false;
                                                        }
                                                    }
                                                }


                                            });

                                        });
                                    }

                                if(isValid==false)
                                {
                                    return false;
                                }

                            }


                            if (customerTypeId == "905" || customerTypeId == "909") //Attached, Generic
                            {
                                    $("#ExcelDataError").html('');
                                    document.getElementById("ExcelDataError").style.display = "none";
                                    var j=0;i=0;
                                    var cnt=0;
                                    var isValid=true;
                                    console.log('Before Checking For Duplicate Vehicle Number');
                                    $('#ExcelTable tr:gt(0)').each(function(index, tr) 
                                    {
                                        var PrevIdent = $(tr).find(':nth-child(2)').text();
                                        j=0;
                                        i=i+1;
//debugger;                                        
                                        $('#ExcelTable tr:gt(0)').each(function(index1, tr1)
                                        {
                                            var CurIdent = $(tr1).find(':nth-child(2)').text();
//debugger;
                                            j=j+1;
                                            if(i>0 && j>1 && j>i)
                                            {
                                                if(PrevIdent!="" && CurIdent!="")
                                                {
//debugger;
                                                    var currentIndex = index1 + 1;
                                                    if(PrevIdent.trim().toUpperCase()==CurIdent.trim().toUpperCase())
                                                    {
//debugger;
                                                        $("#ExcelDataError").append("<span>Duplicate Vehicle Number Found. Row Number: "+currentIndex+"</span><br/>");
                                                        $("#excel_file").val('');
                                                        document.getElementById("ExcelDataError").style.display = "block";
                                                        isValid=false;
                                                        return false;
                                                    }
                                                }
                                            }


                                        });

                                    });


                                if(isValid==false)
                                {
                                    return false;
                                }

                            }


                        }
                    }
                    reader.readAsBinaryString(fileUpload.files[0]);
                } 
                else 
                {
                    alert("This browser does not support HTML5.");
                }
            } 
            else 
            {
                $("#excel_file_error").attr("style", "display:block");
                $("#excel_file_error").html("Please upload a valid CSV file.");
                $("#excel_file").val('');
            }
    });

    function uploadBulkLimitRow()
    {
        debugger;
        document.getElementById("reponseErr").style.display = "none";
        document.getElementById("ExcelDataError").style.display = "none";
        var customerTypeId = $("#CustomerTypeId").val();
        var cardPreference = $('input[name="CardPreference"]:checked').val();
        var cardsCount = $("#NoOfCards").val();
        var noOfVehiclesAllCards = $("#NoofVechileforAllCards").val().trim();

        var flag = "Y";

        if($("#excel_file").val() == '')
        {
             $("#excel_file_error").attr("style", "display:block");
             $("#excel_file_error").html("Please add a xlsx file.");
             flag = "N";
        }


        if(flag == "Y")
        {

            $("#excel_file_error").attr("style", "display:none");


            if($("#excel_file").val() != '')
            {

                var vehicles = [];
                var checked="false";

                if ($(VehicleVerifiedManually).prop("checked"))
                {
                    checked="true";
                }

                var FeePayments=$("#FeePaymentsCollectFeeWaiver").val();

                if(FeePayments===undefined)
                {
                    FeePayments="0";
                }
                else if(FeePayments==undefined)
                {
                    FeePayments="0";
                }
                else if(FeePayments=="undefined")
                {
                    FeePayments="0";
                }

                if (customerTypeId == "905" || customerTypeId == "909") //Attached,Generic
                {
                    $('#ExcelTable tr:gt(0)').each(function(index, tr)
                    {
                                var row = $(this);
                                vehicles.push({
                                    CustomerTypeId: customerTypeId,
                                    Message: $("#Message").val(),
                                    CardPreference: $('input[name="CardPreference"]:checked').val(),
                                    FeePaymentDate: $("#FeePaymentDate").val(),
                                    FeePaymentNo: $("#FeePaymentNo").val(),
                                    FeePaymentsCollectFeeWaiver: FeePayments,
                                    CardIdentifier: row.find("TD").eq(0).html(),
                                    VechileNo: row.find("TD").eq(1).html(),
                                    VehicleType: row.find("TD").eq(2).html(),
                                    VehicleMake: row.find("TD").eq(3).html(),
                                    YearOfRegistration: row.find("TD").eq(4).html(),
                                    MobileNo: row.find("TD").eq(5).html(),
                                    NoOfCards: cardsCount,
                                    NoofVehicles: noOfVehiclesAllCards,
                                    VehicleVerifiedManually: checked,
                                    VehicleNoMsg: "",
                                    MobileNoMsg: "",
                                    Verified: "0",
                                    CardIdentMsg: ""
                                })
                            });
                    }
                    else if (customerTypeId == "901" || customerTypeId == "906") //Fleet,Credit
                    {
                        $('#ExcelTable tr:gt(0)').each(function(index, tr)
                        {
                                    var row = $(this);
                                    vehicles.push({
                                        CustomerTypeId: customerTypeId,
                                        Message: $("#Message").val(),
                                        CardPreference: $('input[name="CardPreference"]:checked').val(),
                                        FeePaymentDate: $("#FeePaymentDate").val(),
                                        FeePaymentNo: $("#FeePaymentNo").val(),
                                        FeePaymentsCollectFeeWaiver: FeePayments,
                                        CardIdentifier: "",
                                        VechileNo: row.find("TD").eq(0).html(),
                                        VehicleType: row.find("TD").eq(1).html(),
                                        VehicleMake: row.find("TD").eq(2).html(),
                                        YearOfRegistration: row.find("TD").eq(3).html(),
                                        MobileNo: row.find("TD").eq(4).html(),
                                        NoOfCards: cardsCount,
                                        NoofVehicles: noOfVehiclesAllCards,
                                        VehicleVerifiedManually: checked,
                                        VehicleNoMsg: "",
                                        MobileNoMsg: "",
                                        Verified: "0",
                                        CardIdentMsg: ""
                                    })
                                });
                    }
                    else if (customerTypeId == "902" || customerTypeId == "917") //Corporate,Non Fleet
                    {
                        $('#ExcelTable tr:gt(0)').each(function(index, tr)
                        {
                                    var row = $(this);
                                    vehicles.push({
                                        CustomerTypeId: customerTypeId,
                                        Message: $("#Message").val(),
                                        CardPreference: $('input[name="CardPreference"]:checked').val(),
                                        FeePaymentDate: $("#FeePaymentDate").val(),
                                        FeePaymentNo: $("#FeePaymentNo").val(),
                                        FeePaymentsCollectFeeWaiver: FeePayments,
                                        CardIdentifier: row.find("TD").eq(0).html(),
                                        VechileNo: "",
                                        VehicleType: "",
                                        VehicleMake: "",
                                        YearOfRegistration: "",
                                        MobileNo: row.find("TD").eq(1).html(),
                                        NoOfCards: cardsCount,
                                        NoofVehicles: noOfVehiclesAllCards,
                                        VehicleVerifiedManually: checked,
                                        VehicleNoMsg: "",
                                        MobileNoMsg: "",
                                        Verified: "0",
                                        CardIdentMsg: ""
                                    })
                                });
                        }


                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("CustomerAddCardVehicleTbl", "ApplicationFormDataEntry")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(vehicles),
                    dataType: "html",
                    success: function (data, status, xhr) {
                            var v = data;
                            if (status == 'success')
                            {
                                document.getElementById("ViewNoOfCardsTbl").style.display = "block";
                                $("#ViewNoOfCardsTbl").html(data);
                                $('html, body').animate({
                                    scrollTop: $("#ViewNoOfCardsTbl").offset().top
                                }, 2000);
                                document.getElementById("divSubmit").style.display = "block";
                                document.getElementById("uploadSection").style.display="none";

                                $('#NoOfCards').attr("readonly", true);
                                $('#NoofVechileforAllCards').attr("readonly", true);
                                $('#FeePaymentDate').attr("readonly", true);
                                $('#FeePaymentNo').attr("readonly", true);
                                $("#btnAdd").attr("disabled", true);
                                $(".radio-button").prop("disabled", true);
                                $(".radio-toolbar").prop("disabled", true);
                                $('#FormNumber').attr("readonly", true);

                                if(customerTypeId==902 || customerTypeId==917)
                                {
                                 document.getElementById("NoOfCardsTbl").className="datatable table table-striped table-bordered w-50 d-md-table b-block text-nowrap display table-responsive";
                                }
                                else
                                {
                                 document.getElementById("NoOfCardsTbl").className="datatable table table-striped table-bordered w-100 d-md-table b-block text-nowrap display table-responsive";
                                }

                                  if (checked=="true")
                                  {
                                    var cnt = 0;

                                    $("#NoOfCardsTbl tbody tr").each(function ()
                                    {
                                        //var row = $(this);
                                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="";
                                        $("#VechileNo_Vefirybtn_" + cnt).prop("disabled", true);
                                        cnt=cnt+1;
                                     });
                                  }
                                  else
                                  {
                                        var cnt = 0;

                                       $("#NoOfCardsTbl tbody tr").each(function ()
                                       {
                                            $("#VechileNo_Vefirybtn_" + cnt).prop("disabled", false);
                                            cnt=cnt+1;
                                      });

                                  }

                            }
                        },
                    error: function (jqXhr, textStatus, errorMessage)
                    {
                        $("#ViewNoOfCardsTbl").html("");
                        $("#btnAdd").attr("disabled", false);
                    }
                });


            }
        }
    }

</script>