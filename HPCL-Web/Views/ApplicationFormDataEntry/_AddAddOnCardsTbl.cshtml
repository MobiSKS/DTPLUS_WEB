@model HPCL.Common.Models.ViewModel.ApplicationFormDataEntry.AddAddOnCard


<div>
    <fieldset class="border-1 rounded border-grey mb-3">
        <legend class="font-12 font-weight-bold d-inline-block w-auto ml-3 mb-0 px-2">Card Preference</legend>
        <div class="col-md-12 col-12 px-4">
            <div class="form-group">
                <div class="d-flex align-items-center justify-content-start mt-3">
                    <div class="d-flex align-items-center justify-content-start mr-3">
                        @Html.RadioButtonFor(m => m.CardPreference, "Card", new { @id = "rbtnCard",@class="radio-button" }) <span class="ml-2"> Card </span>
                    </div>
                    <div class="d-flex align-items-center justify-content-start">
                        @Html.RadioButtonFor(m => m.CardPreference, "Cardless", new { @id = "rbtnCardless",@class="radio-button" }) <span class="ml-2"> Cardless </span>
                    </div>
                </div>
                <span class="error position-static mb-0 mt-2" id="CardPreference_error"></span>
            </div>
        </div>
    </fieldset>

    <fieldset class="border-1 rounded border-grey mb-3" id="divFeePaymentDetails">
        <legend class="font-12 font-weight-bold d-inline-block w-auto ml-3 mb-0 px-2">Fee Payment Details</legend>
        <div class="col-md-12 col-12 px-4">
            <div class="form-group">
                <div class="d-flex align-items-center justify-content-start mt-3">
                    <div class="d-flex align-items-center justify-content-start mr-3">
                        @Html.RadioButtonFor(m => m.FeePaymentsCollectFeeWaiver, "1", new { @id = "rbtnOnline", @class = "radio-toolbar" })
                        <span class="ml-2">Online</span>
                    </div>
                    <div class="d-flex align-items-center justify-content-start mr-3">
                        @Html.RadioButtonFor(m => m.FeePaymentsCollectFeeWaiver, "2", new { @id = "rbtnFeeWaiver", @class = "radio-toolbar" })
                        <span class="ml-2">Fee Waiver</span>
                    </div>
                </div>
            </div>
        </div>

    </fieldset>

    <div class="clearfix"></div>

    <div class="d-flex align-items-center flex-wrap">
        <div class="col-lg-6 col-12 mb-0">
            <div class="form-group d-flex align-items-center flex-wrap">
                <label class="font-weight-normal col-md-5 col-12" id="lblChequeNo">Cheque No.<sup class="text-danger">*</sup></label>
                <div class="col-md-7 col-12">
                    @Html.TextBoxFor(m => m.FeePaymentNo, new { @id = "FeePaymentNo", @class = "form-control", autocomplete = "off" })
                    @Html.ValidationMessageFor(m => m.FeePaymentNo, "", new { @class = "error", @id = "FeePaymentNoErrMsg" })
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-12 mb-0">
            <div class="form-group d-flex align-items-center flex-wrap">
                <label class="font-weight-normal col-md-5 col-12" id="lblChequeDate">Cheque Date<sup class="text-danger">*</sup></label>
                <div class="col-md-7 col-12">
                    @Html.TextBoxFor(m => m.FeePaymentDate, new { @id = "FeePaymentDate", @class = "form-control fromDate",@placeholder="dd-mm-yyyy", autocomplete = "off" })
                    @Html.ValidationMessageFor(m => m.FeePaymentDate, "", new { @class = "error", @id = "FeePaymentDateErrMsg" })
                </div>
            </div>
        </div>
    </div>

<div class="d-flex align-items-center flex-wrap">
    <div class="col-lg-6 col-12 mb-0">
        <div class="form-group d-flex align-items-center flex-wrap">
            <label class="font-weight-normal col-md-5 col-12" id="lblReceivedAmount">Received Amount<sup class="text-danger">*</sup></label>
            <div class="col-md-7 col-12">
                @Html.TextBoxFor(m => m.ReceivedAmount, new { @id = "ReceivedAmount", @class = "form-control", @readonly = "readonly" })
            </div>
        </div>
    </div>
    <div class="col-lg-6 col-12 mb-3">
        <div class="form-group d-flex align-items-center flex-wrap">
            <div class="col-md-7 col-12">
                <span class="error" id="Common_error"></span>
            </div>
        </div>
    </div>
</div>

    <div class="clearfix"></div>
    <div class="d-flex align-items-center justify-content-center mt-3 mb-4">
        <div class="px-2">
            <button class="btn btn_primary" type="button" id="btnAdd" onclick="AddCardTbl()">ADD</button>
        </div>
        <div class="px-2">
            <button class="btn btn_primary" type="button" onclick="ResetClick()" style="display:none">RESET</button>
        </div>
    </div>
    <div class="clearfix"></div>

    <div class="clearfix"></div>

    <div class="clearfix"></div>
</div>

<div id="ViewNoOfCardsTbl" style="display:none;"></div>

<div id="divSubmit" style="display:none;">
    <div class="col-md-12 col-12 px-0" id="divVehicleVerifiedManually">
        <div class="d-flex align-items-center justify-content-start mt-3 mb-3">
            <div class="pr-2 chk_sty">
                @Html.CheckBoxFor(m=>m.VehicleVerifiedManually)<span class="ml-2">Vehicle Numbers have been verified using VAHAN Portal</span>
            </div>
        </div>
    </div>
    <div class="col-md-12 col-12 px-0">
        <div class="d-flex align-items-center justify-content-center flex-wrap mb-0 mt-0">
            <div class="col-md-12 col-12 d-flex align-items-center justify-content-center">
                <div class="pr-2">
                    <button class="btn btn_primary" id="btnsubmit" type="Submit" onclick="return SubmitValidations()">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>
@Html.HiddenFor(model => Model.Message)
@Html.HiddenFor(model => Model.CardPreference)
@Html.HiddenFor(model => Model.ExternalVehicleAPIStatus)
@Html.HiddenFor(model => Model.FeePaymentsCollectFeeWaiver)

<script>

 $(document).ready(function () 
 {

    $('#lblReceivedAmount').hide();
    $('#ReceivedAmount').hide();
    setFromDateFormat();

    console.log('Before Message');

    var customerTypeId = $("#CustomerTypeId").val();

    console.log(customerTypeId);
    if (customerTypeId == "902" || customerTypeId == "917") 
    {
        $('#divVehicleVerifiedManually').hide();
    }
    else
    {
        $('#divVehicleVerifiedManually').show();
    }

    if($("#Message").val()=="")
    {

        $.ajax({
            type: 'POST',  // http method
            url: '@Url.Action("GetFormName", "ApplicationFormDataEntry")',
            data: { customerId: $("#CustomerId").val() },  // data to submit
            dataType: "json",
            success: function (res) {
                console.log(res);
                if (res.searchResult.data.length > 0) 
                {
                    
                    if (res.searchResult.data[0].paymentType != "")
                    {
                        document.getElementById("FeePaymentNo").value = res.searchResult.data[0].paymentType;
                        document.getElementById("FeePaymentDate").value = res.searchResult.data[0].paymentReceivedDate;
                        $("#FeePaymentNo").prop('readonly', true);
                        $("#FeePaymentDate").prop('readonly', true);

                        document.getElementById("rbtnCard").checked = true;
                        document.getElementById("rbtnCard").disabled = true;
                        document.getElementById("CardPreference").value = document.getElementById("rbtnCard").value;

                        document.getElementById("rbtnCardless").checked = false;
                        document.getElementById("rbtnCardless").disabled = true;

                        document.getElementById("rbtnOnline").checked = true;
                        document.getElementById("rbtnOnline").disabled = true;

                        document.getElementById("rbtnFeeWaiver").checked = false;
                        document.getElementById("rbtnFeeWaiver").disabled = true;

                        $('#lblChequeNo').text('');
                        $('#lblChequeNo').append("Payment Source<sup class='text-danger'>*</sup>");
                        $('#lblChequeDate').text('');
                        $('#lblChequeDate').append("Payment Date<sup class='text-danger'>*</sup>");
                        document.getElementById("ReceivedAmount").value = res.searchResult.data[0].receivedAmount;

                    }
                    else
                    {
                        $("#rbtnOnline").prop('disabled', true);
                        document.getElementById("rbtnOnline").checked = false;
                        document.getElementById("rbtnCard").checked = false;
                        $("#rbtnCard").prop('disabled', false);
                        $("#FeePaymentNo").prop('readonly', false);
                        //$("#FeePaymentDate").prop('readonly', false);
                        $('#lblChequeNo').text('');
                        $('#lblChequeNo').append("Approval Email From<sup class='text-danger'>*</sup>");
                        $('#lblChequeDate').text('');
                        $('#lblChequeDate').append("Approval Email Date<sup class='text-danger'>*</sup>");
                        document.getElementById("ReceivedAmount").value = "";
                    }

                }
                else
                {

                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(xhr);
            }
        });


     }

        if($("#Message").val()!="")
        {
           if($('input[name="CardPreference"]:checked').val()=="Card")
           {
                  document.getElementById("rbtnCard").checked = true;
                  document.getElementById("rbtnCardless").checked = false;

                  $('#lblChequeNo').show();
                  $('#lblChequeDate').show();
                  //$("#FeePaymentNo").val('');
                  //$("#FeePaymentDate").val('');
                  $('#FeePaymentNo').show();
                  $('#FeePaymentDate').show();
                  $('#ReceivedAmount').show();
                  $('#divFeePaymentDetails').show();
                  $('#lblReceivedAmount').show();

                  document.getElementById("rbtnFeeWaiver").checked = true;

                  if(document.getElementById("rbtnFeeWaiver").checked)
                  {
                      $('#lblReceivedAmount').hide();
                      $('#ReceivedAmount').hide();

                      $('#lblChequeNo').text('');
                      $('#lblChequeNo').append("Approval Email From<sup class='text-danger'>*</sup>");
                      $('#lblChequeDate').text('');
                      $('#lblChequeDate').append("Approval Email Date<sup class='text-danger'>*</sup>");
                  }
           }
           else
           {
                document.getElementById("rbtnCard").checked = false;
                document.getElementById("rbtnCardless").checked = true;
                $('#lblChequeNo').hide();
                $('#lblChequeDate').hide();
                $("#FeePaymentNo").val('');
                $("#FeePaymentDate").val('');
                $('#FeePaymentNo').hide();
                $('#FeePaymentDate').hide();
                $('#ReceivedAmount').hide();
                $('#divFeePaymentDetails').hide();
                $('#lblReceivedAmount').hide();
                document.getElementById("rbtnFeeWaiver").checked = false;
                document.getElementById("rbtnOnline").checked = false;
           }

           AddCardTbl();
        }
        
 });

function setFromDateFormat(){
        $(".fromDate").attr("readonly", true);
        $('.fromDate').datepicker({
            dateFormat: 'dd-mm-yy',
            changeMonth: true,
            changeYear: true,
            maxDate: new Date(today),
            autoclose: "true",
            yearRange: "-100:+0"
        });
        
         if (($('.fromDate').val() != undefined)  && ($('.fromDate').val() != "") ){
            var d = stringToDate($('.fromDate').val(),"dd-mm-yyyy");
            var ye = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(d)
            var mo = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(d)
            var da = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(d)
            $('.fromDate').val(`${da}-${mo}-${ye}`);
         }
    }

     function AddCardTbl() 
     {
       var ret=true;
       console.log('Inside AddCardTbl()');
        var cardsCount = $("#NoOfCards").val();

        if (cardsCount == "") 
        {
            $('#NoOfCardsErrMsg').text("No. of Cards cannot be left blank");
            $("#NoOfCardsErrMsg").attr("style", "display:block");
            ret=false;
        }
        else if (Number(cardsCount) <=0 || Number(cardsCount) >10)
        {
            $('#NoOfCardsErrMsg').text("No. of Cards may be 1 to 10");
            $("#NoOfCardsErrMsg").attr("style", "display:block");
            ret=false;
        }
        else
        {
            $('#NoOfCardsErrMsg').text("");
        }

        var customerTypeId = $("#CustomerTypeId").val();
        var noOfVehiclesAllCards = $("#NoofVechileforAllCards").val().trim();
        console.log(customerTypeId);
        if (customerTypeId == "905" || customerTypeId == "909") 
        {
            if (noOfVehiclesAllCards == "") 
            {
                $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be left blank");
                $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (Number(noOfVehiclesAllCards) <=0 || Number(noOfVehiclesAllCards) >10)
            {
                $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles May be 1 to 10");
                $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (Number(cardsCount) > Number(noOfVehiclesAllCards)) 
            {
                $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be less than No. of Cards");
                ret=false;
            }
            else
            {
                $("#NoofVechileforAllCardsErrMsg").text("");
            }
        }
        else 
        {
            $("#NoofVechileforAllCardsErrMsg").text("");
        }

        var formNumber = $("#FormNumber").val().trim();

        if(formNumber=="")
        {
           $('#formNameValErrMsg').text("Form Number cannot be left blank");
           $("#formNameValErrMsg").attr("style", "display:block");
           ret=false;
        }
        else if (formNumber.substring(0, 1) == "0") 
        {
            $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
            $("#formNameValErrMsg").attr("style", "display:block");
            ret=false;
        }
        else if (formNumber.length < 10) 
        {
            $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
            $("#formNameValErrMsg").attr("style", "display:block");
            ret=false;
        }
        else if (!(formNumber.match(number))) 
        {
            $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
            $("#formNameValErrMsg").attr("style", "display:block");
            ret=false;
        }
        else if (localStorage.getItem("FORMNOALREADYUSED") == 0) 
        {
            $('#formNameValErrMsg').text("Form Number already exists");
            $("#formNameValErrMsg").attr("style", "display:block");
            ret = false;
        }
        else
        {
            $('#formNameValErrMsg').text("");
        }

        if (!(document.querySelector('input[name="CardPreference"]:checked'))) 
        {
            document.getElementById("CardPreference_error").innerHTML="Please select Card Preference";
            ret = false;
        }

        if (document.getElementById("rbtnCard").checked) 
        {

            if (document.getElementById("rbtnFeeWaiver").checked) 
            {
                if (document.getElementById("FeePaymentNo").value.trim() == "") 
                {
                    $('#FeePaymentNoErrMsg').text("Approval Email From cannot be left blank");
                    $("#FeePaymentNoErrMsg").attr("style", "display:block");
                    ret=false;
                }
                else 
                {
                  $('#FeePaymentNoErrMsg').text("");
                }

                if (document.getElementById("FeePaymentDate").value.trim() == "") 
                {
                    $('#FeePaymentDateErrMsg').text("Approval Email Date cannot be left blank");
                    $("#FeePaymentDateErrMsg").attr("style", "display:block");
                    ret=false;
                }
                else 
                {
                    $('#FeePaymentDateErrMsg').text("");
                }
            }
        
            if (document.getElementById("rbtnOnline").checked) 
            {
                if (document.getElementById("FeePaymentNo").value.trim() == "") 
                {
                    $('#FeePaymentNoErrMsg').text("Payment Source cannot be left blank");
                    $("#FeePaymentNoErrMsg").attr("style", "display:block");
                    ret=false;
                }
                else 
                {
                     $('#FeePaymentNoErrMsg').text("");
                }

                if (document.getElementById("FeePaymentDate").value.trim() == "") 
                {
                    $('#FeePaymentDateErrMsg').text("Payment Date cannot be left blank");
                    $("#FeePaymentDateErrMsg").attr("style", "display:block");
                    ret=false;
                }
                else 
                {
                    $('#FeePaymentDateErrMsg').text("");
                }
            }
        }

        if (document.getElementById("RBEId").value != "") 
        {
            if(document.getElementById("RbeNameVal").value=="")
            {
              document.getElementById("RbeValErrMsg").innerHTML = "Invalid RBE ID";
              document.getElementById("RBEId").focus();
              ret = false;
            }
            else
            {
                document.getElementById("RbeValErrMsg").innerHTML = "";
            }
        }
        else 
        {
            document.getElementById("RbeValErrMsg").innerHTML = "";
        }

        if(ret==false)
        {
           return ret;
        }
        
        var vehicles = [];
        var checked="false";

        if ($(VehicleVerifiedManually).prop("checked"))
        {
            checked="true";
        }

        var FeePayments=$("#FeePaymentsCollectFeeWaiver").val();

        if(FeePayments===undefined)
        {
            FeePayments="0";
        }
        else if(FeePayments==undefined)
        {
            FeePayments="0";
        }
        else if(FeePayments=="undefined")
        {
            FeePayments="0";
        }

        console.log('Before FeePayments');
        console.log(FeePayments);
        if($("#dvRemarks").html().trim()!="")
        {
                $("#OldVehicleDetails TBODY TR").each(function () {
                    var row = $(this);
                    vehicles.push({
                        CustomerTypeId: customerTypeId,
                        Message: $("#Message").val(),
                        CardPreference: $('input[name="CardPreference"]:checked').val(),
                        FeePaymentDate: $("#FeePaymentDate").val(),
                        FeePaymentNo: $("#FeePaymentNo").val(),
                        FeePaymentsCollectFeeWaiver: FeePayments,
                        CardIdentifier: row.find("TD").eq(0).html(),
                        VechileNo: row.find("TD").eq(1).html(),
                        VehicleType: row.find("TD").eq(2).html(),
                        VehicleMake: row.find("TD").eq(3).html(),
                        YearOfRegistration: row.find("TD").eq(4).html(),
                        MobileNo: row.find("TD").eq(5).html(),
                        NoOfCards: cardsCount,
                        NoofVehicles: noOfVehiclesAllCards,
                        VehicleVerifiedManually: checked,
                        VehicleNoMsg: row.find("TD").eq(6).html(),
                        MobileNoMsg: row.find("TD").eq(7).html(),
                        Verified: row.find("TD").eq(8).html(),
                        CardIdentMsg: row.find("TD").eq(9).html()
                    })
                });
           }
           else
           {
                vehicles.push({
                            CustomerTypeId: customerTypeId,
                            Message: $("#Message").val(),
                            CardPreference: $('input[name="CardPreference"]:checked').val(),
                            FeePaymentDate: $("#FeePaymentDate").val(),
                            FeePaymentNo: $("#FeePaymentNo").val(),
                            FeePaymentsCollectFeeWaiver: FeePayments,
                            CardIdentifier: "",
                            VechileNo: "",
                            VehicleType: "",
                            VehicleMake: "",
                            YearOfRegistration: "",
                            MobileNo: "",
                            NoOfCards: cardsCount,
                            NoofVehicles: noOfVehiclesAllCards,
                            VehicleVerifiedManually: checked,
                            VehicleNoMsg: "",
                            MobileNoMsg: "",
                            Verified: "0",
                            CardIdentMsg: ""
                        });
           }
           console.log("2nd Partial Data");
           console.log(JSON.stringify(vehicles));


         $.ajax({
            type: 'POST',
            url: '@Url.Action("CustomerAddCardVehicleTbl", "ApplicationFormDataEntry")',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(vehicles),
            dataType: "html",
            success: function (data, status, xhr) {
                    var v = data;
                    if (status == 'success') 
                    {
                        document.getElementById("ViewNoOfCardsTbl").style.display = "block";
                        $("#ViewNoOfCardsTbl").html(data);
                        $('html, body').animate({
                            scrollTop: $("#ViewNoOfCardsTbl").offset().top
                        }, 2000);
                        document.getElementById("divSubmit").style.display = "block";

                        $('#NoOfCards').attr("readonly", true);
                        $('#NoofVechileforAllCards').attr("readonly", true);
                        $('#FeePaymentDate').attr("readonly", true);
                        $('#FeePaymentNo').attr("readonly", true);
                        $("#btnAdd").attr("disabled", true);
                        $(".radio-button").prop("disabled", true);
                        $(".radio-toolbar").prop("disabled", true);
                        $('#FormNumber').attr("readonly", true);

                        if(customerTypeId==902 || customerTypeId==917)
                        {
                         document.getElementById("NoOfCardsTbl").className="datatable table table-striped table-bordered w-50 d-md-table b-block text-nowrap display table-responsive";
                        }
                        else
                        {
                         document.getElementById("NoOfCardsTbl").className="datatable table table-striped table-bordered w-100 d-md-table b-block text-nowrap display table-responsive";
                        }
                    }
                },
            error: function (jqXhr, textStatus, errorMessage) 
            {
                $("#ViewNoOfCardsTbl").html("");
                $("#btnAdd").attr("disabled", false);
            }
        });
    }

    $('input[name="FeePaymentsCollectFeeWaiver"]:radio').change(function () 
    {
        var selected = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val()
        //alert(selected);
        if (selected == "1") 
        {
            $('#lblChequeNo').text('');
            $('#lblChequeNo').append("Payment Source<sup class='text-danger'>*</sup>");
            $('#lblChequeDate').text('');
            $('#lblChequeDate').append("Payment Date<sup class='text-danger'>*</sup>");
        }
        else if (selected == "2") 
        {
            $('#lblChequeNo').text('');
            $('#lblChequeNo').append("Approval Email From<sup class='text-danger'>*</sup>");
            $('#lblChequeDate').text('');
            $('#lblChequeDate').append("Approval Email Date<sup class='text-danger'>*</sup>");
        }

   });



$('input[name="CardPreference"]:radio').change(function () 
{
    document.getElementById("FeePaymentNoErrMsg").innerHTML = "";
    document.getElementById("FeePaymentDateErrMsg").innerHTML = "";

    var selected = $("input[name='CardPreference']:checked").val()
    //alert(selected);
    if (selected == "Cardless") 
    {
        $('#lblChequeNo').hide();
        $('#lblChequeDate').hide();
        $("#FeePaymentNo").val('');
        $("#FeePaymentDate").val('');
        $('#FeePaymentNo').hide();
        $('#FeePaymentDate').hide();
        $('#ReceivedAmount').hide();
        $('#divFeePaymentDetails').hide();
        $('#lblReceivedAmount').hide();
        document.getElementById("rbtnFeeWaiver").checked = false;
        document.getElementById("rbtnOnline").checked = false;
        document.getElementById("CardPreference_error").innerHTML="";
    }
    else if (selected == "Card") 
    {
        $('#lblChequeNo').show();
        $('#lblChequeDate').show();
        $("#FeePaymentNo").val('');
        $("#FeePaymentDate").val('');
        $('#FeePaymentNo').show();
        $('#FeePaymentDate').show();
        $('#ReceivedAmount').show();
        $('#divFeePaymentDetails').show();
        $('#lblReceivedAmount').show();

        document.getElementById("rbtnFeeWaiver").checked = true;
        //$("#rbtnCard").prop('disabled', false);
        //$("#FeePaymentNo").prop('disabled', false);
        //$("#FeePaymentDate").prop('disabled', false);
        //$('#lblChequeNo').text("Approval Email From");
        if(document.getElementById("rbtnFeeWaiver").checked)
        {
            $('#lblReceivedAmount').hide();
            $('#ReceivedAmount').hide();
        }
        document.getElementById("CardPreference_error").innerHTML="";
    }

    var count = $('#NoOfCardsTbl tr').length;

    //alert(count);

    if (count > 0) 
    {
        AddCardTbl();
    }

});

                
function RemoveSpecialChar(txtName) 
{
    if (txtName.value != '' && txtName.value.match(/^[\w ]+$/) == null) 
    {
        txtName.value = txtName.value.replace(/[\W]/g, '');
    }
}

 $("#FeePaymentNo").on("blur", function () 
    {
        var paymentNo = document.getElementById("FeePaymentNo").value.trim();
        if (paymentNo == "") 
        {
            if (document.getElementById("rbtnCard").checked) 
            {
                if (document.getElementById("rbtnFeeWaiver").checked) 
                {
                    document.getElementById("FeePaymentNoErrMsg").innerHTML = "Approval Email From cannot be left blank";
                    return false;
                }
            }
       
            if (document.getElementById("rbtnOnline").checked) 
            {
                document.getElementById("FeePaymentNoErrMsg").innerHTML = "Payment Source cannot be left blank";
                return false;
            }
        }
        else 
        {
            document.getElementById("FeePaymentNoErrMsg").innerHTML = "";
        }

   });

   $("#FeePaymentDate").on("change", function () 
    {
        var paymentDate = document.getElementById("FeePaymentDate").value.trim();
        if (paymentDate == "") 
        {
            if (document.getElementById("rbtnCard").checked) 
            {
                if (document.getElementById("rbtnFeeWaiver").checked) 
                {
                    document.getElementById("FeePaymentDateErrMsg").innerHTML = "Approval Email Date cannot be left blank";
                    return false;
                }
            }
       
            if (document.getElementById("rbtnOnline").checked) 
            {
                document.getElementById("FeePaymentDateErrMsg").innerHTML = "Payment Date cannot be left blank";
                return false;
            }
        }
        else 
        {
            document.getElementById("FeePaymentDateErrMsg").innerHTML = "";
        }

   });

   function ResetClick() 
   {
        $('#NoOfCards').attr("readonly", false);
        $('#NoofVechileforAllCards').attr("readonly", false);
        //$('#FeePaymentDate').attr("readonly", false);
        $('#FeePaymentNo').attr("readonly", false);

        $("#ViewNoOfCardsTbl").html("");
        document.getElementById("ViewNoOfCardsTbl").style.display = "none";
        document.getElementById("divSubmit").style.display = "none";
    }

    function SubmitValidations()
    {
        debugger;
        var ret=true;

        var i=0;
        var j=0;
        var cnt = 0;

        $("#VehicleVerifiedManually").rules("remove", "required");

        var table = document.getElementById("NoOfCardsTbl");

        if (document.getElementById("CustomerId").value.trim() == "") 
        {
            $('#CustomerIdValErrMsg').text("Please enter Customer ID");
            $("#CustomerIdValErrMsg").attr("style", "display:block");
            ret = false;
        }
        else if (!$("#CustomerId").val().match(mappedCustomerId)) 
        {
            $("#CustomerIdValErrMsg").attr("style", "display:block");
            $("#CustomerIdValErrMsg").html("Invalid Customer ID");
            ret = false;
        }
        else
        {
            $('#CustomerIdValErrMsg').text("");
        }
        console.log('After CustomerId');

        if (document.getElementById("CustomerName").value == "") 
        {
            document.getElementById("CustomerName_error").innerHTML = "Customer Name cannot be left blank";
            ret = false;
        }
        else 
        {
            document.getElementById("CustomerName_error").innerHTML = "";
        }

        var formNumberVal = document.getElementById("FormNumber").value.trim();
        if (formNumberVal == "") 
        {
             $("#formNameValErrMsg").html("Form Number cannot be left blank");
             $("#formNameValErrMsg").attr("style", "display:block");
             ret = false;
        }
        else if (formNumberVal.substring(0, 1) == "0") 
        {
            $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
            $("#formNameValErrMsg").attr("style", "display:block");
            ret = false;
        }
        else if (formNumberVal.length < 10) 
        {
            $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
            $("#formNameValErrMsg").attr("style", "display:block");
            ret = false;
        }
        else if (!(formNumberVal.match(number))) 
        {
            $("#formNameValErrMsg").html("Invalid Form Number. Min-Max 10 digits");
            $("#formNameValErrMsg").attr("style", "display:block");
            ret = false;
        }
        else 
        {
             $("#formNameValErrMsg").html("");
        }
        console.log('After FormNumber');

        if (document.getElementById("NoOfCards").value == "0" || document.getElementById("NoOfCards").value.trim() == "") 
        {
            document.getElementById("NoOfCardsErrMsg").innerHTML = "No. of Cards cannot be left blank";
            ret = false;
        }
        else 
        {
            document.getElementById("NoOfCardsErrMsg").innerHTML = "";
        }
        console.log('After NoOfCards');

        if (document.getElementById("RBEId").value != "") 
        {
            if(document.getElementById("RbeNameVal").value=="")
            {
              document.getElementById("RbeValErrMsg").innerHTML = "Invalid RBE ID";
              document.getElementById("RBEId").focus();
              ret = false;
            }
            else
            {
                document.getElementById("RbeValErrMsg").innerHTML = "";
            }
        }
        else 
        {
            document.getElementById("RbeValErrMsg").innerHTML = "";
        }
        console.log('After RBEId');

        var cardsCount = $("#NoOfCards").val();
        var customerTypeId = document.getElementById("CustomerTypeId").value;
        if (customerTypeId == "905" || customerTypeId == "909") 
        {
            var noOfVehiclesAllCards = $("#NoofVechileforAllCards").val().trim();

            if (noOfVehiclesAllCards == "") 
            {
                $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be left blank");
                $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (Number(noOfVehiclesAllCards) <=0 || Number(noOfVehiclesAllCards) >10)
            {
                $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles May be 1 to 10");
                $("#NoofVechileforAllCardsErrMsg").attr("style", "display:block");
                ret=false;
            }
            else if (Number(cardsCount) > Number(noOfVehiclesAllCards)) 
            {
                $("#NoofVechileforAllCardsErrMsg").text("No. of Vehicles cannot be less than No. of Cards");
                ret=false;
            }
            else
            {
                $("#NoofVechileforAllCardsErrMsg").text("");
            }
           
        }
        else 
        {
            $("#NoofVechileforAllCardsErrMsg").text("");
        }
        console.log('After NoofVechileforAllCards');

        if (document.getElementById("rbtnCard").checked) 
        {

            if (document.getElementById("rbtnFeeWaiver").checked) 
            {
                if (document.getElementById("FeePaymentNo").value.trim() == "") 
                {
                    document.getElementById("FeePaymentNoErrMsg").innerHTML = "Approval Email From cannot be left blank";
                    ret=false;
                }
                else 
                {
                  document.getElementById("FeePaymentNoErrMsg").innerHTML = "";
                }

                if (document.getElementById("FeePaymentDate").value.trim() == "") 
                {
                    document.getElementById("FeePaymentDateErrMsg").innerHTML = "Approval Email Date cannot be left blank";
                    ret=false;
                }
                else 
                {
                    document.getElementById("FeePaymentDateErrMsg").innerHTML = "";
                }
            }
        }

        if (document.getElementById("rbtnCard").checked) 
        {
            if (document.getElementById("rbtnOnline").checked) 
            {
                if (document.getElementById("FeePaymentNo").value.trim() == "") 
                {
                    document.getElementById("FeePaymentNoErrMsg").innerHTML = "Payment Source cannot be left blank";
                    ret=false;
                }
                else 
                {
                    document.getElementById("FeePaymentNoErrMsg").innerHTML = "";
                }

                if (document.getElementById("FeePaymentDate").value.trim() == "") 
                {
                    document.getElementById("FeePaymentDateErrMsg").innerHTML = "Payment Date cannot be left blank";
                    ret=false;
                }
                else 
                {
                    document.getElementById("FeePaymentDateErrMsg").innerHTML = "";
                }
            }
        }
        console.log('After rbtnCard');

        if (!(document.querySelector('input[name="CardPreference"]:checked'))) 
        {
            //alert("Please select Card Preference");
            document.getElementById("CardPreference_error").innerHTML="Please select Card Preference";
            ret=false;
        }

        if (document.getElementById("rbtnCard").checked) 
        {
            if (!(document.querySelector('input[name="FeePaymentsCollectFeeWaiver"]:checked'))) {
                alert("Fee Payment Details Not Selected");
                ret=false;
            }
        }

        var selectedCardType = $("input[name='CardPreference']:checked").val();
        if(selectedCardType!=undefined)
        {
         document.getElementById("CardPreference").value = selectedCardType;
         console.log(selectedCardType);
        }

        var selectedFeePayment = $("input[name='FeePaymentsCollectFeeWaiver']:checked").val();
        document.getElementById("FeePaymentsCollectFeeWaiver").value = selectedFeePayment;
        console.log(selectedFeePayment);

        var count = $('#NoOfCardsTbl tr').length;
        console.log('After count');
        //alert(count);

        if (count == 1) {
            alert("Vehicle Details Not Added");
            return false;
            ret=false;
        }

        var DuplicateFound = false;
        var DetailsNotFound = false;
        var InvalidYearFound = false;
        const d = new Date();
        let curYear = d.getFullYear();

        var selected = $("input[name='CardPreference']:checked").val();
        if (selected == "" || selected == undefined)
            selected = "Not Selected";

        if (customerTypeId == "901" || customerTypeId == "906") //Fleet And Credit
        {
                    
            i=0;
            cnt = 0;

            $("#NoOfCardsTbl tbody tr").each(function () 
            {
                var row = $(this);
                
                var vhno = row.find("td:eq(1) input[type='text']").val();
                var vehicleType =row.find('td').eq(3).find('select').val();
                var vehicleMake = row.find("td:eq(4) input[type='text']").val();
                var yearReg = row.find("td:eq(5) input[type='text']").val();

                if (selected.toUpperCase() == "CARDLESS")
                {
                    var mobile = row.find("td:eq(6) input[type='text']").val();
                }

                if(vhno!= undefined && vhno.trim()=='')
                {
                    document.getElementById('VechileNo_error_'+cnt).innerHTML="Enter Vehicle No.";
                    ret=false;
                }
                else
                {
                    document.getElementById('VechileNo_error_'+cnt).innerHTML="";
                }

                if(vhno!= undefined && vhno.trim()!='')
                {
                    if (!(vhno.match(forVehicleNo))) 
                    {
                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                        ret=false;
                    }
                    else if(vhno.length<6 || vhno.length>10)
                    {
                       document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                       ret=false;
                    }
                    else
                    {
                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="";
                    }
                }

                if (vehicleType == "--Select--") 
                {
                    document.getElementById('ddlVehicleType_error_'+cnt).innerHTML="Select Vehicle Type";
                    ret=false;
                }
                else
                {
                    document.getElementById('ddlVehicleType_error_'+cnt).innerHTML="";
                }

                if(vehicleMake.trim()=='')
                {
                    document.getElementById('VehicleMake_error_'+cnt).innerHTML="Enter Vehicle Make";
                    ret=false;
                }
                else if (!(vehicleMake.match(atLeastOneAlphabet))) 
                {
                    document.getElementById('VehicleMake_error_'+cnt).innerHTML="Invalid Vehicle Make";
                    ret=false;
                }
                else
                {
                    document.getElementById('VehicleMake_error_'+cnt).innerHTML="";
                }
                
                if(yearReg.trim()=='')
                {
                    document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Enter Year of Reg.";
                    ret=false;
                }
                else
                {
                    if (!yearReg.match(number)) 
                    {
                        document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                        ret=false;
                    }
                    else if (yearReg.length < 4) 
                    {
                      document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                      ret=false;
                    }
                    else if (yearReg < 1980 || yearReg > curYear) 
                    {
                      document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                      ret=false;
                    }
                    else
                    {
                      document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="";
                    }
                }
                              

                if (selected.toUpperCase() == "CARDLESS")
                {
                    var mobile = row.find("td:eq(6) input[type='text']").val();

                    if(mobile.trim()=='')
                    {
                        document.getElementById('MobileNo_error_'+cnt).innerHTML="Enter Mobile Number";
                        ret=false;
                    }
                    else
                    {
                        if (mobile.charAt(0) == "0") 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else if (mobile.length < 10) 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else if(!mobile.match(phoneno)) 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else
                        {
                           document.getElementById('MobileNo_error_'+cnt).innerHTML="";
                        }
                    }

                       

                }
                  
              
                cnt=cnt+1;

            });
                      

            j=0;i=0;
            cnt=0;
            console.log('Before Checking For Duplicate VehicleNo');
            $("#NoOfCardsTbl tbody tr").each(function () 
            {
                var row = $(this);
                j=0;
                i=i+1;
                cnt = 0;
                $("#NoOfCardsTbl tbody tr").each(function () 
                {
                    var row1 = $(this);

                    j=j+1;
                    if(i>0 && j>1 && j>i)
                    {
                        var PrevRVno = row.find("td:eq(1) input[type='text']").val();
                        var CurRVno =  row1.find("td:eq(1) input[type='text']").val();

                        if(PrevRVno!="" && CurRVno!="")
                        {
                            if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                            {
                                document.getElementById('VechileNo_error_'+cnt).innerHTML="Duplicate Vehicle No.";
                                ret=false;
                            }
                        }
                    }

                    cnt=cnt+1;
                });

            });
                                                         

            if (selected.toUpperCase() == "CARDLESS")
            {
                j=0;i=0;
                cnt=0;
                console.log('Before Checking For Duplicate MobileNo');
                $("#NoOfCardsTbl tbody tr").each(function () 
                {
                    var row = $(this);
                    j=0;
                    i=i+1;
                    cnt = 0;
                    $("#NoOfCardsTbl tbody tr").each(function () 
                    {
                        var row1 = $(this);

                        j=j+1;
                        if(i>0 && j>1 && j>i)
                        {
                            var PrevMbno = row.find("td:eq(6) input[type='text']").val();
                            var CurMbno =  row1.find("td:eq(6) input[type='text']").val();

                            if(PrevMbno!="" && CurMbno!="")
                            {
                                if(PrevMbno.trim()==CurMbno.trim())
                                {
                                    document.getElementById('MobileNo_error_'+cnt).innerHTML="Duplicate Mobile Number";
                                    ret=false;
                                }
                            }
                        }

                        cnt=cnt+1;
                    });
                });


                console.log('Before Checking Existing Vehicle No.');
                var table = document.getElementById("NoOfCardsTbl");
                cnt=-1;
                for (let row of table.rows)
                {
                    if(row.cells[8].innerHTML.trim()=="1")
                    {
                       document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. already exists";
                       ret=false;
                    }
                    cnt=cnt+1;
                }

                cnt = 0;
                var table = document.getElementById("NoOfCardsTbl");
                if (!$(VehicleVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No. Verified');
                    cnt=-1;
                    for (let row of table.rows) 
                    {
                        //console.log(row.cells);
                        //alert(row.cells[10].innerHTML);
                        var vno = $(row).find("td:eq(1) input[type='text']").val();
                        if(vno!= undefined && vno!="")
                        {
                            if(row.cells[9].innerHTML.trim()=="0")
                            {
                                if (!(vno.match(forVehicleNo))) 
                                {
                                    document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                    ret=false;
                                }
                                else if(vno.length<6 || vno.length>10)
                                {
                                  document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                  ret=false;
                                }
                                else
                                {
                                  document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. not verified";
                                  ret=false;
                                }
                            }
                        }
                        cnt=cnt+1;
                    }
                }

                console.log('Before Checking Existing Mobile No.');
                var table = document.getElementById("NoOfCardsTbl");
                cnt=-1;
                for (let row of table.rows)
                {
                    if(row.cells[10].innerHTML.trim()=="1")
                    {
                        document.getElementById('MobileNo_error_'+cnt).innerHTML="Mobile Number already exists";
                        ret=false;
                    }
   
                    cnt=cnt+1;
                }
 
            }
            else
            {
                console.log('Before Checking Existing Vehicle No.');
                var table = document.getElementById("NoOfCardsTbl");
                cnt=-1;
                for (let row of table.rows)
                {
                    if(row.cells[7].innerHTML.trim()=="1")
                    {
                       document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. already exists";
                       ret=false;
                    }
                    cnt=cnt+1;
                }

                cnt=-1;
                if (!$(VehicleVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No. Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[10].innerHTML);
                        var vno = $(row).find("td:eq(1) input[type='text']").val();
                        if(vno!= undefined && vno!="")
                        {
                            if(row.cells[8].innerHTML.trim()=="0")
                            {
                                if (!(vno.match(forVehicleNo))) 
                                {
                                    document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                    ret=false;
                                }
                                else if(vno.length<6 || vno.length>10)
                                {
                                  document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                  ret=false;
                                }
                                else
                                {
                                   document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. not verified";
                                   ret=false;
                                }
                            }
                        }
                        cnt=cnt+1;
                    }
                }
            }

        }
        else if (customerTypeId == "905" || customerTypeId == "909") //Attached,Generic
        {

            document.getElementById("Common_error").innerHTML = "";

           cnt=0;
           $("#NoOfCardsTbl tbody tr").each(function () 
            {
                var row = $(this);
                
                var cardIdentifier = row.find("td:eq(1) input[type='text']").val();
                var vhno = row.find("td:eq(2) input[type='text']").val();
                var vehicleType =row.find('td').eq(4).find('select').val();
                var vehicleMake = row.find("td:eq(5) input[type='text']").val();
                var yearReg = row.find("td:eq(6) input[type='text']").val();
                
                if(cardIdentifier.trim()=='')
                {
                    document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Enter Card Identifier";
                    ret=false;
                }
                else
                {
                    if(cardIdentifier.trim()!='')
                    {
                        if(cardIdentifier.length<2 || cardIdentifier.length>16)
                        {
                          document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                          ret=false;
                        }
                        else if(!cardIdentifier.match(forVehicleNo))
                        {
                          document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                          ret=false;
                        }
                        else
                        {
                            document.getElementById('CardIdentifier_error_'+cnt).innerHTML="";
                        }
                    }
                }   

                if(vhno!= undefined && vhno.trim()=='')
                {
                    document.getElementById('VechileNo_error_'+cnt).innerHTML="Enter Vehicle No.";
                    ret=false;
                }
                else
                {
                    document.getElementById('VechileNo_error_'+cnt).innerHTML="";
                }

                if(vhno!= undefined && vhno.trim()!='')
                {
                    if (!(vhno.match(forVehicleNo))) 
                    {
                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                        ret=false;
                    }
                    else if(vhno.length<6 || vhno.length>10)
                    {
                      document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                      ret=false;
                    }
                    else
                    {
                        document.getElementById('VechileNo_error_'+cnt).innerHTML ="";
                    }
                }

                if (vehicleType == "--Select--") 
                {
                    document.getElementById('ddlVehicleType_error_'+cnt).innerHTML="Select Vehicle Type";
                    ret=false;
                }
                else
                {
                    document.getElementById('ddlVehicleType_error_'+cnt).innerHTML="";
                }

                if(vehicleMake.trim()=='')
                {
                    document.getElementById('VehicleMake_error_'+cnt).innerHTML="Enter Vehicle Make";
                    ret=false;
                }
                else if (!(vehicleMake.match(atLeastOneAlphabet))) 
                {
                    document.getElementById('VehicleMake_error_'+cnt).innerHTML="Invalid Vehicle Make";
                    ret=false;
                }
                else
                {
                    document.getElementById('VehicleMake_error_'+cnt).innerHTML="";
                }
                
                if(yearReg.trim()=='')
                {
                    document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Enter Year of Reg.";
                    ret=false;
                }
                else
                {
                    if (!yearReg.match(number)) 
                    {
                        document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                        ret=false;
                    }
                    else if (yearReg.length < 4) 
                    {
                      document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                      ret=false;
                    }
                    else if (yearReg < 1980 || yearReg > curYear) 
                    {
                      document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="Invalid Year of Reg.";
                      ret=false;
                    }
                    else
                    {
                      document.getElementById('YearOfRegistration_error_'+cnt).innerHTML="";
                    }
                }
                              

                if (selected.toUpperCase() == "CARDLESS")
                {
                    var mobile = row.find("td:eq(7) input[type='text']").val();

                    if(mobile.trim()=='')
                    {
                        document.getElementById('MobileNo_error_'+cnt).innerHTML="Enter Mobile Number";
                        ret=false;
                    }
                    else
                    {
                        if (mobile.charAt(0) == "0") 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else if (mobile.length < 10) 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else if(!mobile.match(phoneno)) 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else
                        {
                           document.getElementById('MobileNo_error_'+cnt).innerHTML="";
                        }
                    }


                }
                  
              
                cnt=cnt+1;

            });


            //j=0;i=0;
            //cnt=0;
            //console.log('Before Checking For Duplicate Card Identifier');
            //$("#NoOfCardsTbl tbody tr").each(function () 
            //{
            //    var row = $(this);
            //    j=0;
            //    i=i+1;
            //    cnt = 0;
            //    $("#NoOfCardsTbl tbody tr").each(function () 
            //    {
            //        var row1 = $(this);

            //        j=j+1;
            //        if(i>0 && j>1 && j>i)
            //        {
            //            var PrevIdent = row.find("td:eq(1) input[type='text']").val();
            //            var CurIdent =  row1.find("td:eq(1) input[type='text']").val();

            //            if(PrevIdent!="" && CurIdent!="")
            //            {
            //                if(PrevIdent.trim().toUpperCase()==CurIdent.trim().toUpperCase())
            //                {

            //                    if(CurIdent.length<2 || CurIdent.length>16)
            //                    {
            //                      document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
            //                      ret=false;
            //                    }
            //                    else if(!CurIdent.match(forVehicleNo))
            //                    {
            //                      document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
            //                      ret=false;
            //                    }
            //                    else
            //                    {
            //                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Duplicate Card Identifier";
            //                        ret=false;
            //                    }
                                
            //                }
            //            }
            //        }

            //        cnt=cnt+1;
            //    });

            //});

           
            j=0;i=0;
            cnt=0;
            console.log('Before Checking For Duplicate VehicleNo');
            $("#NoOfCardsTbl tbody tr").each(function () 
            {
                var row = $(this);
                j=0;
                i=i+1;
                cnt = 0;
                $("#NoOfCardsTbl tbody tr").each(function () 
                {
                    var row1 = $(this);

                    j=j+1;
                    if(i>0 && j>1 && j>i)
                    {
                        var PrevRVno = row.find("td:eq(2) input[type='text']").val();
                        var CurRVno =  row1.find("td:eq(2) input[type='text']").val();

                        if(PrevRVno!="" && CurRVno!="")
                        {
                            if(PrevRVno.trim().toUpperCase()==CurRVno.trim().toUpperCase())
                            {
                                document.getElementById('VechileNo_error_'+cnt).innerHTML="Duplicate Vehicle No.";
                                ret=false;
                            }
                        }
                    }

                    cnt=cnt+1;
                });

            });
          

            if (selected.toUpperCase() == "CARDLESS")
            {
                j=0;i=0;
                cnt=0;
                //console.log('Before Checking For Duplicate MobileNo');
                //$("#NoOfCardsTbl tbody tr").each(function () 
                //{
                //    var row = $(this);
                //    j=0;
                //    i=i+1;
                //    cnt = 0;
                //    $("#NoOfCardsTbl tbody tr").each(function () 
                //    {
                //        var row1 = $(this);

                //        j=j+1;
                //        if(i>0 && j>1 && j>i)
                //        {
                //            var PrevMbno = row.find("td:eq(7) input[type='text']").val();
                //            var CurMbno =  row1.find("td:eq(7) input[type='text']").val();

                //            if(PrevMbno!="" && CurMbno!="")
                //            {
                //                if(PrevMbno.trim()==CurMbno.trim())
                //                {
                //                    document.getElementById('MobileNo_error_'+cnt).innerHTML="Duplicate Mobile Number";
                //                    ret=false;
                //                }
                //            }
                //        }

                //        cnt=cnt+1;
                //    });
                //});


                cnt=-1;
                console.log('Before Checking Existing Vehicle No.');
                var table = document.getElementById("NoOfCardsTbl");

                for (let row of table.rows)
                {
                    //alert(row.cells[9].innerHTML);
                    if(row.cells[9].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(2) input[type='text']").val();

                        if(Vhno!= undefined && Vhno!="")
                        {
                          document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. already exists";
                          ret=false;
                        }

                    }
                    cnt=cnt+1;
                }

               cnt=-1;
                if (!$(VehicleVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No. Verified');
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[10].innerHTML);
                         console.log(row.cells[10].innerHTML);
                        if(row.cells[10].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(2) input[type='text']").val();
  
                            if(Vhno!= undefined && Vhno!="")
                            {
                                if (!(Vhno.match(forVehicleNo))) 
                                {
                                    document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                    ret=false;
                                }
                                else if(Vhno.length<6 || Vhno.length>10)
                                {
                                  document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                  ret=false;
                                }
                                else
                                {
                                    document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. not verified";
                                    ret=false;
                                }
                            }
                        }
                        cnt=cnt+1;
                    }
                }


                console.log('Before Checking Existing Mobile No.');
                var table = document.getElementById("NoOfCardsTbl");
                cnt=-1;
                for (let row of table.rows)
                {
                    if(row.cells[11].innerHTML.trim()=="1")
                    {
                        document.getElementById('MobileNo_error_'+cnt).innerHTML="Mobile Number already exists";
                        ret=false;
                    }
   
                    cnt=cnt+1;
                }

            }
            else
            {
                console.log('Before Checking Existing Vehicle No.');
                var table = document.getElementById("NoOfCardsTbl");
                cnt=-1;
                for (let row of table.rows)
                {
                    //alert(row.cells[8].innerHTML);
                    if(row.cells[8].innerHTML.trim()=="1")
                    {
                        var Vhno = $(row).find("td:eq(2) input[type='text']").val();

                        if(Vhno!= undefined && Vhno!="")
                        {
                          document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. already exists";
                          ret=false;
                        }
                    }
                    cnt=cnt+1;
                }

                var table = document.getElementById("NoOfCardsTbl");
                if (!$(VehicleVerifiedManually).prop("checked"))
                {
                    console.log('Before Checking Vehicle No. Verified');
                    cnt=-1;
                    for (let row of table.rows) 
                    {
                        //alert(row.cells[9].innerHTML);
                        if(row.cells[9].innerHTML.trim()=="0")
                        {
                            var Vhno = $(row).find("td:eq(2) input[type='text']").val();

                            if(Vhno!= undefined && Vhno!="")
                            {
                                if (!(Vhno.match(forVehicleNo))) 
                                {
                                    document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                    ret=false;
                                }
                                else if(Vhno.length<6 || Vhno.length>10)
                                {
                                  document.getElementById('VechileNo_error_'+cnt).innerHTML ="Invalid Vehicle No.";
                                  ret=false;
                                }
                                else
                                {
                                    document.getElementById('VechileNo_error_'+cnt).innerHTML="Vehicle No. not verified";
                                    ret=false;
                                }
                            }
                        }

                        cnt=cnt+1;

                    }
                }

            }


            console.log('Before Checking Existing Card Identifier');
            var table = document.getElementById("NoOfCardsTbl");
            cnt=-1;
            for (let row of table.rows)
            {
                if (selected.toUpperCase() == "CARDLESS")
                {
                    if(row.cells[8].innerHTML.trim()=="1")
                    {
                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Card Identifier already exists";
                        ret=false;
                    }
                }
                else
                {
                    if(row.cells[7].innerHTML.trim()=="1")
                    {
                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Card Identifier already exists";
                        ret=false;
                    }
                }
                cnt=cnt+1;
            }

        }
        else if (customerTypeId == "902" || customerTypeId == "917") //Corporate,Non Fleet
        {

            document.getElementById("Common_error").innerHTML = "";

            cnt=0;
            $("#NoOfCardsTbl tbody tr").each(function () 
            {
                var row = $(this);
                
                var cardIdentifier = row.find("td:eq(1) input[type='text']").val();

                if(cardIdentifier.trim()=='')
                {
                    document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Enter Card Identifier";
                    ret=false;
                }
                else
                {
                    if(cardIdentifier.trim()!='')
                    {
                        if(cardIdentifier.length<2 || cardIdentifier.length>16)
                        {
                          document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                          ret=false;
                        }
                        else if(!cardIdentifier.match(forVehicleNo))
                        {
                          document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                          ret=false;
                        }
                        else
                        {
                            document.getElementById('CardIdentifier_error_'+cnt).innerHTML="";
                        }
                    }
                }               
                                                             

                if (selected.toUpperCase() == "CARDLESS")
                {
                    var mobile = row.find("td:eq(2) input[type='text']").val();

                    if(mobile.trim()=='')
                    {
                        document.getElementById('MobileNo_error_'+cnt).innerHTML="Enter Mobile Number";
                        ret=false;
                    }
                    else
                    {
                        if (mobile.charAt(0) == "0") 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else if (mobile.length < 10) 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else if(!mobile.match(phoneno)) 
                        {
                            document.getElementById('MobileNo_error_'+cnt).innerHTML="Invalid Mobile Number";
                            ret=false;
                        }
                        else
                        {
                           document.getElementById('MobileNo_error_'+cnt).innerHTML="";
                        }
                    }
                      
                }
                  
              
                cnt=cnt+1;

            });


            j=0;i=0;
            cnt=0;
            console.log('Before Checking For Duplicate Card Identifier');
            $("#NoOfCardsTbl tbody tr").each(function () 
            {
                var row = $(this);
                j=0;
                i=i+1;
                cnt = 0;
                $("#NoOfCardsTbl tbody tr").each(function () 
                {
                    var row1 = $(this);

                    j=j+1;
                    if(i>0 && j>1 && j>i)
                    {
                        var PrevIdent = row.find("td:eq(1) input[type='text']").val();
                        var CurIdent =  row1.find("td:eq(1) input[type='text']").val();

                        if(PrevIdent!="" && CurIdent!="")
                        {
                            if(PrevIdent.trim().toUpperCase()==CurIdent.trim().toUpperCase())
                            {
                                if(CurIdent.length<2 || CurIdent.length>16)
                                {
                                  document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                                  ret=false;
                                }
                                else if(!CurIdent.match(forVehicleNo))
                                {
                                  document.getElementById('CardIdentifier_error_'+cnt).innerHTML ="Invalid Card Identifier";
                                  ret=false;
                                }
                                else
                                {
                                    document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Duplicate Card Identifier";
                                    ret=false;
                                }
                            }
                        }
                    }

                    cnt=cnt+1;
                });

            });
                        

            if (selected.toUpperCase() == "CARDLESS")
            {
 
                j=0;i=0;
                cnt=0;
                console.log('Before Checking For Duplicate MobileNo');
                $("#NoOfCardsTbl tbody tr").each(function () 
                {
                    var row = $(this);
                    j=0;
                    i=i+1;
                    cnt = 0;
                    $("#NoOfCardsTbl tbody tr").each(function () 
                    {
                        var row1 = $(this);

                        j=j+1;
                        if(i>0 && j>1 && j>i)
                        {
                            var PrevMobile = row.find("td:eq(2) input[type='text']").val();
                            var CurMobile =  row1.find("td:eq(2) input[type='text']").val();

                            if(PrevMobile!="" && CurMobile!="")
                            {
                                if(PrevMobile.trim().toUpperCase()==CurMobile.trim().toUpperCase())
                                {
                                    document.getElementById('MobileNo_error_'+cnt).innerHTML="Duplicate Mobile Number";
                                    ret=false;
                                }
                            }
                        }

                        cnt=cnt+1;
                    });

                });


                console.log('Before Checking Existing Mobile No.');
                var table = document.getElementById("NoOfCardsTbl");
                cnt=-1;
                for (let row of table.rows)
                {
                    if(row.cells[4].innerHTML.trim()=="1")
                    {
                        document.getElementById('MobileNo_error_'+cnt).innerHTML="Mobile Number already exists";
                        ret=false;
                    }
   
                    cnt=cnt+1;
                }

            }

            console.log('Before Checking Existing Card Identifier');
            var table = document.getElementById("NoOfCardsTbl");
            cnt=-1;
            for (let row of table.rows)
            {
                if (selected.toUpperCase() == "CARDLESS")
                {
                    if(row.cells[3].innerHTML.trim()=="1")
                    {
                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Card Identifier already exists";
                        ret=false;
                    }
                }
                else
                {
                    if(row.cells[2].innerHTML.trim()=="1")
                    {
                        document.getElementById('CardIdentifier_error_'+cnt).innerHTML="Card Identifier already exists";
                        ret=false;
                    }
                }
                cnt=cnt+1;
            }

        }

        console.log(ret);
        return ret;
    }

    $('#VehicleVerifiedManually').click(function()
    {
          var customerTypeId = document.getElementById("CustomerTypeId").value;
          console.log(customerTypeId);
          if ($(this).prop("checked"))
          {
            var cnt = 0;

            $("#NoOfCardsTbl tbody tr").each(function () 
            {
                //var row = $(this);
                document.getElementById('VechileNo_error_'+cnt).innerHTML ="";
                $("#VechileNo_Vefirybtn_" + cnt).prop("disabled", true);
                cnt=cnt+1;
             });
          }
          else
          {
                var cnt = 0;
                var vehicleNo = "";
                var isValid=true;

               $("#NoOfCardsTbl tbody tr").each(function ()
               {
                    isValid=true;
                    vehicleNo = "";
                    vehicleNo=document.getElementById('VechileNo_'+cnt).value;
                    if(vehicleNo.trim()=='')
                    {
                        isValid=false;
                    }
                    else
                    {
                        if(vehicleNo.trim()!='')
                        {
                            if (!(vehicleNo.match(forVehicleNo))) 
                            {
                                isValid=false;
                            }
                            else if(vehicleNo.length<6 || vehicleNo.length>10)
                            {
                                isValid=false;
                            }
                        }
                    } 

                    if(isValid)
                    {
                       $("#VechileNo_Vefirybtn_" + cnt).prop("disabled", false);
                    }
                    else
                    {
                       $("#VechileNo_Vefirybtn_" + cnt).prop("disabled", true);
                    }

                    cnt=cnt+1;

              });

          }

    });

</script>