@model HPCL.Common.Models.ViewModel.ValidateNewCards.ValidateNewCardsModel
@{
    ViewData["Title"] = "Details";
    PagerModel pager = new PagerModel();
    int pageNo = 0;

    if (ViewBag.pager != null)
    {
        pager = ViewBag.Pager;
        pageNo = pager.CurrentPage;
    }
}

<div class="bg-white p-2 p-md-4 w-100">
    <ul class="breadcrumb bread_custom bg-transparent m-0 pb-1 py-0 px-0">
        <li class="breadcrumb-item"><a href="@Url.Action("Index", "Enrollments")" class="text_primary">Enrollments</a> </li>
        <li class="breadcrumb-item font-weight-light">Validate Cards</li>
    </ul>
    <div id="reason" class="mb-3 text-center displayNone" style="background-color: #a0f1d6;"></div>
    @using (Html.BeginForm(null, null, FormMethod.Get, new { id = "form1", @class = "toBeHiddenOnSuccess" }))
    {
        <h5>Validate New Cards</h5>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="basicInfo" role="tabpanel" aria-labelledby="basicInfo-tab">
                <div class="w-100">
                    <div class="border-1 rounded border-grey mb-3">
                        <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Search Officer</p>
                        <div class="col-lg-12 col-md-12 col-12 pl-0 pr-md-2 pr-0 pt-3">
                            <div class="d-flex align-items-center justify-content-start flex-wrap">
                                <div class="col-lg-6 col-12">
                                    <div class="d-flex align-items-center justify-content-start flex-wrap mb-0">
                                        <label class="font-weight-normal col-md-5 col-12 mb-3">Form Number<sup class="text-danger">*</sup></label>
                                        <div class="col-md-7 col-12 mb-3">
                                            <div class="custom_select">
                                                @Html.TextBoxFor(m => m.FormNumber, new { @class = "form-control" })
                                            </div>
                                            <span class="error" style="font-size: 14px; color: #dc3545 !important " id="categoryID"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-12">
                                    <div class="d-flex align-items-center justify-content-start flex-wrap mb-0">
                                        <label class="font-weight-normal col-md-5 col-12 mb-3">Date</label>
                                        <div class="col-md-7 col-12 mb-3">
                                            <div class="custom_select">
                                                @Html.TextBoxFor(m => m.Date, new { @class = "form-control" })
                                            </div>
                                            <span class="error" style="font-size: 14px; color: #dc3545 !important " id="fromDate"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center justify-content-start flex-wrap">
                                <div class="col-lg-6 col-12">
                                    <div class="d-flex align-items-center justify-content-start flex-wrap mb-0">
                                        <label class="font-weight-normal col-md-5 col-12 mb-3">Created By</label>
                                        <div class="col-md-7 col-12 mb-3">
                                            <div class="custom_select">
                                                @Html.DropDownListFor(m => m.CreatedBy, new SelectList(Model.OfficerTypeMdl, "OfficerTypeID", "OfficerTypeName"), new { @class = "form-control" })
                                            </div>
                                            <span class="error" style="font-size: 14px; color: #dc3545 !important " id="toDate"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex align-items-center justify-content-center flex-wrap mt-3 px-4 w-100 mb-3">
                            <div class="px-2 mb-3 col-sm-auto col-12 mb-sm-0 mb-2">
                                <button class="btn btn_primary py-2 px-4" type="submit">Search</button>
                            </div>
                            <div class="px-2 mb-3 col-sm-auto col-12 mb-sm-0 mb-2">
                                <button class="btn btn_primary py-2 px-4" type="button" onclick="clearDetails()">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    }
    <div id="show_Table" class="toBeHiddenOnSuccess">
        @if (Model.NewCardsLists.Count() > 0)
        {
            <table class="table table-striped table-bordered table-responsive datatable" id="merchantApprovalDetails">
                <thead style="background-color:lightgray;">
                    <tr>
                        <th style="width:5%;">S.No.</th>
                        <th style="width:10%;">Customer Ref. No.</th>
                        <th style="width:10%;">Form No.</th>
                        <th style="width:20%;">Customer Name</th>
                        <th style="width:10%;">RBE/RSM Name</th>
                        <th>Mobile No.</th>
                        <th style="width:10%;">Action</th>
                    </tr>
                </thead>
                <tbody id="searchMerchantTableBody">
                    @{
                        int y = 0;
                    }
                    @foreach (var item in Model.NewCardsLists)
                    {
                        y = y + 1;
                        <tr>
                            <td>@y</td>
                            <td>@item.CustomerReferenceNo</td>
                            <td>@item.FormNumber</td>
                            <td>@item.CustomerName</td>
                            <td>@item.CreatedRoleName</td>
                            <td style="width:10%;">@item.MobileNo</td>
                            <td><a href="#" onclick="statusAction(@item.CustomerReferenceNo)">@item.StatusName</a></td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="container">
                @if (pager.TotalPages > 0)
                {
                    <ul class="pagination justify-content-end">
                        @for (var pge = pager.StartPage; pge <= pager.EndPage; pge++)
                        {
                            <li class="page-item @(pge == pager.CurrentPage ? " active" : "" )">
                                <a class="page-link" asp-controller="Merchant" asp-action="VerifyMerchant" asp-route-pg="@pge">@pge</a>
                            </li>
                        }
                    </ul>
                }
            </div>
        }
        else
        {
            <div class="col-12 text-center alert-danger p-2">
                No Records found!
            </div>
        }
    </div>
</div>
<div class="" id="vehicleDetails">
</div>
<script type="text/javascript">
    $(document).ready(function () {
        $("#Date").datepicker({
            "setDate": new Date(),
            "autoclose": true,
            dateFormat: 'dd-mm-yy'
        });
    });

    function clearDetails() {
        document.getElementById("vehicleDetails").innerHTML = "";
        $("#FormNumber").val("");
        $("#CreatedBy").val(0);
        $("#Date").val("");

    };

    function statusAction(CustomerRefNum) {
        var id = CustomerRefNum;

        $.ajax({
            type: 'GET',  // http method
            url: '@Url.Action("GetCardDetailsForApproval", "ValidateNewCards")',
            contentType: "application/json; charset=utf-8",
            data: { CustomerRefNo: id },  // data to submit
            dataType: "text",
            success: function (data, status, xhr) {
                var v = data;
                if (status == 'success') {
                    $("#vehicleDetails").html(data);
                    $('html, body').animate({
                        scrollTop: $("#vehicleDetails").offset().top
                    }, 2000);
                }
                else {
                    console.log(v);
                }
            },
            error: function (jqXhr, textStatus, errorMessage) {
                alert("Error Populating Sales Area Data");
            }
        });
    };

</script>
