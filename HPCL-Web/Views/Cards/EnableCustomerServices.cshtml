@model HPCL.Common.Models.ViewModel.Cards.EnableCustomerServicesModel
@using HPCL.Common.Resources;
@{
    ViewData["Title"] = "Enable / Disable Products and Transactions";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="col-lg-12 p-4 p-md-4">
    <div class="bg-white p-2 p-md-4">
        <ul class="breadcrumb bread_custom bg-transparent m-0 pb-1 py-0 px-0">
            <li class="breadcrumb-item"><a href="#" class="text_primary">Cards</a> </li>
            <li class="breadcrumb-item font-weight-light">Enable / Disable Products and Transactions</li>
        </ul>
        <form>
            <div class="w-100">
                <div class="col-lg-12 col-md-12 col-12 pl-0 pr-0">
                    <div class="border-1 rounded border-grey pb-3">
                        <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Enable / Disable Products and Transactions</p>
                        <div class="col-lg-12 col-md-12 col-12 py-3">
                            <div class="d-flex align-items-center flex-wrap">
                                <div class="col-lg-6 col-12">
                                    <div class="d-flex align-items-center flex-wrap mb-3">
                                        <label class="font-weight-normal col-md-4 col-12">Customer ID <sup class="text-danger">*</sup></label>
                                        <div class="col-md-7 col-12">
                                            <div class="custom_select">
                                                @Html.TextBoxFor(m => m.CustomerId, new { @class = "form-control", maxlength = "10", onkeypress = "return isNumberKey(event)" })
                                                @Html.ValidationMessageFor(m => m.CustomerId, "", new { @class = "error", @id = "CustomerIdValErrMsg" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-12">
                                    <div class="d-flex align-items-center flex-wrap mb-3">
                                        <label class="font-weight-normal offset-md-1 col-md-4 col-12">Card Number </label>
                                        <div class="col-md-7 col-12">
                                            <div class="custom_select">
                                                @Html.TextBoxFor(m => m.CardNo, new { @class = "form-control restrictPaste", maxlength = "16", onkeypress = "return isNumberKey(event)" })
                                                @Html.ValidationMessageFor(m => m.CardNo, "", new { @class = "error", @id = "CardNoErrMsg" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center flex-wrap">
                                <div class="col-lg-6 col-12">
                                    <div class="d-flex align-items-center flex-wrap mb-3">
                                        <label class="font-weight-normal col-md-4 col-12">Mobile Number</label>
                                        <div class="col-md-7 col-12">
                                            <div class="custom_select">
                                                @Html.TextBoxFor(m => m.MobileNo, new { @class = "form-control", maxlength = "10", onkeypress = "return isNumberKey(event)" })
                                                @Html.ValidationMessageFor(m => m.MobileNo, "", new { @class = "error", @id = "MobileNoErrMsg" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div class="d-flex align-items-center justify-content-center mt-0">
                            <div class="px-2">
                                <button class="btn btn_primary" type="button" id="btnSearch">@Label.Search</button>
                            </div>
                            <div class="px-2">
                                <button class="btn btn_primary" type="button" id="btnReset">@Label.Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-12 pl-0 pr-2 mt-3">
                    <div class="border-1 rounded border-grey pb-3">
                        <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Available Product</p>
                        <div class="col-lg-12 col-md-12 col-12 py-3" style="min-height:398px">
                            <div class="d-flex align-items-center flex-wrap">
                                <div class="col-md-12 col-12 px-0" id="AvailableProductTbl">
                                    <table class="table d-md-table d-block" style="width:100%;" id="AvailablePTbl">
                                    </table>
                                </div>
                            </div>

                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-12 pl-2 pr-0 mt-3">
                    <div class="border-1 rounded border-grey pb-3">
                        <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Allowed Product</p>
                        <div class="col-lg-12 col-md-12 col-12 py-3" style="min-height:398px">
                            <div class="d-flex align-items-center flex-wrap">
                                <div class="col-md-12 col-12 px-0" id="AllowedProductTbl">
                                    <table class="table d-md-table d-block" style="width:100%;" id="AllowedPTbl">
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-12 pl-0 pr-2 mt-3">
                    <div class="border-1 rounded border-grey pb-3">
                        <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Available Transaction Type</p>
                        <div class="col-lg-12 col-md-12 col-12 py-3" style="min-height:398px">
                            <div class="d-flex align-items-center flex-wrap">
                                <div class="col-md-12 col-12 px-0" id="AvailableTransactionsTypeTbl">
                                    <table class="table d-md-table d-block" style="width:100%;" id="AvailableTTbl">
                                        
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-12 pl-2 pr-0 mt-3">
                    <div class="border-1 rounded border-grey pb-3">
                        <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Allowed Transaction Type</p>
                        <div class="col-lg-12 col-md-12 col-12 py-3" style="min-height:398px">
                            <div class="d-flex align-items-center flex-wrap">
                                <div class="col-md-12 col-12 px-0" id="AllowedTransactionsTypeTbl">
                                    <table class="table d-md-table d-block" style="width:100%;" id="AllowedTTbl">

                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </form>
        <div class="clearfix"></div>
    </div>
</div>
<div class="clearfix"></div>
<script>

$("#CustomerId").on("blur", function ()
{
    if ($("#CustomerId").val().trim() == "")
    {
        $('#CustomerIdValErrMsg').html("Please enter Customer ID");
        return false;
    }
    else if (!$("#CustomerId").val().match(mappedCustomerId))
    {
        $("#CustomerIdValErrMsg").attr("style", "display:block");
        $("#CustomerIdValErrMsg").html("Invalid Customer ID");
        return false;
    }
    else
    {
        $('#CustomerIdValErrMsg').html("");
    }

})

$("#MobileNo").on("blur", function () 
{
    //debugger;
    var communicationMobile = document.getElementById("MobileNo").value.trim();
    if (communicationMobile != "") 
    {
        if (communicationMobile.substring(0, 1) == "0") 
        {
            document.getElementById("MobileNoErrMsg").innerHTML = "Invalid Mobile Number. Min-Max 10 digits";
            return false;
        }
        else if (communicationMobile.length < 10) 
        {
            document.getElementById("MobileNoErrMsg").innerHTML = "Invalid Mobile Number. Min-Max 10 digits";
            return false;
        }
        else if (!communicationMobile.match(phoneno)) 
        {
            document.getElementById("MobileNoErrMsg").innerHTML = "Invalid Mobile Number. Min-Max 10 digits";
            return false;
        }
        else 
        {
            document.getElementById("MobileNoErrMsg").innerHTML = "";
        }
    }

});

$("#CardNo").on("blur", function () 
{
    //debugger;
    var cardNo = document.getElementById("CardNo").value.trim();
    if (cardNo != "") 
    {
        if (cardNo.substring(0, 1) == "0") 
        {
            document.getElementById("CardNoErrMsg").innerHTML = "Invalid Card Number";
            return false;
        }
        else if (cardNo.length < 16) 
        {
            document.getElementById("CardNoErrMsg").innerHTML = "Invalid Card Number";
            return false;
        }
        else if (!cardNo.match(cardNoCheck)) 
        {
            document.getElementById("CardNoErrMsg").innerHTML = "Invalid Card Number";
            return false;
        }
        else 
        {
            document.getElementById("CardNoErrMsg").innerHTML = "";
        }
    }

});
$('#CustomerId').keypress(function (e) {
    if (e.keyCode == 13) {  // detect the enter key
        e.preventDefault();
        $('#btnSearch').click();
    }
});

$("#btnSearch").on("click", (function (e)
{
    debugger;
    var flag="Y";
    if ($("#CustomerId").val().trim() == "")
    {
        $('#CustomerIdValErrMsg').html("Please enter Customer ID");
        $("#CustomerIdValErrMsg").attr("style", "display:block");
        flag="N";
    }
    else if (!$("#CustomerId").val().match(mappedCustomerId))
    {
        $("#CustomerIdValErrMsg").attr("style", "display:block");
        $("#CustomerIdValErrMsg").html("Invalid Customer ID");
        flag="N";
    }
    else
    {
        $('#CustomerIdValErrMsg').html("");
    }

    var cardNo = document.getElementById("CardNo").value.trim();
    if (cardNo != "") 
    {
        if (cardNo.substring(0, 1) == "0") 
        {
            document.getElementById("CardNoErrMsg").innerHTML = "Invalid Card Number";
            $("#CardNoErrMsg").attr("style", "display:block");
            flag="N";
        }
        else if (cardNo.length < 16) 
        {
            document.getElementById("CardNoErrMsg").innerHTML = "Invalid Card Number";
            $("#CardNoErrMsg").attr("style", "display:block");
            flag="N";
        }
        else if (!cardNo.match(cardNoCheck)) 
        {
            document.getElementById("CardNoErrMsg").innerHTML = "Invalid Card Number";
            $("#CardNoErrMsg").attr("style", "display:block");
            flag="N";
        }
        else 
        {
            document.getElementById("CardNoErrMsg").innerHTML = "";
        }
    }

    var comMobile = document.getElementById("MobileNo").value.trim();
    if (comMobile != "") 
    {
        if (comMobile.substring(0, 1) == "0") 
        {
            document.getElementById("MobileNoErrMsg").innerHTML = "Invalid Mobile Number. Min-Max 10 digits";
            $("#MobileNoErrMsg").attr("style", "display:block");
            flag="N";
        }
        else if (comMobile.length < 10) 
        {
            document.getElementById("MobileNoErrMsg").innerHTML = "Invalid Mobile Number. Min-Max 10 digits";
            $("#MobileNoErrMsg").attr("style", "display:block");
            flag="N";
        }
        else if (!comMobile.match(phoneno)) 
        {
            document.getElementById("MobileNoErrMsg").innerHTML = "Invalid Mobile Number. Min-Max 10 digits";
            $("#MobileNoErrMsg").attr("style", "display:block");
            flag="N";
        }
        else 
        {
            document.getElementById("MobileNoErrMsg").innerHTML = "";
        }
    }

    if(flag=="Y")
    {
          $.ajax({
            url: "@Url.Action("GetDetailForEnableDisableProductsAndTransactions","Cards")",
            type: "POST",
            dataType: "JSON",
            data: { CustomerId: $("#CustomerId").val(), CardNo: cardNo, MobileNo:comMobile },
            success: function (resp) 
            {
                debugger;
                console.log(resp,"res");
                if (resp.searchList.success == true) 
                {
                   
                        $("#AvailableProductTbl td").parent().remove();
                        //$('#AvailableProductTbl table').DataTable().clear().destroy();

                        $("#AllowedProductTbl td").parent().remove();
                        $("#AvailableTransactionsTypeTbl td").parent().remove();
                        $("#AllowedTransactionsTypeTbl td").parent().remove();

                        var j=0;
                        var k=0;
                        var availableRows = "<tbody>"
                        var allowedRows = "<tbody>"
                        var availableTranRows = "<tbody>"
                        var allowedTranRows = "<tbody>"

                        for (var i = 0; i < resp.searchList.data.getProductsType.length; i++) 
                        {
                            debugger;
                            if(resp.searchList.data.getProductsType[i].statusFlag==0)
                            {
                                j=j+1;
                                
                                availableRows += "<tr>"
                                  + "<td style='width: 7%;'>"+ (j) +"</td>"
                                  //+ "<td width='400px' class='nav-item'><a class='customerId' data-toggle='tab' href='#BasicInfo' onclick='ViewBasicInfo(this)' role='tab'><span class='rowCardNo'>" + res[i].customerID + "</span></a></td>"
                                  + "<td style='width: 77%;'>" + resp.searchList.data.getProductsType[i].productName + "</td>"
                                  + "<td style='display:none'>" + resp.searchList.data.getProductsType[i].productID + "</td>"
                                  + "<td style='width: 16%;'><button class='btn btn_primary' type='button'>Add</button></td>"
                                  + "</tr >";
           
                            }
                            debugger;
                            if(resp.searchList.data.getProductsType[i].statusFlag==1)
                            {
                                k=k+1;
                                
                                 allowedRows += "<tr>"
                                  + "<td style='width: 7%;'>"+ (k) +"</td>"
                                  //+ "<td width='400px' class='nav-item'><a class='customerId' data-toggle='tab' href='#BasicInfo' onclick='ViewBasicInfo(this)' role='tab'><span class='rowCardNo'>" + res[i].customerID + "</span></a></td>"
                                  + "<td style='width: 77%;'>" + resp.searchList.data.getProductsType[i].productName + "</td>"
                                  + "<td style='display:none'>" + resp.searchList.data.getProductsType[i].productID + "</td>"
                                  + "<td style='width: 16%;'><a class='Icons_sty' data-toggle='tooltip' title='' tooltip='Delete'><i class='fa fa-times-circle text-danger Delete'></i></a></td>"
                                  + "</tr >";
           
                            }


                        }
                        availableRows += "</tbody>"
                        $('#AvailableProductTbl table').append(availableRows);

                        allowedRows += "</tbody>"
                        $('#AllowedProductTbl table').append(allowedRows);

                        var j=0;
                        var k=0;
                        for (var i = 0; i < resp.searchList.data.getTransactionsType.length; i++) 
                        {
                            debugger;
                            if(resp.searchList.data.getTransactionsType[i].statusFlag==0)
                            {
                                j=j+1;
                                
                                availableTranRows += "<tr>"
                                  + "<td style='width: 7%;'>"+ (j) +"</td>"
                                  //+ "<td width='400px' class='nav-item'><a class='customerId' data-toggle='tab' href='#BasicInfo' onclick='ViewBasicInfo(this)' role='tab'><span class='rowCardNo'>" + res[i].customerID + "</span></a></td>"
                                  + "<td style='width: 77%;'>" + resp.searchList.data.getTransactionsType[i].transactionType + "</td>"
                                  + "<td style='display:none'>" + resp.searchList.data.getTransactionsType[i].transactionID + "</td>"
                                  + "<td style='width: 16%;'><button class='btn btn_primary' type='button'>Add</button></td>"
                                  + "</tr >";
           
                            }
                            debugger;
                            if(resp.searchList.data.getTransactionsType[i].statusFlag==1)
                            {
                                k=k+1;
                                
                                 allowedTranRows += "<tr>"
                                  + "<td style='width: 7%;'>"+ (k) +"</td>"
                                  //+ "<td width='400px' class='nav-item'><a class='customerId' data-toggle='tab' href='#BasicInfo' onclick='ViewBasicInfo(this)' role='tab'><span class='rowCardNo'>" + res[i].customerID + "</span></a></td>"
                                  + "<td style='width: 77%;'>" + resp.searchList.data.getTransactionsType[i].transactionType + "</td>"
                                  + "<td style='display:none'>" + resp.searchList.data.getTransactionsType[i].transactionID + "</td>"
                                  + "<td style='width: 16%;'><a class='Icons_sty' data-toggle='tooltip' title='' tooltip='Delete'><i class='fa fa-times-circle text-danger Delete'></i></a></td>"
                                  + "</tr >";
           
                            }
                        }

                        availableTranRows += "</tbody>"
                        $('#AvailableTransactionsTypeTbl table').append(availableTranRows);

                        allowedTranRows += "</tbody>"
                        $('#AllowedTransactionsTypeTbl table').append(allowedTranRows);
                }

            },
            error: function (ex) {
                alert('Failed' + ex);
            }
        });


    }

 }));

$("#btnReset").click(function () 
{
    window.location.href = '@Url.Action("EnableCustomerServices", "Cards")';
});

$("#AllowedPTbl").on('click', '.Delete', function () 
{
    debugger;
    row = $(this).closest("tr");
    var i = row[0].cells[0].textContent;
    var productID = row[0].cells[2].textContent;
    alert(productID);      

});

$("#AllowedTTbl").on('click', '.Delete', function () 
{
    debugger;
    row = $(this).closest("tr");
    var i = row[0].cells[0].textContent;
    var transactionID = row[0].cells[2].textContent;
    alert(transactionID);      

});

</script>