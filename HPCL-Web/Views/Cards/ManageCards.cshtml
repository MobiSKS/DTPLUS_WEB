@model HPCL_Web.Models.ManageCards.CustomerCards

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.js"></script>

<marquee width="100%" direction="left" height="30%">
    Dear Fleet Customer, For TDS related information, Please check the latest notification at TDS Alert
</marquee>
<div class="col-lg-12 p-4 p-md-4">
    <div class="bg-white p-2 p-md-4">

        @*<form name="applicationForm" onsubmit="return submitForm()" class="w-100">*@

        <form method="post" data-ajax="true" data-ajax-controller="Cards" data-ajax-action="ManageCards" data-ajax-method="POST" data-ajax-success="OnSuccess" data-ajax-failure="OnFailure">

            <div class="tab-content mt-3" id="myTabContent">
                <div class="tab-pane fade show active" id="basicInfo" role="tabpanel" aria-labelledby="basicInfo-tab">

                    <div class="border-1 rounded border-grey h-100 mt-3">

                        <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold" id="ManageCardHeader"> Manage Card </p>
                        <div class="py-2 p-md-4">

                            <div class="form-group d-flex align-items-center flex-wrap">

                            </div>

                            <div>
                                <ul class="nav nav-pills justify-content-end">
                                    <li id="CustomerCards" class="nav-item">
                                        <a class="nav-link active" id="CustomerCardTab" data-toggle="tab" href="#CustomerCardsSection" role="tab" style="margin:10px">Customer Cards</a>
                                    </li>
                                    <li id="CardDetails" class="nav-item">
                                        <a class="nav-link disabled" id="CardDetailsTab" data-toggle="tab" href="#CardDetailsSection" role="tab" style="margin:10px">Card Details</a>
                                    </li>
                                    <li id="Limits" class="nav-item">
                                        <a class="nav-link disabled" id="LimitTab" data-toggle="tab" href="#LimitSection" role="tab" style="margin:10px">Limits</a>
                                    </li>
                                    <li id="Services" class="nav-item">
                                        <a class="nav-link disabled" id="ServicesTab" data-toggle="tab" href="#ServiceSection" role="tab" style="margin:10px">Services</a>
                                    </li>
                                </ul>
                            </div>

                            <div class="tab-content">

                                <div id="CustomerCardsSection" class="tab-pane active" role="tabpanel">
                                    <div class="row w-100">

                                        <div class="d-flex align-items-center justify-content-between flex-wrap">

                                            <div class="form-group d-flex align-items-center flex-wrap">

                                            </div>

                                            <div class="col-md-6 col-12">
                                                <div class="form-group d-flex align-items-center flex-wrap">
                                                    <label class="font-weight-normal col-md-5 col-12">Customer ID<sup class="text-danger">*</sup></label>
                                                    <div class="col-md-7 col-12">
                                                        @Html.TextBoxFor(m => m.CustomerId, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.CustomerId, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-12">
                                                <div class="form-group d-flex align-items-center flex-wrap">
                                                    <label class="font-weight-normal col-md-5 col-12">Card Number</label>
                                                    <div class="col-md-7 col-12">
                                                        @Html.TextBoxFor(m => m.CardNo, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.CardNo, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-12">
                                                <div class="form-group d-flex align-items-center flex-wrap">
                                                    <label class="font-weight-normal col-md-5 col-12">Mobile Number</label>
                                                    <div class="col-md-7 col-12">
                                                        @Html.TextBoxFor(m => m.MobileNumber, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.MobileNumber, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-12">
                                                <div class="form-group d-flex align-items-center flex-wrap">
                                                    <label class="font-weight-normal col-md-5 col-12">Vehicle No</label>
                                                    <div class="col-md-7 col-12">
                                                        @Html.TextBoxFor(m => m.VehicleNumber, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.VehicleNumber, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-12">
                                                <div class="form-group d-flex align-items-center flex-wrap">
                                                    <label class="font-weight-normal col-md-5 col-12">Status</label>
                                                    <div class="col-md-7 col-12">
                                                        @Html.DropDownListFor(m => m.StatusFlag, new SelectList(Model.StatusModals, "StatusId", "StatusName"), new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.StatusFlag, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="d-flex align-items-center justify-content-center mt-3">
                                        <div class="px-2">
                                            <button class="btn" type="submit" id="btnSave" name="submit" onclick="document.getElementById('CardSearch').style.display = 'block';" style="background-color:#084693;color:white;">SEARCH</button>
                                            <button class="btn" id="=btnCancel" name="cancel" style="background-color:#084693;color:white;">VIEW GENERIC / ATTACHED VEHICLE</button>
                                            <button class="btn" id="=btnCancel" name="cancel" style="background-color:#084693;color:white;">DOWNLOAD GENERIC / ATTACHED VEHICLE</button>
                                        </div>
                                    </div>

                                    <div class="form-group d-flex align-items-center flex-wrap">

                                    </div>

                                    <table id="CardSearch" class="table table-striped table-bordered table-responsive" style="display:none;">
                                        <tr>
                                            <th>
                                                @Html.DisplayName("Sr. Number")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Card Number")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Customer ID")
                                            </th>
                                            <th>
                                                @Html.DisplayName("User Id")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Card Type")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Vehicle No/User Name")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Vehicle Type")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Issue Date")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Expiry Date")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Status")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Year Of Registration")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Manufacturer")
                                            </th>
                                            <th>
                                                @Html.DisplayName("OWNED/ATTACHED")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Mobile Number")
                                            </th>
                                            <th>
                                                @Html.DisplayName("VIN Number")
                                            </th>
                                            <th>
                                                @Html.DisplayName("Cardless Mapping")
                                            </th>

                                        </tr>
                                    </table>

                                </div>


                                <div id="CardDetailsSection" class="tab-pane" role="tabpanel">
                                    <div class="tab-pane fade show active" id="basicInfo" role="tabpanel" aria-labelledby="basicInfo-tab">
                                        <div class="w-100">
                                            <div class="col-lg-6 col-md-12 col-12 pl-0 pr-md-2 pr-0 py-2">
                                                <fieldset class="border-1 rounded border-grey">
                                                    <legend class="font-weight-bold">Card Details</legend>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Customer ID <sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.CustomerId, new { @id = "CustomerIdCardValue", @class = "form-control" })
                                                            @Html.ValidationMessageFor(m => m.CustomerId, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Card Number</label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.CardNo, new { @id = "CardNoDValue", @class = "form-control" })
                                                            @Html.ValidationMessageFor(m => m.CardNo, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Card Category <sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            <div class="custom_select">
                                                                @Html.DropDownListFor(m => m.CardCategory, Enumerable.Empty<SelectListItem>(), new {@id= "CardCategoryValue", @class = "form-control", disabled = "disabled" })
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Card Issue Type <sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            <div class="custom_select">
                                                                @Html.DropDownListFor(m => m.CardIssueType, Enumerable.Empty<SelectListItem>(), new {@id= "CardIssueTypeValue", @class = "form-control", disabled = "disabled" })
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Request Date <sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.RequestDate, new { type = "date", @id = "RequestDateValue", @class = "form-control" })
                                                            @Html.ValidationMessageFor(m => m.RequestDate, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Form Number</label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.FormNumber, new { @id = "FormNumberValue", @class = "form-control" })
                                                            @Html.ValidationMessageFor(m => m.FormNumber, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">RBE ID<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.RbeId, new { @id = "RbeIdValue", @class = "form-control" })
                                                            @Html.ValidationMessageFor(m => m.RbeId, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">RBE Name<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.RbeName, new { @id = "RbeNameValue", @class = "form-control" })
                                                            @Html.ValidationMessageFor(m => m.RbeName, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-12 col-12 pr-0 pl-md-2 pl-0 py-2">
                                            <fieldset class="border-1 rounded border-grey h-100">
                                                <legend class="font-weight-bold">Vehicle Details</legend>
                                                <div class="py-2 pr-4 pl-0 pr-md-4">
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Vehicle Reg. No./User Name<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.VehicleNumber, new { @id = "VehicleNumberValue", @class = "form-control" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Type<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            <div class="custom_select">
                                                                @Html.DropDownListFor(m => m.vehicleType, Enumerable.Empty<SelectListItem>(), new {@id= "vehicleTypeValue", @class = "form-control", disabled = "disabled" })
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Make<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.VehicleMake, new { @id = "VehicleMakeValue", @class = "form-control" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Year Of Reg.<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.YearOfReg, new { @id = "YearOfRegValue", @class = "form-control" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">Ownership Type<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            <div class="custom_select">
                                                                @Html.DropDownListFor(m => m.OwnerType, Enumerable.Empty<SelectListItem>(), new {@id= "OwnerTypeValue", @class = "form-control", disabled = "disabled" })
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group d-flex align-items-center flex-wrap">
                                                        <label class="font-weight-normal col-md-5 col-12">VIN Number<sup class="text-danger">*</sup></label>
                                                        <div class="col-md-7 col-12">
                                                            @Html.TextBoxFor(m => m.VinNumber, new { @id = "VinNumberValue", @class = "form-control" })
                                                        </div>
                                                    </div>

                                                    <div id="getCardD">

                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>


                                    <div class="clearfix"></div>

                                    <div class="d-flex align-items-center justify-content-between flex-wrap">

                                        <div class="w-100">
                                            <p class="font-weight-bold">Fee Payment Details</p>
                                            <div class="col-sm-10">
                                                <div class="form-check">
                                                    <label class="radio-inline">
                                                        <input type="radio" name="optradio" checked>
                                                        Fee Collect(CR)
                                                    </label>
                                                    <label class="radio-inline">
                                                        <input type="radio" name="optradio">
                                                        Fee Collect(Cheque)
                                                    </label>
                                                    <label class="radio-inline">
                                                        <input type="radio" name="optradio">
                                                        Fee Waiver
                                                    </label>
                                                </div>
                                            </div>


                                            <div class="col-md-6 col-8">
                                                <div class="form-group d-flex align-items-center flex-wrap">
                                                    <label class="font-weight-normal col-md-5 col-12">Approval Email From<sup class="text-danger">*</sup></label>
                                                    <div class="col-md-7 col-12">
                                                        <input type="text" name="perma_address1" class="form-control">
                                                        <div class="error" id="perma_address1_error"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-8">
                                                <div class="form-group d-flex align-items-center flex-wrap">
                                                    <label class="font-weight-normal col-md-5 col-12">Approval Email Date</label>
                                                    <div class="col-md-7 col-12">
                                                        <input type="text" name="perma_address2" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div>


                                <div id="LimitSection" class="tab-pane" role="tabpanel">
                                </div>

                                <div id="ServiceSection" class="tab-pane" role="tabpanel">

                                    <p>Select Service</p>
                                    <div class="form-group d-flex align-items-center flex-wrap">

                                    </div>

                                    <ul class="list-group list-group-flush" id="wkslist">
                                       
                                    </ul>

                                    <div class="form-group d-flex align-items-center flex-wrap">

                                    </div>

                                    <div class="row">
                                        <div class="col-auto mr-auto">
                                        </div>
                                        <div class="col-auto">
                                            <button type="submit" class="btn" id="btnUpdateService" onclick="callServ(this)" style="background-color:#084693;color:white;">SAVE UPDATED SERVICES</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>


<script type="text/javascript">
    //var cardNo = "";
    //var mobileNumber = "";

    function OnSuccess(data) {
        $("#CardSearch td").parent().remove();

        for (var i = 0; i < data.searchList.length; i++) {

            //cardNo = data.searchList[i].cardNumber;
            //mobileNumber = data.searchList[i].mobileNumber;
            var rows = "<tbody><tr>"
                + "<td><span class='rowData'>" + data.searchList[i].srNumber + "</span></td>"
                + "<td class='nav-item'><a class='CardNumber' data-toggle='tab' href='#CardDetailsSection' onclick='ViewCardDetails(this)' role='tab'><span class='rowData'>" + data.searchList[i].cardNumber + "</span></a></td>"
                + "<td><span class='rowData'>" + data.searchList[i].customerID + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].userID + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].cardIssueType + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].vechileNo + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].vehicleType + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].issueDate + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].expiryDate + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].status + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].yearOfRegistration + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].manufacturer + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].ownershipType + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].mobileNumber + "</span></td>"
                + "<td><span class='rowData'>" + data.searchList[i].vinNumber + "</span></td>"
                + "<td><a href='@Html.Raw(@Url.Action("CardlessMapping"))' class='editNumber'>Edit</a></td></tr></tbody>";

           
            $('#CardSearch').append(rows);

        }
    }

    function OnFailure(data) {
        alert('HTTP Status Code: ' + data + '  Error Message: ' + data);
    }


    function ViewCardDetails(o) {

        var CardId = o.innerText;

        $("#ManageCardHeader").replaceWith("<p class='text_primary px-3 py-2 bg-grey m-0 font-weight-bold'>Manage Cards CARD PAN: ( " + CardId + ") </p>");

        $("#CardDetailsTab").removeClass("disabled");
        $("#LimitTab").removeClass("disabled");
        $("#ServicesTab").removeClass("disabled");
        $('#CardDetailsTab').tab('show');

        $.ajax({
            url: "@Url.Action("ViewCardDetails", "Cards")",
            type: "POST",
            dataType: "JSON",
            data: { CardId: CardId },
            success: function (res) {
                console.log("searchlist", res.cardDetailsList);
                console.log("servicelist", res.servicesDetailsList);

                console.log("card remaining", res.cardRemaining);
                console.log("ccms remaining", res.ccmsRemaining);

                var vl = 1;

                //$('#CustomerIdValue').val(res.cardDetailsList[0].customerID);

                $('#CustomerIdCardValue').val(res.cardDetailsList[0].cardNumber);

                var cardCategory = $('<option value="' + res.cardDetailsList[0].cardCategory + '">' + res.cardDetailsList[0].cardCategory + '</option>');
                $('#CardCategoryValue').append(cardCategory);

                var issueType = $('<option value="' + res.cardDetailsList[0].cardIssueType + '">' + res.cardDetailsList[0].cardIssueType + '</option>');
                $('#CardIssueTypeValue').append(issueType);

                $('#RequestDateValue').val(res.cardDetailsList[0].requestDate);
                $('#FormNumberValue').val(res.cardDetailsList[0].formNumber);
                //$('#RbeIdValue').val(res.cardDetailsList[0].rbeid);
                //$('#RbeNameValue').val(res.cardDetailsList[0].rbeName);
                $('#VehicleNumberValue').val(res.cardDetailsList[0].vechileNo);

                var vehicleType = $('<option value="' + res.cardDetailsList[0].vehicleType + '">' + res.cardDetailsList[0].vehicleType + '</option>');
                $('#vehicleTypeValue').append(vehicleType);

                $('#VehicleMakeValue').val(res.cardDetailsList[0].vehicleMake);
                $('#YearOfRegValue').val(res.cardDetailsList[0].yearOfRegistration);

                var ownType = $('<option value="' + res.cardDetailsList[0].ownershipType + '">' + res.cardDetailsList[0].ownershipType + '</option>');
                $('#OwnerTypeValue').append(ownType);

                $('#VinNumberValue').val(res.cardDetailsList[0].vinNumber);

                for (var i = 0; i < res.servicesDetailsList.length; i++) {
                    var checkboxList = "<li class='list - group - item'>"
                        + "<div class='custom-control custom-checkbox'>"
                        + "<input type='checkbox' class='custom-control-input cbk' name=" + res.servicesDetailsList[i].serviceID + " id=" + res.servicesDetailsList[i].serviceID + ">"
                        + "<label class='custom-control-label' for=" + res.servicesDetailsList[i].serviceID + ">" + res.servicesDetailsList[i].serviceName + "</label>"
                        + "</div></li>";

                    $('#wkslist').append(checkboxList);

                    if (res.servicesDetailsList[i].selectedServices == 1) {
                        console.log(res.servicesDetailsList[i].selectedServices);
                        $('input[name *= "' + res.servicesDetailsList[i].serviceID+'"]').prop('checked', true);
                    }
                }

                },
                error: function (ex) {
                    alert('Failed' + ex);
                }
        });
    };
</script>

<style>
    .nav-item > li.active > a,
    .nav-item > li.active > a:focus,
    .nav-item > li.active > a:hover {
        background-color: gray;
    }

    .nav-pills .nav-link.active, .nav-pills .show > .nav-link {
        background-color: gray;
    }

    .nav-pills .nav-link {
        background-color: cornflowerblue;
        color: black;
    }
</style>