@model HPCL.Common.Models.ViewModel.DtpSupport.TeamMappingViewModel
@using Microsoft.AspNetCore.Http;

<div class="col-lg-12">
    <div class="bg-white p-2 p-md-4">
        <ul class="breadcrumb bread_custom bg-transparent m-0 pb-1 py-0 px-0">
            <li class="breadcrumb-item"><a href="@Url.Action("Index","DtpSupport")" class="text_primary">DTP Support</a> </li>
            <li class="breadcrumb-item font-weight-light">Team Mapping</li>
        </ul>
        @if (ViewBag.SuccessMessage != "" && ViewBag.SuccessMessage != null)
        {
            <div id="reason" class="mb-3 text-center alert alert-success">@ViewBag.SuccessMessage</div>
        }
        @if (ViewBag.ErrorMessage != "" && ViewBag.ErrorMessage != null)
        {
            <div id="reason" class="mb-3 text-center alert alert-danger">@ViewBag.ErrorMessage</div>
        }
        <form id="formValid" class="toBeHiddenOnSuccess">
            <div class="w-100">
                <div class="col-lg-12 col-md-12 col-12 pl-0 pr-0 mb-3">
                    <div class="border-1 rounded border-grey pb-0">
                        <p class="text_primary px-3 py-3 bg-grey m-0 font-weight-bold">Team Mapping</p>
                        <button class="btn btn_primary add_update_btn" type="button" id="AddRecord">ADD NEW RECORD</button>
                            <div class="col-lg-12 col-md-12 col-12 py-3">
                                <p class="text-dark px-0 pb-2 mb-3 font-weight-bold teamAdd" style="display:none;border-bottom:1px solid #ccc;">Add Record</p>
                                <p class="text-dark px-0 pb-2 mb-3 font-weight-bold teamSearch" style="border-bottom:1px solid #ccc;">Search</p>
                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label id="lblCustomerId" class="font-weight-normal col-md-3 col-12 teamAddlbl">ZBM ID</label>
                                            <div class="col-md-7 col-12">
                                                <div class="custom_select">
                                                    @Html.TextBoxFor(m => m.ZBMID, new { @class = "form-control",maxlength="30" })
                                                    <span style="display:none" class="error" id="ZBMId_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label id="lblCustomerId" class="font-weight-normal col-md-3 col-12 teamAddlbl">ZBM Name</label>
                                            <div class="col-md-7 col-12">
                                                <div class="custom_select">
                                                    @Html.TextBoxFor(m => m.ZBMName, new { @class = "form-control",maxlength="30" })
                                                    <span style="display:none" class="error" id="ZBMName_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label id="lblCustomerId" class="font-weight-normal col-md-3 col-12 teamAddlbl">RSM ID</label>
                                            <div class="col-md-7 col-12">
                                                <div class="custom_select">
                                                    @Html.TextBoxFor(m => m.RSMID, new { @class = "form-control" ,maxlength="30"})
                                                    <span style="display:none" class="error" id="RSMId_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label id="lblCustomerId" class="font-weight-normal col-md-3 col-12 teamAddlbl">RSM Name</label>
                                            <div class="col-md-7 col-12">
                                                <div class="custom_select">
                                                    @Html.TextBoxFor(m => m.RSMName , new { @class = "form-control" ,maxlength="30"})
                                                    <span style="display:none" class="error" id="RSMName_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label id="lblCustomerId" class="font-weight-normal col-md-3 col-12 teamAddlbl">RBE ID</label>
                                            <div class="col-md-7 col-12">
                                                <div class="custom_select">
                                                    @Html.TextBoxFor(m => m.RBEID, new { @class = "form-control" ,maxlength="30"})
                                                    <span style="display:none" class="error" id="RBEId_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label id="lblCustomerId" class="font-weight-normal col-md-3 col-12 teamAddlbl">RBE Name</label>
                                            <div class="col-md-7 col-12">
                                                <div class="custom_select">
                                                    @Html.TextBoxFor(m => m.RBEName, new { @class = "form-control" ,maxlength="30"})
                                                    <span style="display:none" class="error" id="RBEName_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label id="lblCustomerId" class="font-weight-normal col-md-3 col-12 teamAddlbl">Location</label>
                                            <div class="col-md-7 col-12">
                                                <div class="custom_select">
                                                    @Html.TextBoxFor(m => m.Location, new { @class = "form-control" ,maxlength="30" })
                                                    <span style="display:none" class="error" id="Location_error"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="clearfix"></div>
                                <div class="d-flex align-items-center justify-content-center mt-0">
                                    <div class="px-2 teamAdd" style="display:none;">
                                        <button class="btn btn_primary" type="button" id="btnAdd">ADD</button>
                                    </div>
                                    <div class="px-2">
                                        <button class="btn btn_primary teamSearch" type="submit" id="btnSearch">SEARCH</button>
                                    </div>
                                    <div class="px-2">
                                        <button class="btn btn_primary" type="button" id="btnReset" onclick="location.href='@Url.Action("TeamMapping", "DtpSupport", new { reset="Y" })'">RESET</button>
                                    </div>
                                    <div class="px-2 teamAdd" style="display:none;">
                                        <button class="btn btn_primary" type="button" onclick="location.href='@Url.Action("TeamMapping", "DtpSupport")'" >SEARCH</button>
                                    </div>
                                </div>

                            </div>
                            <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </form>
        <div class="clearfix"></div>

        <div class="clearfix"></div>
        @if (ViewBag.Reset != "Y")
        {
            @if (Model.Data.Count() > 0)
            {

                <table class="table table-striped table-bordered table-responsive d-md-table" style="width:100%;word-wrap:break-word;table-layout:fixed;" id="TeamMapSearch">
                    <thead style="background-color:lightgray;">
                        <tr>
                            <th>S.No.</th>
                            <th>ZBM ID</th>
                            <th>ZBM Name</th>
                            <th>RSM ID</th>
                            <th>RSM Name</th>
                            <th>RBE ID</th>
                            <th>RBE Name</th>
                            <th>Location</th>
                            <th>Action</th>
                            <th style="display:none">ID</th>

                        </tr>
                    </thead>
                    <tbody id="searchTableBody">
                        @{
                            int i = 0;
                        }
                        @foreach (var item in Model.Data)
                        {
                            i = i + 1;

                            <tr>
                                <td>@i</td>
                                <td class="editCell" id="tdZBMId">@item.ZBMId</td>
                                <td class="editCell" id="tdZBMName">@item.ZBMName</td>
                                <td class="editCell" id="tdRSMId">@item.RSMId</td>
                                <td class="editCell" id="tdRSMName">@item.RSMName</td>
                                <td class="editCell" id="tdRBEId">@item.RBEId</td>
                                <td class="editCell" id="tdRBEName">@item.RBEName</td>
                                <td class="editCell" id="tdLocation">@item.Location</td>


                                <td style="width:8px">
                                    <div class="d-flex align-items-center justify-content-start">
                                        <a class="d-block" data-toggle="tooltip" title="" tooltip="Edit"><i class="fa fa-pencil-square-o edit" aria-hidden="true"></i></a>
                                        <a class="d-block" data-toggle="tooltip" title="" tooltip="Update"><i class="fa fa-floppy-o save" aria-hidden="true" style="display:none"></i></a>
                                        <a class="d-block" data-toggle="tooltip" title="" tooltip="Cancel"><i class="fa fa-remove cancel" aria-hidden="true" style="display:none"></i></a>
                                        <a asp-action="DeleteTeamMapping" class="d-block" asp-route-TeamMappingId="@item.TeamMappingId" onclick="return confirm('Do you want to delete this record ?');" data-toggle="tooltip" title="" tooltip="Delete"><i class="fa fa-trash-o" aria-hidden="true"></i></a>
                                    </div>
                                </td>
                                <td style="display:none">@item.TeamMappingId</td>
                            </tr>
                        }
                    </tbody>
                </table>

                <div class="clearfix"></div>
            }
            else
            {
                <div class="mb-3 text-center alert alert-danger" id="divMsg">
                    @Model.Message
                </div>
            }
        }
        <div class="clearfix"></div>
        <input type="hidden" id="Status">
    </div>
</div>

<script type="text/javascript">
    var pageStatus="@ViewBag.Reset";//ViewBag.Reset has value "Y" for reset click, "A" for Add button click
    var activeRow="";
     var pZBMId = "", pZBMName = "", pRSMId = "",pRSMName = "", pRBEId = "", pRBEName = "",plocation ="";
    $(document).ready(function () {
         $('.table').DataTable({
            "lengthMenu": [10, 20, 50, 100, 200, 500],
            "oLanguage": {
                "sLengthMenu": "Display _MENU_ Records",
                "info": "Showing _START_ to _END_ of _TOTAL_ Records",
            }
        });

        if(pageStatus=="A"){
           if(!$("label.teamAddlbl").hasClass("Required")){
                $("label.teamAddlbl").addClass("Required");
                $("label.teamAddlbl").append('<sup class="text-danger">*</sup>');
           }
           $("#Status").val("ADD");
           $(".teamAdd").attr("style","display:block");
           $(".teamSearch").attr("style","display:none");
           $("p.teamAdd").attr("style","display:block;border-bottom:1px solid #ccc;");
           
        }
        else{
             $("#Status").val("");
            $("label.teamAddlbl").removeClass("Required");
        }
    });
    
     
     $("#btnSearch").on("click",(function(e){
         var flag="Y";
        
        if($("#ZBMID").val().trim()!=""){
            if(!($("#ZBMID").val().match(nameWithNumCheck))){
                $("#ZBMId_error").html("ZBM ID is Invalid");
                $("#ZBMId_error").attr("style","display:block");
                flag="N";
            }
            else if($("#ZBMID").val().match(onlyNumbers)){
                $("#ZBMId_error").html("ZBM ID is Invalid");
                $("#ZBMId_error").attr("style","display:block");
                flag="N";
            }
        }
     
        if($("#ZBMName").val().trim()!=""){
            if(!($("#ZBMName").val().match(nameWithNumCheck))){
                $("#ZBMName_error").html("ZBM Name is Invalid");
                $("#ZBMName_error").attr("style","display:block");
                flag="N";
            }
            else if($("#ZBMName").val().match(onlyNumbers)){
                $("#ZBMName_error").html("ZBM Name is Invalid");
                $("#ZBMName_error").attr("style","display:block");
                flag="N";
            }
        }
        
        if($("#RSMID").val().trim()!=""){
            if(!($("#RSMID").val().match(nameWithNumCheck))){
                $("#RSMId_error").html("RSM ID is Invalid");
                $("#RSMId_error").attr("style","display:block");
                flag="N";
            }
            else if($("#RSMID").val().match(onlyNumbers)){
                $("#RSMId_error").html("RSM ID is Invalid");
                $("#RSMId_error").attr("style","display:block");
                flag="N";
            }
        }
     
        if($("#RSMName").val().trim()!=""){
            if(!($("#RSMName").val().match(nameWithNumCheck))){
                $("#RSMName_error").html("RSM Name is Invalid");
                $("#RSMName_error").attr("style","display:block");
                flag="N";
            }
            else if($("#RSMName").val().match(onlyNumbers)){
                $("#RSMName_error").html("RSM Name is Invalid");
                $("#RSMName_error").attr("style","display:block");
                flag="N";
            }
        }
        
        if($("#RBEID").val().trim()!=""){
            if(!($("#RBEID").val().match(nameWithNumCheck))){
                $("#RBEId_error").html("RBE ID is Invalid");
                $("#RBEId_error").attr("style","display:block");
                flag="N";
            }
            else if($("#RBEID").val().match(onlyNumbers)){
                $("#RBEId_error").html("RBE ID is Invalid");
                $("#RBEId_error").attr("style","display:block");
                flag="N";
            }
        }
        
        if($("#RBEName").val().trim()!=""){
            if(!($("#RBEName").val().match(nameWithNumCheck))){
                $("#RBEName_error").html("RBE Name is Invalid");
                $("#RBEName_error").attr("style","display:block");
                flag="N";
            }
            else if($("#RBEName").val().match(onlyNumbers)){
                $("#RBEName_error").html("RBE Name is Invalid");
                $("#RBEName_error").attr("style","display:block");
                flag="N";
            }
        }
      
        if($("#Location").val().trim()!=""){
            if(!($("#Location").val().match(nameWithNumCheck))){
                $("#Location_error").html("Location is Invalid");
                $("#Location_error").attr("style","display:block");
                flag="N";
            }
            else if($("#Location").val().match(onlyNumbers)){
                $("#Location_error").html("Location is Invalid");
                $("#Location_error").attr("style","display:block");
                flag="N";
            }
        }
        if(flag=="N"){
            e.preventDefault();
        }
     }));
     $("#AddRecord").click(function(){
         if(!$("label.teamAddlbl").hasClass("Required")){
            $("label.teamAddlbl").addClass("Required");
            $("label.teamAddlbl").append('<sup class="text-danger">*</sup>');
         }

        $(".teamAdd").attr("style","display:block");
        $(".teamSearch").attr("style","display:none");
        $("p.teamAdd").attr("style","display:block;border-bottom:1px solid #ccc;");

        $("#Status").val("ADD");
        $("#ZBMID").val("");
        $("#ZBMName").val("");
        $("#RSMName").val("");
        $("#RBEID").val("");
        $("#RBEName").val("");
        $("#Location").val("");
        $("#RSMID").val("");
        $("#divMsg").html("");
        $("#divMsg").attr("style","display:none");
    });
    $("#btnAdd").click(function(){
        var flag = "Y";
        //debugger;
        if($("#ZBMID").val().trim()==""){
            $("#ZBMId_error").html("ZBM ID is required");
            $("#ZBMId_error").attr("style","display:block");
            flag="N";
        }
        else{
            if(!($("#ZBMID").val().match(nameWithNumCheck))){
                $("#ZBMId_error").html("ZBM ID is Invalid");
                $("#ZBMId_error").attr("style","display:block");
                flag="N";
            }
            else if($("#ZBMID").val().match(onlyNumbers)){
                $("#ZBMId_error").html("ZBM ID is Invalid");
                $("#ZBMId_error").attr("style","display:block");
                flag="N";
            }
        }
        if($("#ZBMName").val().trim()==""){
            $("#ZBMName_error").html("ZBM Name is required");
             $("#ZBMName_error").attr("style","display:block");
            flag="N";
        }
        else{
            if(!($("#ZBMName").val().match(nameWithNumCheck))){
                $("#ZBMName_error").html("ZBM Name is Invalid");
                $("#ZBMName_error").attr("style","display:block");
                flag="N";
            }
            else if($("#ZBMName").val().match(onlyNumbers)){
                $("#ZBMName_error").html("ZBM Name is Invalid");
                $("#ZBMName_error").attr("style","display:block");
                flag="N";
            }
        }
        if($("#RSMID").val().trim()==""){
            $("#RSMId_error").html("RSM ID is required");
             $("#RSMId_error").attr("style","display:block");
            flag="N";
        }
        else{
            if(!($("#RSMID").val().match(nameWithNumCheck))){
                $("#RSMId_error").html("RSM ID is Invalid");
                $("#RSMId_error").attr("style","display:block");
                flag="N";
            }
            else if($("#RSMID").val().match(onlyNumbers)){
                $("#RSMId_error").html("RSM ID is Invalid");
                $("#RSMId_error").attr("style","display:block");
                flag="N";
            }
        }
        if($("#RSMName").val().trim()==""){
            $("#RSMName_error").html("RSM Name is required");
             $("#RSMName_error").attr("style","display:block");
            flag="N";
        }
        else{
            if(!($("#RSMName").val().match(nameWithNumCheck))){
                $("#RSMName_error").html("RSM Name is Invalid");
                $("#RSMName_error").attr("style","display:block");
                flag="N";
            }
            else if($("#RSMName").val().match(onlyNumbers)){
                $("#RSMName_error").html("RSM Name is Invalid");
                $("#RSMName_error").attr("style","display:block");
                flag="N";
            }
        }
        if($("#RBEID").val().trim()==""){
            $("#RBEId_error").html("RBE ID is required");
             $("#RBEId_error").attr("style","display:block");
            flag="N";
        }
        else{
            if(!($("#RBEID").val().match(nameWithNumCheck))){
                $("#RBEId_error").html("RBE ID is Invalid");
                $("#RBEId_error").attr("style","display:block");
                flag="N";
            }
            else if($("#RBEID").val().match(onlyNumbers)){
                $("#RBEId_error").html("RBE ID is Invalid");
                $("#RBEId_error").attr("style","display:block");
                flag="N";
            }
        }
        if($("#RBEName").val().trim()==""){
            $("#RBEName_error").html("RBE Name is required");
             $("#RBEName_error").attr("style","display:block");
            flag="N";
        }
        else{
            if(!($("#RBEName").val().match(nameWithNumCheck))){
                $("#RBEName_error").html("RBE Name is Invalid");
                $("#RBEName_error").attr("style","display:block");
                flag="N";
            }
            else if($("#RBEName").val().match(onlyNumbers)){
                $("#RBEName_error").html("RBE Name is Invalid");
                $("#RBEName_error").attr("style","display:block");
                flag="N";
            }
        }
        if($("#Location").val().trim()==""){
            $("#Location_error").html("Location is required");
             $("#Location_error").attr("style","display:block");
            flag="N";
        }
        else{
            if(!($("#Location").val().match(nameWithNumCheck))){
                $("#Location_error").html("Location is Invalid");
                $("#Location_error").attr("style","display:block");
                flag="N";
            }
            else if($("#Location").val().match(onlyNumbers)){
                $("#Location_error").html("Location is Invalid");
                $("#Location_error").attr("style","display:block");
                flag="N";
            }
        }

        if (flag == "Y") {
            var reqData=$('#formValid').serialize();
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("AddTeamMapping", "DtpSupport")',
                    data:reqData,
                    dataType: 'json',
                    success: function (data) {
                        var successMsg="",errorMsg="";
                        if(data[0].status==1)
                            successMsg=data[0].reason;
                        else if(data[0].status==0)
                            errorMsg=data[0].reason;
                        var url = '@Html.Raw(@Url.Action("TeamMapping", "DtpSupport",new { reset = "A", success = "mm", error = "ee" }))';
                        url = url.replace("mm", encodeURIComponent(successMsg)).replace("ee", encodeURIComponent(errorMsg));
                       window.location.href=url;
                    },
                    error: function (ex) {
                        alert('Error.' + ex);
                    }
                });

        }
    });
    $("#ZBMID").on("blur", function () {
         var zbmId = $("#ZBMID").val();
         if (zbmId.trim() == "") {
             if( $("#Status").val()=="ADD"){
                $("#ZBMId_error").html("ZBM ID is required");
                $("#ZBMId_error").attr("style","display:block");
             }
             else{
                 $("#ZBMId_error").attr("style", "display:none");
                 $("#ZBMId_error").html("");
             }
         }
         else{
            if(!($("#ZBMID").val().match(nameWithNumCheck))){
                $("#ZBMId_error").html("ZBM ID is Invalid");
                $("#ZBMId_error").attr("style","display:block");
            }
            else if($("#ZBMID").val().match(onlyNumbers)){
                $("#ZBMId_error").html("ZBM ID is Invalid");
                $("#ZBMId_error").attr("style","display:block");
            }
            else{
                 $("#ZBMId_error").attr("style", "display:none");
                 $("#ZBMId_error").html("");
            }
        }
     });
     $("#ZBMName").on("blur", function () {
         var zbmName = $("#ZBMName").val();
         if (zbmName.trim() == "") {
             if( $("#Status").val()=="ADD"){
                $("#ZBMName_error").html("ZBM Name is required");
                $("#ZBMName_error").attr("style","display:block");
             }
             else{
                 $("#ZBMName_error").attr("style", "display:none");
                 $("#ZBMName_error").html("");
             }
         }
         else{
            if(!($("#ZBMName").val().match(nameWithNumCheck))){
                $("#ZBMName_error").html("ZBM Name is Invalid");
                $("#ZBMName_error").attr("style","display:block");
            }
            else if($("#ZBMName").val().match(onlyNumbers)){
                $("#ZBMName_error").html("ZBM Name is Invalid");
                $("#ZBMName_error").attr("style","display:block");
            }
            else{
                 $("#ZBMName_error").attr("style", "display:none");
                 $("#ZBMName_error").html("");
             }
        }
     });
      $("#RSMID").on("blur", function () {
         var rsmId = $("#RSMID").val();
         if (rsmId.trim() == "") {
             if( $("#Status").val()=="ADD"){
                $("#RSMId_error").html("RSM ID is required");
                $("#RSMId_error").attr("style","display:block");
             }
             else{
                 $("#RSMId_error").attr("style", "display:none");
                 $("#RSMId_error").html("");
             }
         }
         else{
            if(!($("#RSMID").val().match(nameWithNumCheck))){
                $("#RSMId_error").html("RSM ID is Invalid");
                $("#RSMId_error").attr("style","display:block");
            }
            else if($("#RSMID").val().match(onlyNumbers)){
                $("#RSMId_error").html("RSM ID is Invalid");
                $("#RSMId_error").attr("style","display:block");
            }
            else{
                 $("#RSMId_error").attr("style", "display:none");
                 $("#RSMId_error").html("");
             }
        }
     });

      $("#RSMName").on("blur", function () {
         var rsmName = $("#RSMName").val();
         if (rsmName.trim() == "") {
             if( $("#Status").val()=="ADD"){
                $("#RSMName_error").html("RSM Name is required");
                $("#RSMName_error").attr("style","display:block");
             }
             else{
                 $("#RSMName_error").attr("style", "display:none");
                 $("#RSMName_error").html("");
             }
         }
         else{
            if(!($("#RSMName").val().match(nameWithNumCheck))){
                $("#RSMName_error").html("RSM Name is Invalid");
                $("#RSMName_error").attr("style","display:block");
            }
            else if($("#RSMName").val().match(onlyNumbers)){
                $("#RSMName_error").html("RSM Name is Invalid");
                $("#RSMName_error").attr("style","display:block");
            }
            else{
                 $("#RSMName_error").attr("style", "display:none");
                 $("#RSMName_error").html("");
             }
        }
     });
     $("#RBEID").on("blur", function () {
         var rbeId = $("#RBEID").val();
         if (rbeId.trim() == "") {
             if( $("#Status").val()=="ADD"){
                $("#RBEId_error").html("RBE ID is required");
                $("#RBEId_error").attr("style","display:block");
             }
             else{
                 $("#RBEId_error").attr("style", "display:none");
                 $("#RBEId_error").html("");
             }
         }
         else{
            if(!($("#RBEID").val().match(nameWithNumCheck))){
                $("#RBEId_error").html("RBE ID is Invalid");
                $("#RBEId_error").attr("style","display:block");
            }
            else if($("#RBEID").val().match(onlyNumbers)){
                $("#RBEId_error").html("RBE ID is Invalid");
                $("#RBEId_error").attr("style","display:block");
            }
            else{
                 $("#RBEId_error").attr("style", "display:none");
                 $("#RBEId_error").html("");
             }

        }
     });
      $("#RBEName").on("blur", function () {
         var rbeName = $("#RBEName").val();
         if (rbeName.trim() == "") {
             if( $("#Status").val()=="ADD"){
                $("#RBEName_error").html("RBE Name is required");
                $("#RBEName_error").attr("style","display:block");
             }
             else{
                 $("#RBEName_error").attr("style", "display:none");
                 $("#RBEName_error").html("");
             }
         }
         else{
            if(!($("#RBEName").val().match(nameWithNumCheck))){
                $("#RBEName_error").html("RBE Name is Invalid");
                $("#RBEName_error").attr("style","display:block");
            }
            else if($("#RBEName").val().match(onlyNumbers)){
                $("#RBEName_error").html("RBE Name is Invalid");
                $("#RBEName_error").attr("style","display:block");
            }
            else{
                 $("#RBEName_error").attr("style", "display:none");
                 $("#RBEName_error").html("");
             }
        }
     });
      $("#Location").on("blur", function () {
         var location = $("#Location").val();
         if (location.trim() == "") {
             if( $("#Status").val()=="ADD"){
               $("#Location_error").html("Location is required");
                $("#Location_error").attr("style","display:block");
             }
             else{
                 $("#Location_error").attr("style", "display:none");
                 $("#Location_error").html("");
             }
         }
         else{
            if(!($("#Location").val().match(nameWithNumCheck))){
                $("#Location_error").html("Location is Invalid");
                $("#Location_error").attr("style","display:block");
            }
            else if($("#Location").val().match(onlyNumbers)){
                $("#Location_error").html("Location is Invalid");
                $("#Location_error").attr("style","display:block");
            }
            else{
                 $("#Location_error").attr("style", "display:none");
                 $("#Location_error").html("");
             }
        }
     });

     $("#TeamMapSearch").on('click', '.edit', function () {
        if(activeRow==""){
            currentRow = $(this).closest("tr");
            activeRow=currentRow;
            var i = currentRow[0].cells[0].textContent;
            pZBMId = currentRow[0].cells[1].textContent;
           pZBMName = currentRow[0].cells[2].textContent;
           pRSMId = currentRow[0].cells[3].textContent;
           pRSMName = currentRow[0].cells[4].textContent;
           pRBEId = currentRow[0].cells[5].textContent;
           pRBEName = currentRow[0].cells[6].textContent;
           plocation = currentRow[0].cells[7].textContent;
            currentRow.find('td.editCell').each(function(){

                          $(this)[0].innerHTML=('<input type="text" onblur="validateText(this);" maxlength="30" class="form-control" value="'+ $(this)[0].textContent + '" id="'+$(this)[0].id+'_'+i+'"><span class="field-validation-error text-danger" id="'+$(this)[0].id+'_error'+i+'"></span>');
                      });
           $('#tdZBMId_'+i).focus();


           currentRow.find('.edit').attr("style","display:none");
           currentRow.find('.save').attr("style","display:block");
           currentRow.find('.cancel').attr("style","display:block");
       }
    });
     $("#TeamMapSearch").on('click', '.cancel', function () {
          currentRow = $(this).closest("tr");
          //currentRow.find('td.editCell').each(function(){
          //             $(this).removeClass('edit-feild');
          //        });
          currentRow[0].cells[1].textContent=pZBMId;
          currentRow[0].cells[2].textContent=pZBMName;
          currentRow[0].cells[3].textContent=pRSMId;
          currentRow[0].cells[4].textContent=pRSMName;
          currentRow[0].cells[5].textContent=pRBEId;
          currentRow[0].cells[6].textContent=pRBEName;
          currentRow[0].cells[7].textContent=plocation;

       currentRow.find('.edit').attr("style","display:block");
       currentRow.find('.save').attr("style","display:none");
       currentRow.find('.cancel').attr("style","display:none");
       activeRow="";
     });
     $("#TeamMapSearch").on('click', '.save', function () {
         var flag="Y";
          row = $(this).closest("tr");
          var i = row[0].cells[0].textContent;
          var zbmId = $('#tdZBMId_'+i).val();
          var zbmName= $('#tdZBMName_'+i).val();
          var RSMId =  $('#tdRSMId_'+i).val();
          var RSMName = $('#tdRSMName_'+i).val();
          var RBEId = $('#tdRBEId_'+i).val();
          var RBEName = $('#tdRBEName_'+i).val();
          var location = $('#tdLocation_'+i).val();
          var teamMappingID = row[0].cells[9].textContent;
          if(zbmId.trim()==""){
              $('#tdZBMId_error'+i).html("ZBM ID is required");
              flag="N";
          }
          else{
               if(!(zbmId.match(nameWithNumCheck))){
                   $('#tdZBMId_error'+i).html("ZBM ID is Invalid");
                   flag="N";
               }
               else if(zbmId.match(onlyNumbers)){
                   $('#tdZBMId_error'+i).html("ZBM ID is Invalid");
                   flag="N";
               }
               else{
                   $('#tdZBMId_error'+i).html("");
               }
          }
          if(zbmName.trim()==""){
              $('#tdZBMName_error'+i).html("ZBM Name is required");
              flag="N";
          }
          else{
               if(!(zbmName.match(nameWithNumCheck))){
                   $('#tdZBMName_error'+i).html("ZBM Name is Invalid");
                   flag="N";
               }
               else if(zbmName.match(onlyNumbers)){
                   $('#tdZBMName_error'+i).html("ZBM Name is Invalid");
                   flag="N";
               }
               else{
                   $('#tdZBMName_error'+i).html("");
               }
          }
          if(RSMId.trim()==""){
              $('#tdRSMId_error'+i).html("RSM ID is required");
              flag="N";
          }
          else{
               if(!(RSMId.match(nameWithNumCheck))){
                   $('#tdRSMId_error'+i).html("RSM ID is Invalid");
                   flag="N";
               }
               else if(RSMId.match(onlyNumbers)){
                   $('#tdRSMId_error'+i).html("RSM ID is Invalid");
                   flag="N";
               }
               else{
                   $('#tdRSMId_error'+i).html("");
               }
          }
          if(RSMName.trim()==""){
              $('#tdRSMName_error'+i).html("RSM Name is required");
              flag="N";
          }
          else{
               if(!(RSMName.match(nameWithNumCheck))){
                   $('#tdRSMName_error'+i).html("RSM Name is Invalid");
                   flag="N";
               }
               else if(RSMName.match(onlyNumbers)){
                   $('#tdRSMName_error'+i).html("RSM Name is Invalid");
                   flag="N";
               }
               else{
                   $('#tdRSMName_error'+i).html("");
               }
          }
          if(RBEId.trim()==""){
              $('#tdRBEId_error'+i).html("RBE ID is required");
              flag="N";
          }
          else{
               if(!(RBEId.match(nameWithNumCheck))){
                   $('#tdRBEId_error'+i).html("RBE ID is Invalid");
                   flag="N";
               }
               else if(RBEId.match(onlyNumbers)){
                   $('#tdRBEId_error'+i).html("RBE ID is Invalid");
                   flag="N";
               }
               else{
                   $('#tdRBEId_error'+i).html("");
               }
          }
          if(RBEName.trim()==""){
              $('#tdRBEName_error'+i).html("RBE Name is required");
              flag="N";
          }
          else{
               if(!(RBEName.match(nameWithNumCheck))){
                   $('#tdRBEName_error'+i).html("RBE Name is Invalid");
                   flag="N";
               }
               else if(RBEName.match(onlyNumbers)){
                   $('#tdRBEName_error'+i).html("RBE Name is Invalid");
                   flag="N";
               }
               else{
                   $('#tdRBEName_error'+i).html("");
               }
          }
          if(location.trim()==""){
              $('#tdLocation_error'+i).html("Location is required");
              flag="N";
          }
          else{
               if(!(location.match(nameWithNumCheck))){
                   $('#tdLocation_error'+i).html("Location is Invalid");
                   flag="N";
               }
               else if(location.match(onlyNumbers)){
                   $('#tdLocation_error'+i).html("Location is Invalid");
                   flag="N";
               }
               else{
                   $('#tdLocation_error'+i).html("");
               }
          }
          if(flag=="Y"){
             var reqmodel={ ZBMID: zbmId, ZBMName: zbmName, RSMID: RSMId,RSMName:RSMName,RBEId:RBEId,RBEName:RBEName,Location:location,TeamMappingID:teamMappingID};
             $.ajax({
                    type: 'POST',
                    url: '@Url.Action("UpdateTeamMapping", "DtpSupport")',
                    contentType: "application/json; charset=utf-8",
                    data:JSON.stringify(reqmodel),
                    dataType: 'json',
                    success: function (data) {
                        var successMsg="",errorMsg="";
                        if(data[0].status==1)
                            successMsg=data[0].reason;
                        else if(data[0].status==0)
                            errorMsg=data[0].reason;
                        var url = '@Html.Raw(@Url.Action("TeamMapping", "DtpSupport",new {  success = "mm", error = "ee" }))';
                        url = url.replace("mm", encodeURIComponent(successMsg)).replace("ee", encodeURIComponent(errorMsg));
                        window.location.href=url;
                    },
                    error: function (ex) {
                        alert('Error.' + ex);
                    }
             });
           }
     });
     function validateText(e){
         if(activeRow!=""){
             var text=e.value;
             var id=e.id;
             var i = activeRow[0].cells[0].textContent;
             if(id=="tdZBMId_"+i){
                 if(text.trim()==""){
                      $('#tdZBMId_error'+i).html("ZBM ID is required");
                  }
                  else{
                       if(!(text.match(nameWithNumCheck))){
                            $('#tdZBMId_error'+i).html("ZBM ID is Invalid");
                       }
                       else if(text.match(onlyNumbers)){
                            $('#tdZBMId_error'+i).html("ZBM ID is Invalid");
                       }
                       else{
                            $('#tdZBMId_error'+i).html("");
                       }
                    }
              }
              if(id=="tdZBMName_"+i){
                 if(text.trim()==""){
                      $('#tdZBMName_error'+i).html("ZBM Name is required");
                  }
                  else{
                       if(!(text.match(nameWithNumCheck))){
                            $('#tdZBMName_error'+i).html("ZBM Name is Invalid");
                       }
                       else if(text.match(onlyNumbers)){
                            $('#tdZBMName_error'+i).html("ZBM Name is Invalid");
                       }
                       else{
                            $('#tdZBMName_error'+i).html("");
                       }
                    }
              }
              if(id=="tdRSMId_"+i){
                 if(text.trim()==""){
                      $('#tdRSMId_error'+i).html("RSM ID is required");
                  }
                  else{
                       if(!(text.match(nameWithNumCheck))){
                            $('#tdRSMId_error'+i).html("RSM ID is Invalid");
                       }
                       else if(text.match(onlyNumbers)){
                            $('#tdRSMId_error'+i).html("RSM ID is Invalid");
                       }
                       else{
                            $('#tdRSMId_error'+i).html("");
                       }
                    }
              }
              if(id=="tdRSMName_"+i){
                 if(text.trim()==""){
                      $('#tdRSMName_error'+i).html("RSM Name is required");
                  }
                  else{
                       if(!(text.match(nameWithNumCheck))){
                            $('#tdRSMName_error'+i).html("RSM Name is Invalid");
                       }
                       else if(text.match(onlyNumbers)){
                            $('#tdRSMName_error'+i).html("RSM Name is Invalid");
                       }
                       else{
                            $('#tdRSMName_error'+i).html("");
                       }
                    }
              }
             if(id=="tdRBEId_"+i){
                 if(text.trim()==""){
                      $('#tdRBEId_error'+i).html("RBE ID is required");
                  }
                  else{
                       if(!(text.match(nameWithNumCheck))){
                            $('#tdRBEId_error'+i).html("RBE ID is Invalid");
                       }
                       else if(text.match(onlyNumbers)){
                            $('#tdRBEId_error'+i).html("RBE ID is Invalid");
                       }
                       else{
                            $('#tdRBEId_error'+i).html("");
                       }
                    }
              }
             if(id=="tdRBEName_"+i){
                 if(text.trim()==""){
                      $('#tdRBEName_error'+i).html("RBE Name is required");
                  }
                  else{
                       if(!(text.match(nameWithNumCheck))){
                            $('#tdRBEName_error'+i).html("RBE Name is Invalid");
                       }
                       else if(text.match(onlyNumbers)){
                            $('#tdRBEName_error'+i).html("RBE Name is Invalid");
                       }
                       else{
                            $('#tdRBEName_error'+i).html("");
                       }
                    }
              }
              if(id=="tdLocation_"+i){
                 if(text.trim()==""){
                      $('#tdLocation_error'+i).html("Location is required");
                  }
                  else{
                       if(!(text.match(nameWithNumCheck))){
                            $('#tdLocation_error'+i).html("Location is Invalid");
                       }
                       else if(text.match(onlyNumbers)){
                            $('#tdLocation_error'+i).html("Location is Invalid");
                       }
                       else{
                            $('#tdLocation_error'+i).html("");
                       }
                    }
              }
          }
     }
</script>