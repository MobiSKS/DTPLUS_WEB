@model HPCL.Common.Models.ViewModel.DtpSupport.BlockUnblockCustomerCcmsAccount
@using Microsoft.AspNetCore.Http;

<div class="col-lg-12">
    <div class="bg-white p-2 p-md-4">
        <ul class="breadcrumb bread_custom bg-transparent m-0 pb-1 py-0 px-0">
            <li class="breadcrumb-item"><a href="@Url.Action("Index")" class="text_primary">DTP Support</a> </li>
            <li class="breadcrumb-item font-weight-light">Block/UnBlock Customer CCMS Account</li>
        </ul>

        <div class="w-100">
            <div class="col-lg-12 col-md-12 col-12 pl-0 pr-0">
                <div class="border-1 rounded border-grey pb-0">
                    <p class="text_primary px-3 py-2 bg-grey m-0 font-weight-bold">Block/UnBlock Customer CCMS Account</p>
                    <div class="col-lg-12 col-md-12 col-12 py-3">

                        <form id="searchCcmsAccount">

                            <fieldset class="border-1 rounded border-grey mb-3" style="padding-top:1%;padding-bottom:1%;">
                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="col-lg-6 col-12">
                                        <div class="d-flex align-items-center flex-wrap mb-3">
                                            <label class="font-weight-normal col-md-4 col-12">Customer ID <sup class="text-danger">*</sup></label>
                                            <div class="col-md-7 col-12">
                                                <div class="custom_select">
                                                    @Html.TextBoxFor(m => m.CustomerID, new { @id = "custIdVal", @class = "form-control" })
                                                    @Html.ValidationMessageFor(m => m.CustomerID, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="clearfix"></div>
                                <div class="d-flex align-items-center justify-content-center mt-0">
                                    <div class="px-2">
                                        <button class="btn btn_primary" type="button" onclick="searchCustomerCcmsAccount()">SEARCH</button>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </fieldset>

                            <div id="reason" class="mb-3 text-center" style="background-color: #a0f1d6;display:none;margin-top:10px;"></div>

                            <fieldset class="border-1 rounded border-grey mb-3" id="updateSection" style="display:none;padding-top:1%;padding-bottom:1%;">
                                <div>
                                    <div class="d-flex align-items-center flex-wrap">
                                        <div class="col-lg-6 col-12">
                                            <div class="d-flex align-items-center flex-wrap mb-3">
                                                <label class="font-weight-normal col-md-4 col-12">Customer Name</label>
                                                <div class="col-md-7 col-12">
                                                    <div class="custom_select">
                                                        <label id="CustomerName"></label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="d-flex align-items-center flex-wrap">
                                        <div class="col-lg-12 col-12">
                                            <div class="d-flex align-items-center flex-wrap mb-3">
                                                <label class="col-md-2 col-12">CCMS Sale/CCMS Reload</label>
                                                <div class="col-md-10 col-12">
                                                    <div class="form-check form-check-inline">
                                                        <input type="radio" name="CCMSBalanceStatus" value="0" /> <span class="ml-2"> Block </span>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input type="radio" name="CCMSBalanceStatus" value="1" />  <span class="ml-2"> UnBlock </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="d-flex align-items-center flex-wrap">
                                        <div class="col-lg-12 col-12">
                                            <div class="d-flex align-items-center flex-wrap mb-3">
                                                <label class="col-md-2 col-12">Remark</label>
                                                <div class="col-md-7 col-12">
                                                    <div class="custom_select">
                                                        @Html.TextAreaFor(m => m.CCMSBalanceRemarks, new { @id = "remarkVal", @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.CCMSBalanceRemarks, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="clearfix"></div>
                                    <div class="d-flex align-items-center justify-content-center mt-0">
                                        <div class="px-2">
                                            <button class="btn btn_primary" type="button" onclick = "updateCustomerCcmsAccount()">UPDATE</button>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </fieldset>

                        </form>

                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>

        <div class="clearfix"></div>
    </div>
</div>
<div class="clearfix"></div>


<script>

     function searchCustomerCcmsAccount() {

        if ($("#searchCcmsAccount").valid()) {

            var customerId = $("#custIdVal").val();

            $.ajax({
                type: 'POST',  // http method
                url: '@Url.Action("SearchCustomerCcmsAccount", "DtpSupport")',
                data: {customerId: customerId},  // data to submit
                success: function (res, status, xhr) {

                       if(res.searchResult.data[0].status == 1){

                           document.getElementById("reason").style.display = "none";

                           $("#CustomerName").html("");
                           $("#remarkVal").html("");

                           $("#CustomerName").append("<span>"+ res.searchResult.data[0].customerName +"</span>");

                           $('input[name="CCMSBalanceStatus"][value="' + res.searchResult.data[0].ccmsBalanceStatusId + '"]').prop('checked', true);

                           $("#remarkVal").val(res.searchResult.data[0].ccmsBalanceRemarks);

                           document.getElementById("updateSection").style.display = "block";

                           $("#custIdVal").attr("readonly", true);

                       }else{
                            document.getElementById("updateSection").style.display = "none";
                            $("#reason").html("");
                            $("#reason").append("<span>" + res.searchResult.data[0].reason + "</span>");
                            document.getElementById("reason").style.display = "block";
                       }

                },
                error: function (jqXhr, textStatus, errorMessage) {
                    console.log("Error");
                }
            });
        } else {
            return false;
        }
    }


     function updateCustomerCcmsAccount() {

        if ($("#searchCcmsAccount").valid()) {

            var customerId = $("#custIdVal").val();

            $.ajax({
                type: 'POST',  // http method
                url: '@Url.Action("UpdateBlockUnBlockCcmsAccount", "DtpSupport")',
                data: $("#searchCcmsAccount").serialize(),  // data to submit
                success: function (res, status, xhr) {

                    document.getElementById("updateSection").style.display = "none";
                    $("#reason").html("");
                    $("#reason").append("<span>" + res + "</span>");
                    document.getElementById("reason").style.display = "block";
                    $("#custIdVal").attr("readonly", false);

                },
                error: function (jqXhr, textStatus, errorMessage) {
                    console.log("Error");
                }
            });
        } else {
            return false;
        }
    }

</script>